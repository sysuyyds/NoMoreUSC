registerNamespace("InfoPlus.Dynamics.Parser");InfoPlus.Dynamics.Parser.Expression=(function(){if(!Object.create){Object.create=(function(){function F(){}return function(o){F.prototype=o;return new F()}})()}if(typeof Object.getPrototypeOf!=="function"){Object.getPrototypeOf="".__proto__===String.prototype?function(object){return object.__proto__}:function(object){return object.constructor.prototype}}var o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v){}return o},$V0=[1,3],$V1=[1,8],$V2=[1,12],$V3=[1,16],$V4=[1,15],$V5=[1,17],$V6=[1,13],$V7=[1,14],$V8=[1,19],$V9=[1,20],$Va=[1,21],$Vb=[1,22],$Vc=[1,23],$Vd=[1,24],$Ve=[1,25],$Vf=[1,26],$Vg=[1,27],$Vh=[1,28],$Vi=[1,29],$Vj=[1,30],$Vk=[1,31],$Vl=[5,6,7,9,10,11,12,13,14,15,16,17,18,19,25,41,43],$Vm=[1,37],$Vn=[1,57],$Vo=[1,58],$Vp=[5,6,7,25,41,43],$Vq=[5,6,7,9,10,11,12,13,14,25,41,43],$Vr=[5,6,7,9,10,11,12,13,14,15,16,25,41,43],$Vs=[5,6,7,9,10,11,12,13,14,15,16,17,18,19,25,39,41,42,43],$Vt=[25,41];var parser={trace:function trace(){},yy:{},symbols_:{error:2,expressions:3,expression:4,EOF:5,"||":6,"&&":7,"!":8,">":9,"<":10,"==":11,">=":12,"<=":13,"!=":14,"+":15,"-":16,"*":17,"/":18,"%":19,literal:20,parenthesis:21,references:22,functionCall:23,PARENTHESIS:24,CLOSE_PARENTHESIS:25,string:26,number:27,bool:28,NUMBER:29,STRING:30,BOOL:31,DOLLAR:32,ID:33,attributes:34,attribute:35,method:36,index:37,property:38,DOT:39,params:40,COMMA:41,BRACKET:42,CLOSE_BRACKET:43,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",6:"||",7:"&&",8:"!",9:">",10:"<",11:"==",12:">=",13:"<=",14:"!=",15:"+",16:"-",17:"*",18:"/",19:"%",24:"PARENTHESIS",25:"CLOSE_PARENTHESIS",29:"NUMBER",30:"STRING",31:"BOOL",32:"DOLLAR",33:"ID",39:"DOT",41:"COMMA",42:"BRACKET",43:"CLOSE_BRACKET"},productions_:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1],[4,1],[4,1],[4,2],[21,3],[20,1],[20,1],[20,1],[27,1],[27,2],[26,1],[28,1],[22,3],[22,2],[34,1],[34,2],[35,1],[35,1],[35,1],[36,2],[23,4],[23,3],[40,1],[40,3],[38,2],[37,3]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return $$[$0-1];break;case 2:case 3:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:this.$={type:"expression",expression:[$$[$0-2],$$[$0]],operator:$$[$0-1]};break;case 4:this.$={type:"expression",expression:[$$[$0]],operator:"not"};break;case 16:case 17:case 18:case 25:case 27:case 28:case 36:case 41:this.$=$$[$0];break;case 19:this.$={type:"functionCall",id:$$[$0].id,args:$$[$0].args};break;case 20:this.$={type:"expression",expression:[$$[$0]],operator:"minus"};break;case 21:this.$={type:"expression",expression:[$$[$0-1]],operator:"parenthesis"};break;case 22:this.$={type:"string",value:$$[$0]};break;case 23:this.$={type:"number",value:$$[$0]};break;case 24:this.$={type:"bool",value:$$[$0]};break;case 26:this.$="-"+$$[$0];break;case 29:this.$={type:"references",id:$$[$0-1],path:$$[$0]};break;case 30:this.$={type:"references",id:$$[$0]};break;case 31:case 39:this.$=[$$[$0]];break;case 32:this.$=[].concat($$[$0-1],$$[$0]);break;case 33:this.$={type:"method",id:$$[$0].id,args:$$[$0].args};break;case 34:this.$={type:"index",id:$$[$0]};break;case 35:this.$={type:"property",id:$$[$0]};break;case 37:this.$={id:$$[$0-3],args:$$[$0-1]};break;case 38:this.$={id:$$[$0-2],args:undefined};break;case 40:this.$=[].concat($$[$0-2],$$[$0]);break;case 42:this.$=$$[$0-1];break}},table:[{3:1,4:2,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{1:[3]},{5:[1,18],6:$V8,7:$V9,9:$Va,10:$Vb,11:$Vc,12:$Vd,13:$Ve,14:$Vf,15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk},{4:32,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},o($Vl,[2,16]),o($Vl,[2,17]),o($Vl,[2,18]),o($Vl,[2,19]),{21:33,24:$V2,29:[1,34]},o($Vl,[2,22]),o($Vl,[2,23]),o($Vl,[2,24]),{4:35,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{33:[1,36]},{24:$Vm},o($Vl,[2,27]),o($Vl,[2,25]),o($Vl,[2,28]),{1:[2,1]},{4:38,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:39,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:40,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:41,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:42,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:43,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:44,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:45,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:46,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:47,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:48,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:49,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{4:50,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},o($Vl,[2,4]),o($Vl,[2,20]),o($Vl,[2,26]),{6:$V8,7:$V9,9:$Va,10:$Vb,11:$Vc,12:$Vd,13:$Ve,14:$Vf,15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk,25:[1,51]},o($Vl,[2,30],{34:52,35:53,36:54,37:55,38:56,39:$Vn,42:$Vo}),{4:61,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,25:[1,60],26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7,40:59},o($Vp,[2,2],{9:$Va,10:$Vb,11:$Vc,12:$Vd,13:$Ve,14:$Vf,15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk}),o($Vp,[2,3],{9:$Va,10:$Vb,11:$Vc,12:$Vd,13:$Ve,14:$Vf,15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk}),o($Vq,[2,5],{15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk}),o($Vq,[2,6],{15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk}),o($Vq,[2,7],{15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk}),o($Vq,[2,8],{15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk}),o($Vq,[2,9],{15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk}),o($Vq,[2,10],{15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk}),o($Vr,[2,11],{17:$Vi,18:$Vj,19:$Vk}),o($Vr,[2,12],{17:$Vi,18:$Vj,19:$Vk}),o($Vl,[2,13]),o($Vl,[2,14]),o($Vl,[2,15]),o($Vl,[2,21]),o($Vl,[2,29],{36:54,37:55,38:56,35:62,39:$Vn,42:$Vo}),o($Vs,[2,31]),o($Vs,[2,33]),o($Vs,[2,34]),o($Vs,[2,35]),{23:63,33:[1,64]},{4:65,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},{25:[1,66],41:[1,67]},o($Vs,[2,38]),o($Vt,[2,39],{6:$V8,7:$V9,9:$Va,10:$Vb,11:$Vc,12:$Vd,13:$Ve,14:$Vf,15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk}),o($Vs,[2,32]),o($Vs,[2,36]),o($Vs,[2,41],{24:$Vm}),{6:$V8,7:$V9,9:$Va,10:$Vb,11:$Vc,12:$Vd,13:$Ve,14:$Vf,15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk,43:[1,68]},o($Vs,[2,37]),{4:69,8:$V0,16:$V1,20:4,21:5,22:6,23:7,24:$V2,26:9,27:10,28:11,29:$V3,30:$V4,31:$V5,32:$V6,33:$V7},o($Vs,[2,42]),o($Vt,[2,40],{6:$V8,7:$V9,9:$Va,10:$Vb,11:$Vc,12:$Vd,13:$Ve,14:$Vf,15:$Vg,16:$Vh,17:$Vi,18:$Vj,19:$Vk})],defaultActions:{18:[2,1]},parseError:function parseError(str,hash){if(hash.recoverable){this.trace(str)}else{var error=new Error(str);error.hash=hash;throw error}},parse:function parse(input){var self=this,stack=[0],tstack=[],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1;var args=lstack.slice.call(arguments,1);var lexer=Object.create(this.lexer);var sharedState={yy:{}};for(var k in this.yy){if(Object.prototype.hasOwnProperty.call(this.yy,k)){sharedState.yy[k]=this.yy[k]}}lexer.setInput(input,sharedState.yy);sharedState.yy.lexer=lexer;sharedState.yy.parser=this;if(typeof lexer.yylloc=="undefined"){lexer.yylloc={}}var yyloc=lexer.yylloc;lstack.push(yyloc);var ranges=lexer.options&&lexer.options.ranges;if(typeof sharedState.yy.parseError==="function"){this.parseError=sharedState.yy.parseError}else{this.parseError=Object.getPrototypeOf(this).parseError}function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}_token_stack:var lex=function(){var token;token=lexer.lex()||EOF;if(typeof token!=="number"){token=self.symbols_[token]||token}return token};var symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;while(true){state=stack[stack.length-1];if(this.defaultActions[state]){action=this.defaultActions[state]}else{if(symbol===null||typeof symbol=="undefined"){symbol=lex()}action=table[state]&&table[state][symbol]}if(typeof action==="undefined"||!action.length||!action[0]){var errStr="";expected=[];for(p in table[state]){if(this.terminals_[p]&&p>TERROR){expected.push("'"+this.terminals_[p]+"'")}}if(lexer.showPosition){errStr="Parse error on line "+(yylineno+1)+":\n"+lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'"}else{errStr="Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==EOF?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'")}this.parseError(errStr,{text:lexer.match,token:this.terminals_[symbol]||symbol,line:lexer.yylineno,loc:yyloc,expected:expected})}if(action[0] instanceof Array&&action.length>1){throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol)}switch(action[0]){case 1:stack.push(symbol);vstack.push(lexer.yytext);lstack.push(lexer.yylloc);stack.push(action[1]);symbol=null;if(!preErrorSymbol){yyleng=lexer.yyleng;yytext=lexer.yytext;yylineno=lexer.yylineno;yyloc=lexer.yylloc;if(recovering>0){recovering--}}else{symbol=preErrorSymbol;preErrorSymbol=null}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};if(ranges){yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]}r=this.performAction.apply(yyval,[yytext,yyleng,yylineno,sharedState.yy,action[1],vstack,lstack].concat(args));if(typeof r!=="undefined"){return r}if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return true}}return true}};var lexer=(function(){var lexer=({EOF:1,parseError:function parseError(str,hash){if(this.yy.parser){this.yy.parser.parseError(str,hash)}else{throw new Error(str)}},setInput:function(input,yy){this.yy=yy||this.yy||{};this._input=input;this._more=this._backtrack=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges){this.yylloc.range=[0,0]}this.offset=0;return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges){this.yylloc.range[1]++}this._input=this._input.slice(1);return ch},unput:function(ch){var len=ch.length;var lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(lines.length-1){this.yylineno-=lines.length-1}var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len};if(this.options.ranges){this.yylloc.range=[r[0],r[0]+this.yyleng-len]}this.yyleng=this.yytext.length;return this},more:function(){this._more=true;return this},reject:function(){if(this.options.backtrack_lexer){this._backtrack=true}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}return this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;if(next.length<20){next+=this._input.substr(0,20-next.length)}return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput();var c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},test_match:function(match,indexed_rule){var token,lines,backup;if(this.options.backtrack_lexer){backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};if(this.options.ranges){backup.yylloc.range=this.yylloc.range.slice(0)}}lines=match[0].match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno+=lines.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._backtrack=false;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input){this.done=false}if(token){return token}else{if(this._backtrack){for(var k in backup){this[k]=backup[k]}return false}}return false},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var token,match,tempMatch,index;if(!this._more){this.yytext="";this.match=""}var rules=this._currentRules();for(var i=0;i<rules.length;i++){tempMatch=this._input.match(this.rules[rules[i]]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(this.options.backtrack_lexer){token=this.test_match(tempMatch,rules[i]);if(token!==false){return token}else{if(this._backtrack){match=false;continue}else{return false}}}else{if(!this.options.flex){break}}}}if(match){token=this.test_match(match,rules[index]);if(token!==false){return token}return false}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function lex(){var r=this.next();if(r){return r}else{return this.lex()}},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){var n=this.conditionStack.length-1;if(n>0){return this.conditionStack.pop()}else{return this.conditionStack[0]}},_currentRules:function _currentRules(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}else{return this.conditions.INITIAL.rules}},topState:function topState(n){n=this.conditionStack.length-1-Math.abs(n||0);if(n>=0){return this.conditionStack[n]}else{return"INITIAL"}},pushState:function pushState(condition){this.begin(condition)},stateStackSize:function stateStackSize(){return this.conditionStack.length},options:{},performAction:function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:this.begin("ref");break;case 1:this.begin("fb");return 33;break;case 2:break;case 3:return 29;break;case 4:return yy_.yytext;break;case 5:return yy_.yytext;break;case 6:return yy_.yytext;break;case 7:return yy_.yytext;break;case 8:return yy_.yytext;break;case 9:return yy_.yytext;break;case 10:return yy_.yytext;break;case 11:return yy_.yytext;break;case 12:return yy_.yytext;break;case 13:return"EQUAL";break;case 14:return 31;break;case 15:return 31;break;case 16:return 31;break;case 17:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\'/g,"'");return 30;break;case 18:yy_.yytext=yy_.yytext.substr(1,yy_.yyleng-2).replace(/\\"/g,'"');return 30;break;case 19:return 32;break;case 20:return 33;break;case 21:return 39;break;case 22:this.popState();return 41;break;case 23:return 41;break;case 24:this.begin("b");return 42;break;case 25:this.popState();return 43;break;case 26:this.begin("func");return 24;break;case 27:return 24;break;case 28:return 25;break;case 29:this.begin("p");return 24;break;case 30:this.popState();return 25;break;case 31:this.popState();this.popState();return 25;break;case 32:this.popState();break;case 33:this.popState();break;case 34:this.popState();return 5;break;case 35:return 5;break}},rules:[/^(?:[.]*?(?=\$))/,/^(?:[a-zA-Z][a-zA-Z_]*?(?=\())/,/^(?:\s+)/,/^(?:[0-9]+(\.[0-9]+)?\b)/,/^(?:[%\+\-\*/])/,/^(?:<=)/,/^(?:>=)/,/^(?:[><])/,/^(?:==)/,/^(?:\|\|)/,/^(?:&&)/,/^(?:!=)/,/^(?:!)/,/^(?:=)/,/^(?:null\b)/,/^(?:false\b)/,/^(?:true\b)/,/^(?:'(\\'|[^\'])*')/,/^(?:"(\\"|[^\"])*")/,/^(?:\$(?=[a-zA-Z_]))/,/^(?:[_a-zA-Z][a-zA-Z0-9_]*)/,/^(?:\.)/,/^(?:,[ ]*)/,/^(?:,[ ]*)/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\()/,/^(?:\))/,/^(?:\()/,/^(?:\))/,/^(?:\))/,/^(?:\s+)/,/^(?:(?=.))/,/^(?:$)/,/^(?:$)/],conditions:{ref:{rules:[4,19,20,21,22,24,29,32,33,34],inclusive:false},b:{rules:[0,1,2,3,4,17,18,24,25,27,28],inclusive:false},p:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,23,24,29,30],inclusive:false},func:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,23,29,31,34],inclusive:false},fb:{rules:[26],inclusive:false},INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,27,28,35],inclusive:true}}});return lexer})();parser.lexer=lexer;function Parser(){this.yy={}}Parser.prototype=parser;parser.Parser=Parser;return new Parser})();
registerNamespace("InfoPlus.Dynamics.Parser");InfoPlus.Dynamics.Parser.Compile=function(asts,functions){this.asts=asts;this.functions=functions||InfoPlus.Dynamics.Functions};InfoPlus.Dynamics.Parser.Compile.prototype={asts:null,context:null,evaluate:function(context,targetObject){this.context=(context!==undefined)?context:{};if(targetObject!==undefined){this.targetObject=targetObject}try{return this.getExpression(this.asts)}catch(err){var txt="Error occur while evaluating the dynamic expression.\n\n";txt+="Error description: "+err.message+"\n\n";txt+="Click OK to continue.\n\n";alert(txt)}return null},getReferenceNameArray:function(){this.references={};this.getRef(this.asts);var ret=[];for(var key in this.references){if(this.references.hasOwnProperty(key)){ret.push(key)}}return ret},getRef:function(ast){var exp=ast.expression;var type=ast.type;if(type==="expression"){switch(ast.operator){case"+":case"-":case"/":case"%":case"*":case"||":case"&&":case">":case"<":case"==":case">=":case"<=":case"!=":this.getRef(exp[0]);this.getRef(exp[1]);break;case"minus":case"not":case"parenthesis":this.getRef(exp[0]);break;default:}}else{if(type==="references"){if(this.references[ast.id]===undefined){this.references[ast.id]=null}if(ast.path!==undefined){for(var i=0;i<ast.path.length;i++){var property=ast.path[i];if(property.type==="index"){var indexAst=property.id;if(indexAst.type==="references"){this.getRef(indexAst)}}else{if(property.type==="method"){if(property.args!==undefined){for(var argIndex=0;argIndex<property.args.length;argIndex++){var arg=property.args[argIndex];if(arg.type==="references"){this.getRef(arg)}}}}}}}}else{if(type==="functionCall"){if(ast.args!==undefined){for(var j=0;j<ast.args.length;j++){this.getRef(ast.args[j])}}}}}},isArray:function(obj){return Object.prototype.toString.call(obj)==="[object Array]"},getArrayExpression:function(expression1,expression2,operator){var ret=[],i,len;if(this.isArray(expression1)){if(this.isArray(expression2)){len=Math.min(expression1.length,expression2.length);for(i=0;i<len;i++){ret[i]=this.getArrayExpression(expression1[i],expression2[i],operator)}}else{for(i=0,len=expression1.length;i<len;i++){ret[i]=this.getArrayExpression(expression1[i],expression2,operator)}}}else{if(this.isArray(expression2)){for(i=0,len=expression2.length;i<len;i++){ret[i]=this.getArrayExpression(expression1,expression2[i],operator)}}else{ret=this.getExpressByValue(expression1,expression2,operator)}}return ret},getExpressByValue:function(value1,value2,operator){var ret;if(value1!=null&&value1.hasOwnProperty("value")){value1=value1.value}if(value2!=null&&value2.hasOwnProperty("value")){value2=value2.value}switch(operator){case"+":ret=value1+value2;break;case"-":ret=value1-value2;break;case"/":ret=value1/value2;break;case"%":ret=value1%value2;break;case"*":ret=value1*value2;break;case"||":ret=value1||value2;break;case"&&":ret=value1&&value2;break;case">":ret=value1>value2;break;case"<":ret=value1<value2;break;case"==":ret=value1==value2;break;case">=":ret=value1>=value2;break;case"<=":ret=value1<=value2;break;case"!=":ret=value1!=value2;break;case"minus":ret=-value1;break;case"not":ret=!value1;break}return ret},getExpression:function(ast){var exp=ast.expression;var ret;switch(ast.type){case"expression":var exp0=this.getExpression(exp[0]);var exp1=(exp[1]!==undefined)?this.getExpression(exp[1]):undefined;switch(ast.operator){case"+":case"-":case"/":case"%":case"*":case"||":case"&&":case">":case"<":case"==":case">=":case"<=":case"!=":if(this.isArray(exp0)||this.isArray(exp1)){ret=this.getArrayExpression(exp0,exp1,ast.operator)}else{ret=this.getExpressByValue(exp0,exp1,ast.operator)}break;case"minus":if(this.isArray(exp0)){ret=this.getArrayExpression(exp0,undefined,ast.operator)}else{ret=-exp0}break;case"not":if(this.isArray(exp0)){ret=this.getArrayExpression(exp0,undefined,ast.operator)}else{ret=!exp0}break;case"parenthesis":ret=this.getExpression(exp[0]);break;default:return undefined}return ret;case"string":var v=ast.value;if(v!=null){v=v.replace(/\\n/g,"\n").replace(/\\'/g,"'").replace(/\\"/g,'"').replace(/\\\\/g,"\\")}return v;case"number":return Number(ast.value);case"bool":if(ast.value==="null"){return null}else{return(ast.value==="true")}case"references":return this.getReferences(ast);case"functionCall":return this.getFunctionCall(ast);default:return undefined}},getLiteral:function(literal){var type=literal.type;var ret="";if(type==="string"){ret=literal.value}else{if(type==="number"){ret=Number(literal.value)}else{if(type==="bool"){if(literal.value==="null"){ret=null}else{if(literal.value==="false"){ret=false}else{if(literal.value==="true"){ret=true}}}}else{return this.getReferences(literal)}}}return ret},getReferences:function(ast){var context=this.context;var ret=context[ast.id];if(ast.path!==undefined&&ret!==undefined){for(var i=0;i<ast.path.length;i++){var property=ast.path[i];ret=this.getAttributes(property,ret);if(ret===undefined){break}}}return ret},getAttributes:function(property,baseRef){var type=property.type;var ret;var id=property.id;if(type==="method"){ret=this.getPropMethod(property,baseRef)}else{if(type==="property"){if(this.isArray(baseRef)){ret=[];for(var i=0,len=baseRef.length;i<len;i++){ret[i]=this.getAttributes(property,baseRef[i])}}else{ret=baseRef[id]}}else{ret=this.getPropIndex(property,baseRef)}}return ret},getFunctionCall:function(ast){var func,globalFunctionCall=false;if(this.targetObject===undefined){func=this.functions[ast.id];globalFunctionCall=true}else{func=this.targetObject[ast.id];if(!func||(typeof func!=="function")){func=this.functions[ast.id];globalFunctionCall=true}}var args=[];if(ast.args!==undefined){for(var i=0;i<ast.args.length;i++){args.push(this.getExpression(ast.args[i]))}}if(func&&func.call){if(globalFunctionCall){return func.apply(this.context,args)}else{return func.apply(this.targetObject,args)}}return undefined},getPropMethod:function(property,baseRef){var id=property.id;var ret=baseRef[id];var args=[];if(property.args!==undefined){for(var i=0;i<property.args.length;i++){args.push(this.getExpression(property.args[i]))}}if(ret&&ret.call){ret=ret.apply(baseRef,args)}else{ret=undefined}return ret},getPropIndex:function(property,baseRef){var ast=property.id;var key;key=this.getExpression(ast);var ret;ret=baseRef[key];return ret}};
(function(window,undefined){var coreControl=function(control){this.control=control};coreControl.TYPE_BOUNDABLE="boundable";coreControl.TYPE_REPEATABLE="repeatable";coreControl.TYPE_VIEW="view";coreControl.prototype={control:null,type:coreControl.TYPE_BOUNDABLE,getGuid:function(){if(this.control==null){return null}return this.control.guid},getId:function(){if(this.control==null){return null}return this.control.getId()},getName:function(){if(this.control==null){return null}return $(this.control.element).attr("name")},getPath:function(){if(this.control==null){return null}return this.control.path},setValue:function(value){},getValue:function(){},setStyle:function(name,value){},getStyle:function(name){return null},registerEvent:function(type,data,handler){},unRegisterEvent:function(type,handler){},triggerEvent:function(type){},validate:function(){},isReadable:function(){},isWritable:function(){},isEditable:function(){},callMethod:function(){if(arguments.length===0){return}var methodName=arguments[0];if(typeof this[methodName]==="function"){var params=[];for(var i=1,len=arguments.length;i<len;i++){params.push(arguments[i])}this[methodName].apply(this,params)}},processDynamicParams:function(params){if(params instanceof InfoPlus.Dynamics.Params){return params.params[0]}return params}};define("InfoPlus.Core.CoreControl",coreControl)})(window);
(function(window,undefined){var coreBoundControl=function(control){this.type=InfoPlus.Core.CoreControl.TYPE_BOUNDABLE;InfoPlus.Core.CoreControl.call(this,control)};coreBoundControl.prototype=$.extend(new InfoPlus.Core.CoreControl(),{setValue:function(value){if(this.control==null||!this.control.isWritable()){return}if(value!=null){var attributes=value.expando||value.attributes;if(value instanceof InfoPlus.Controls.Data.ValuePair){this.control.setValue(value.value,value.displayValue,$$.params.initializing,attributes);return}if(value instanceof InfoPlus.Controls.Data.Uri){this.control.setValue(value.value);return}if(value.hasOwnProperty("value")&&value.hasOwnProperty("displayValue")){this.control.setValue(value.value,value.displayValue,$$.params.initializing,attributes);return}if(value.hasOwnProperty("codeId")&&value.hasOwnProperty("codeName")){this.control.setValue(value.codeId,value.codeName,$$.params.initializing,attributes);return}}this.control.setValue(value)},getValue:function(){if(this.control==null||!this.control.isReadable()){return null}return this.control.getValue()},getAttributes:function(){if(this.control==null||!this.control.isReadable()){return null}return this.control.getAttributes()},validate:function(){if(this.control==null){return true}return $IU.checkControlValidation([this.control],true,true)},registerEvent:function(type,data,handler){$(this.control.element).on(type,data,handler)},unRegisterEvent:function(type,handler){$(this.control.element).off(type,handler)},trigger:function(type){$(this.control.element).trigger(type)},isReadable:function(){return this.control.isReadable()},isWritable:function(){return this.control.isWritable()},isEditable:function(){return this.control.isEditable()},getDataSource:function(){return this.control.getDataSource()},setStyle:function(name,value){if(this.control==null||!this.control.isReadable()){return}this.control.setStyle(name,value)},getStyle:function(name){if(this.control==null){return null}return this.control.getStyle(name)},setFocus:function(){if(this.control==null||!this.control.isReadable()){return}this.control.setFocus()},lostFocus:function(){if(this.control==null||!this.control.isReadable()){return}this.control.lostFocus()},setOptions:function(items){if(this.control==null){return}if(typeof this.control.setOptions==="function"){this.control.setOptions(this.control.element,items)}},setParentValue:function(parentValue,fromInit){if(this.control==null||!this.control.isWritable()){return}this.control.setParentValue(parentValue,fromInit)},setDataSource:function(dataSource,fromInit){if(this.control==null){return}if(typeof this.control.setDataSource==="function"){this.control.setDataSource(dataSource,fromInit)}},visible:function(isVisible,fromInit){if(this.control==null){return}this.control.visible(isVisible,fromInit)},rowVisible:function(isVisible,fromInit){if(this.control==null){return}var $row=this.control.getRow();if(!$row.is("tr")){if($row.hasClass("infoplus_view")){var view=$row.data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT);if(view!=null){view.visible(isVisible,fromInit)}}else{if(isVisible){$IU.dynamicShowElement($row)}else{$IU.dynamicHideElement($row)}}}else{$IU.processTrRowVisible($row,isVisible,fromInit)}},colVisible:function(isVisible,fromInit){if(this.control==null){return}var $controlElement=$(this.control.element),$parents=$controlElement.parents(".infoplus_repeatParentElement"),repeatTableControl=null;for(var i=0,len=$parents.length;i<len;i++){var repeatControl=$($parents[i]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(repeatControl.repeatType===InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE){repeatTableControl=repeatControl;break}}if(repeatTableControl!=null){var $td=$($controlElement.parents("td")[0]),index=$td.parent().children("td").index($td);if(index!==-1){repeatTableControl.setColumnVisible(index,isVisible)}}},readOnly:function(isReadOnly,fromInit){if(this.control==null||this.control.isReadOnly()){return}isReadOnly=this.processDynamicParams(isReadOnly);if(isReadOnly){this.control.setReadOnly()}else{this.control.element.readOnly=false;this.control.element.disabled=false;$(this.control.element).removeClass($Control.CLASSNAME_READONLY).removeClass("disabled")}this.control.setDynamicReadOnly(isReadOnly,fromInit);this.control.dynamicReadonly=isReadOnly},tooltip:function(tooltip){if(this.control==null){return}this.control.setTooltip(tooltip)}});define("InfoPlus.Core.CoreBoundControl",coreBoundControl)})(window);
(function(window,undefined){var coreRepeatControl=function(control){this.type=InfoPlus.Core.CoreControl.TYPE_REPEATABLE;InfoPlus.Core.CoreControl.call(this,control)};coreRepeatControl.prototype=$.extend(new InfoPlus.Core.CoreControl(),{getId:function(){if(this.control==null){return null}return this.control.repeatParentElement.id},getName:function(){if(this.control==null){return null}return $(this.control.repeatParentElement).attr("name")},setValue:function(value){if(this.control===null){return}this.control.setData(value)},setStyle:function(name,value){$IU.setDynamicStyle(this.control.repeatParentElement,name,value)},getStyle:function(name){return $IU.getElementStyle(this.control.repeatParentElement,name)},getValueByParentElement:function(parentElement,repeatPath){var result={};var pathSartWithRepeatPath=function(comparePath){return comparePath.substr(0,repeatPath.length)===repeatPath};var getPathArray=function(originPath){var pathArray=originPath.substr(repeatPath.length).split("_");pathArray.splice(0,1);return pathArray};var convertValue=function(value){if(value instanceof $Controls.Data.Uri){return value.value}if(value instanceof $Controls.Data.ValuePair){return{codeId:value.value,codeName:value.displayValue}}return value};var convertFieldName=function(name){if(name.substr(0,5).toLowerCase()==="field"){return name.substr(5,1).toLowerCase()+name.substring(6)}else{return name.substr(0,1).toLowerCase()+name.substring(1)}};var convertGroupName=function(name){if(name.substr(0,5).toLowerCase()==="group"){return name.substr(5,1).toLowerCase()+name.substring(6)}else{return name.substr(0,1).toLowerCase()+name.substring(1)}};var initObj=function(obj,groupArray,pathArray){var groups=groupArray.slice(groupArray.length-pathArray.length);for(var index=0,length=groups.length;index<length;index++){var groupName=convertGroupName(groups[index]),objLen=parseInt(pathArray[index],10)+1,groupObj=obj[groupName];if(groupObj==null){groupObj=[];obj[groupName]=groupObj}if(groupObj.length<objLen){var pos=groupObj.length;while(pos<objLen){groupObj[pos++]={}}}obj=groupObj[objLen-1]}return obj};var setValue=function(obj,groupArray,pathArray,fldName,value){obj=initObj(obj,groupArray,pathArray);obj[fldName]=convertValue(value)};var setGroup=function(obj,groupArray,pathArray,groupName){obj=initObj(obj,groupArray,pathArray);if(obj[groupName]===undefined){obj[groupName]=[]}};var fields=infoCore.getFields();$(parentElement).find("."+$Control.CLASSNAME_CONTROL).each(function(){var $element=$(this),path=$element.data($Control.DATA_PATH),fieldName=$element.data($Control.DATA_FIELD),control=$element.data($Control.DATA_CONTROL_OBJECT);if(fieldName!=null&&control!=null){if(pathSartWithRepeatPath(path)){var field=fields[fieldName],val=control.getValue(),groupArray=field.groupArray;if(val!=null){if(path===repeatPath){result[convertFieldName(field.name)]=convertValue(val)}else{setValue(result,groupArray,getPathArray(path),convertFieldName(field.name),val)}}}}});$(parentElement).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var $element=$(this),repeatControl=$element.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(repeatControl!=null){var path=repeatControl.path,groupName=repeatControl.groupName,groupArray=repeatControl.fullGroupName.split("//");groupArray.splice(groupArray.length-1,1);if(path===repeatPath){if(result[convertGroupName(groupName)]===undefined){result[convertGroupName(groupName)]=[]}}else{setGroup(result,groupArray,getPathArray(path),convertGroupName(groupName))}}});if(repeatPath===this.control.path){result=result[convertGroupName(this.control.groupName)];if(result===undefined){result=[]}}return result},getValue:function(){if(this.control==null){return null}if(this.control.power.readPower===true){return this.getValueByParentElement(this.control.repeatContentParentElement,this.control.path)}else{return[]}},getAttributes:function(){return null},validate:function(){if(this.control==null){return true}var controls=$(this.control.repeatContentParentElement).find("*[class*='validate']").filter($IU.isValidateControlFilter);return $IU.checkControlValidation(controls,true,true)},registerEvent:function(type,data,handler){$(this.control.repeatParentElement).on(type,data,handler)},unRegisterEvent:function(type,handler){$(this.control.repeatParentElement).off(type,handler)},trigger:function(type){$(this.control.repeatParentElement).trigger(type)},isReadable:function(){return this.control.power.readPower},isWritable:function(){return this.control.power.writePower},addRow:function(insertAfterIndex,rowData){var repeatControl=this.control;if(repeatControl==null){return}if(repeatControl.power.insertPower===false){return}if(insertAfterIndex===undefined&&rowData===undefined){repeatControl.addRepeat(null,null,true,false,false,false);return}if(typeof insertAfterIndex==="object"){rowData=insertAfterIndex;insertAfterIndex=null}else{var insertAfterChild=repeatControl.getRepeatChild(insertAfterIndex);if(insertAfterChild!=null){repeatControl.popupMenu.repeatSection=insertAfterChild}}var index=insertAfterIndex==null?repeatControl.getRepeatChildren().length:insertAfterIndex+1;repeatControl.addRepeat(null,null,true,false,false,false);if(rowData!==undefined){this.setRowData(index,rowData)}},deleteRow:function(index){if(index==null){return}var repeatControl=this.control;if(repeatControl==null){return}if(repeatControl.power.deletePower===false){return}var deleteChild=repeatControl.getRepeatChild(index);if(deleteChild!=null){repeatControl.deleteRepeat(deleteChild,true)}},setRowData:function(index,rowData){if(this.control==null){return}var path=this.control.path+"_"+index;$IU.setFormData(rowData,path,false)},getRowData:function(index){if(this.control==null){return null}var child=this.control.getRepeatChild(index);if(child!=null){return this.getValueByParentElement(child,this.control.path+"_"+index)}return null},moveRow:function(oldIndex,newIndex){if(this.control==null){return}var repeatControl=this.control;if(repeatControl.power.writePower===false){return}repeatControl.moveRow(oldIndex,newIndex)},sortColumn:function(columnIndex,sortType){if(this.control==null){return}this.control.sorter.sortColumn(columnIndex,sortType)},getChildren:function(){return this.control.getRepeatChildren()},readOnly:function(isReadOnly,fromInit){if(this.control==null){return}var repeatControl=this.control;repeatControl.readOnly=isReadOnly;if(repeatControl.repeatAddLink==null){return}if(repeatControl.shouldShowAddLink()){repeatControl.repeatAddLink.showLink()}else{repeatControl.repeatAddLink.hideLink()}},visible:function(isVisible,fromInit){var $repeat=$(this.control.repeatParentElement);if(isVisible){$repeat.show()}else{$repeat.hide()}},rowVisible:function(isVisible,fromInit){if(this.control==null){return}var $row=this.control.getRow();if(!$row.is("tr")){if($row.hasClass("infoplus_view")){var view=$row.data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT);if(view!=null){view.visible(isVisible,fromInit)}}else{if(isVisible){$IU.dynamicShowElement($row)}else{$IU.dynamicHideElement($row)}}}else{$IU.processTrRowVisible($row,isVisible,fromInit)}},colVisible:function(isVisible,fromInit){if(this.control==null){return}var $controlElement=$(this.control.repeatParentElement),$parents=$controlElement.parents(".infoplus_repeatParentElement"),repeatTableControl=null;for(var i=0,len=$parents.length;i<len;i++){var repeatControl=$($parents[i]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(repeatControl.repeatType===InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE){repeatTableControl=repeatControl;break}}if(repeatTableControl!=null){var $td=$($controlElement.parents("td")[0]),index=$td.parent().children("td").index($td);if(index!==-1){repeatTableControl.setColumnVisible(index,isVisible)}}},itemVisible:function(isVisible,rowIndex,fromInit){var children=this.control.getRepeatChildren();if(rowIndex>=0&&rowIndex<children.length){var $row=$(children[rowIndex]);if(isVisible===true){if(fromInit){$IU.dynamicShowElement($row)}else{$IU.dynamicShowElement($row,"slow")}}else{$IU.dynamicHideElement($row)}}},itemReadOnly:function(isReadOnly,rowIndex,fromInit){var groupName=this.control.fullGroupName;var children=this.control.getRepeatChildren();if(rowIndex>=0&&rowIndex<children.length){var $row=$(children[rowIndex]);$row.data("isReadOnly",!!isReadOnly);$row.find(".infoplus_control").each(function(){var control=$(this).data("controlObject");if(control!=null){if(control.field.groupName===groupName){$$(control).readOnly(!!isReadOnly,fromInit)}}})}}});define("InfoPlus.Core.CoreRepeatControl",coreRepeatControl)})(window);
(function(window,undefined){var coreViewControl=function(view){this.type=InfoPlus.Core.CoreControl.TYPE_VIEW;InfoPlus.Core.CoreControl.call(this,view)};coreViewControl.prototype=$.extend(new InfoPlus.Core.CoreControl(),{getId:function(){if(this.control==null){return null}return this.control.element.id},getName:function(){if(this.control==null){return null}return $(this.control.element).attr("name")},getPath:function(){return""},setStyle:function(name,value){if(this.control==null){return}$IU.setDynamicStyle(this.control.element,name,value)},getStyle:function(name){if(this.control==null){return null}return $IU.getElementStyle(this.control.element,name)},getValue:function(){return null},getAttributes:function(){return null},validate:function(){if(this.control==null){return true}var controls=$(this.control.element).find("*[class*='validate']").filter($IU.isValidateControlFilter);return $IU.checkControlValidation(controls,true,true)},registerEvent:function(type,data,handler){$(this.control.element).on(type,data,handler)},unRegisterEvent:function(type,handler){$(this.control.element).off(type,handler)},trigger:function(type){$(this.control.element).trigger(type)},visible:function(isVisible,fromInit){if(this.control==null){return}this.control.visible(isVisible,fromInit)},expanded:function(isExpanded,fromInit){if(this.control==null){return}this.control.expanded(isExpanded,fromInit)},rowVisible:function(isVisible,fromInit){this.visible(isVisible,fromInit)},readOnly:function(isReadOnly,fromInit){if(this.control==null){return}}});define("InfoPlus.Core.CoreViewControl",coreViewControl)})(window);
(function(window,undefined){var codeManager=function(){};codeManager.prototype={requestMap:{},getCodes:function(){return $$.entity.codes},getCode:function(name){if($$.entity.codes==null){return null}else{return $$.entity.codes[name]}},addRequestCode:function(code,field){if(this.requestMap[code]===undefined){this.requestMap[code]=[field]}else{var fields=this.requestMap[code];if(!$IU.arrayContains(fields,field)){fields.push(field)}}},requestCodes:function(){var map=this.requestMap;for(var code in map){if(map.hasOwnProperty(code)){(function(requestCode){var data={prefix:"",type:"Code",code:requestCode,parent:"",isTopLevel:true,pageNo:0,pageSize:65534,rand:Math.random()*999,settings:"{}"};$$.ajax({type:"POST",url:$$.params.formRender.suggestService,data:data,needParse:false,showParseErrMsg:false,showAjaxErrMsg:false,addFormParam:true}).done(function(data){var codes=$$.entity.codes,codeObject=codes[requestCode];if(codeObject!=null&&$IU.isArray(codeObject.items)&&codeObject.items.length>0){return}var fields=map[requestCode];if($IU.isArray(fields)){for(var i=0,len=fields.length;i<len;i++){var field=fields[i];$$("&"+field).options(data)}}if(codeObject==null){codeObject={};codes[requestCode]=codeObject}codeObject.items=data.items;if(map.hasOwnProperty(requestCode)){delete map[requestCode]}})})(code)}}}};define("InfoPlus.CodeManager",codeManager)})(window);
(function($,window,undefined){var document=window.document;var infoCore=function(selector){return new infoCore.fn.init(selector)};var slice=Array.prototype.slice;infoCore.fn=infoCore.prototype={constructor:infoCore,selector:"",length:0,toArray:function(){return slice.call(this,0)},init:function(selector){if(selector instanceof InfoPlus.Controls.Control){this[0]=new InfoPlus.Core.CoreBoundControl(selector);this.length=1;return this}if(selector instanceof InfoPlus.Repeat.RepeatControl){this[0]=new InfoPlus.Core.CoreRepeatControl(selector);this.length=1;return this}if(selector instanceof InfoPlus.Layout.View){this[0]=new InfoPlus.Core.CoreViewControl(selector);this.length=1;return this}if(selector instanceof InfoPlus.Core.CoreControl){this[0]=selector;this.length=1;return this}if($.isArray(selector)){var controls=selector,index=0;for(var i=0,len=controls.length;i<len;i++){var control=controls[i];if(control instanceof InfoPlus.Controls.Control){this[index++]=new InfoPlus.Core.CoreBoundControl(control);continue}if(control instanceof InfoPlus.Repeat.RepeatControl){this[index++]=new InfoPlus.Core.CoreRepeatControl(control);continue}if(control instanceof InfoPlus.Layout.View){this[index++]=new InfoPlus.Core.CoreViewControl(control);continue}if(control instanceof InfoPlus.Core.CoreControl){this[index++]=control}}this.length=index;return this}if(typeof selector==="string"){var reg=/&([a-zA-Z]+[a-zA-Z\d]*)/g;selector=selector.replace(reg,"[name='$1'],[name^='$1_']");reg=/\*([a-zA-Z]+[a-zA-Z\d]*)/g;selector=selector.replace(reg,".infoplus_$1Control")}var $jQueryObj=$(selector);if($jQueryObj.length>0){index=0;for(i=0,len=$jQueryObj.length;i<len;i++){var $element=$($jQueryObj[i]);control=$element.data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT);if(control!==undefined){this[index++]=new InfoPlus.Core.CoreBoundControl(control);continue}var repeatControl=$element.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(repeatControl!==undefined){this[index++]=new InfoPlus.Core.CoreRepeatControl(repeatControl);continue}var viewControl=$element.data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT);if(viewControl!==undefined){this[index++]=new InfoPlus.Core.CoreViewControl(viewControl)}}this.length=index;this.selector=selector}else{this.length=0;this.selector=selector}return this},each:function(callback,args){return infoCore.each(this,callback,args)},on:function(type,data,handler){if(typeof data==="function"){handler=data;data=undefined}if(infoCore.event.isCoreObjectEventTypes(type)){if(this.selector!==""){infoCore.event.registerCoreObjectEvents(type,this.selector,data,handler)}else{this.each(function(){infoCore.event.registerCoreObjectEvents(type,this,data,handler)})}}else{if(this.selector!==""){infoCore.registerEvents(type,this.selector,false,data,handler)}else{this.each(function(){this.callMethod("registerEvent",type,data,handler)})}}return this},off:function(type,handler){if(infoCore.event.isCoreObjectEventTypes(type)){if(this.selector!==""){infoCore.event.unregisterCoreObjectEvents(type,this.selector,handler)}else{this.each(function(){infoCore.event.unregisterCoreObjectEvents(type,this,handler)})}}else{if(this.selector!==""){infoCore.unregisterEvents(type,this.selector,handler)}else{this.each(function(){this.callMethod("unregisterEvent",type,handler)})}}return this},trigger:function(type){if(this.selector!==""){$(this.selector).trigger(type)}else{this.each(function(){this.callMethod("trigger",type)})}return this},val:function(value){if(value!==undefined){return this.each(function(){this.setValue(value)})}else{if(this.length>0){return this[0].getValue()}else{return null}}},attr:function(){if(this.length>0){return this[0].getAttributes()}else{return null}},isReadable:function(){if(this.length>0){return this[0].isReadable()}else{return null}},isWritable:function(){if(this.length>0){return this[0].isWritable()}else{return null}},isEditable:function(){if(this.length>0){return this[0].isEditable()}else{return null}},css:function(propertyName,value){if(typeof propertyName==="string"&&value===undefined){if(this.length>0){return this[0].getStyle(propertyName)}else{return null}}else{var styles=[];if($IU.isArray(propertyName)){styles=propertyName}else{if(typeof propertyName==="object"){var properties=propertyName;if(properties==null){return this}for(var key in properties){if(properties.hasOwnProperty(key)){styles.push({name:key,value:properties[key]})}}}else{if(typeof propertyName==="string"&&typeof value==="string"){styles.push({name:propertyName,value:value})}}}return this.each(function(){for(var i=0,len=styles.length;i<len;i++){this.setStyle(styles[i].name,styles[i].value)}})}},getName:function(){if(this.length>0){return this[0].getName()}else{return null}},contains:function(control){for(var i=0;i<this.length;i++){if(this[i].getGuid()===control.getGuid()){return true}}return false},get:function(index){if(this.length>index){return this[index]}return undefined},filter:function(filterObj){var result=[];this.each(function(){if(typeof filterObj==="function"){if(filterObj.call(this)===true){result.push(this)}}else{var shouldPush=true;for(var key in filterObj){if(filterObj.hasOwnProperty(key)){var value=filterObj[key],funcName="get"+key.substring(0,1).toUpperCase()+key.substring(1),func=this[funcName];if(typeof func==="function"){if(func.call(this)!==value){shouldPush=false;break}}}}if(shouldPush){result.push(this)}}});return infoCore(result)},validate:function(){var checks=[];for(var i=0;i<this.length;i++){var coreControl=this[i];if(coreControl instanceof InfoPlus.Core.CoreBoundControl){checks.push(coreControl.control)}else{var controls=$(coreControl.control.repeatContentParentElement).find("*[class*='validate']").filter($IU.isValidateControlFilter);for(var index=0,len=controls.length;index<len;index++){checks.push(controls[index])}}}return $IU.checkControlValidation(checks,true,true)}};infoCore.fn.init.prototype=infoCore.fn;$.extend(infoCore.fn,{visible:function(isVisible,fromInit){var $retVal=this.each(function(){this.callMethod("visible",isVisible,fromInit)});if(!fromInit){$IU.updateFormTipsAndViews()}return $retVal},expanded:function(isExpanded,fromInit){var $retVal=this.each(function(){this.callMethod("expanded",isExpanded,fromInit)});if(!fromInit){$IU.updateFormTipsAndViews()}return $retVal},itemVisible:function(isVisible,rowIndex,fromInit){var $retVal=this.each(function(){this.callMethod("itemVisible",isVisible,rowIndex,fromInit)});if(!fromInit){$IU.updateFormTipsAndViews()}return $retVal},rowVisible:function(isVisible,fromInit){var $retVal=this.each(function(){this.callMethod("rowVisible",isVisible,fromInit)});if(!fromInit){$IU.updateFormTipsAndViews()}return $retVal},colVisible:function(isVisible,fromInit){var $retVal=this.each(function(){this.callMethod("colVisible",isVisible,fromInit)});if(!fromInit){$IU.updateFormTipsAndViews()}return $retVal},parentValue:function(parentValue,fromInit){return this.each(function(){this.callMethod("setParentValue",parentValue,fromInit)})},dataSource:function(source,fromInit){return this.each(function(){this.callMethod("setDataSource",source,fromInit)})},readOnly:function(isReadOnly,fromInit){return this.each(function(){this.callMethod("readOnly",isReadOnly,fromInit)})},itemReadOnly:function(isReadOnly,rowIndex,fromInit){return this.each(function(){this.callMethod("itemReadOnly",isReadOnly,rowIndex,fromInit)})},tooltip:function(tooltip,fromInit){return this.each(function(){this.callMethod("tooltip",tooltip,fromInit)})}});$.extend(infoCore.fn,{options:function(data){return this.each(function(){this.callMethod("setOptions",data.items)})}});$.extend(infoCore,{DEBUG:false,MOBILE:false,WECHAT:navigator.userAgent.match(/MicroMessenger/),MINIPROGRAM:navigator.userAgent.match(/miniprogram/i)||window.__wxjs_environment==="miniprogram",DINGTALK:navigator.userAgent.toLowerCase().match(/dingtalk/),dingTalkJSLoaded:false,PREVIEW:false,testFile:null,APP:navigator.userAgent.match(/TaskCenterApp/),params:{renderContainer:$("#div_render_container"),renderForm:$("#renderForm"),holder:{remark:$("#form_remark_holder"),milestone:$("#form_milestone_holder"),renderContent:$("#renderContent_holder"),render:$("#render_holder"),form:$("#form_holder"),title:$("#title_holder"),commandHolder:$("#command_holder"),commandBar:$("#form_command_bar")},fieldChanging:null,fieldSyncing:false,initControls:[],ajax:{blockingIds:[],blockedCallbacks:[]},rowIndexSuffix:Math.round(Math.random()*900000+100000),initializing:true,showTutorial:true,ids:{save:"FormCommandSave",print:"FormCommandPrint",download:"FormCommandDownload",admin:"FormCommandAdmin"}},dynamics:{styles:{},referedStyles:{},formulas:{},referedFormulas:{},initialFormulas:{},actions:{},referedActions:{},validations:{},referedValidations:{},globalContext:{}},initVisibility:function(){infoCore.visibility={titleBar:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW&&!$$.APP,commandBar:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW,milestone:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW&&($$.params.showRemark!=="false"),remark:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW&&($$.params.showRemark!=="false"),floatTool:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW&&!$$.MOBILE,footer:!$$.VIEWS_ONLY&&!$$.PRINT&&!$$.PREVIEW}},initCore:function(params){infoCore.params=$.extend(infoCore.params,params);infoCore.initVisibility();infoCore.codeManager=new InfoPlus.CodeManager();infoCore.dynamics.cache=new InfoPlus.Dynamics.Cache();infoCore.entity=params.formRender.entity},setTestFile:function(testFile){infoCore.testFile=testFile},getTestFile:function(){return infoCore.testFile},getFormRender:function(){return infoCore.params.formRender},registerEvents:function(type,selector,once,data,handler){if(once===undefined){handler=selector;infoCore.event.registerGlobalEvents(type,handler)}else{if(once===true){if(infoCore.event.findRegisteredEvent(type,selector)===true){return}}if(typeof data==="function"){handler=data;data=undefined}if(infoCore.event.registerSelectorEvents(type,selector,handler)){if(data!==undefined){$$.params.renderForm.on(type,selector,data,handler)}else{$$.params.renderForm.on(type,selector,handler)}}}},unregisterEvents:function(type,selector,handler){if(typeof selector==="string"){$$.params.renderForm.off(type,selector,handler);infoCore.event.unregisterSelectorEvents(type,selector,handler)}else{handler=(typeof selector==="function")?selector:undefined;infoCore.event.unregisterGlobalEvents(type,handler)}},registerControlEvents:function(control){var events=control.events;if(!$.isArray(events)){return}if(events.length===0){return}for(var i=0,len=events.length;i<len;i++){var event=events[i];var selector=event.selector!==undefined?event.selector:"."+InfoPlus.Controls.Control.CLASSNAME_CONTROL+"."+control.getElementClassName();infoCore.registerEvents(event.type,selector,true,event.data,event.handler)}},each:function(object,callback,args){var name,i=0,length=object.length,isObj=length===undefined||$.isFunction(object);if(args){if(isObj){for(name in object){if(object.hasOwnProperty(name)){if(callback.apply(object[name],args)===false){break}}}}else{for(;i<length;){if(callback.apply(object[i++],args)===false){break}}}}else{if(isObj){for(name in object){if(object.hasOwnProperty(name)){if(callback.call(object[name],name,object[name])===false){break}}}}else{for(;i<length;){if(callback.call(object[i],i,object[i++])===false){break}}}}return object}});infoCore.event={};infoCore.event.GLOBAL_EVENT_BEFORE_RENDER="beforeRender";infoCore.event.GLOBAL_EVENT_READY="ready";infoCore.event.GLOBAL_EVENT_REMARK_READY="remarkReady";infoCore.event.GLOBAL_EVENT_FORM_VISIBLE="visible";infoCore.event.GLOBAL_EVENT_RESIZE="resize";infoCore.event.GLOBAL_EVENT_FIELD_CHANGED="fieldChanged";infoCore.event.GLOBAL_EVENT_FIELD_REFERED="fieldRefered";infoCore.event.GLOBAL_EVENT_ADDING_REPEAT="addingRepeat";infoCore.event.GLOBAL_EVENT_ADDED_REPEAT="addedRepeat";infoCore.event.GLOBAL_EVENT_CANDIDATES_QUERIED="candidatesQueried";infoCore.event.INFOCORE_OBJECT_EVENT_FIELD_CHANGED="fieldChanged";infoCore.event.INFOCORE_OBJECT_EVENT_FIELD_REFERED="fieldRefered";infoCore.event.INFOCORE_OBJECT_EVENT_FIELD_SUGGESTED="fieldSuggested";infoCore.event.INFOCORE_OBJECT_EVENT_ADDING_REPEAT="addingRepeat";infoCore.event.INFOCORE_OBJECT_EVENT_ADDED_REPEAT="addedRepeat";infoCore.event.globalEventFlag={ready:false,remarkReady:false,visible:false};$.extend(infoCore.event,{globalEventTypes:[infoCore.event.GLOBAL_EVENT_BEFORE_RENDER,infoCore.event.GLOBAL_EVENT_READY,infoCore.event.GLOBAL_EVENT_REMARK_READY,infoCore.event.GLOBAL_EVENT_FORM_VISIBLE,infoCore.event.GLOBAL_EVENT_RESIZE,infoCore.event.GLOBAL_EVENT_FIELD_CHANGED,infoCore.event.GLOBAL_EVENT_FIELD_REFERED,infoCore.event.GLOBAL_EVENT_ADDING_REPEAT,infoCore.event.GLOBAL_EVENT_ADDED_REPEAT,infoCore.event.GLOBAL_EVENT_CANDIDATES_QUERIED],coreObjectEventTypes:[infoCore.event.INFOCORE_OBJECT_EVENT_FIELD_CHANGED,infoCore.event.INFOCORE_OBJECT_EVENT_FIELD_REFERED,infoCore.event.INFOCORE_OBJECT_EVENT_FIELD_SUGGESTED,infoCore.event.INFOCORE_OBJECT_EVENT_ADDING_REPEAT,infoCore.event.INFOCORE_OBJECT_EVENT_ADDED_REPEAT],globalEventHandlers:{},selectorEventHandlers:{},coreObjectEventHandlers:{},isGlobalEventTypes:function(type){var types=infoCore.event.globalEventTypes;for(var i=0,len=types.length;i<len;i++){if(types[i]===type){return true}}return false},isCoreObjectEventTypes:function(type){var types=infoCore.event.coreObjectEventTypes;for(var i=0,len=types.length;i<len;i++){if(types[i]===type){return true}}return false},registerCoreObjectEvents:function(type,selector,data,handler){if(!infoCore.event.isCoreObjectEventTypes(type)){return false}var coreObjectEventHandlers=infoCore.event.coreObjectEventHandlers;if(coreObjectEventHandlers[type]===undefined){coreObjectEventHandlers[type]=[]}var control=null;if(typeof selector!=="string"){control=selector;selector=null}var handlers=coreObjectEventHandlers[type];for(var i=0,len=handlers.length;i<len;i++){var handlerObj=handlers[i];if(handlerObj.handler===handler){if(control!=null){if(handlerObj.control!=null&&handlerObj.control.getGuid()===control.getGuid()){return false}}else{if(handlerObj.selector!=null&&handlerObj.selector===selector){return false}}}}handlers.push({control:control,selector:selector,data:data,handler:handler});return true},unregisterCoreObjectEvents:function(type,selector,handler){var handlers=infoCore.event.coreObjectEventHandlers[type];if(handlers===undefined||handlers===null){return}if(selector!==undefined&&handler!==undefined){var control=null;if(typeof selector!=="string"){control=selector;selector=null}for(var i=0,len=handlers.length;i<len;i++){var handlerObj=handlers[i];if(handlerObj.handler===handler){if(control!=null){if(handlerObj.control!=null&&handlerObj.control.getGuid()===control.getGuid()){handlers.splice(i,1);return}}else{if(handlerObj.selector!=null&&handlerObj.selector===selector){handlers.splice(i,1);return}}}}}else{infoCore.event.coreObjectEventHandlers[type]=[]}},registerGlobalEvents:function(type,handler){if(!infoCore.event.isGlobalEventTypes(type)){return false}var globalEventHandlers=infoCore.event.globalEventHandlers;if(globalEventHandlers[type]===undefined){globalEventHandlers[type]=[]}var handlers=globalEventHandlers[type];for(var i=0,len=handlers.length;i<len;i++){if(handlers[i]===handler){return false}}handlers.push(handler);return true},unregisterGlobalEvents:function(type,handler){var handlers=infoCore.event.globalEventHandlers[type];if(handlers===undefined||handlers===null){return}if(handler!==undefined){for(var i=0,len=handlers.length;i<len;i++){if(handlers[i]===handler){handlers.splice(i,1);return}}}else{infoCore.event.globalEventHandlers[type]=[]}},registerSelectorEvents:function(type,selector,handler){var selectorEventHandlers=infoCore.event.selectorEventHandlers;if(selectorEventHandlers[selector]===undefined){selectorEventHandlers[selector]={}}if(selectorEventHandlers[selector][type]===undefined){selectorEventHandlers[selector][type]=[]}var handlers=selectorEventHandlers[selector][type];for(var i=0,len=handlers.length;i<len;i++){if(handlers[i]===handler){return false}}handlers.push(handler);return true},unregisterSelectorEvents:function(type,selector,handler){var handlers=infoCore.event.selectorEventHandlers[selector];if(handlers===undefined){return}handlers=handlers[type];if(handlers===undefined||handlers===null){return}if(handler!==undefined){for(var i=0,len=handlers.length;i<len;i++){if(handlers[i]===handler){handlers.splice(i,1);return}}}else{infoCore.event.selectorEventHandlers[selector][type]=[]}},findRegisteredEvent:function(type,selector){var selectorEventHandlers=infoCore.event.selectorEventHandlers[selector];if(selectorEventHandlers===undefined){return false}return selectorEventHandlers[type]!==undefined}});for(var eventIndex=0,eventLen=infoCore.event.globalEventTypes.length;eventIndex<eventLen;eventIndex++){infoCore[infoCore.event.globalEventTypes[eventIndex]]=function(type){return function(handler){if(typeof handler==="function"){if(infoCore.event.globalEventFlag[type]===true){handler.apply(window,arguments)}else{infoCore.event.registerGlobalEvents(type,handler)}}else{if(infoCore.event.globalEventFlag[type]!==undefined){infoCore.event.globalEventFlag[type]=true}var handlers=infoCore.event.globalEventHandlers[type];if(handlers===undefined||handlers===null){return}for(var i=0,len=handlers.length;i<len;i++){var eventHandler=handlers[i];if(typeof eventHandler==="function"){eventHandler.apply(window,arguments)}}}}}(infoCore.event.globalEventTypes[eventIndex])}var coreControlInHandler=function(control,handlerObj){if(handlerObj.selector!=null){if($$(handlerObj.selector).contains(control)){return true}}if(handlerObj.control!=null){if(handlerObj.control.getGuid()===control.getGuid()){return true}}return false};for(eventIndex=0,eventLen=infoCore.event.coreObjectEventTypes.length;eventIndex<eventLen;eventIndex++){infoCore.fn[infoCore.event.coreObjectEventTypes[eventIndex]]=function(type){return function(handler){var thisCoreObject=this;if(typeof handler==="function"){thisCoreObject.on(type,handler)}else{var handlers=infoCore.event.coreObjectEventHandlers[type];if(handlers!=null){for(var coreIndex=0,coreLen=thisCoreObject.length;coreIndex<coreLen;coreIndex++){var coreControl=thisCoreObject[coreIndex];for(var handlerIndex=0,handlerLen=handlers.length;handlerIndex<handlerLen;handlerIndex++){var handlerObj=handlers[handlerIndex];if(coreControlInHandler(coreControl,handlerObj)){if(typeof handlerObj.handler==="function"){var args=[];if(handlerObj.data!=null){args.push({data:data})}for(var i=0,len=arguments.length;i<len;i++){args.push(arguments[i])}handlerObj.handler.apply(infoCore(coreControl),args)}}}}}}}}(infoCore.event.coreObjectEventTypes[eventIndex])}var doAction=function(actionData,skipMessage,before,after,hidePrintPrompt){var doAction=function(){infoCore.ajax({type:"POST",url:infoCore.params.doActionUrl,data:actionData,requestMsg:$$.lt("submit.requestMsg"),beforeShowErrorMsg:function(){$.unblockUI()}}).always(after).done(function(data){var todoSteps=[],continueDebugSteps=[],continueStep;for(i=0;i<data.entities.length;i++){var step=data.entities[i];var thisEntryTop=$$.params.formEntryIdTop!=null?$$.params.formEntryIdTop:$$.params.formEntryId;var stepEntryTop=step.entryIdTop!=null?step.entryIdTop:step.entryId;if(thisEntryTop!==stepEntryTop){continueStep=step;todoSteps=[];break}else{if(step.assignUser===$$.params.userId){todoSteps.push(step)}if(!$$.params.isRelease&&$$.params.entrust==="true"&&step.type==="Manual"){continueDebugSteps.push(step)}}}var closeButtonText=!$IU.isEmptyStr($$.params.back)?$$.lt("common.back"):(!$IU.browserCloseable()?$$.lt("common.ok"):$$.lt("common.close"));var callback=function(){$IU.closeWindow()};var message=(data.error==null||data.error==="")?$$.lt("submit.success"):'<div class="form_do_action_error">'+data.error+"</div>";var printButton,downloadButton,printInvoiceButton,closeButton,nextButton;var arrangeButtons=function(){var pushButton=function(button){if(button!=null){buttons.push(button)}};var buttons=[];if(printButton!=null){printButton.defaultButton=($$.params.printable===true&&closeButton==null)}if(downloadButton!=null){downloadButton.defaultButton=($$.params.downloadable===true&&closeButton==null);if(printButton!=null&&printButton.defaultButton===true){downloadButton.defaultButton=false}}if(nextButton!=null){nextButton.defaultButton=(printButton==null&&downloadButton==null)||!($$.params.printAfterAction||$$.params.downloadAfterAction)}if(closeButton!=null){closeButton.defaultButton=(nextButton==null)}if((nextButton!=null&&nextButton.defaultButton===true)||(closeButton!=null&&closeButton.defaultButton===true)){pushButton(nextButton);pushButton(closeButton);pushButton(printButton);pushButton(downloadButton);pushButton(printInvoiceButton)}else{pushButton(printButton);pushButton(downloadButton);pushButton(nextButton);pushButton(closeButton);pushButton(printInvoiceButton)}return buttons};var getPrintDownloadMessage=function(printRes,downloadRes,printOrDownloadRes){if($$.params.printable===true&&$$.params.downloadable!==true){return $$.lt(printRes)}else{if($$.params.printable!==true&&$$.params.downloadable===true){return $$.lt(downloadRes)}else{return $$.lt(printOrDownloadRes)}}};if(data.error==null||data.error===""){if(!hidePrintPrompt){if($$.params.printable===true||$$.params.downloadable===true){message+=(data.error!=null?"":"<br/>");message+=getPrintDownloadMessage("submit.canDo.print","submit.canDo.download","submit.canDo.printOrDownload");if(!($$.params.printAfterAction||$$.params.downloadAfterAction)){message+=getPrintDownloadMessage("submit.hasNotDo.print","submit.hasNotDo.download","submit.hasNotDo.printOrDownload")}message+=getPrintDownloadMessage("submit.canClick.print","submit.canClick.download","submit.canClick.printOrDownload")}}}if($$.params.printable===true&&!hidePrintPrompt){printButton={name:$$.lt("common.print"),defaultButton:true,preventDefault:true,callback:function(){var openInNewWindow=(buttons!=null&&buttons.length!=null&&buttons.length>1);$IU.openUrl($IU.processUrl($$.params.printUrl),null,openInNewWindow?"_blank":"_self");return false}}}if($$.params.downloadable===true&&!hidePrintPrompt){downloadButton={name:$$.lt("common.download"),defaultButton:$$.params.printable!==true,preventDefault:true,callback:function(){$$.params.downloadAfterAction=false;$$.download(true);return false}}}if($$.params.printInvoice&&$$.params.printAfterAction){printInvoiceButton={name:$$.lt("thing.printInvoice"),defaultButton:false,preventDefault:true,callback:function(){$$.printInvoice();return false}}}if(todoSteps.length===0&&continueStep===undefined){if(!($$.params.printAfterAction||$$.params.downloadAfterAction)||hidePrintPrompt){closeButton={name:closeButtonText,callback:callback,defaultButton:true,callOnClose:true}}else{message+="<div>"+$$.lt("submit.closeAfterPrint")+"</div>"}var buttons=arrangeButtons();if(continueDebugSteps.length>0){var continueDebugMessage="<div>";continueDebugMessage+=$$.lt("submit.continueTodoList");if($$.params.isRelease===false){continueDebugMessage+="<br/>"+$$.lt("submit.openInNewWindow")}for(i=0;i<continueDebugSteps.length;i++){step=continueDebugSteps[i];continueDebugMessage+="<br/><input class='infoplus_chooseNextStep' type='radio' value='"+step.flowStepId+"'"+(i===0?"checked":"")+" name='nextStepChooseRadio'/>"+$$.lt("submit.doStep",step.name)}continueDebugMessage+="</div>";nextStep=function(){var $nextSteps=$(".infoplus_chooseNextStep");for(var index=0;index<$nextSteps.length;index++){var radio=$nextSteps[index];if(radio.checked===true){for(i=0;i<continueDebugSteps.length;i++){if(parseInt(radio.value,10)===continueDebugSteps[i].flowStepId){if($$.params.isRelease===false){var hiddenLink=document.createElement("a");$(hiddenLink).css("display","none").attr("target","_blank").attr("href",$IU.processUrl(continueDebugSteps[i].renderUri));$("body").append(hiddenLink);$IU.fireClick(hiddenLink)}else{window.location.href=$IU.processUrl(continueDebugSteps[i].renderUri)}break}}break}}return false};buttons.push({name:$$.lt("submit.continueToDebug"),preventDefault:true,callback:function(){if(continueDebugSteps.length===1){window.location.href=$IU.processUrl(continueDebugSteps[0].renderUri)}else{var nextButton={name:$$.lt("submit.nextStep"),defaultButton:true,callback:nextStep,preventDefault:true};dialog.rebuild({content:continueDebugMessage,maxWidth:440,buttons:[nextButton]})}return false}})}var dialog=new InfoPlus.Render.Dialog({content:message,maxWidth:buttons.length>1?550:440,buttons:buttons});dialog.show()}else{var nextStep=function(){if(continueStep!==undefined){window.location.href=$IU.processUrl(continueStep.renderUri)}else{if(todoSteps.length===1){window.location.href=$IU.processUrl(todoSteps[0].renderUri)}else{var $nextSteps=$(".infoplus_chooseNextStep");for(var index=0;index<$nextSteps.length;index++){var radio=$nextSteps[index];if(radio.checked===true){for(i=0;i<todoSteps.length;i++){if(parseInt(radio.value,10)===todoSteps[i].flowStepId){if($$.params.isRelease===false){var hiddenLink=document.createElement("a");$(hiddenLink).css("display","none").attr("target","_blank").attr("href",$IU.processUrl(todoSteps[i].renderUri));$("body").append(hiddenLink);$IU.fireClick(hiddenLink)}else{window.location.href=$IU.processUrl(todoSteps[i].renderUri)}break}}break}}}}return false};if(continueStep!==undefined){message+="<br/>"+$$.lt("submit.continueTodo",$IU.processStepName(continueStep.name))}else{if(todoSteps.length===1){if(!skipMessage){message+="<br/>"+(printButton!=null?$$.lt("submit.canContinueTodo",$IU.processStepName(todoSteps[0].name)):$$.lt("submit.pleaseContinueTodo",$IU.processStepName(todoSteps[0].name)))}else{window.location.href=$IU.processUrl(todoSteps[0].renderUri);return}}else{message+="<br/>"+$$.lt("submit.continueTodoList");if($$.params.isRelease===false){message+="<br/>"+$$.lt("submit.openInNewWindow")}for(var i=0;i<todoSteps.length;i++){step=todoSteps[i];message+="<br/><input class='infoplus_chooseNextStep' type='radio' value='"+step.flowStepId+"'"+(i===0?"checked":"")+" name='nextStepChooseRadio'/>"+$$.lt("submit.doStep",$IU.processStepName(step.name))}}}var close=function(){$IU.closeWindow()};nextButton={name:(continueStep!==undefined?$$.lt("submit.next"):$$.lt("submit.nextStep")),defaultButton:true,callback:nextStep,preventDefault:true};if(!($$.params.printAfterAction||$$.params.downloadAfterAction)||hidePrintPrompt){closeButton={name:closeButtonText,callback:close,callOnClose:true}}else{message+="<div>"+$$.lt("submit.closeAfterPrint")+"</div>"}buttons=arrangeButtons();dialog=new InfoPlus.Render.Dialog({content:message,maxWidth:buttons.length>2?550:400,buttons:buttons});dialog.show()}})};var delay=before();if(delay!==undefined){setTimeout(doAction,delay)}else{doAction()}};var parseData=function(data,parseErrMsg){var result={error:null,data:null};var getJsonFromData=function(){if(typeof data==="string"){return data}if(data.d!=null){return data.d}if(data.string!=null){return data.string}return null};if(data==null){result.error={msg:$$.lt("submit.parseDataError"),errno:-1};return result}var json=getJsonFromData();if(typeof JSON!=="undefined"){result.data=JSON.parse(json)}else{result.data=$.parseJSON(json)}if(result.data==null||result.data.entities==null){if(parseErrMsg===undefined){result.error={msg:$$.lt("submit.jsonError"),errno:-1}}else{result.error={msg:parseErrMsg,errno:-1}}return result}if(result.data.errno!==0){result.error={msg:result.data.error,errno:result.data.errno};return result}return result};$.extend(infoCore,{parseDynamic:function(input,keyName){try{return InfoPlus.Dynamics.Parser.Expression.parse(input)}catch(err){var txt="Error occur while parsing the dynamic expression of "+keyName+".\n\n";txt+=(input+"\n\n");txt+="Error description: "+err.message+"\n\n";txt+="Click OK to continue.\n\n";alert(txt)}return null},debug:function(msg){if(!infoCore.params.isRelease){infoCore.log(msg)}},getIeVersion:function(){var msie=+((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]);if(isNaN(msie)){msie=+((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1])}return msie},log:function(msg,file,css){if(window.console!==undefined){if(typeof msg==="object"){if(file!==undefined){console.log(file)}if(console.dirxml!=null){console.dir(msg)}else{var printObj=function(o,s){var str="";for(var p in o){if(o.hasOwnProperty(p)){if($.isArray(o[p])){str+=s+p+": [ \n"+printObj(o[p],s+"  ")+s+"]\n"}else{if(typeof o[p]==="object"){if(o[p]===null){str+=s+p+": null\n"}else{str+=s+p+": { \n"+printObj(o[p],s+"  ")+s+"}\n"}}else{str+=s+p+": "+o[p]+"\n"}}}}return str};console.log(printObj(msg,""))}}else{var log=file===undefined?msg:file+" -> "+msg;if(css!==undefined){log="%c"+log;console.log(log,css)}else{console.log(log)}}}else{alert(msg)}},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=(c==="x"?r:(r&3|8));return v.toString(16)})},getTransitionEndEventName:function(){if($$.params.transitionEndEventName!=null){return $$.params.transitionEndEventName}var el=document.createElement("fake"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"};for(var t in transEndEventNames){if(transEndEventNames.hasOwnProperty(t)){if(el.style[t]!==undefined){$$.params.transitionEndEventName=transEndEventNames[t];return transEndEventNames[t]}}}return null},asynchronousInvoke:function(method,invoker,args){if(typeof method!=="function"){return}var invoke=function(){if(invoker!=null){if(args==null){method.apply(invoker)}else{method.apply(invoker,args)}}else{method.apply()}};if($$.params.ajax.blockingIds.length>0){var guid=$$.guid();$$.params.ajax.blockedCallbacks.push({id:guid,callback:method,invoker:invoker,args:args});$$.blockUI({message:"<span class='loading'>...</span>"});setTimeout(function(){for(var i=0,len=$$.params.ajax.blockedCallbacks.length;i<len;i++){if($$.params.ajax.blockedCallbacks[i].id===guid){$$.params.ajax.blockedCallbacks.splice(i,1);$.unblockUI();invoke();break}}},5000);return false}else{invoke()}},ajax:function(options){var defer=$.Deferred();if(options==null||options.url==null){return defer.reject({error:$$.lt("error.lackOfPara")})}if(options.data!=null){options.data["csrfToken"]=$(document).find("meta[itemscope=csrfToken]").attr("content");if(options.data["lang"]==null){options.data["lang"]=$$.params.lang}}if(($$.params.viewToken||transformer.viewToken)!=null){options.data["viewToken"]=($$.params.viewToken||transformer.viewToken)}options.cache=false;options.dataType="json";var needParse=options.needParse===undefined?true:options.needParse,requestMsg=options.requestMsg===undefined?"":options.requestMsg,parseErrMsg=options.parseErrMsg===undefined?requestMsg+$$.lt("common.fail"):options.parseErrMsg,ajaxErrMsg=options.ajaxErrMsg===undefined?requestMsg+$$.lt("common.fail"):options.ajaxErrMsg,showParseErrMsg=options.showParseErrMsg===undefined?true:options.showParseErrMsg,showAjaxErrMsg=options.showAjaxErrMsg===undefined?true:options.showAjaxErrMsg,beforeShowErrorMsg=options.beforeShowErrorMsg,errorTitle=options.errorTitle,block=options.block===true;if(options.addFormParam===true){$.extend(options.data,{instanceId:$$.params.formInstanceId,stepId:$$.params.formStepId==null?-1:$$.params.formStepId,entryId:$$.params.formEntryId,workflowId:$$.params.workflowId,release:$$.params.release})}var showError=function(errNo,errCode,msg,showErrorTip,entities){if(showParseErrMsg===true){if(typeof beforeShowErrorMsg==="function"){beforeShowErrorMsg()}var errorMessage=msg,detailMessage=null,oldSpliter="|INFOPLUS_SPLITER|",newSpliter="\n\n";var pos=errorMessage.indexOf(oldSpliter);if(pos!==-1){detailMessage=errorMessage.substr(pos+oldSpliter.length);errorMessage=errorMessage.substring(0,pos)}else{pos=errorMessage.indexOf(newSpliter);if(pos!==-1){detailMessage=errorMessage.substr(pos+newSpliter.length);errorMessage=errorMessage.substring(0,pos)}}if(errCode==="EVENT_CANCELLED"&&(detailMessage==null||detailMessage==="")&&options.errorTipElement!=null){var control=$(options.errorTipElement).data($Control.DATA_CONTROL_OBJECT);if(control.controlType===$Control.CONTROL_TYPE_BUTTON||control.controlType===$Control.CONTROL_TYPE_LINK_BUTTON||control.controlType===$Control.CONTROL_TYPE_CHECKBOX){$IU.errorMessageBox(errorMessage,null,null,entities,errCode,false,false,null,400)}else{setTimeout(function(){errorMessage=$IU.linkifyStr($IU.htmlEncode(errorMessage));$(options.errorTipElement).validationEngine("showPrompt",errorMessage,null,"topLeft",true);control.popError=true},300)}}else{$IU.errorMessageBox(errorMessage,detailMessage,(errorTitle===undefined)?requestMsg+$$.lt("common.fail"):(errorTitle!==""?errorTitle:null),entities,errCode,showErrorTip)}}};if(block===true){options.guid=$$.guid();$$.params.ajax.blockingIds.push(options.guid)}options.contentType="application/x-www-form-urlencoded; charset=utf-8";$.ajax(options).done(function(data){if($.isNumeric(data.errno)){if(data.errno!==0){if(data.ecode==="FILE_IS_LOCKED"&&options.requestAgain!==true){setTimeout(function(){options.requestAgain=true;$$.ajax(options).done(function(newData){defer.resolve(newData)}).fail(function(errorData){defer.reject(errorData)})},3000);return}if(data.ecode==="SAFETY_PROTECTION_CSRF"&&options.requestAgain!==true){$("meta[itemscope=csrfToken]").attr("content",data.entities[0]);options.requestAgain=true;$$.ajax(options).done(function(newData){defer.resolve(newData)}).fail(function(errorData){defer.reject(errorData)});return}if(data.ecode==="USER_LOGIN_REQUIRED"){if($$.params.entrust===true||transformer.entrust==="true"){contentDiv=document.createElement("div");var tipSpan=document.createElement("span");$(tipSpan).text($$.lt("login.entrust"));$(contentDiv).append(tipSpan);dialog=new InfoPlus.Render.Dialog({content:contentDiv,maxWidth:450,buttons:[{name:$$.lt("common.close"),callback:function(){defer.reject({msg:data.error,errno:data.errno,data:data,errCode:data.ecode})}},{name:$$.lt("common.reload"),defaultButton:true,callback:function(){window.location.reload()}}]})}else{var contentDiv=document.createElement("div"),timeoutDiv=document.createElement("div"),linkSpan=document.createElement("span"),retrySpan=document.createElement("span");$(timeoutDiv).text($$.lt("login.needReLogin")).css("margin","20px 0 10px 0");var reLoginUrl=$$.params.reLoginUrl;var link=document.createElement("a"),$link=$(link);link.target="_blank";if(reLoginUrl!==undefined){if(reLoginUrl.indexOf("returnUrl")===-1){$link.attr("href",reLoginUrl+"?returnUrl="+encodeURIComponent(window.location.href))}else{$link.attr("href",reLoginUrl)}}$link.text($$.lt("login.reLogin")).addClass("relogin_link dialog_button default rightest fr").css("margin","auto");$link.click(function(){$(window).one("focus",function(){dialog.close();$$.ajax(options).done(function(newData){defer.resolve(newData)}).fail(function(errorData){defer.reject(errorData)})})});var buttonUrl=$link.attr("href");$(linkSpan).append(link);$(retrySpan).text($$.lt("login.retry"));var reloginDiv=document.createElement("div");$(reloginDiv).append(link);var closeDiv=document.createElement("div"),closeLink=document.createElement("a"),closeI=document.createElement("i");$(closeI).addClass("i-icon-close2");$(closeLink).append(closeI).addClass("dialog_close button show").attr("href","#").attr("title",$$.lt("common.close")).attr("style","float:right;color:#616161;position:relative;top:-28px;text-decoration:none");$(closeLink).click(function(){dialog.close();defer.reject({msg:data.error,errno:data.errno,data:data,errCode:data.ecode})});$(closeDiv).append(closeLink);$(contentDiv).append(closeDiv).append(timeoutDiv).append(reloginDiv);var dialog=new InfoPlus.Render.Dialog({content:contentDiv,maxWidth:350,noButton:true})}dialog.show()}else{showError(data.errno,data.ecode,data.error,data.errno<0,data.entities);defer.reject({msg:data.error,errno:data.errno,data:data,errCode:data.ecode})}}else{defer.resolve(data)}}else{if(needParse===true){var parsedData=parseData(data,parseErrMsg);if(parsedData.error!=null){showError(parsedData.error.errno,parsedData.error.ecode,parsedData.error.msg,parsedData.error.errno<0,parsedData.error.entities);var rejectData={msg:parsedData.error.msg,errno:parsedData.error.errno,data:parsedData.data};defer.reject(rejectData)}else{defer.resolve(parsedData.data)}}else{defer.resolve(data)}}}).fail(function(error){if(showAjaxErrMsg===true){if(typeof beforeShowErrorMsg==="function"){beforeShowErrorMsg()}if(error.status===0){error.statusText=$$.lt("common.networkError")}$IU.errorMessageBox(ajaxErrMsg,error.status+":"+error.statusText,requestMsg+$$.lt("common.fail"),null,null,true)}defer.reject({msg:error.statusText,errno:-1})}).always(function(){if(options.block===true){for(var i=0,len=$$.params.ajax.blockingIds.length;i<len;i++){if($$.params.ajax.blockingIds[i]===options.guid){$$.params.ajax.blockingIds.splice(i,1)}}if($$.params.ajax.blockingIds.length===0){$.unblockUI();len=$$.params.ajax.blockedCallbacks.length;while(len>0){var callback=$$.params.ajax.blockedCallbacks.splice(0,1)[0];if(typeof callback.callback==="function"){if(callback.invoker!=null){if(callback.args==null){callback.callback.apply(callback.invoker)}else{callback.callback.apply(callback.invoker,callback.args)}}else{callback.callback()}}len=$$.params.ajax.blockedCallbacks.length}}}});return defer.promise()},loadHistory:function(options){var $historyHolder=options.holder!=null?$(options.holder):$$.params.holder.remark,instanceId=(options.entryId!==undefined)?options.entryId:(options.instanceId||$$.params.formInstanceId),stepId=(options.stepId!==undefined)?options.stepId:(($$.params.formStepId==null?-1:$$.params.formStepId)),includingTop=options.includingTop||false;return $$.ajax({type:"POST",url:$$.params.uriHistory.replace("{id}",instanceId),data:{stepId:stepId,includingTop:includingTop},requestMsg:$$.lt("remarkHistory.request"),beforeShowErrorMsg:function(){if(!$$.MOBILE){$historyHolder.removeClass("loading").unblock()}}})},doAction:function(data,nextUsers,skipMessage,beforeDoAction,afterDoAction,transferToes,transferBack,hidePrintPrompt){if(skipMessage===undefined){skipMessage=true}if(typeof data!=="object"){var code=data;var command=null;$("a.command_button_content").each(function(){if($(this).data("code")===code){command=this}});if(command!=null){data={actionId:$(command).data("actionId"),nextUsers:$.toJSON({}),formData:$.toJSON(infoCore.params.formRender.save({},false)),remark:""}}else{return}}else{if(nextUsers!==undefined){data.nextUsers=$.toJSON(nextUsers)}}data.stepId=infoCore.params.formStepId==null?-1:infoCore.params.formStepId;data.timestamp=infoCore.params.timestamp;data.boundFields=infoCore.params.boundFields.toString();data.rand=Math.random()*999;if(transferToes){data.transferToes=transferToes;data.transferBack=transferBack}if(infoCore.params.receiveCode!=null){data.thing=infoCore.params.receiveCode}if(beforeDoAction===undefined){beforeDoAction=function(){$$.blockUI({message:"<span class='loading'>"+$$.lt("submit.submitting")+"</span>"})};afterDoAction=function(){$.unblockUI()}}doAction(data,skipMessage,beforeDoAction,afterDoAction,hidePrintPrompt)},clickActionButton:function(code){if(code==null){return}var command=null;$("a.command_button_content").each(function(){if($(this).data("code")===code){command=this}});if(command!=null){$IU.fireClick(command)}},save:function(callback){$$.asynchronousInvoke(function(){var saveToServer=function(remark){remark=remark||"";var data={};data=$$.params.formRender.save(data,false);var postData={formData:$.toJSON(data),remark:remark,timestamp:$$.params.timestamp,rand:Math.random()*999,boundFields:$$.params.boundFields.toString()};var review=$IU.getReviewData();if(review!=null){postData.review=$.toJSON(review)}$$.blockUI({message:"<span class='loading'>"+$$.lt("save.wait")+"</span>"});$$.ajax({type:"POST",url:$$.params.uriSave,data:postData,requestMsg:$$.lt("save.saving"),addFormParam:true}).done(function(){if(callback===undefined||(typeof callback!=="function")){$IU.messageBox(null,$$.lt("save.success"),null,240,function(){if($$.params.adminView){window.location.href=$IU.processUrl($$.params.adminViewUrl)}else{window.location.reload()}})}else{callback()}}).always(function(){$.unblockUI()});return data};if(null==$$.params.formRender){return null}if($IU.doValidate(true)===false){return null}if($$.params.adminView){var remarkDiv=document.createElement("div"),$remarkDiv=$(remarkDiv);var tipDiv=document.createElement("div");$(tipDiv).text($$.lt("save.adminModifyReason"));$remarkDiv.append(tipDiv);var mustInputRemarkDiv=document.createElement("div"),$mustInputRemarkDiv=$(mustInputRemarkDiv);$mustInputRemarkDiv.text($$.lt("save.reasonRequired")).css("color","red").hide();$remarkDiv.append(mustInputRemarkDiv);var textRemark=document.createElement("textarea"),$textRemark=$(textRemark);$textRemark.css("height","120px").css("width","100%");$remarkDiv.append(textRemark);var dialog=new InfoPlus.Render.Dialog({content:remarkDiv,maxWidth:600,buttons:[{name:$$.lt("common.ok"),callback:function(){var remark=$textRemark.val()||"";if($IU.trimString(remark)===""){if(!$mustInputRemarkDiv.is(":visible")){$mustInputRemarkDiv.show().effect("highlight")}else{$mustInputRemarkDiv.effect("pulsate")}return false}else{saveToServer(remark)}},defaultButton:true,preventDefault:true},{name:$$.lt("common.cancel")}]});dialog.show()}else{return saveToServer()}})},review:function(){if($$.MOBILE){$IU.mobileExpandAllViews()}$IU.refreshReviewByForm();var memoMaker=new InfoPlus.MemoMaker({data:$$.params.review,onFinish:function(){$IU.refreshReviewByForm($(memoMaker.maskDiv));memoMaker.close();$IU.refreshFormReviews()},onCancel:function(){memoMaker.close();$IU.refreshFormReviews()}});memoMaker.render();memoMaker.show()},print:function(){if(!$$.params.readOnly&&$$.params.printAfterAction){$IU.messageBox(null,$$.lt("print.printAfterAction"),null,300);return false}$IU.openUrl($IU.processUrl($$.params.printUrl,"membership"),null,"_blank")},download:function(afterAction){if(!$$.params.readOnly&&$$.params.downloadAfterAction){$IU.messageBox(null,$$.lt("download.pleaseDownloadAfterAction"),null,300);return false}var contentDiv=document.createElement("div");var wordRadio=document.createElement("input");wordRadio.type="radio";wordRadio.name="optDownloadType";var radioLabel=document.createElement("label");radioLabel.appendChild(wordRadio);$(radioLabel).addClass("download_radio_div").val("   ");var downloadDiv=document.createElement("div");$(downloadDiv).addClass("download_word");downloadDiv.appendChild(radioLabel);contentDiv.appendChild(downloadDiv);var pdfRadio=document.createElement("input");pdfRadio.type="radio";pdfRadio.name="optDownloadType";radioLabel=document.createElement("label");radioLabel.appendChild(pdfRadio);$(radioLabel).addClass("download_radio_div").val("   ");downloadDiv=document.createElement("div");$(downloadDiv).addClass("download_pdf");downloadDiv.appendChild(radioLabel);contentDiv.appendChild(downloadDiv);$(contentDiv).addClass("download_content_div");if($$.params.exportReadOnly){wordRadio.disabled=true;pdfRadio.checked=true;$(wordRadio).parents("div.download_word").addClass("download_disable")}else{wordRadio.checked=true}var cancelButton={name:$$.lt("common.cancel")},okButton={name:$$.lt("common.ok"),defaultButton:true,callback:function(){if(wordRadio.checked===true){$IU.openUrl($IU.processUrl($$.params.downloadWordUrl,"membership"),contentDiv,"_blank")}else{$IU.openUrl($IU.processUrl($$.params.downloadPdfUrl,"membership"),contentDiv,"_blank")}}},saveAndDownloadButton={name:$$.lt("download.saveBeforeDownload"),defaultButton:true,callback:function(){$$.save(function(){var downloaded=false;var downloadAfterSave=function(){if(downloaded===true){return}if(wordRadio.checked===true){$IU.openUrl($IU.processUrl($$.params.downloadWordUrl,"membership"),contentDiv,"_blank")}else{$IU.openUrl($IU.processUrl($$.params.downloadPdfUrl,"membership"),contentDiv,"_blank")}downloaded=true;saveSuccessDialog.close()};var saveSuccessDialog=new InfoPlus.Render.Dialog({content:$$.lt("save.success"),maxWidth:240,beforeClose:downloadAfterSave,buttons:[{name:$$.lt("download.start"),defaultButton:true,callback:downloadAfterSave,callOnClose:false}]});saveSuccessDialog.show()})}},buttons=[okButton,cancelButton];if(afterAction!==true&&$$.params.saveable){okButton.defaultButton=false;okButton.name=$$.lt("download.downloadDirectly");okButton.preventDefault=true;okButton.callback=function(){$IU.confirmBox($$.lt("download.downloadDirectlyTip"),$$.lt("download.confirmDownloadDirectly"),$$.lt("common.ok"),320,function(){if(wordRadio.checked===true){$IU.openUrl($IU.processUrl($$.params.downloadWordUrl,"membership"),contentDiv,"_blank")}else{$IU.openUrl($IU.processUrl($$.params.downloadPdfUrl,"membership"),contentDiv,"_blank")}dialog.close()});return false};buttons.splice(0,0,saveAndDownloadButton)}var dialog=new InfoPlus.Render.Dialog({title:$$.lt("download.choose"),content:contentDiv,maxWidth:340,buttons:buttons});dialog.show()},instruct:function(){if($$.params.instructionUrl==null){return}if(!$$.MOBILE){var $titleHolder=$("#title_holder"),titleHeight=$titleHolder.height(),commandHeight=$("#command_holder").height(),titleTop=parseInt($titleHolder.parent().css("top"),10),titleCommandHeight=titleHeight+commandHeight+(isNaN(titleTop)?0:titleTop),dialogTitleHeight=40,dialogPadding=48,iframeBorder=4,margin=20,suggestHeight=$(window).height()-titleCommandHeight-dialogTitleHeight-dialogPadding-iframeBorder-margin;$IU.iframeBox($$.params.instructionUrl,$$.lt("common.instruction"),true,false,$(window).width(),suggestHeight)}else{var page=new InfoPlus.Render.Mobile.Page({title:$$.lt("common.instruction"),appendToBody:true,uri:$$.params.instructionUrl});page.show()}},compare:function(){var history=$$.params.sameStepHistoryList;if(history==null||history.length===0){return false}var content=document.createElement("div"),$content=$(content),introduce=document.createElement("div"),historyContent=document.createElement("ul");$(introduce).text($$.lt("compare.introduce")).addClass("compareIntroduce");$content.append(introduce);for(var i=0,len=history.length;i<len;i++){var remark=history[i];var li=document.createElement("li");var label=document.createElement("label");var input=document.createElement("input");input.value=remark.formStepId;input.checked=(i===0);$(input).attr("type","radio").attr("name","comparedHistoryOption").addClass("comparedHistoryOption");if(remark.actionTime){var text=remark.actionTime+" "+$IU.unixTimeToLocalTimeString(remark.actionTime)}else{$(input).data("initIndex",i);text=remark.name||$$.lt("compare.initData")}var textNode=document.createTextNode(text);$(label).append(input).append(textNode).addClass("comparedHistoryLabel");li.appendChild(label);historyContent.appendChild(li)}$content.append(historyContent);var buttons=[{name:$$.lt("compare.compare"),defaultButton:true,callback:function(){InfoPlus.Comparer.clearAll(true);var $optionsList=$(".comparedHistoryOption"),historyStepId,compareInitDataIndex;$optionsList.each(function(){if(this.checked){if($(this).data("initIndex")!=null){compareInitDataIndex=$(this).data("initIndex")}else{historyStepId=this.value}}});if(historyStepId!=null){$$.blockUI({message:$$.lt("compare.requesting")});$$.ajax({type:"POST",url:$$.params.uriCompare+"/"+historyStepId,data:{compareTo:$$.params.formStepId},requestMsg:$$.lt("compare.requestHistory"),beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(data){if(data.entities!=null&&data.entities.length>0){var oldData=$IU.convertData(data.entities[0]),newData=$IU.convertData($$.params.formRender.save({}));var comparer=new InfoPlus.Comparer(oldData,newData);comparer.compare()}}).always(function(){$.unblockUI()})}else{$IU.compareInitData(compareInitDataIndex)}}},{name:$$.lt("common.cancel")}];var dialog=new InfoPlus.Render.Dialog({content:content,maxWidth:400,buttons:buttons});dialog.show()},printInvoice:function(){if(!$$.params.printInvoice){return}var printWindow;var $thingControlElements=$(".infoplus_thingControl"),$invoiceDiv=$("#div_invoice");$invoiceDiv.empty();var imgReady=[],windowReady=false;var print=function(){if(!windowReady){return}for(var i=0,len=imgReady.length;i<len;i++){if(!imgReady[i]){return}}printWindow.focus();printWindow.print();printWindow.close()};var allEmpty=function(){var result=true;$thingControlElements.each(function(){var thisControl=$(this).data($Control.DATA_CONTROL_OBJECT);if(thisControl!=null){var printContent=thisControl.getPrintContent(imgReady,print);if(printContent!=null){result=false}}});return result};var addThingContent=function(printThingIds){$thingControlElements.each(function(){var thisControl=$(this).data($Control.DATA_CONTROL_OBJECT);if(thisControl!=null){var shouldPrint=true;if(printThingIds!=null){shouldPrint=false;for(var i=0,len=printThingIds.length;i<len;i++){if(printThingIds[i]===thisControl.getValue().value){shouldPrint=true}}}if(shouldPrint){var printContent=thisControl.getPrintContent(imgReady,print);if(printContent!=null){$invoiceDiv.append(printContent)}}}})};var selectThing=function(){var contentDiv=document.createElement("div");var checks=[];for(var i=0,len=$thingControlElements.length;i<len;i++){var thisControl=$($thingControlElements[i]).data($Control.DATA_CONTROL_OBJECT),value=thisControl.getValue();if(value.displayValue===""){continue}var label=document.createElement("label"),input=document.createElement("input");input.type="checkbox";input.value=value.value;input.checked=true;var textNode=document.createTextNode(value.displayValue);$(label).append(input).append(textNode).addClass("choosePrintThingLabel");contentDiv.appendChild(label);checks.push(input)}var buttons=[{name:$$.lt("common.ok"),defaultButton:true,callback:function(){var checkedThingIds=[];for(i=0,len=checks.length;i<len;i++){if(checks[i].checked){checkedThingIds.push(checks[i].value)}}setTimeout(function(){addThingContent(checkedThingIds);openPrintPage()},1000)}},{name:$$.lt("common.cancel")}];var dialog=new InfoPlus.Render.Dialog({title:$$.lt("thing.choosePrint"),content:contentDiv,maxWidth:340,buttons:buttons});dialog.show()};var openPrintPage=function(){printWindow=window.open();var html=$invoiceDiv.html();printWindow.document.write("<style>body {text-align:center}</style>"+html);printWindow.document.close();var onWindowReady=function(){if(!windowReady){windowReady=true;print()}};$(printWindow).load(onWindowReady);$(printWindow.document).ready(onWindowReady)};if(!allEmpty()){if($thingControlElements.length===1){addThingContent();openPrintPage()}else{selectThing()}}else{$IU.messageBox(null,$$.lt("thing.nothingToPrint"),null,300)}},getFields:function(){if(infoCore.entity==null){return null}return infoCore.entity.fields},getGlobalContext:function(data){var getValuePairArray=function(codes,names){var vps=[];for(var i=0,len=codes.length;i<len;i++){vps.push(new $Controls.Data.ValuePair(codes[i],(names[i]!==undefined)?names[i]:codes[i]))}return vps};var getVarFromHiddenControls=function(){var d={};$$.params.renderForm.find("."+$Control.CLASSNAME_VAR).each(function(){var thisControl=$(this).data($Control.DATA_CONTROL_OBJECT);d[thisControl.field.name]=thisControl.getValue()});return d};if(data==null){data=getVarFromHiddenControls()}var context={};for(var key in data){if(data.hasOwnProperty(key)){if($IU.beginWith(key,"_VAR_")){if(data[key+"_name"]!==undefined){context[key]=new $Controls.Data.ValuePair(data[key],data[key+"_name"]);continue}if(data[key+"_Name"]!==undefined){context[key]=new $Controls.Data.ValuePair(data[key],data[key+"_Name"]);continue}if(data[key+"_Names"]!==undefined){context[key]=getValuePairArray($IU.splitAttribute(data[key]),$IU.splitAttribute(data[key+"_Names"]));continue}if($IU.endWith(key,"_Codes")){var attrName=key.substring(0,key.length-6);context[attrName]=getValuePairArray($IU.splitAttribute(data[key]),data[attrName+"_Names"]!==undefined?$IU.splitAttribute(data[attrName+"_Names"]):[]);context[key]=data[key];continue}if(!context.hasOwnProperty(key)){context[key]=data[key]}}}}return context},blockUI:function(options){var default_css={border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:0.5,color:"#fff",cursor:"pointer",width:$$.MOBILE?"80%":"45%",top:"40%",left:$$.MOBILE?"10%":"28%",textAlign:"center"};options.css=$.extend({},default_css,options.css||{});$.blockUI(options)},getLocaleText:function(name){var result=InfoPlus.Language,names=name.split(".");for(var i=0,len=names.length;i<len;i++){result=result[names[i]];if(result==null){if($$.params.isRelease===false){$$.log("locale text not found->"+name+"("+$$.params.lang+")")}return""}}return result},lt:function(name){var text=$$.getLocaleText(name);if(arguments.length===1){return text}else{for(var i=1,len=arguments.length;i<len;i++){text=text.replace("{"+(i-1)+"}",arguments[i])}return text}},hlt:function(name){var text=$IU.htmlEncode($$.getLocaleText(name));if(arguments.length===1){return text}else{for(var i=1,len=arguments.length;i<len;i++){text=text.replace("{"+(i-1)+"}",arguments[i])}return text}},transformLocation:function(lng,lat,isWGS){if(isWGS===true){return InfoPlus.CoordTransform.wgstobd(lng,lat)}else{return InfoPlus.CoordTransform.bdtowgs(lng,lat)}}});window.infoCore=window.$$=infoCore})(jQuery,window);
(function(window,undefined){var fieldChangeEventProcessor=function(){};fieldChangeEventProcessor.prototype={blockChangedField:function(element,clickFireFieldChange){if(!$(element).is(":visible")){return}var blockElement;blockElement=$(element).parents("div")[0];$(blockElement).block({message:clickFireFieldChange?"<span class='blockingNoText'>&nbsp;&nbsp;&nbsp;&nbsp;</span>":"<span class='blocking'>"+$$.lt("common.wait")+"</span>",css:{border:"none",padding:clickFireFieldChange?"0":"3px 0 3px 0",backgroundColor:"#AFC5DE",opacity:0.6,cursor:"not-allowed",width:"100%",textAlign:"center",height:$(element).outerHeight()+"px",minHeight:"22px"},overlayCSS:{backgroundColor:"#AFC5DE",width:"100%",opacity:0.6}});return blockElement},getFieldChangeSendData:function(control,formData){var value=control.getValue();if(value==null){value=""}if(value instanceof $Controls.Data.ValuePair||value instanceof $Controls.Data.Uri){value=value.value}var element=control.element;var fieldName=$(element).data($Control.DATA_FIELD);var path=$(element).data($Control.DATA_PATH);if(fieldName==null||path==null){return null}return{formData:(formData!==undefined)?$.toJSON(formData):null,fieldName:fieldName,fieldValue:value,path:path,boundFields:$$.params.boundFields.toString()}},fieldChangeEvent:function(control,formData){var requestData=this.getFieldChangeSendData(control,formData);if(requestData==null){var defer=$.Deferred();return defer.reject({error:""})}var errorTipElement=control.controlContainer||control.element,blockElement=control.element;if(control.popError===true){control.popError=false;$(errorTipElement).validationEngine("hidePrompt")}var blockElement=this.blockChangedField(blockElement,control.clickFireFieldChange);$$.params.fieldChanging={controls:[],names:null};var processData=function(data){if(data==null||data.entities==null||!$IU.isArray(data.entities)){return}if(data.entities.length>0){if($$.params.fieldChanging==null){$$.params.fieldChanging={controls:[],names:null}}if(data.entities[0].hasOwnProperty("fieldName")){var entities=data.entities;$$.params.fieldChanging.names=$IU.getFieldNamesFromFieldChangeOldData(entities);var fieldChangeControls=[];for(var i=0;i<entities.length;i++){var fdName=entities[i].fieldName+entities[i].fieldPath;if(document.getElementsByName(fdName).length===0){var hiddenControl=$IU.addVariableControl(fdName,entities[i].fieldValue,entities[i].fieldDisplayValue);hiddenControl.onFieldRefer=true;hiddenControl.addFieldChangeClass();fieldChangeControls.push(hiddenControl)}else{$IU.setElementValue(fdName,entities[i].fieldValue,entities[i].fieldDisplayValue)}}$$.dynamics.globalContext=$$.getGlobalContext();for(i=0;i<fieldChangeControls.length;i++){hiddenControl=fieldChangeControls[i];$(hiddenControl.element).change()}}else{var changedData=$.parseJSON(data.entities[0]);delete changedData.entityIndex;$$.params.fieldChanging.names=$IU.getFieldNamesFromFieldChangeData(changedData);var path=$.type(data.entities[1])==="string"?data.entities[1]:requestData.path;$IU.setFormData(changedData,path,false);$IU.rebindValidationEngine()}}};return $$.ajax({type:"POST",url:$$.params.formRender.fieldChangeService,data:requestData,errorTitle:null,errorTipElement:errorTipElement,block:true,addFormParam:true}).always(function(){if(blockElement!=null){$(blockElement).unblock()}blockElement=null}).done(function(data){processData(data)}).fail(function(data){if(data.errCode==="EVENT_CANCELLED"){processData(data.data)}}).always(function(d){setTimeout(function(){$$.params.fieldChanging=null},0)})}};define("InfoPlus.Controls.Event.FieldChangeEventProcessor",fieldChangeEventProcessor)})(window);
(function(window,undefined){var analyzer=function(){};analyzer.prototype={analysisDynamic:function(dynamics,keyName,fieldRowIndexName,fieldGroupCountName,parentFieldName){var hasAnalysed=function(key){return $$.dynamics.styles[key]!==undefined||$$.dynamics.formulas[key]!==undefined||$$.dynamics.actions[key]!==undefined||$$.dynamics.validations[key]!==undefined};if(hasAnalysed(keyName)||dynamics==null||!$IU.isArray(dynamics)){return}if(parentFieldName!==undefined){if(dynamics===undefined){dynamics=[]}dynamics.push({key:"parentValue",values:[{value:"$"+parentFieldName,condition:"true"}]})}var styles=[],rowStyles=[],repeatItemStyles=[],formulas=[],actions=[],validations=[],repeatItemActions=[];var pushArray=function(originArray,pushArray){if(pushArray==null||!$IU.isArray(pushArray)){return}for(var index=0,l=pushArray.length;index<l;index++){originArray.push(pushArray[index])}};for(var i=0,len=dynamics.length;i<len;i++){var dynamic=dynamics[i],actionName=dynamic.key,values=dynamic.values;if(actionName==="value"){pushArray(formulas,values);continue}if(actionName==="style"){pushArray(styles,values);continue}if(actionName==="rowStyle"){pushArray(rowStyles,values);continue}if(actionName==="itemStyle"){pushArray(repeatItemStyles,values);continue}if(actionName.substr(0,4)==="item"&&keyName.substr(0,5)==="group"){pushArray(repeatItemActions,[{actionName:actionName,actions:values}]);continue}if(actionName==="validation"){pushArray(validations,values);continue}pushArray(actions,[{actionName:actionName,actions:values}])}this.analysisDynamicStyles(styles,rowStyles,repeatItemStyles,keyName,fieldRowIndexName,fieldGroupCountName);this.analysisDynamicFormulas(formulas,keyName,fieldRowIndexName,fieldGroupCountName);this.analysisDynamicActions(actions,repeatItemActions,keyName,fieldRowIndexName,fieldGroupCountName);this.analysisDynamicValidations(validations,keyName,fieldRowIndexName,fieldGroupCountName)},analysisDynamicStyles:function(styles,rowStyles,repeatItemStyles,styleKeyName,fieldRowIndexName,fieldGroupCountName){if(styles.length===0&&rowStyles.length===0&&repeatItemStyles.length===0){return}var dynamics=$$.dynamics;if(dynamics.styles[styleKeyName]!==undefined){return}var compiledStyles=[];var analysis=function(analysisStyles,isRowStyle,isRepeatItemStyle){for(var i=0,styleLen=analysisStyles.length;i<styleLen;i++){var dynamicStyle=new InfoPlus.Dynamics.Style({style:analysisStyles[i].value,condition:analysisStyles[i].condition,isRowStyle:isRowStyle,isRepeatItemStyle:isRepeatItemStyle,fieldRowIndexName:fieldRowIndexName,fieldGroupCountName:fieldGroupCountName,keyName:styleKeyName});compiledStyles.push(dynamicStyle);var refNames=dynamicStyle.references,len=refNames.length;for(var refIndex=0;refIndex<len;refIndex++){var refName=refNames[refIndex];if(dynamics.referedStyles[refName]===undefined){dynamics.referedStyles[refName]=[]}dynamics.referedStyles[refName].push(dynamicStyle.getReferedStyle(styleKeyName))}}};analysis(styles,false,false);analysis(rowStyles,true,false);analysis(repeatItemStyles,false,true);dynamics.styles[styleKeyName]=compiledStyles},analysisDynamicFormulas:function(formulas,formulaKeyName,fieldRowIndexName,fieldGroupCountName){if(formulas.length>0){var dynamics=$$.dynamics;if(dynamics.formulas[formulaKeyName]===undefined){var compiledFormulas=[];for(var i=0,formulaLen=formulas.length;i<formulaLen;i++){if(formulas[i].value==null||formulas[i].value===""){continue}var dynamicFormula=new InfoPlus.Dynamics.Formula({formula:formulas[i].value,condition:formulas[i].condition,fieldRowIndexName:fieldRowIndexName,fieldGroupCountName:fieldGroupCountName,keyName:formulaKeyName});compiledFormulas.push(dynamicFormula);var refNames=dynamicFormula.references,len=refNames.length;for(var refIndex=0;refIndex<len;refIndex++){var refName=refNames[refIndex];if(refName===formulaKeyName){continue}if(dynamics.referedFormulas[refName]===undefined){dynamics.referedFormulas[refName]=[]}dynamics.referedFormulas[refName].push(dynamicFormula.getReferedFormula(formulaKeyName))}}dynamics.formulas[formulaKeyName]=compiledFormulas}}},analysisDynamicActions:function(actionArray,repeatItemActionArray,actionKeyName,fieldRowIndexName,fieldGroupCountName){if(actionArray.length===0&&repeatItemActionArray.length===0){return}var dynamics=$$.dynamics;if(dynamics.actions[actionKeyName]!==undefined){return}var compiledActions=[];var analysis=function(analysisActions,isRepeatItemAction){for(var index=0,l=analysisActions.length;index<l;index++){var actionName=analysisActions[index].actionName,actions=analysisActions[index].actions;for(var i=0,actionLen=actions.length;i<actionLen;i++){var action=actions[i],actionString="";if(action.value!=null&&action.value!==""){if($IU.isDynamicActionCallWithParams(actionName,action.value)){action.value="params"+$IU.trimString(action.value)}if(!isRepeatItemAction){actionString=actionName+"("+action.value+",$fromInit)"}else{actionString=actionName+"("+action.value+",$"+fieldRowIndexName+",$fromInit)"}}else{$IU.debugTip($$.lt("dynamics.error.valueNotSet",actionKeyName,actionName),"warning");continue}var dynamicAction=new InfoPlus.Dynamics.Action({action:actionString,condition:action.condition,isRepeatItemAction:isRepeatItemAction,fieldRowIndexName:fieldRowIndexName,fieldGroupCountName:fieldGroupCountName,keyName:actionKeyName});compiledActions.push(dynamicAction);var refNames=dynamicAction.references,len=refNames.length;for(var refIndex=0;refIndex<len;refIndex++){var refName=refNames[refIndex];if(dynamics.referedActions[refName]===undefined){dynamics.referedActions[refName]=[]}dynamics.referedActions[refName].push(dynamicAction.getReferedAction(actionKeyName))}}}};analysis(actionArray,false);analysis(repeatItemActionArray,true);dynamics.actions[actionKeyName]=compiledActions},analysisDynamicValidations:function(validations,validationKeyName,fieldRowIndexName,fieldGroupCountName){if(validations.length===0){return}var dynamics=$$.dynamics;if(dynamics.validations[validationKeyName]!==undefined){return}var compiledValidations=[];for(var index=0,l=validations.length;index<l;index++){var dynamicValidation=new InfoPlus.Dynamics.Validation({tip:validations[index].value,condition:validations[index].condition,fieldRowIndexName:fieldRowIndexName,fieldGroupCountName:fieldGroupCountName,keyName:validationKeyName});compiledValidations.push(dynamicValidation);var refNames=dynamicValidation.references,len=refNames.length;for(var refIndex=0;refIndex<len;refIndex++){var refName=refNames[refIndex];if(dynamics.referedValidations[refName]===undefined){dynamics.referedValidations[refName]=[]}dynamics.referedValidations[refName].push(dynamicValidation.getReferedValidation(validationKeyName))}}dynamics.validations[validationKeyName]=compiledValidations}};define("InfoPlus.Dynamics.Analyzer",analyzer)})(window);
(function(window,undefined){var dynamicProcessor=function(){};dynamicProcessor.prototype={getReferedControls:function(control,pathReferedControls,dynamicData){var referedControls=[];for(var controlIndex=0,rcLen=pathReferedControls.length;controlIndex<rcLen;controlIndex++){var referedControl=pathReferedControls[controlIndex],dynamics=dynamicData[referedControl.getDynamicKeyName()];if(dynamics!==undefined&&dynamics!==null&&$IU.isArray(dynamics)){for(var i=0,len=dynamics.length;i<len;i++){var dynamic=dynamics[i];if($IU.dynamicReferControl(dynamic,control)){referedControls.push(referedControl);break}}}}return referedControls},processReferPath:function(control){var path=(control.referPath!==undefined)?control.referPath:[];path.push(control.field.name);control.referPath=undefined;return path},processRepeatContext:function(originContext,repeatChildFieldNames,rowIndex){var newContext={};for(var key in originContext){if(originContext.hasOwnProperty(key)){if($IU.arrayContains(repeatChildFieldNames,key)||key.indexOf("RowIndex")!==-1){var value=originContext[key];if($IU.isArray(value)){if(value[rowIndex]!==undefined){newContext[key]=value[rowIndex]}}}else{newContext[key]=originContext[key]}}}newContext.rowIndex=rowIndex;newContext.INDEX=rowIndex;return newContext},processDynamicStyle:function(targetControl,render,referFromControl,excludePath,fromInit){var styles=$$.dynamics.styles[targetControl.getDynamicKeyName()];if(!$IU.isArray(styles)){return}if(targetControl.repeatParentElement!=null){$IU.saveOriginStyles(targetControl.repeatParentElement)}else{$IU.saveOriginStyles(targetControl.element)}var $$targetControl=$$(targetControl);if(fromInit===true){var context=this.getInitControlContext(targetControl)}else{context=this.getControlContext(targetControl,excludePath)}for(var styleIndex=0,len=styles.length;styleIndex<len;styleIndex++){var style=styles[styleIndex];if(referFromControl===undefined||(referFromControl!==undefined&&$IU.dynamicReferControl(style,referFromControl))){var compiler=new InfoPlus.Dynamics.Parser.Compile(style.conditionAsts);if(style.isRepeatItemStyle===true){if(typeof targetControl.getRepeatChildren==="function"){var children=targetControl.getRepeatChildren();for(var i=0,rLen=children.length;i<rLen;i++){var rowContext=this.processRepeatContext(context,targetControl.fieldNames,i);if(style.ignoreCondition===true||compiler.evaluate(rowContext)===true){var row=children[i];for(var si=0,sl=style.styles.length;si<sl;si++){$IU.setDynamicStyle(row,style.styles[si].name,style.styles[si].value)}}}}}else{if(style.ignoreCondition===true||compiler.evaluate(context)===true){if(style.isRowStyle===true){var $row=targetControl.getRow();if($row.length>0){for(si=0,sl=style.styles.length;si<sl;si++){$IU.setDynamicStyle($row[0],style.styles[si].name,style.styles[si].value)}}}else{$$targetControl.css(style.styles)}}}}}},processDynamicAction:function(targetControl,render,referFromControl,excludePath,fromInit){var actions=$$.dynamics.actions[targetControl.getDynamicKeyName()];if(!$IU.isArray(actions)){return}var $$targetControl=$$(targetControl);if(fromInit===true){var context=this.getInitControlContext(targetControl)}else{context=this.getControlContext(targetControl,excludePath)}for(var actionIndex=0,len=actions.length;actionIndex<len;actionIndex++){var action=actions[actionIndex];if(referFromControl===undefined||(referFromControl!==undefined&&$IU.dynamicReferControl(action,referFromControl))){var compiler=new InfoPlus.Dynamics.Parser.Compile(action.conditionAsts);if(action.isRepeatItemAction===false){if(action.ignoreCondition===true||compiler.evaluate(context)===true){compiler=new InfoPlus.Dynamics.Parser.Compile(action.actionAsts);compiler.evaluate(context,$$targetControl)}}else{if(typeof targetControl.getRepeatChildren==="function"){var children=targetControl.getRepeatChildren();for(var i=0,rLen=children.length;i<rLen;i++){var rowContext=this.processRepeatContext(context,targetControl.fieldNames,i);if(action.ignoreCondition===true||compiler.evaluate(rowContext)===true){compiler=new InfoPlus.Dynamics.Parser.Compile(action.actionAsts);compiler.evaluate(rowContext,$$targetControl)}}}else{}}}}},processDynamicValidation:function(targetControl,render,referFromControl,excludePath){if(targetControl.ignoreValidation===true||targetControl.isReadOnly()||targetControl.isDynamicReadonly()||!targetControl.isVisible()){return}var validations=$$.dynamics.validations[targetControl.getDynamicKeyName()];if(!$IU.isArray(validations)){return}var context=this.getControlContext(targetControl,excludePath);var targetElement=targetControl.element;if(targetElement.getAttribute("type")==="radio"){var fieldName=targetControl.field.name;targetElement=$($("input[name='"+fieldName+"'][type!=hidden]:first"))[0]}if($(targetElement).hasClass("infoplus_suggesterControl")){targetElement=$(targetControl.controlContainer).find(".active_input")[0]}var prompt;for(var validationIndex=0,len=validations.length;validationIndex<len;validationIndex++){var validation=validations[validationIndex];if(referFromControl===undefined||(referFromControl!==undefined&&$IU.dynamicReferControl(validation,referFromControl))){var compiler=new InfoPlus.Dynamics.Parser.Compile(validation.conditionAsts);if(validation.ignoreCondition===true||compiler.evaluate(context)===true){compiler=new InfoPlus.Dynamics.Parser.Compile(validation.tipAsts);var tip=compiler.evaluate(context);if(tip!=null&&tip!==""){if(prompt!==undefined){prompt+="<br/>"+tip}else{prompt=tip}}}}}if(prompt===undefined){$(targetElement).validationEngine("hidePrompt")}else{$(targetElement).validationEngine("showPrompt",prompt,"danger",targetControl.validatorPromptPosition,true)}},processDynamicFormula:function(targetControl,render,referFromControl,referPath,excludePath,fromInit){var formulas=$$.dynamics.formulas[targetControl.getDynamicKeyName()];if(!$IU.isArray(formulas)){return}var $$targetControl=$$(targetControl);if(!targetControl.isWritable()){return}if(targetControl.repeatParentElement!==undefined){return}if(referPath!==undefined&&this.foundControlInReferPath(targetControl,referPath)){return}if(fromInit===true){var context=this.getInitControlContext(targetControl)}else{context=this.getControlContext(targetControl,excludePath)}for(var formulaIndex=0,len=formulas.length;formulaIndex<len;formulaIndex++){var formula=formulas[formulaIndex];if(referFromControl===undefined||(referFromControl!==undefined&&$IU.dynamicReferControl(formula,referFromControl))){var compiler=new InfoPlus.Dynamics.Parser.Compile(formula.conditionAsts);if(formula.ignoreCondition===true||compiler.evaluate(context)===true){compiler=new InfoPlus.Dynamics.Parser.Compile(formula.formulaAsts);var value=compiler.evaluate(context);var fireChangeEventAgain=(targetControl.repeatParentElement===undefined&&targetControl.shouldFireChangeEventAgain(value));if(value===undefined){value=null}$$targetControl.val(value);if(!formula.isRowIndex&&targetControl.controlType!==$Control.CONTROL_TYPE_MAP){if(targetControl.element!==undefined){$IU.highLightElement(targetControl.element)}}if(fireChangeEventAgain){targetControl.referPath=referPath;setTimeout(function(control){return function(){$(control.element).change()}}(targetControl),0)}}}}},processReferedStyle:function(referFromControl,referedControls,render,excludePath){var referedStyleControls=this.getReferedControls(referFromControl,referedControls,$$.dynamics.styles);for(var controlIndex=0,controlLength=referedStyleControls.length;controlIndex<controlLength;controlIndex++){var targetControl=referedStyleControls[controlIndex];this.processDynamicStyle(targetControl,render,referFromControl,excludePath)}},foundControlInReferPath:function(targetControl,referPath){for(var referPathIndex=0;referPathIndex<referPath.length;referPathIndex++){if(referPath[referPathIndex]===targetControl.getDynamicKeyName()){return true}}return false},processReferedFormula:function(referFromControl,referedControls,render,excludePath){var referPath=this.processReferPath(referFromControl);var referedFormulaControls=this.getReferedControls(referFromControl,referedControls,$$.dynamics.formulas);for(var controlIndex=0,controlLength=referedFormulaControls.length;controlIndex<controlLength;controlIndex++){var targetControl=referedFormulaControls[controlIndex];this.processDynamicFormula(targetControl,render,referFromControl,referPath,excludePath)}},processReferedAction:function(referFromControl,referedControls,render,excludePath){var referedActionControls=this.getReferedControls(referFromControl,referedControls,$$.dynamics.actions);for(var controlIndex=0,controlLength=referedActionControls.length;controlIndex<controlLength;controlIndex++){var targetControl=referedActionControls[controlIndex];this.processDynamicAction(targetControl,render,referFromControl,excludePath)}},processReferedValidation:function(referFromControl,referedControls,render,excludePath){var referedValidationControls=this.getReferedControls(referFromControl,referedControls,$$.dynamics.validations);for(var controlIndex=0,controlLength=referedValidationControls.length;controlIndex<controlLength;controlIndex++){var targetControl=referedValidationControls[controlIndex];this.processDynamicValidation(targetControl,render,referFromControl,excludePath)}},fieldReferEvent:function(referFromControl,render,referParent,referSibling,referChild,fieldChangingReferAll,doAllActionStyle,excludePath){if($$.params.fieldChanging!=null){if(fieldChangingReferAll===true){var referedControls=this.getReferedControlsByPath(referFromControl.path,true,true,true)}else{referedControls=this.getReferedControlsByPath(referFromControl.path,referParent,referSibling,referChild)}if($$.params.fieldChanging.names!=null){var filteredControls=[];for(var i=0,len=referedControls.length;i<len;i++){if(!$$.params.fieldChanging.names.hasOwnProperty(referedControls[i].getDynamicKeyName())){filteredControls.push(referedControls[i])}}referedControls=filteredControls}this.processReferedFormula(referFromControl,referedControls,render,excludePath)}else{if(doAllActionStyle===true){referedControls=this.getReferedControlsByPath(referFromControl.path,true,true,true);if(referParent===true&&referSibling===true&&referChild===true){formulaReferedControls=referedControls}else{var formulaReferedControls=this.getReferedControlsByPath(referFromControl.path,referParent,referSibling,referChild)}}else{referedControls=this.getReferedControlsByPath(referFromControl.path,referParent,referSibling,referChild);formulaReferedControls=referedControls}this.processReferedAction(referFromControl,referedControls,render,excludePath);this.processReferedStyle(referFromControl,referedControls,render,excludePath);this.processReferedFormula(referFromControl,formulaReferedControls,render,excludePath);this.processReferedValidation(referFromControl,referedControls,render,excludePath)}},isReferedControl:function(mainControlPath,referedControlPaths,control,referParent,referSibling,referChild){var path=control.path;if(path==null||mainControlPath==null){return{refered:false}}var len;if(referParent){len=referedControlPaths.length-1}if(referParent&&referSibling){len=referedControlPaths.length}for(var i=0;i<len;i++){if(referedControlPaths[i]===path){return{refered:true,children:false}}}if(referChild){if(path.length>mainControlPath.length){if(path.substr(0,mainControlPath.length)===mainControlPath&&path.substr(mainControlPath.length,1)==="_"){return{refered:true,children:true,subPath:path.substr(mainControlPath.length)}}}}return{refered:false}},getReferedControlsByPath:function(controlPath,referParent,referSibling,referChild){var referedControlPaths=$IU.getReferedControlPaths(controlPath);var formControls=$IU.getAllControls();var controls=[];for(var i=0,len=formControls.length;i<len;i++){var control=formControls[i];var isRefered=this.isReferedControl(controlPath,referedControlPaths,control,referParent,referSibling,referChild);if(isRefered.refered===true){controls.push(control)}}return controls},getControlValue:function(control,isInit){var getValuePairArray=function(codes,names,parentId){var vps=[];for(var i=0,len=codes.length;i<len;i++){vps.push(new $Controls.Data.ValuePair(codes[i],(names[i]!==undefined)?names[i]:codes[i],parentId))}return vps};var value=control.getValue(isInit);var field=control.field;if(field!=null){if(field.type===$Control.DATA_TYPE_INT||field.type===$Control.DATA_TYPE_DOUBLE){if($IU.isString(value)&&$IU.trimString(value)===""){value=0}}}if(control.controlType==="BoundCheckList"&&control.field.type===$Control.DATA_TYPE_STRING&&(value instanceof $Controls.Data.ValuePair)){value=value.value}if((value instanceof $Controls.Data.ValuePair)||(value instanceof $Controls.Data.Uri)){var attributes=control.getAttributes();value.expando=attributes;for(var key in attributes){if(attributes.hasOwnProperty(key)){if((key!=="value"&&key!=="displayValue")||(value instanceof $Controls.Data.Uri)){if(attributes[key+"_name"]!==undefined){value[key]=new $Controls.Data.ValuePair(attributes[key],attributes[key+"_name"],value.value);continue}if(attributes[key+"_Name"]!==undefined){value[key]=new $Controls.Data.ValuePair(attributes[key],attributes[key+"_Name"],value.value);continue}if(attributes[key+"_Names"]!==undefined){value[key]=getValuePairArray($IU.splitAttribute(attributes[key]),$IU.splitAttribute(attributes[key+"_Names"],value.value));continue}if($IU.endWith(key,"_Codes")){var attrName=key.substring(0,key.length-6);value[attrName]=getValuePairArray($IU.splitAttribute(attributes[key]),attributes[attrName+"_Names"]!==undefined?$IU.splitAttribute(attributes[attrName+"_Names"]):[],value.value);continue}value[key]=attributes[key]}}}}return value},putValueIntoContext:function(context,keyName,value,isRefered){if(isRefered.children===true){if(context[keyName]===undefined){context[keyName]=[]}var v=context[keyName];var pathArray=isRefered.subPath.split("_").slice(1);for(var i=0;i<pathArray.length;i++){var pathIndex=parseInt(pathArray[i],10);if(i===pathArray.length-1){v[pathIndex]=value}else{if(v[pathIndex]===undefined){v[pathIndex]=[]}v=v[pathIndex]}}}else{context[keyName]=value}},getReferedKeyNames:function(targetDynamicKeyName){var referedKeyNames=[],refered={},referedStyles=$$.dynamics.referedStyles,referedFormulas=$$.dynamics.referedFormulas,referedActions=$$.dynamics.referedActions,referedValidations=$$.dynamics.referedValidations,keyName;for(keyName in referedStyles){if(referedStyles.hasOwnProperty(keyName)){var styles=referedStyles[keyName],len=styles.length;for(var i=0;i<len;i++){if(styles[i].targetFieldName===targetDynamicKeyName){if(!refered.hasOwnProperty(keyName)){refered[keyName]="";break}}}}}for(keyName in referedFormulas){if(referedFormulas.hasOwnProperty(keyName)){var formulas=referedFormulas[keyName];len=formulas.length;for(i=0;i<len;i++){if(formulas[i].targetFieldName===targetDynamicKeyName){if(!refered.hasOwnProperty(keyName)){refered[keyName]="";break}}}}}for(keyName in referedActions){if(referedActions.hasOwnProperty(keyName)){var actions=referedActions[keyName];len=actions.length;for(i=0;i<len;i++){if(actions[i].targetFieldName===targetDynamicKeyName){if(!refered.hasOwnProperty(keyName)){refered[keyName]="";break}}}}}for(keyName in referedValidations){if(referedValidations.hasOwnProperty(keyName)){var validations=referedValidations[keyName];len=validations.length;for(i=0;i<len;i++){if(validations[i].targetFieldName===targetDynamicKeyName){if(!refered.hasOwnProperty(keyName)){refered[keyName]="";break}}}}}for(keyName in refered){if(refered.hasOwnProperty(keyName)){referedKeyNames.push(keyName)}}return referedKeyNames},getControlContext:function(control,excludePath,ignoreJudgeRefer){var instance=this,controlPath=control.path,referedControlPaths=$IU.getReferedControlPaths(controlPath),referedKeyNames=this.getReferedKeyNames(control.getDynamicKeyName()),context=$.extend({},$$.dynamics.globalContext);var putControlIntoContext=function(thisControl){var keyName=thisControl.getDynamicKeyName();var controlKeyName=thisControl.getDynamicContextControlName();if(ignoreJudgeRefer===null||ignoreJudgeRefer===false){if(!$IU.arrayContains(referedKeyNames,keyName)&&!$IU.arrayContains(referedKeyNames,controlKeyName)){return}}if(excludePath!==undefined&&$IU.pathInclude(thisControl.path,excludePath)){return}var isRefered=instance.isReferedControl(controlPath,referedControlPaths,thisControl,true,true,true);if(isRefered.refered===true){if($IU.arrayContains(referedKeyNames,keyName)||ignoreJudgeRefer===true){var value=instance.getControlValue(thisControl);if(thisControl.controlType===$Control.CONTROL_TYPE_RADIO&&value==null){return}instance.putValueIntoContext(context,keyName,value,isRefered)}if($IU.arrayContains(referedKeyNames,controlKeyName)||ignoreJudgeRefer===true){instance.putValueIntoContext(context,controlKeyName,new InfoPlus.Dynamics.ControlReference(thisControl),isRefered)}}};var putRepeatControlIntoContext=function(thisControl){var controlKeyName=thisControl.getDynamicContextControlName();if(!$IU.arrayContains(referedKeyNames,controlKeyName)){return}if(excludePath!==undefined&&$IU.pathInclude(thisControl.path,excludePath)){return}var isRefered=instance.isReferedControl(controlPath,referedControlPaths,thisControl,true,true,true);if(isRefered.refered===true){instance.putValueIntoContext(context,controlKeyName,new InfoPlus.Dynamics.RepeatControlReference(thisControl),isRefered)}};var cacheControls=$$.dynamics.cache.get(controlPath);for(var i=0,len=cacheControls.length;i<len;i++){var cacheControl=cacheControls[i];if(cacheControl.repeatType==null){putControlIntoContext(cacheControl)}else{putRepeatControlIntoContext(cacheControl)}}context.fromInit=false;this.putViewContext(control,context);return context},getInitControls:function(){if($$.params.initControls.length===0){var controls=[],instance=this;$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).not("."+$Control.CLASSNAME_VAR).each(function(){var thisControl=$(this).data($Control.DATA_CONTROL_OBJECT);if(thisControl==null||thisControl.path==null||thisControl.field==null){return}var keyName=thisControl.getDynamicKeyName();var controlKeyName=thisControl.getDynamicContextControlName();var value=instance.getControlValue(thisControl,true);if(thisControl.controlType===$Control.CONTROL_TYPE_RADIO&&value==null){return}controls.push({control:thisControl,infoCoreControl:$$(thisControl),keyName:keyName,controlKeyName:controlKeyName,value:value,isRepeat:false})});$$.params.renderForm.find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var thisControl=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(thisControl==null||thisControl.path==null||thisControl.groupName==null){return}var controlKeyName=thisControl.getDynamicContextControlName();controls.push({control:thisControl,infoCoreControl:$$(thisControl),controlKeyName:controlKeyName,isRepeat:true})});$$.params.initControls=controls}return $$.params.initControls},getInitControlContext:function(control){var initControls=this.getInitControls(),controlPath=control.path,referedControlPaths=$IU.getReferedControlPaths(controlPath),referedKeyNames=this.getReferedKeyNames(control.getDynamicKeyName()),context=$.extend({},$$.dynamics.globalContext);for(var i=0,len=initControls.length;i<len;i++){var thisControl=initControls[i];if(!thisControl.isRepeat){var keyName=thisControl.keyName;var controlKeyName=thisControl.controlKeyName;if(!$IU.arrayContains(referedKeyNames,keyName)&&!$IU.arrayContains(referedKeyNames,controlKeyName)){continue}var isRefered=this.isReferedControl(controlPath,referedControlPaths,thisControl.control,true,true,true);if(isRefered.refered===true){if($IU.arrayContains(referedKeyNames,keyName)){var value=thisControl.value;this.putValueIntoContext(context,keyName,value,isRefered)}if($IU.arrayContains(referedKeyNames,controlKeyName)){this.putValueIntoContext(context,controlKeyName,new InfoPlus.Dynamics.ControlReference(thisControl.control),isRefered)}}}else{controlKeyName=thisControl.controlKeyName;if(!$IU.arrayContains(referedKeyNames,controlKeyName)){continue}isRefered=this.isReferedControl(controlPath,referedControlPaths,thisControl.control,true,true,true);if(isRefered.refered===true){this.putValueIntoContext(context,controlKeyName,new InfoPlus.Dynamics.RepeatControlReference(thisControl.control),isRefered)}}}context.fromInit=true;this.putViewContext(control,context);return context},putViewContext:function(control,context){if(control instanceof InfoPlus.Layout.View){context.viewWidth=control.render.width;context.PAGE=control.render.name}else{var $view=$(control.element).parents(".infoplus_view");if($view.length>0){context.viewWidth=$view.data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT).render.width}else{context.viewWidth=window.width}}}};define("InfoPlus.Dynamics.Processor",dynamicProcessor)})(window);
(function(window,undefined){var repeatControl=function(config){this.initData=config.initData;this.formRender=config.formRender;this.render=config.render;this.path=config.path;this.repeatParentElement=config.repeatParentElement;this.repeatContentParentElement=config.repeatContentParentElement;this.firstControlNamePrefix=config.firstControlNamePrefix;this.repeatType=config.repeatType;this.addLinkText=config.addLinkText;this.fieldNames=config.fieldNames;this.groupInformation=config.groupInformation;this.groupName=this.groupInformation.name;this.fullGroupName=this.groupInformation.groupName;this.columnVisible=[];this.init()};repeatControl.REPEAT_TYPE_SECTION=0;repeatControl.REPEAT_TYPE_TABLE=1;repeatControl.CLASS_REPEAT_SECTION_EXPAND="infoplus_repeatSection_expand";repeatControl.CLASS_REPEAT_SECTION_SHRINK="infoplus_repeatSection_shrink";repeatControl.CLASS_REPEAT_SECTION_SHRUNKEN="infoplus_repeat_section_shrunken";repeatControl.CLASS_REPEAT_SECTION_EXPAND_BUTTON_OPACITY="opacity5";repeatControl.CLASS_REPEAT_SECTION="infoplus_repeatingSection";repeatControl.CLASS_SECTION_BUTTON="infoplus_repeatSectionMenuButton";repeatControl.CLASS_REPEAT_SECTION_EXPAND_BUTTON="infoplus_repeatSectionExpandButton";repeatControl.CLASS_REPEAT_TABLE_ROW="infoplus_repeatingTableRow";repeatControl.CLASS_TABLE_BUTTON="infoplus_repeatTableMenuButton";repeatControl.CLASS_ADD_LINK="infoplus_addLink";repeatControl.CLASS_ADD_LINK_DIV="infoplus_addLinkDiv";repeatControl.CLASS_ADD_LINK_CONTAINER_DIV="infoplus_addLinkContainerDiv";repeatControl.CLASS_MENUBUTTON_SELECTED="infoplus_menuButtonSelected";repeatControl.CLASS_POPUP_MENU="infoplus_popupMenu";repeatControl.CLASS_MENU_ITEM="infoplus_menuItem";repeatControl.CLASS_REPEAT_PARENT_ELEMENT="infoplus_repeatParentElement";repeatControl.CLASS_REPEAT_SELECTED="infoplus_repeatingSelected";repeatControl.CLASS_REPEAT_MENU_POPUPED="infoplus_repeatingMenuPopuped";repeatControl.CLASS_REPEAT_MASTER="infoplus_repeat_master";repeatControl.DATA_REPEAT_CONTROL_OBJECT="repeatControl";repeatControl.DATA_REPEAT_MENU_DIV="infoplus_repeat_menu_div";repeatControl.DATA_REPEAT_DIV="infoplus_repeat_div";repeatControl.DATA_REPEAT_SECTION_DIV="infoplus_repeat_section_div";repeatControl.DATA_REPEAT_SECTION_EXPAND_BUTTON="infoplus_repeat_section_expand_button";repeatControl.DATA_REPEAT_SECTION_EXPAND_BUTTON_TOP="infoplus_repeat_expand_top";repeatControl.DATA_REPEAT_SECTION_EXPAND_BUTTON_SHRINK_TOP="infoplus_repeat_expand_shrink_top";repeatControl.DATA_REPEAT_SECTION_EXPAND_HEIGHT="infoplus_repeat_section_expand_height";repeatControl.REPEAT_SECTION_SHRINK_HEIGHT=28;repeatControl.NEW_ROW_INDEX=-1;repeatControl.prototype={guid:null,initData:null,eventsInitialized:false,formRender:null,render:null,path:null,popupMenu:null,repeatParentElement:null,repeatContentParentElement:null,repeatAddLink:null,repeatLayout:null,newRepeatData:null,firstControlNamePrefix:null,repeatType:0,power:null,repeatTableBody:null,keyIndex:null,groupName:null,fullGroupName:null,addLinkText:null,fieldNames:null,sorter:null,hideMenuTimer:null,dynamicProcessor:new InfoPlus.Dynamics.Processor(),readOnly:false,columnVisible:[],showingDetail:false,init:function(){this.guid=$$.guid();this.groupCountFieldName="field"+(this.groupName.substr(0,1).toUpperCase()+this.groupName.substr(1))+"Count"+$$.params.rowIndexSuffix;this.rowIndexFieldName="field"+(this.groupName.substr(0,1).toUpperCase()+this.groupName.substr(1))+"RowIndex"+$$.params.rowIndexSuffix;this.repeatParentElement.id=this.groupName+this.path;$(this.repeatParentElement).attr("name",this.repeatParentElement.id).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT,this);this.replaceHeightStyle();this.initPower();this.initRepeatableNewData();this.initCountControl();this.initRepeatParentElementStyle();this.initPopupMenu();if(this.isRepeatTable()){this.initRepeatTableBody();if(this.power.writePower===true){this.initTableSorter()}}this.createRepeatableContent(this.initData);this.initAddLink();if(this.popupMenu!=null){$(this.repeatParentElement).append($(this.popupMenu.menuDiv).detach())}if(InfoPlus.Repeat.RepeatControl.prototype.eventsInitialized===false){this.initEvents();InfoPlus.Repeat.RepeatControl.prototype.eventsInitialized=true}this.initMasterDetailEvent();this.initExternalCodeFields()},replaceHeightStyle:function(){if(this.isRepeatTable()||this.render==null||this.render.attributes==null){return}var findStyleAttribute=function(attributes){for(var i=0,len=attributes.length;i<len;i++){var attribute=attributes[i];if(attribute.key!=null&&attribute.key.toLowerCase()==="style"){return attribute}}return null};var styleAttribute=findStyleAttribute(this.render.attributes);if(styleAttribute!=null&&styleAttribute.value!=null){var result="";var styles=styleAttribute.value.split(";");for(var i=0,len=styles.length;i<len;i++){var style=styles[i].split(":");if(style.length===2&&$IU.trimString(style[0].toLowerCase())==="height"){result+="min-height:"+style[1]+";"}else{result+=styles[i]+";"}}styleAttribute.value=result}},initMasterDetailEvent:function(){var instance=this;if(this.groupInformation.isMasterDetail){$(this.repeatParentElement).on("click",".infoplus_labelControl",function(){var $td=$(this).parentsUntil("tr."+repeatControl.CLASS_REPEAT_TABLE_ROW).last();if($td.size()!==0){if(!$td.hasClass("detailCell")){instance.showDetail($td.parent()[0])}}return false});if(!$$.MOBILE){$(this.repeatParentElement).on("click","tr."+repeatControl.CLASS_REPEAT_TABLE_ROW,function(event){var inFileControlDiv=$(event.target).hasClass("infoplus_fileControl")||($(event.target).parents(".infoplus_fileControl").length>0);if(inFileControlDiv){if($(event.target).hasClass("infoplus_fileControl")&&event.target.nodeName==="DIV"){instance.showDetail(this);return false}}else{if(!$(event.target).hasClass("infoplus_control")){instance.showDetail(this);return false}}})}}},initExternalCodeFields:function(){var formRender=this.formRender;formRender.eachLayout(function(render){if(render.renderType==="BoundSelect"||render.renderType==="BoundOptionList"){var field=$$.entity.fields[render.field];if(field!=null&&field.code!=null){var items=null;var code=$$.codeManager.getCode(field.code);if(code!=null){items=code.items}if(items==null||($IU.isArray(items)&&items.length===0)){if(code==null||(code!=null&&code.codeType==="External")){$$.codeManager.addRequestCode(field.code,field.name)}}}}},this.render,"Boundable")},initEvents:function(){var events=InfoPlus.Repeat.RepeatControl.Events.events;for(var i=0,len=events.length;i<len;i++){var event=events[i];$$.registerEvents(event.type,event.selector,true,event.data,event.handler)}},initTableSorter:function(){this.sorter=new InfoPlus.Repeat.TableSorter(this)},initAddLink:function(){var repeatAddLink=this.power.insertPower?new InfoPlus.Repeat.RepeatAddLink(this.repeatParentElement,6,this.addLinkText):null;if(repeatAddLink!=null){if(this.shouldShowAddLink()){repeatAddLink.showLink()}else{repeatAddLink.hideLink()}}this.repeatAddLink=repeatAddLink},initPower:function(){this.power=new InfoPlus.Repeat.RepeatPower(this.groupInformation)},initRepeatParentElementStyle:function(){if(this.power.readPower===false){$(this.repeatParentElement).css("display","none")}$(this.repeatParentElement).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT);if(this.groupInformation.isMasterDetail){$(this.repeatParentElement).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MASTER)}},initPopupMenu:function(){var power=this.power;if(power.writePower===false&&power.insertPower===false&&power.deletePower===false&&power.enforceReadPower===false){return}this.popupMenu=new InfoPlus.Repeat.PopupMenu(this)},isRepeatSection:function(){return this.repeatType===InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_SECTION},isRepeatTable:function(){return this.repeatType===InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE},shouldShowAddLink:function(){if(this.readOnly===true){return false}return this.power.insertPower!==false},createRepeatTable:function(){var render=this.render,repeatParentElement=this.repeatParentElement,table=document.createElement("table");this.formRender.createAttributes(table,render.attributes);if(null!=repeatParentElement){repeatParentElement.appendChild(table)}this.formRender.createColGroup(render,table);var tbody=document.createElement("tbody");table.appendChild(tbody);for(var i=0,len=render.renders.length;i<len;i++){if(render.renders[i]["repeating"]!==true){var child=this.formRender.createLayout(render.renders[i],this.initData,this.path);$(child).addClass("infoplus_repeatingTableHeader");tbody.appendChild(child)}}return tbody},initRepeatTableBody:function(){if(this.isRepeatTable()){this.repeatTableBody=this.createRepeatTable();var contentRowIndex=-1;for(var i=0,len=this.render.renders.length;i<len;i++){if(this.render.renders[i]["repeating"]===true){contentRowIndex=i;break}}if(contentRowIndex!==-1){this.render=this.render.renders[contentRowIndex]}else{$IU.delayedErrorMessageBox($$.lt("repeatControl.settingError",this.groupName))}this.repeatContentParentElement=this.repeatTableBody}},initRepeatableNewData:function(){var fieldNames=this.fieldNames,entity=$$.entity;var newData={};for(var index=0;index<fieldNames.length;index++){var fieldName=fieldNames[index];if(entity.fields[fieldName]==null){$IU.debugTip($$.lt("repeatControl.fieldNotFound",fieldName),"warning");this.newRepeatData=newData;return}var permission=entity.fields[fieldName].permission||"";if(entity.fields[fieldName].initialValue!==undefined&&(permission.indexOf("w")!==-1||permission.indexOf("t")!==-1)){newData[fieldName]=entity.fields[fieldName].initialValue;if(entity.fields[fieldName].initialText!==undefined){newData[fieldName+"_displayText"]=entity.fields[fieldName].initialText}}else{newData[fieldName]=""}}this.newRepeatData=newData},sliceEntity:function(data,index,dice){var slice={};slice.keyCount=0;slice.data={};for(var key in data){if(data.hasOwnProperty(key)){var entity=data[key];if($IU.isArray(entity)){var len=entity.length;if(index>=0&&index<len){if(null==dice||$IU.arrayContains(dice,key)){slice.keyCount++;slice.data[key]=entity[index]}}}}}return slice},createRepeatLayout:function(data,path){var child;if(this.isRepeatTable()){child=this.formRender.createLayout(this.render,data,path);$(child).children("td.detailCell").children().first().addClass("detailSection");child.setAttribute("id",this.groupName+"_row_"+Math.round(Math.random()*100000));var columnVisible=this.columnVisible;for(var index=0,len=columnVisible.length;index<len;index++){if(columnVisible[index]===false){$(child).children("td:nth-child("+(index+1)+")").hide()}}}else{var innerChild=this.formRender.createLayout(this.render,data,path);child=document.createElement("div");child.appendChild(innerChild);$(child).attr("class",$(innerChild).attr("class"));$(innerChild).removeAttr("class");if(innerChild.style.width!=null){child.style.width=innerChild.style.width}}this.addRowIndexControl(child,path);return child},initRepeatable:function(repeatChildElement,subPath,keyIndex){$(repeatChildElement).data($Control.DATA_PATH,subPath);repeatChildElement.repeatParentElement=this.repeatParentElement;repeatChildElement.popupMenu=this.popupMenu;repeatChildElement.isRepeatTable=this.isRepeatTable();repeatChildElement.keyIndex=keyIndex},createRepeatSectionExpandButton:function(parentElement){if(parentElement==null){return}var siblings=$(parentElement).children();var repeatSectionDiv=siblings[0];var menuDiv=siblings[siblings.length-1];var expandDiv=document.createElement("div"),$expandDiv=$(expandDiv);$expandDiv.addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND_BUTTON).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRINK).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND_BUTTON_OPACITY).attr("title",$$.lt("repeatControl.shrink")).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_MENU_DIV,menuDiv).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_DIV,repeatSectionDiv).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_DIV,parentElement);$expandDiv.hide();parentElement.appendChild(expandDiv);$(parentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_EXPAND_BUTTON,expandDiv)},changeErrorDivToTempClassName:function(oldId,newId,$foundErrorDivs,tempErrorDivSurfix,errorDivTempClassNames){var oldErrorDivClassName=oldId+"formError";for(var errorDivIndex=0;errorDivIndex<$foundErrorDivs.length;errorDivIndex++){if($foundErrorDivs[errorDivIndex].className.indexOf(oldErrorDivClassName)!==-1){var newErrorDivClassName=newId+tempErrorDivSurfix;$($foundErrorDivs[errorDivIndex]).removeClass(oldErrorDivClassName);$($foundErrorDivs[errorDivIndex]).addClass(newErrorDivClassName);errorDivTempClassNames.push(newErrorDivClassName)}}},changeErrorDivToNewClassName:function(errorDivTempClassNames,tempErrorDivSurfix){for(var index=0;index<errorDivTempClassNames.length;index++){var errorDivTempClassName=errorDivTempClassNames[index];var errorDiv=$("div."+errorDivTempClassName)[0];$(errorDiv).removeClass(errorDivTempClassName);$(errorDiv).addClass(errorDivTempClassName.substring(0,errorDivTempClassName.length-tempErrorDivSurfix.length)+"formError")}},changeRadioControlToTempName:function(control,newControlPath,tempRadioControlSurfix,radioControls){control.name=$(control).data($Control.DATA_FIELD)+newControlPath+tempRadioControlSurfix;radioControls.push(control)},changeRadioControlToNewName:function(radioControls,tempRadioControlSurfix){for(var index=0;index<radioControls.length;index++){var radioControl=radioControls[index];radioControl.name=radioControl.name.substr(0,radioControl.name.length-tempRadioControlSurfix.length)}},changeControlPath:function(child,newPath,oldPath,$foundErrorDivs,errorDivTempClassNames,radioControls,tempRadioControlSurfix,tempErrorDivSurfix){var instance=this;$(child).find("."+$Control.CLASSNAME_CONTROL).each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);if(control==null||control.element==null){return}var controlElement=control.element,$controlElement=$(controlElement),oldControlPath=$controlElement.data($Control.DATA_PATH);if(oldControlPath==null){return}var newControlPath=newPath+oldControlPath.substr(oldPath.length);var hiddenInput=$controlElement.data($Control.DATA_ORIGIN_INPUT);var oldId=(hiddenInput==null)?controlElement.id:hiddenInput.id;var newId=oldId.substr(0,oldId.length-oldControlPath.length)+newControlPath;if(hiddenInput==null){if(controlElement.type!=="radio"){$controlElement.attr("name",$controlElement.data($Control.DATA_FIELD)+newControlPath)}else{instance.changeRadioControlToTempName(controlElement,newControlPath,tempRadioControlSurfix,radioControls)}controlElement.id=newId}else{hiddenInput.name=$controlElement.data($Control.DATA_FIELD)+newControlPath;hiddenInput.id=newId}$controlElement.data($Control.DATA_PATH,newControlPath);if(control.controlType===$Control.CONTROL_TYPE_DATE){var date=control;date.reInitDatePicker()}control.path=newControlPath;if($controlElement.hasClass($Control.CLASSNAME_ROWINDEX)){control.setValue(instance.getRowIndex(newControlPath))}instance.changeErrorDivToTempClassName(oldId,newId,$foundErrorDivs,tempErrorDivSurfix,errorDivTempClassNames)})},changeParentElementPath:function(child,newPath,oldPath){var $repeatParentElements=$(child).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT);for(var i=0;i<$repeatParentElements.length;i++){var repeatParentElement=$repeatParentElements[i],repeatCtrl=$(repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);var oldParentElementPath=repeatCtrl.path;if(oldParentElementPath==null){continue}var newParentElementPath=newPath+oldParentElementPath.substr(oldPath.length);repeatCtrl.path=newParentElementPath;repeatParentElement.id=repeatCtrl.groupName+newParentElementPath;$(repeatParentElement).attr("name",repeatParentElement.id)}},changeRepeatElementPath:function(child,newPath,oldPath){var $repeatControls=$(child).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION+",."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW);for(var i=0;i<$repeatControls.length;i++){var $repeatControl=$($repeatControls[i]);var oldElementPath=$repeatControl.data($Control.DATA_PATH);if(oldElementPath==null){continue}var newElementPath=newPath+oldElementPath.substr(oldPath.length);$repeatControl.data($Control.DATA_PATH,newElementPath)}},changeKeyIndex:function(repeatParentElement,newKeyIndex){if(this.isRepeatSection()){$(repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT).keyIndex=newKeyIndex}else{$($(repeatParentElement).parent().parent()[0]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT).keyIndex=newKeyIndex}},getRepeatChildren:function(){return $(this.repeatContentParentElement).children(this.isRepeatSection()?"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW)},getRepeatChild:function(index){var children=this.getRepeatChildren();if(index<children.length){return children[index]}return null},updateRepeatParentElementKeyIndex:function(){var $repeatableChildren=this.getRepeatChildren();var newKeyIndex=[];for(var index=0;index<$repeatableChildren.length;index++){var child=$repeatableChildren[index];newKeyIndex.push(child.keyIndex)}this.keyIndex=newKeyIndex},reorganizeRepeatableElement:function(updateErrorDivPosition){var $rows=$(this.repeatContentParentElement).find(this.isRepeatSection()?"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW);$rows.each(function(){var $row=$(this);if($row.is(":animated")){$row.stop(true,true)}});var $repeatableChildren=this.getRepeatChildren();var radioControls=[];var errorDivTempClassNames=[];var tempRadioControlSuffix="_radio_temp";var tempErrorDivSuffix="_errorDiv_temp";var newKeyIndex=[];var $foundErrorDivs=$("body > div.formError");for(var index=0,len=$repeatableChildren.length;index<len;index++){var child=$repeatableChildren[index];var $child=$(child);newKeyIndex.push(child.keyIndex);var oldPath=$child.data($Control.DATA_PATH);var oldPathSplit=oldPath.split("_");if(parseInt(oldPathSplit[oldPathSplit.length-1])===index){continue}oldPathSplit.shift();var newPath="";for(var i=0;i<oldPathSplit.length-1;i++){newPath+="_"+oldPathSplit[i]}newPath+="_"+index;$child.data($Control.DATA_PATH,newPath);this.changeControlPath(child,newPath,oldPath,$foundErrorDivs,errorDivTempClassNames,radioControls,tempRadioControlSuffix,tempErrorDivSuffix);this.changeParentElementPath(child,newPath,oldPath);this.changeRepeatElementPath(child,newPath,oldPath)}this.changeRadioControlToNewName(radioControls,tempRadioControlSuffix);this.changeErrorDivToNewClassName(errorDivTempClassNames,tempErrorDivSuffix);if(updateErrorDivPosition){$IU.updateFormTipsAndViews()}this.keyIndex=newKeyIndex},createRepeatableRow:function(repeatIndex,repeatData,keyIndex){var subPath=this.path+"_"+repeatIndex,child=this.createRepeatLayout(repeatData,subPath);this.initRepeatable(child,subPath,repeatIndex);this.repeatContentParentElement.appendChild(child);if(this.isRepeatTable()){$(child).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW)}else{$(child).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION);this.createRepeatSectionExpandButton(child)}keyIndex.push(repeatIndex);return child},createRepeatableContent:function(data){var repeatIndex=0,dataSlice=this.sliceEntity(data,repeatIndex,this.fieldNames),keyIndex=[],minOccur=this.groupInformation.minOccur==null?0:this.groupInformation.minOccur;if(dataSlice.keyCount===0){if(minOccur>0&&this.power.insertPower===true){while(repeatIndex<minOccur){var repeatData=this.newRepeatData;var row=this.createRepeatableRow(repeatIndex,repeatData,keyIndex);this.formRender.doDynamicFormulaControls=this.formRender.doDynamicFormulaControls.concat($IU.getAllControls(row));repeatIndex++}}}else{while(dataSlice.keyCount>0){repeatData=dataSlice.data;this.createRepeatableRow(repeatIndex,repeatData,keyIndex);dataSlice=this.sliceEntity(data,++repeatIndex,this.fieldNames)}}this.keyIndex=keyIndex;this.updateCountControl()},deleteRepeat:function(repeat,reorganize,ignoreFieldRefer){var $repeat=$(repeat);if(ignoreFieldRefer===undefined){ignoreFieldRefer=false}if(!ignoreFieldRefer){var excludePath=$repeat.data($Control.DATA_PATH);var render=this.formRender;$$.dynamics.cache.build();$repeat.find("."+$Control.CLASSNAME_CONTROL).each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);if(control==null||control.field===undefined||control.element===undefined){return}if(control.onFieldRefer){control.fieldReferEvent(render,true,false,false,false,false,excludePath)}})}$IU.clearErrorPrompt(repeat);$repeat.empty();$repeat.remove();if(reorganize){this.reorganizeRepeatableElement(true);if(this.repeatAddLink!=null){if(this.shouldShowAddLink()){this.repeatAddLink.showLink()}}}this.updateCountControl()},addRepeatingClass:function(child){if(this.isRepeatSection()){$(child).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION)}else{$(child).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW)}},addMenuButton:function(child){if(this.isRepeatSection()){this.createRepeatSectionExpandButton(child)}else{}},reorganizeAndUpdateKeyIndex:function(reorganize){if(reorganize){this.reorganizeRepeatableElement(false)}else{this.updateRepeatParentElementKeyIndex()}},showRepeatWithEffect:function(repeatCtrl,moveUp,callback){var effectName=this.isRepeatSection()?"slide":"highlight";var options=this.isRepeatSection()?{direction:moveUp?"down":"up"}:{color:"#BFD0E6"};if(callback!=null&&typeof callback==="function"){if(!$(repeatCtrl).is(":visible")){$(repeatCtrl).show(effectName,options,"slow",callback)}else{callback()}}else{if(!$(repeatCtrl).is(":visible")){$(repeatCtrl).show(effectName,options,"slow")}}},doDynamicsAfterCreate:function(controls){var formRender=this.formRender,repeatControl=this;$$.dynamics.cache.build();for(var i=0,len=controls.length;i<len;i++){var control=controls[i];control.setDynamicStyle(formRender);control.setDynamicValue(formRender);control.doDynamicAction(formRender);if(control.onFieldRefer){control.fieldReferEvent(formRender,true,false,false,false,false)}}repeatControl.setDynamicStyle(formRender)},createAfterShowCallback:function(controls,newRow){var firstControlNamePrefix=this.firstControlNamePrefix,shouldShowAddLink=this.shouldShowAddLink(),repeatAddLink=!shouldShowAddLink?this.repeatAddLink:null,formRender=this.formRender,repeatControl=this;return function(){if(firstControlNamePrefix!=null){$IU.setFocusToElement(firstControlNamePrefix+$(this).data($Control.DATA_PATH))}$IU.updateFormTipsAndViews();$IU.rebindValidationEngine();if(repeatAddLink!=null){if(!shouldShowAddLink){repeatAddLink.hideLink()}}$$.addedRepeat(repeatControl,newRow);$$(repeatControl).addedRepeat(newRow)}},appendChildToLast:function(child){if(this.isRepeatSection()){var $addLinkDiv=$(this.repeatContentParentElement).children("."+InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK_CONTAINER_DIV);if($addLinkDiv.length>0){$addLinkDiv.before(child)}else{$(this.repeatContentParentElement).append(child)}}else{$(this.repeatContentParentElement).append(child)}},addLayoutToDom:function(child){if(this.popupMenu!=null&&this.popupMenu.repeatSection!=null){$(this.popupMenu.repeatSection).after(child)}else{this.appendChildToLast(child)}},getRowIndex:function(path){var pathArray=path.split("_");return parseInt(pathArray[pathArray.length-1],10)},addRowIndexControl:function(row,path){var fakeField={name:this.rowIndexFieldName,type:$Control.DATA_TYPE_INT,permission:"rw"};var fakeRender={renderCategory:"Boundable",controlId:this.rowIndexFieldName,field:this.rowIndexFieldName};var hiddenControl=new $Controls.Hidden(path,fakeField,fakeRender,this.getRowIndex(path));$(hiddenControl.element).addClass($Control.CLASSNAME_ROWINDEX);$(row).append(hiddenControl.element);return hiddenControl},initCountControl:function(){var path=this.path;var fakeField={name:this.groupCountFieldName,type:$Control.DATA_TYPE_INT,permission:"rw"};var fakeRender={renderCategory:"Boundable",controlId:this.groupCountFieldName,field:this.groupCountFieldName};var hiddenControl=new $Controls.Hidden(path,fakeField,fakeRender,0);$(hiddenControl.element).addClass($Control.CLASSNAME_GROUP_COUNT);$(this.repeatParentElement).append(hiddenControl.element);return hiddenControl},updateCountControl:function(){var countControl=$(this.repeatParentElement).children("."+$Control.CLASSNAME_GROUP_COUNT).data($Control.DATA_CONTROL_OBJECT);var rowClass=this.isRepeatSection()?repeatControl.CLASS_REPEAT_SECTION:repeatControl.CLASS_REPEAT_TABLE_ROW;var count=$(this.repeatContentParentElement).children("."+rowClass).length;if(countControl!=null){countControl.setValue(count)}},addDetailDialogScrollEvent:function(dialog){var updateFlag;$(dialog.element).find(".dialog_content").on("scroll",function(){if(updateFlag===undefined){updateFlag=setTimeout(function(){updateFlag=undefined;$IU.updateFormTipsAndViews()},300)}$(this).find(".infoplus_popupMenu").each(function(){if($(this).is(":visible")){if($(this).data("menu").repeatSection!=null){var repeatable=$(this).data("menu").repeatSection;var pos=$IU.getElementPosition(repeatable),offsetLeft=pos.left+repeatable.offsetWidth,offsetTop=pos.top;offsetTop-=$(repeatable).parents(".dialog_content").scrollTop();var minTop=parseInt($(repeatable).parents(".dialog_body").css("padding-top"),10)+$(repeatable).parents(".dialog_body").children(".dialog_title").outerHeight();if(offsetTop<minTop){offsetTop=minTop}$(this).css("left",offsetLeft).css("top",offsetTop)}}})})},addRepeat:function(data,path,addToDom,scrollToNewRow,updateRowIndex,fromAddClick){if(data==null){data=this.newRepeatData}if(path==null){path=this.getNewPath()}var formRender=this.formRender;if(addToDom){formRender.save(null,false)}var child=this.createRepeatLayout(data,path),$child=$(child);this.initRepeatable(child,path,repeatControl.NEW_ROW_INDEX);child.style.display="none";$child.data("isAdded",true);this.addRepeatingClass(child);if(addToDom){var controls=$IU.getAllControls(child);this.addLayoutToDom(child);this.updateCountControl();this.reorganizeRepeatableElement(false);formRender.initFieldReferedClass();if(updateRowIndex===true){$(child).children("."+$Control.CLASSNAME_ROWINDEX).change()}if(scrollToNewRow===true){if(this.popupMenu!=null&&this.popupMenu.repeatSection!=null){var $currentRow=$(this.popupMenu.repeatSection),currentRowBottom=$currentRow.offset().top+$currentRow.outerHeight();if($currentRow.outerHeight()>30){currentRowBottom+=30}}else{currentRowBottom=$(this.repeatAddLink.linkDiv).offset().top;currentRowBottom+=30}if(currentRowBottom>$(document).scrollTop()+$(window).height()){setTimeout(function(){$IU.scrollTo(currentRowBottom-$("#command_holder").outerHeight()-30-10,500)},100)}}if(this.groupInformation.isMasterDetail&&fromAddClick){var instance=this;var $detailCell=$child.find("td.detailCell"),$detailContent=$detailCell.children();$detailContent.css("height","auto");$$.addingRepeat(this,child);$$(this).addingRepeat(child);this.doDynamicsAfterCreate(controls);if(!$IU.isDynamicInvisible($child)){$child.show()}var afterShowCallback=this.createAfterShowCallback(controls,child);afterShowCallback();var options={title:this.getDetailTitle(),content:$detailContent,buttons:[{name:$$.lt("common.ok"),callback:function(){$detailContent.detach().appendTo($detailCell)},callOnClose:true,defaultButton:true},{name:$$.lt("common.cancel"),callback:function(){instance.deleteRepeat(child,true)}}]};$IU.clearAllError();if(!$$.MOBILE){options.container=$$.params.renderForm;options.overflow="visible";options.lowZindex=true;options.maxWidth="95%";options.autoWidth=true;options.autoHeight=true;options.backgroundNoScroll=true;var dialog=new InfoPlus.Render.Dialog(options);dialog.show();this.addDetailDialogScrollEvent(dialog)}else{options.onShow=function(){instance.showingDetail=false};this.showingDetail=true;var page=new InfoPlus.Render.Mobile.Page(options);page.show()}}else{$$.addingRepeat(this,child);$$(this).addingRepeat(child);this.doDynamicsAfterCreate(controls);if(!$IU.isDynamicInvisible($child)){this.showRepeatWithEffect(child,false,this.createAfterShowCallback(controls,child))}else{afterShowCallback=this.createAfterShowCallback(controls,child);afterShowCallback()}}}return child},getDetailTitle:function(){if(this.groupInformation&&!$IU.isEmptyStr(this.groupInformation.description)){return this.groupInformation.description}else{return $$.lt("repeatControl.detail")}},showDetail:function(repeatSection){if(this.showingDetail){return}var $repeatSection=$(repeatSection);if(this.isRepeatTable()&&this.groupInformation.isMasterDetail){var instance=this;var shouldShowDeleteButton=function(){if(instance.readOnly===true){return false}if($repeatSection.data("isAdded")!==undefined){if($repeatSection.data("isAdded")===true){return true}}return instance.power.deletePower};var $detailCell=$(repeatSection).find("td.detailCell"),$detailContent=$detailCell.children();$detailContent.css("height","auto");$IU.clearAllError();var options={title:this.getDetailTitle(),content:$detailContent,onShow:function(){setTimeout(function(){instance.showingDetail=false;if($repeatSection.data("showDetailError")===true){$repeatSection.removeData("showDetailError");var controls=$detailContent.find("*[class*='validate']").filter($IU.isValidateControlFilter);$IU.checkControlValidation(controls,true,false)}var diffs=$detailContent.data("diffs");if(diffs!=null){var types={"new":"infoTip",modify:"warningTip","delete":"errorTip"};var onClose=function(control){return function(){control.clearModified()}};for(var i=0,len=diffs.length;i<len;i++){var control=diffs[i].control,diffObj=diffs[i].diff;if((control.controlContainer!=null&&$(control.controlContainer).is(":visible"))||$(control.element).is(":visible")){var hoverText=null;if(diffObj.type==="delete"||diffObj.type==="modify"){hoverText=(diffObj.value===""?$$.lt("compare.previousValue.empty"):($$.lt("compare.previousValue.previous")+diffObj.value))}diffs[i].tip=new InfoPlus.Render.PopTip({popper:control.controlContainer||control.element,container:!$$.MOBILE?dialog.element:page.element,text:$$.lt("compare.compareType.type"+diffObj.type.substr(0,1).toUpperCase()+diffObj.type.substr(1)),hoverText:hoverText,colorClass:types[diffObj.type],placement:"top",effect:"bounce",onClose:onClose(control)});control.markModified()}}}},300)},onClose:function(){var diffs=$detailContent.data("diffs");if(diffs!=null){for(var i=0,len=diffs.length;i<len;i++){diffs[i].tip.close(true)}}},buttons:[{name:$$.lt("common.close"),callback:function(){$detailContent.detach().appendTo($detailCell)},callOnClose:true,defaultButton:true}]};if(!$$.MOBILE){options.container=$$.params.renderForm;options.overflow="visible";options.lowZindex=true;options.maxWidth="95%";options.autoWidth=true;options.autoHeight=true;options.backgroundNoScroll=true;if(shouldShowDeleteButton()){options.buttons.push({name:$$.lt("common.deleteText"),className:"delete_detail_button",preventDefault:true,callback:function(){if(instance.groupInformation!=null&&instance.groupInformation.minOccur!=null&&instance.groupInformation.minOccur>0){if(instance.getRepeatChildren().length<=instance.groupInformation.minOccur){$IU.messageBox(null,$$.lt("popupMenu.minLimit"),null,300);return false}}$IU.yesNoBox((instance.isRepeatSection()?$$.lt("repeatControl.deleteSection"):$$.lt("repeatControl.deleteRow")),300,function(){dialog.close();instance.deleteRepeat(repeatSection,true)});return false}})}var dialog=new InfoPlus.Render.Dialog(options);dialog.show();this.addDetailDialogScrollEvent(dialog)}else{if(shouldShowDeleteButton()){options.buttons.push({name:$$.lt("common.deleteText"),className:"delete_detail_button",preventDefault:true,callback:function(){if(instance.groupInformation!=null&&instance.groupInformation.minOccur!=null&&instance.groupInformation.minOccur>0){if(instance.getRepeatChildren().length<=instance.groupInformation.minOccur){$IU.messageBox(null,$$.lt("popupMenu.minLimit"),null,300);return false}}$IU.yesNoBox((instance.isRepeatSection()?$$.lt("repeatControl.deleteSection"):$$.lt("repeatControl.deleteRow")),300,function(){page.close();instance.deleteRepeat(repeatSection,true)});return false}})}this.showingDetail=true;var page=new InfoPlus.Render.Mobile.Page(options);page.show()}}},moveDownRepeatSection:function(repeatSection){if(this.power.writePower===false){return}var $repeatSection=$(repeatSection),classSelectorName="."+(this.isRepeatSection()?InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),$next=$repeatSection.next(classSelectorName);if($next.length>0){var moveRepeatSectionTop=$repeatSection.offset().top+$next.outerHeight();if(moveRepeatSectionTop>$(document.body).scrollTop()+$(window).height()){setTimeout(function(){$IU.scrollTo(moveRepeatSectionTop-$("#command_holder").outerHeight()-10,500)},100)}$repeatSection.detach().insertAfter($next).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);this.reorganizeRepeatableElement(true);var instance=this;setTimeout(function(){instance.showRepeatWithEffect(repeatSection,false)},0)}},moveUpRepeatSection:function(repeatSection){if(this.power.writePower===false){return}var $repeatSection=$(repeatSection),classSelectorName="."+(this.isRepeatSection()?InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),$prev=$repeatSection.prev(classSelectorName);if($prev.length>0){var moveRepeatSectionTop=$prev.offset().top;if(moveRepeatSectionTop<$(document.body).scrollTop()+$("#command_holder").outerHeight()){setTimeout(function(){$IU.scrollTo(moveRepeatSectionTop-$("#command_holder").outerHeight()-10,500)},100)}$repeatSection.detach().insertBefore($prev).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);this.reorganizeRepeatableElement(true);var instance=this;setTimeout(function(){instance.showRepeatWithEffect(repeatSection,false)},0)}},moveRow:function(oldIndex,newIndex){if(oldIndex<0||newIndex<0){return}if(this.power.writePower===false){return}var $children=this.getRepeatChildren();if(oldIndex>=$children.length){return}if(newIndex>=$children.length){newIndex=$children.length-1}if(oldIndex===newIndex){return}var $moveRow=$($children[oldIndex]),$moveToRow=$($children[newIndex]);if(oldIndex<newIndex){$moveRow.detach().insertAfter($moveToRow)}else{$moveRow.detach().insertBefore($moveToRow)}this.reorganizeRepeatableElement(true);this.showRepeatWithEffect($moveRow[0],oldIndex>newIndex)},getNewPath:function(){var repeatSection=this.popupMenu!=null?this.popupMenu.repeatSection:null,repeatChildrenClassName="."+(this.isRepeatSection()?InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW),subPath;if(repeatSection!=null){var repeatLevel=$(repeatSection).data($Control.DATA_PATH).split("_");subPath=this.path+"_"+(Number(repeatLevel[repeatLevel.length-1])+1)}else{var childCount=$(this.repeatContentParentElement).children(repeatChildrenClassName).length;subPath=this.path+"_"+childCount}return subPath},getGroupIndexArray:function(groupObjArray){var indexArray=[],len=groupObjArray.length;for(var i=0;i<len;i++){indexArray.push(groupObjArray.groupIndex)}return indexArray},createFinishShowFlag:function(newChildren){var flag=[];for(var newIndex=0;newIndex<newChildren.length;newIndex++){if(newChildren[newIndex]===undefined){flag[newIndex]=true}else{flag[newIndex]=!$(newChildren[newIndex]).data("isNew")}}return flag},createAfterShowAllCallback:function(newRow,finishFlag,index){var shouldShowAddLink=this.shouldShowAddLink(),repeatAddLink=this.repeatAddLink,repeatControl=this;return function(){$$.addedRepeat(repeatControl,newRow);$$(repeatControl).addedRepeat(newRow);finishFlag[index]=true;var allDone=true;for(var i=0;i<finishFlag.length;i++){if(finishFlag[i]===false){allDone=false;break}}if(allDone){$$.params.renderForm.validationEngine("detach");$$.params.renderForm.validationEngine("attach");if(repeatAddLink!=null){if(!shouldShowAddLink){repeatAddLink.hideLink()}else{repeatAddLink.showLink()}}}}},convertData:function(data){var resultData={};for(var key in data){if(data.hasOwnProperty(key)){if(key==="entityIndex"){continue}var value=data[key];if($IU.isArray(value)){continue}if(key.length>0){var newKey="field"+key.substring(0,1).toUpperCase()+key.substring(1),field=$$.entity.fields[newKey];if(value.hasOwnProperty("attributes")){resultData[newKey+"_Attr"]=value.attributes}if(field!=null){var fieldType=field.type.toLocaleLowerCase();if(fieldType==="date"){if($IU.isString(value)){resultData[newKey]=$IU.dateStringToUnixTime(value)}else{resultData[newKey]=value}continue}if(fieldType==="user"||fieldType==="organize"||fieldType==="code"||value.codeId!=null){resultData[newKey]=value.codeId||"";resultData[newKey+"_displayText"]=value.codeName||"";continue}}resultData[newKey]=value}}}return resultData},addChildren:function(newData,newChildren){for(var newIndex=0,len=newChildren.length;newIndex<len;newIndex++){if(newChildren[newIndex]!=null){$(newChildren[newIndex]).data("isNew",false)}}for(newIndex=0,len=newData.length;newIndex<len;newIndex++){var entityIndex=newData[newIndex]["entityIndex"];if(entityIndex===-1||entityIndex===undefined){var newPath=this.path+"_"+newIndex;newChildren[newIndex]=this.addRepeat(this.convertData(newData[newIndex]),newPath,false,false,false,false);$(newChildren[newIndex]).data("isNew",true)}}for(newIndex=0;newIndex<newChildren.length;newIndex++){var newChild=newChildren[newIndex];if(newChild!==undefined){this.appendChildToLast(newChild);if($(newChild).data("isNew")===true){$$.addingRepeat(this,newChild);$$(this).addingRepeat(newChild)}}}},preprocessChangedDataGroup:function(newData){$IU.clearErrorPrompt(this.repeatParentElement);if($$.params.fieldChanging!=null){var $rows=$(this.repeatContentParentElement).find(this.isRepeatSection()?"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW);$rows.each(function(){var $row=$(this);if($row.is(":animated")){$row.stop(true,true)}})}var oldChildren=this.getRepeatChildren(),oldDataLen=oldChildren.length,newDataLen=newData.length,newChildren=[],notDeleted=[],shouldDeleted=[],newIndex;var getNewDataIndex=function(oldGroupIndex){for(var index=0;index<newDataLen;index++){if(oldGroupIndex===newData[index]["entityIndex"]){return index}}return -1};for(var oldIndex=0;oldIndex<oldDataLen;oldIndex++){var child=oldChildren[oldIndex];newIndex=getNewDataIndex(oldIndex);if(newIndex===-1){if(this.power.deletePower===false){notDeleted.push(child)}else{shouldDeleted.push(child)}}else{newChildren[newIndex]=child}}for(var delIndex=0,delLen=shouldDeleted.length;delIndex<delLen;delIndex++){var child=shouldDeleted[delIndex],isLast=(delIndex===delLen-1),isFieldChanging=($$.params.fieldChanging!=null);this.deleteRepeat(child,false,!isLast&&isFieldChanging)}if(this.power.deletePower===false&&notDeleted.length>0){for(var i=0,len=newData.length;i<notDeleted.length;i++){newChildren[i+len]=notDeleted[i]}}for(newIndex=0;newIndex<newChildren.length;newIndex++){var newChild=newChildren[newIndex];if(newChild!==undefined){$(newChild).detach()}}var formRender=this.formRender;formRender.save(null,false);this.addChildren(newData,newChildren);this.updateCountControl();this.reorganizeRepeatableElement(false);formRender.initFieldReferedClass();formRender.save(null,false);var dynamicStyles=$$.dynamics.styles;$$.dynamics.cache.build();$(this.repeatContentParentElement).find("."+$Control.CLASSNAME_CONTROL).each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);if(control==null||control.field===undefined||control.element===undefined){return}var fieldName=control.field.name;if(control.onFieldRefer){control.fieldReferEvent(formRender,true,false,false,true,true)}if(dynamicStyles[fieldName]!==undefined){$IU.saveOriginStyles(this)}});var finishShowFlag=this.createFinishShowFlag(newChildren);for(newIndex=0;newIndex<newChildren.length;newIndex++){newChild=newChildren[newIndex];if(newChild!==undefined){if($(newChild).data("isNew")===true){if($$.params.fieldChanging==null){this.showRepeatWithEffect(newChild,false,this.createAfterShowAllCallback(newChild,finishShowFlag,newIndex))}else{$(newChild).show();$$.addedRepeat(this,newChild);$$(this).addedRepeat(newChild)}}else{if($IU.getComputedStyle(newChild,"display")!=="none"){$(newChild).show()}}}}},setData:function(data){if(this.power.insertPower===false){var d=[];for(var i=0,len=data.length;i<len;i++){var repeatRow=data[i],isNew=repeatRow.entityIndex===repeatControl.NEW_ROW_INDEX||repeatRow.entityIndex===undefined;if(!isNew){d.push(repeatRow)}}data=d}this.preprocessChangedDataGroup(data);for(i=0,len=data.length;i<len;i++){repeatRow=data[i];isNew=repeatRow.entityIndex===repeatControl.NEW_ROW_INDEX||repeatRow.entityIndex===undefined;var newPath=this.path+"_"+i;$IU.setFormData(repeatRow,newPath,isNew)}},showPopupMenu:function(repeatable,isRepeatSection,isLastRow){var popupMenu=this.popupMenu;if(popupMenu==null){return}var $menuDiv=$(popupMenu.menuDiv);popupMenu.repeatSection=repeatable;popupMenu.adjustMenuItemVisibility();if(popupMenu.allMenuItemHide===true){return}if($$.MOBILE){var rootFontSize=parseFloat($("html").css("font-size"));var menuWidth=8;$menuDiv.find("."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM).each(function(){if($(this).css("display")!=="none"){menuWidth+=parseFloat($(this).css("width"))}});$menuDiv.css("width",(menuWidth/rootFontSize)+"rem")}if(!$$.MOBILE){var inDetailDialog=($(repeatable).parents(".detailSection").length>0);if(inDetailDialog){var pos=$IU.getElementPosition(repeatable),offsetLeft=pos.left+repeatable.offsetWidth,offsetTop=pos.top;offsetTop-=$(repeatable).parents(".dialog_content").scrollTop();var minTop=parseInt($(repeatable).parents(".dialog_body").css("padding-top"),10)+$(repeatable).parents(".dialog_body").children(".dialog_title").outerHeight();if(offsetTop<minTop){offsetTop=minTop}$menuDiv.css("position","fixed")}else{offsetLeft=repeatable.offsetLeft+repeatable.offsetWidth;offsetTop=repeatable.offsetTop}if(isRepeatSection===false){var tableElement=repeatable.parentNode.parentNode;offsetLeft+=tableElement.offsetLeft;offsetTop+=tableElement.offsetTop}}else{offsetTop=repeatable.offsetTop+repeatable.offsetHeight;var menuBottom=$menuDiv.parent().offset().top+offsetTop+$menuDiv.outerHeight(),screenBottom=$(document).scrollTop()+$(window).height();if($$.params.mobileAutoView&&isLastRow){offsetTop=repeatable.offsetTop-$menuDiv.outerHeight()}else{if(menuBottom>screenBottom){if(menuBottom-screenBottom<$menuDiv.outerHeight()){offsetTop=repeatable.offsetTop+repeatable.offsetHeight-$menuDiv.outerHeight()}else{offsetTop=screenBottom-(menuBottom-offsetTop)-2}}}var $repeatable=$(repeatable);if($repeatable.offset().left<0&&($repeatable.offset().left+$repeatable.width())>$(window).width()){offsetLeft=($(window).width()-$menuDiv.width())/2-$repeatable.offset().left}else{if($repeatable.offset().left<0||($repeatable.offset().left+$repeatable.width())>$(window).width()){if($repeatable.offset().left<0){offsetLeft=repeatable.offsetLeft-$repeatable.offset().left+((repeatable.offsetWidth+$repeatable.offset().left)-menuWidth)/2}else{offsetLeft=repeatable.offsetLeft+(($(window).width()-$repeatable.offset().left)-menuWidth)/2}}else{offsetLeft=repeatable.offsetLeft+(repeatable.offsetWidth-menuWidth)/2}if(offsetLeft+$menuDiv.parent().offset().left+$menuDiv.outerWidth()>$(window).width()){offsetLeft=$(window).width()-$menuDiv.outerWidth()-$menuDiv.parent().offset().left}if($menuDiv.parent().offset().left<0&&offsetLeft+$menuDiv.parent().offset().left<0){offsetLeft=-$menuDiv.parent().offset().left}}}$menuDiv.css("left",offsetLeft).css("top",offsetTop);if(popupMenu.strategy!==undefined){popupMenu.strategy.adjustShowPopupMenuPosition($menuDiv)}if($$.MOBILE){$menuDiv.slideDown(200)}else{$menuDiv.show()}},setColumnVisible:function(index,visible){if(this.repeatType!==repeatControl.REPEAT_TYPE_TABLE){return}var $table=$(this.repeatParentElement).children("table");if(visible){$table.children("colgroup").children("col:nth-child("+(index+1)+")").show();$IU.dynamicShowElement($table.children("tbody").children("tr").children("td:nth-child("+(index+1)+")"));$IU.dynamicShowElement($table.children("tr").children("td:nth-child("+(index+1)+")"))}else{$table.children("colgroup").children("col:nth-child("+(index+1)+")").hide();$IU.dynamicHideElement($table.children("tbody").children("tr").children("td:nth-child("+(index+1)+")"));$IU.dynamicHideElement($table.children("tr").children("td:nth-child("+(index+1)+")"))}this.columnVisible[index]=visible},getDynamicKeyName:function(){return this.groupName},getDynamicContextControlName:function(){return this.groupName},setDynamicStyle:function(render,fromInit){this.dynamicProcessor.processDynamicStyle(this,render,undefined,undefined,fromInit)},doDynamicAction:function(render,fromInit){this.dynamicProcessor.processDynamicAction(this,render,undefined,undefined,fromInit)},getRow:function(){var $repeat=$(this.repeatParentElement);return $repeat.parents("tr,.infoplus_repeatingSection,.infoplus_view").first()},setDynamicValue:function(){},setClass:function(className){$(this.repeatParentElement).addClass(className)},removeClass:function(className){$(this.repeatParentElement).removeClass(className);this.getRepeatChildren().removeClass(className)}};repeatControl.selectedRepeatRow=null;define("InfoPlus.Repeat.RepeatControl",repeatControl);var clearSelectedRow=function(row){if(InfoPlus.Repeat.RepeatControl.selectedRepeatRow!=null){if(InfoPlus.Repeat.RepeatControl.selectedRepeatRow!==row||$$.MOBILE){var $selectedRepeatRow=$(InfoPlus.Repeat.RepeatControl.selectedRepeatRow);$selectedRepeatRow.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED);if($selectedRepeatRow[0].popupMenu!=null){$selectedRepeatRow[0].popupMenu.hideMenu()}}}};var selectRow=function(repeatCtrl,row,isRepeatSection,isLastRow){$(row).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED);if(!$(row).is(":animated")){setTimeout(function(){var $childRow=$(row).find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION);var childIsAnimated=false;if($childRow.size()>0){for(var i=0;i<$childRow.size();i++){if($childRow.eq(i).is(":animated")){childIsAnimated=true}}}if(!childIsAnimated){repeatCtrl.showPopupMenu(row,isRepeatSection,isLastRow)}else{setTimeout(function(){repeatCtrl.showPopupMenu(row,isRepeatSection,isLastRow)},500)}},0)}else{setTimeout(function(){repeatCtrl.showPopupMenu(row,isRepeatSection,isLastRow)},500)}InfoPlus.Repeat.RepeatControl.selectedRepeatRow=row};var repeatControlEvents={onRepeatSectionExpandButtonClick:function(withoutAnimate){var $button=$(this),$repeatDiv=$($button.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_DIV)),$repeatParentDiv=$($button.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_DIV));var expandRepeatSection=function(){$button.hide();$button.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRINK).attr("title",$$.lt("repeatControl.shrink"));$repeatDiv.css("overflow-y","");$repeatParentDiv.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRUNKEN);if(withoutAnimate===undefined){$repeatDiv.animate({height:$button.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_EXPAND_HEIGHT)+"px"},500,function(){$repeatDiv.css("height","");$button.show()})}else{$repeatDiv.css("height","");$button.show()}};var shrinkRepeatSection=function(){$button.hide();$button.data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_SECTION_EXPAND_HEIGHT,$repeatDiv.height());$repeatDiv.css("overflow-y","hidden");$repeatParentDiv.addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRUNKEN);$repeatDiv.animate({height:InfoPlus.Repeat.RepeatControl.REPEAT_SECTION_SHRINK_HEIGHT+"px"},500,function(){$button.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_SHRINK).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND).attr("title",$$.lt("repeatControl.expand")).show()})};var $errors=$(".formError");if(withoutAnimate){$errors.remove()}else{$errors.fadeTo("fast",0.3,function(){$(this).remove()})}if($button.hasClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION_EXPAND)){expandRepeatSection()}else{shrinkRepeatSection()}},onRepeatSectionTouchStart:function(event){if(this.popupMenu!=null){this.popupMenu.menuResetTimeout();clearSelectedRow(this);event.stopPropagation()}},onRepeatSectionTouchEnd:function(event){if(this.popupMenu!=null){var repeatControl=$(this.repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);selectRow(repeatControl,this,true);event.stopPropagation()}},onRepeatSectionMouseEnter:function(){if($$.MOBILE){return false}if(this.popupMenu==null){return false}this.popupMenu.menuResetTimeout();clearSelectedRow(this);var repeatControl=$(this.repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);selectRow(repeatControl,this,true);return false},onRepeatSectionMouseLeave:function(event){if(this.popupMenu==null){return false}$(this).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);if($$.MOBILE&&InfoPlus.Repeat.RepeatControl.selectedRepeatRow!==this){return false}var $repeatParentRow=$$.MOBILE?null:$(this.repeatParentElement).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION);if(this.popupMenu!=null){this.popupMenu.menuStartTimeout(this.popupMenu.menuTimeout,event.pageX,event.pageY,$repeatParentRow)}},onRepeatTableRowTouchStart:function(event){if(this.popupMenu!=null){this.popupMenu.menuResetTimeout();clearSelectedRow(this);event.stopPropagation()}},onRepeatTableRowTouchEnd:function(event){if(this.popupMenu!=null){var repeatControl=$($(this).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT)[0]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);selectRow(repeatControl,this,false,$(this).next("tr").length===0);event.stopPropagation()}},onRepeatTableRowMouseEnter:function(){if($$.MOBILE){return false}if(this.popupMenu==null){return false}this.popupMenu.menuResetTimeout();clearSelectedRow(this);var repeatControl=$($(this).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT)[0]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);selectRow(repeatControl,this,false);return false},onRepeatTableRowMouseLeave:function(event){if(this.popupMenu==null){return false}$(this).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);if($$.MOBILE&&InfoPlus.Repeat.RepeatControl.selectedRepeatRow!==this){return false}var $repeatParentRow=$$.MOBILE?null:$(this).parents("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION);if(this.popupMenu!=null){this.popupMenu.menuStartTimeout(this.popupMenu.menuTimeout,event.pageX,event.pageY,$repeatParentRow)}},onAddLinkClick:function(){var repeatCtrl=$(this.repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);var popupMenu=repeatCtrl.popupMenu;if(popupMenu!=null&&repeatCtrl.readOnly===false){popupMenu.repeatSection=null;popupMenu.onAddClick()}return false},onMenuMouseLeave:function(event){if($$.MOBILE){return false}$(this).data("menu").menuStartTimeout($(this).data("menu").menuTimeout,event.pageX,event.pageY)},onMenuMouseEnter:function(){if($$.MOBILE){return false}$(this).data("menu").menuResetTimeout()},onMenuItemMouseLeave:function(){if($$.MOBILE){return false}if($(this).data("menuType")!==InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION){$(this).removeClass("infoplus_repeatMenuOn")}},onMenuItemMouseEnter:function(){if($$.MOBILE){return false}if($(this).data("menuType")!==InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION){$(this).addClass("infoplus_repeatMenuOn");$(this).data("menu").menuResetTimeout()}},onMenuItemTouchStart:function(event){event.stopPropagation()},onMenuItemTouchEnd:function(event){var menu=$(this).data("menu");setTimeout(function(){$(menu.menuDiv).hide()},100);$(menu.repeatSection).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);switch($(this).data("menuType")){case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP:menu.onMoveUpClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN:menu.onMoveDownClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD:menu.onAddClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE:$IU.yesNoBox((menu.isRepeatSection()?$$.lt("repeatControl.deleteSection"):$$.lt("repeatControl.deleteRow")),300,function(){menu.onDeleteClick()});break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION:break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL:menu.onDetailClick();break}event.stopPropagation()},onMenuItemClick:function(){if($$.MOBILE){return false}var menu=$(this).data("menu");if($$.MOBILE){setTimeout(function(){$(menu.menuDiv).hide()},100)}else{$(menu.menuDiv).hide()}$(menu.repeatSection).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED).removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);switch($(this).data("menuType")){case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP:menu.onMoveUpClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN:menu.onMoveDownClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD:menu.onAddClick();break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE:$IU.yesNoBox((menu.isRepeatSection()?$$.lt("repeatControl.deleteSection"):$$.lt("repeatControl.deleteRow")),300,function(){menu.onDeleteClick()});break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION:break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL:menu.onDetailClick();break}}};repeatControlEvents.events=[{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"touchstart",handler:repeatControlEvents.onRepeatSectionTouchStart},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"touchend",handler:repeatControlEvents.onRepeatSectionTouchEnd},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"mouseenter",handler:repeatControlEvents.onRepeatSectionMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION,type:"mouseleave",handler:repeatControlEvents.onRepeatSectionMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"touchstart",handler:repeatControlEvents.onRepeatTableRowTouchStart},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"touchend",handler:repeatControlEvents.onRepeatTableRowTouchEnd},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"mouseenter",handler:repeatControlEvents.onRepeatTableRowMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW,type:"mouseleave",handler:repeatControlEvents.onRepeatTableRowMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK,type:"click",handler:repeatControlEvents.onAddLinkClick},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_POPUP_MENU,type:"mouseenter",handler:repeatControlEvents.onMenuMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_POPUP_MENU,type:"mouseleave",handler:repeatControlEvents.onMenuMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"mouseenter",handler:repeatControlEvents.onMenuItemMouseEnter},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"mouseleave",handler:repeatControlEvents.onMenuItemMouseLeave},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"click",handler:repeatControlEvents.onMenuItemClick},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"touchstart",handler:repeatControlEvents.onMenuItemTouchStart},{selector:"."+InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM,type:"touchend",handler:repeatControlEvents.onMenuItemTouchEnd}];define("InfoPlus.Repeat.RepeatControl.Events",repeatControlEvents)})(window);
(function(window,undefined){var repeatPower=function(groupInformation){if(groupInformation==null||groupInformation.permission==null){this.readPower=false;this.enforceReadPower=false;this.writePower=false;this.insertPower=false;this.deletePower=false}else{var permission=(groupInformation.permission||"");this.readPower=(permission.indexOf("r")!==-1);this.enforceReadPower=(permission.indexOf("R")!==-1);this.writePower=(permission.indexOf("w")!==-1);this.insertPower=(permission.indexOf("i")!==-1);this.deletePower=(permission.indexOf("d")!==-1)}};repeatPower.prototype={readPower:false,enforceReadPower:false,writePower:false,insertPower:false,deletePower:false};define("InfoPlus.Repeat.RepeatPower",repeatPower)})(window);
(function(window,undefined){var repeatAddLink=function(repeatParentElement,offsetLeft,linkText){this.repeatParentElement=repeatParentElement;if(linkText==="Insert item"||linkText===""){linkText=$$.lt("repeatAddLink.addText")}this.createLinkDiv(offsetLeft,linkText)};repeatAddLink.prototype={repeatParentElement:null,linkDiv:null,createLinkDiv:function(offsetLeft,linkText){var child=document.createElement("a");child.className=InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK;child.href="javascript:void(0);";child.innerHTML=(linkText==null?$$.lt("repeatAddLink.addText"):linkText);$(child).css("text-align","left");child.repeatParentElement=this.repeatParentElement;var div=document.createElement("div");$(div).css("display","none").css("left",offsetLeft+"px").addClass(InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK_DIV);div.appendChild(child);this.linkDiv=div;var container=document.createElement("div");$(container).addClass(InfoPlus.Repeat.RepeatControl.CLASS_ADD_LINK_CONTAINER_DIV).append(this.linkDiv);this.repeatParentElement.appendChild(container)},showLink:function(){$(this.linkDiv).show()},hideLink:function(){$(this.linkDiv).hide()}};define("InfoPlus.Repeat.RepeatAddLink",repeatAddLink)})(window);
(function(window,undefined){var popupMenu=function(repeatControl){this.repeatControl=repeatControl;this.render=repeatControl.formRender;this.repeatParentElement=repeatControl.repeatParentElement;this.createMenuDiv();this.strategy=new InfoPlus.Repeat.PopupMenu.Strategy()};popupMenu.MENU_ITEM_TYPE_MOVEUP=0;popupMenu.MENU_ITEM_TYPE_MOVEDOWN=1;popupMenu.MENU_ITEM_TYPE_ADD=2;popupMenu.MENU_ITEM_TYPE_DELETE=3;popupMenu.MENU_ITEM_TYPE_NO_ACTION=4;popupMenu.MENU_ITEM_TYPE_DETAIL=5;popupMenu.prototype={menuDiv:null,menuButton:null,repeatParentElement:null,repeatSection:null,render:null,hideMenuTimer:null,menuTimeout:200,menuItemMoveUp:null,menuItemMoveDown:null,menuItemAdd:null,menuItemDelete:null,menuItemNoAction:null,allMenuItemHide:false,menuOverMenuItem:function(){this.menuResetTimeout()},menuStartTimeout:function(hideTimeout,x,y,$repeatParentRow){this.menuResetTimeout();this.hideMenuTimer=setTimeout($.proxy(this.hideMenuWithMousePosition,this,x,y,$repeatParentRow),hideTimeout)},menuResetTimeout:function(){if(this.hideMenuTimer!=null){clearTimeout(this.hideMenuTimer)}this.hideMenuTimer=null},createMenuDiv:function(){var menuDiv=document.createElement("ul");menuDiv.id=""+Math.round(Math.random()*100000);this.menuDiv=menuDiv;$(menuDiv).data("menu",this);menuDiv.style.display="none";$(menuDiv).addClass(InfoPlus.Repeat.RepeatControl.CLASS_POPUP_MENU);this.menuItemDetail=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL);this.menuItemMoveUp=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP);this.menuItemMoveDown=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN);this.menuItemAdd=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD);this.menuItemDelete=this.createMenuItem(InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE);this.repeatParentElement.appendChild(this.menuDiv)},createMenuItem:function(menuItemType){var menuItemDiv=document.createElement("li");$(menuItemDiv).addClass(InfoPlus.Repeat.RepeatControl.CLASS_MENU_ITEM);$(menuItemDiv).data("menu",this).data("menuType",menuItemType);switch(menuItemType){case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEUP:$(menuItemDiv).text($$.lt("popupMenu.up"));$(menuItemDiv).addClass("infoplus_menuUp");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_MOVEDOWN:$(menuItemDiv).text($$.lt("popupMenu.down"));$(menuItemDiv).addClass("infoplus_menuDown");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_ADD:$(menuItemDiv).text($$.lt("popupMenu.add"));$(menuItemDiv).addClass("infoplus_menuAdd");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DELETE:$(menuItemDiv).text($$.lt("popupMenu.deleteText"));$(menuItemDiv).addClass("infoplus_menuDelete");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_NO_ACTION:$(menuItemDiv).text($$.lt("popupMenu.noAction"));$(menuItemDiv).addClass("infoplus_menuNoAction");break;case InfoPlus.Repeat.PopupMenu.MENU_ITEM_TYPE_DETAIL:$(menuItemDiv).text($$.lt("popupMenu.detail"));$(menuItemDiv).addClass("infoplus_menuDetail");break}this.menuDiv.appendChild(menuItemDiv);return menuItemDiv},hideMenuWithMousePosition:function(x,y,$repeatParentRow){if(this.repeatSection!=null){var $section=$(this.repeatSection);$section.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_MENU_POPUPED);var pos=$IU.getElementPosition(this.repeatSection);if(!(x>=pos.left&&x<=pos.left+this.repeatSection.scrollWidth&&y>=pos.top&&y<=pos.top+this.repeatSection.scrollHeight)){$section.removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED);if(this.isRepeatSection()){}else{}}}this.hideMenu();if($repeatParentRow!=null&&$repeatParentRow.length>0){var repeatControl=$($repeatParentRow[0].repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);repeatControl.showPopupMenu($repeatParentRow[0],true);InfoPlus.Repeat.RepeatControl.selectedRepeatRow=$repeatParentRow[0];$($repeatParentRow[0]).addClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SELECTED)}},hideMenu:function(){$(this.menuDiv).hide()},shouldShowDetailMenu:function(){if(this.repeatSection==null){return false}if(this.isRepeatSection()){return false}if(this.repeatControl.power.readPower===false){return false}return this.repeatControl.groupInformation.isMasterDetail===true},shouldShowMoveUpMenu:function(){if(this.repeatSection==null){return false}if(this.repeatControl.readOnly===true){return false}if(this.repeatControl.power.writePower===false){return false}if(this.isRepeatSection()){return $(this.repeatSection).prev("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION).length!==0}else{return $(this.repeatSection).prev("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW).length!==0}},shouldShowMoveDownMenu:function(){if(this.repeatSection==null){return false}if(this.repeatControl.readOnly===true){return false}if(this.repeatControl.power.writePower===false){return false}if(this.isRepeatSection()){return $(this.repeatSection).next("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_SECTION).length!==0}else{return $(this.repeatSection).next("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW).length!==0}},shouldShowAddMenu:function(){if(this.repeatSection==null){return false}if(this.repeatControl.readOnly===true){return false}return this.repeatControl.power.insertPower},shouldShowDeleteMenu:function(){if(this.repeatSection==null){return false}if(this.repeatControl.readOnly===true){return false}if($(this.repeatSection).data("isReadOnly")===true){return false}if($(this.repeatSection).data("isAdded")!==undefined){if($(this.repeatSection).data("isAdded")===true){return true}}return this.repeatControl.power.deletePower},adjustMenuItemVisibility:function(){var allHide=true;var adjustVisibility=function(menu,isShow){if(isShow){$(menu).show();allHide=false}else{$(menu).hide()}};adjustVisibility(this.menuItemDetail,this.shouldShowDetailMenu());adjustVisibility(this.menuItemMoveUp,this.shouldShowMoveUpMenu());adjustVisibility(this.menuItemMoveDown,this.shouldShowMoveDownMenu());adjustVisibility(this.menuItemAdd,this.shouldShowAddMenu());adjustVisibility(this.menuItemDelete,this.shouldShowDeleteMenu());this.allMenuItemHide=allHide},getRepeatControlFieldNames:function(repeat){var repeatControls=[];$(repeat).find("."+$Control.CLASSNAME_CONTROL).each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);if(control==null||control.field===undefined||control.element===undefined){return}if(control.onFieldRefer){repeatControls.push(control.field.name)}});return repeatControls},onDetailClick:function(){this.repeatControl.showDetail(this.repeatSection)},onMoveUpClick:function(){this.repeatControl.moveUpRepeatSection(this.repeatSection)},onMoveDownClick:function(){this.repeatControl.moveDownRepeatSection(this.repeatSection)},onAddClick:function(){var repeatControl=this.repeatControl;if(repeatControl.groupInformation!=null){if(repeatControl.groupInformation.maxOccur>0){if(repeatControl.getRepeatChildren().length>=repeatControl.groupInformation.maxOccur){$IU.messageBox(null,$$.lt("popupMenu.maxLimit"),null,300);return false}}}repeatControl.addRepeat(null,null,true,true,true,true)},onDeleteClick:function(){var repeatControl=this.repeatControl;if(repeatControl.groupInformation!=null){if(repeatControl.groupInformation.minOccur>0){if(repeatControl.getRepeatChildren().length<=repeatControl.groupInformation.minOccur){$IU.messageBox(null,$$.lt("popupMenu.minLimit"),null,300);return false}}}this.repeatControl.deleteRepeat(this.repeatSection,true)},isRepeatSection:function(){return this.repeatControl.isRepeatSection()},isRepeatTable:function(){return this.repeatControl.isRepeatTable()}};define("InfoPlus.Repeat.PopupMenu",popupMenu);var strategy=function(){};strategy.prototype={adjustShowPopupMenuPosition:function($menuDiv){}};define("InfoPlus.Repeat.PopupMenu.Strategy",strategy)})(window);
(function(window,undefined){var tableSorter=function(repeatControl){var instance=this;this.repeatTableBody=repeatControl.repeatTableBody;this.repeatControl=repeatControl;this.needReorganize=repeatControl.power.writePower===true||repeatControl.power.insertPower===true||repeatControl.power.deletePower===true;if(repeatControl.power.writePower===true){var $headers=$(this.repeatTableBody).children(".infoplus_repeatingTableHeader");if($headers.length>0){$IU.analysisTable($($headers[0]));for(var headerIndex=0,len=$headers.length;headerIndex<len;headerIndex++){var header=$headers[headerIndex],headRowCells=header.cells;for(var i=0;i<headRowCells.length;i++){var cell=headRowCells[i],$cell=$(cell),sortIndex=$cell.data("rawTdIndex");this.sortType[sortIndex]=InfoPlus.Repeat.TableSorter.SORT_TYPE_NONE;if($cell.attr("colspan")==null){$cell.addClass("infoplus_table_sort").click(function(event){if(!repeatControl.readOnly){var $srcElement=$(event.srcElement);if($srcElement.data($Control.DATA_CONTROL_OBJECT)==null){instance.onHeaderClick($(this).data("rawTdIndex"))}}})}else{$cell.removeData("rawTdIndex")}}}}}};tableSorter.SORT_TYPE_NONE=0;tableSorter.SORT_TYPE_ASC=1;tableSorter.SORT_TYPE_DESC=2;tableSorter.prototype={repeatTableBody:null,sortType:{},render:null,needReorganize:false,sortColumn:function(columnIndex,sortType){var columnCount=this.repeatTableBody.rows[0].cells.length;if(columnIndex>=columnCount){return}if(sortType===InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC){this.sortType[columnIndex]=InfoPlus.Repeat.TableSorter.SORT_TYPE_ASC}else{this.sortType[columnIndex]=InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC}this.onHeaderClick(columnIndex)},onHeaderClick:function(columnIndex){var getControlValue=function(sourceControls){if(sourceControls.length===0){return""}var firstControl=sourceControls[0];var controlType=$(firstControl).data($Control.DATA_CONTROL_TYPE);var control=$(firstControl).data($Control.DATA_CONTROL_OBJECT);if(controlType===$Control.CONTROL_TYPE_RADIO){var value="";var checkedRadio=$(sourceControls).filter("[name='"+firstControl.name+"']:checked");if(checkedRadio.length>0){value=$(checkedRadio[0]).val()}return value}return control.getSortValue()};var isNumberControl=function(judgeControls){if(judgeControls.length===0){return false}var firstControl=judgeControls[0];var control=$(firstControl).data($Control.DATA_CONTROL_OBJECT);if(control==null){return false}var type=control.field.type;return(type===$Control.DATA_TYPE_BOOL||type===$Control.DATA_TYPE_INT||type===$Control.DATA_TYPE_DOUBLE||type===$Control.DATA_TYPE_DATE)};var $rows=$(this.repeatTableBody).children(".infoplus_repeatingTableRow");var rowsCount=$rows.length;var sortArray=new InfoPlus.QuickSortArray();var sortByNumber=false;for(var rowIndex=0;rowIndex<rowsCount;rowIndex++){var cell=$rows[rowIndex].cells[columnIndex];var controls=$(cell).find("*").filter($IU.isControlFilter);if(rowIndex===1){sortByNumber=isNumberControl(controls)}sortArray.push({oldIndex:rowIndex,value:getControlValue(controls)})}if(this.sortType[columnIndex]===InfoPlus.Repeat.TableSorter.SORT_TYPE_NONE||this.sortType[columnIndex]===InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC){if(sortByNumber){sortArray.numberQuickSort()}else{sortArray.sort(function(a,b){return $IU.localeCompare(a.value,b.value)})}this.sortType[columnIndex]=InfoPlus.Repeat.TableSorter.SORT_TYPE_ASC}else{if(sortByNumber){sortArray.numberQuickSort();sortArray.reverse()}else{sortArray.sort(function(a,b){return -$IU.localeCompare(a.value,b.value)})}this.sortType[columnIndex]=InfoPlus.Repeat.TableSorter.SORT_TYPE_DESC}var newRowsArray=[];for(var i=0;i<rowsCount-1;i++){newRowsArray.push($rows[sortArray[i].oldIndex])}var currentRow=$($rows[0]).prev();for(i=0;i<newRowsArray.length;i++){$(currentRow).after($(newRowsArray[i]));currentRow=newRowsArray[i]}if(this.needReorganize){this.repeatControl.reorganizeRepeatableElement(true)}else{this.repeatControl.updateRepeatParentElementKeyIndex()}var $headers=$(this.repeatTableBody).children(".infoplus_repeatingTableHeader");for(i=0;i<$headers.length;i++){var header=$headers[i],cells=header.cells;for(var cellIndex=0;cellIndex<cells.length;cellIndex++){var $cell=$(cells[cellIndex]);if($cell.data("rawTdIndex")!=null){if($cell.data("rawTdIndex")===columnIndex){if(this.sortType[columnIndex]===InfoPlus.Repeat.TableSorter.SORT_TYPE_ASC){$cell.removeClass("infoplus_table_sort_desc");$cell.addClass("infoplus_table_sort_asc")}else{$cell.removeClass("infoplus_table_sort_asc");$cell.addClass("infoplus_table_sort_desc")}}else{$cell.removeClass("infoplus_table_sort_desc");$cell.removeClass("infoplus_table_sort_asc")}}}}}};define("InfoPlus.Repeat.TableSorter",tableSorter)})(window);
(function(window,undefined){var parameters=function(params){this.params=params};parameters.prototype={};define("InfoPlus.Dynamics.Params",parameters)})(window);
(function(window,undefined){var renderTools={};renderTools.toFixed=function(number,fix){var pr=parseInt(fix,10);if(isNaN(pr)){pr=0}var power=pr>0?Math.pow(10,pr):1;return Math.round(number*power)/power};renderTools._add=function(arg1,arg2){var r1,r2,m;try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}m=Math.pow(10,Math.max(r1,r2));return(arg1*m+arg2*m)/m};renderTools._sum=function(value){if($IU.isNumberExactly(value)){return{value:value,count:1}}else{if($IU.isArray(value)){var sum=0,count=0,len=value.length;for(var i=0;i<len;i++){var s=InfoPlus.Dynamics.Functions._sum(value[i]);sum=InfoPlus.Dynamics.Functions._add(sum,s.value);count+=s.count}return{value:sum,count:count}}else{if(value!=null&&value.hasOwnProperty("value")){value=value.value}var parseValue=parseFloat(value);if(!isNaN(parseValue)){return{value:parseValue,count:1}}}}return{value:0,count:0}};renderTools._sumByCondition=function(value,condition){if($IU.isNumberExactly(value)){if(condition===undefined||condition===true){return{value:value,count:1}}}else{if($IU.isArray(value)){var sum=0,count=0,len=value.length;for(var i=0;i<len;i++){var s;if(condition[i]===undefined){s=InfoPlus.Dynamics.Functions._sum(value[i])}else{s=InfoPlus.Dynamics.Functions._sumByCondition(value[i],condition[i])}sum=InfoPlus.Dynamics.Functions._add(sum,s.value);count+=s.count}return{value:sum,count:count}}else{if(condition===undefined||condition===true){if(value!=null&&value.hasOwnProperty("value")){value=value.value}var parseValue=parseFloat(value);if(!isNaN(parseValue)){return{value:parseValue,count:1}}}}}return{value:0,count:0}};renderTools.sum=function(value,condition){if(condition===undefined){return InfoPlus.Dynamics.Functions._sum(value).value}else{return InfoPlus.Dynamics.Functions._sumByCondition(value,condition).value}};renderTools.avg=function(value,condition){var sum;if(condition===undefined){sum=InfoPlus.Dynamics.Functions._sum(value)}else{sum=InfoPlus.Dynamics.Functions._sumByCondition(value,condition)}if(sum.count===0){return 0}return(sum.value/sum.count)};var _concat=function(value,gapString,property){gapString=gapString||"";if(value==null){return undefined}if($IU.isString(value)){return value}if($IU.isBoolean(value)){return(value===true)?"1":"0"}if($IU.isNumberExactly(value)){return value+""}if(property!==undefined&&value.hasOwnProperty(property)){return value[property]}if($IU.isArray(value)){var result="",len=value.length;for(var i=0;i<len;i++){var s=_concat(value[i],gapString,property);if(s!==undefined){result=result+s+((i!==len-1)?gapString:"")}}return result}return""};renderTools.concat=function(value,gapString,property){return _concat(value,gapString,property)};renderTools.reduce=function(value,repeat,gapString){if($IU.isNumberExactly(repeat)&&$IU.isInt(repeat)&&repeat>1){var valueArray=[];if($IU.isArray(value)){for(var i=0,len=value.length;i<len;i++){var index=0;while(index++<repeat){valueArray.push(value[i])}}}else{index=0;while(index++<repeat){valueArray.push(value)}}return _concat(valueArray,gapString)}else{return _concat(value,gapString)}};renderTools._length=function(value){if(value==null){return 0}if($IU.isString(value)){return value.length}if($IU.isArray(value)){var result=[],len=value.length;for(var i=0;i<len;i++){result[i]=InfoPlus.Dynamics.Functions._length(value[i])}return result}return 0};renderTools.length=function(value){return InfoPlus.Dynamics.Functions._length(value)};renderTools._countByCondition=function(value,condition){if($IU.isArray(value)){var len=value.length,count=0;for(var i=0;i<len;i++){if(condition[i]===undefined){count+=InfoPlus.Dynamics.Functions._count(value[i])}else{count+=InfoPlus.Dynamics.Functions._countByCondition(value[i],condition[i])}}return count}else{if(condition===undefined||condition===true){return(value!==undefined)?1:0}}};renderTools._count=function(value){if($IU.isArray(value)){var len=value.length,count=0;for(var i=0;i<len;i++){count+=InfoPlus.Dynamics.Functions._count(value[i])}return count}else{return(value!==undefined)?1:0}};renderTools.count=function(value,condition){if(condition===undefined){return InfoPlus.Dynamics.Functions._count(value)}else{return InfoPlus.Dynamics.Functions._countByCondition(value,condition)}};renderTools.dateSpan=function(dateFrom,dateTo){if(dateFrom===""||dateTo===""){return""}return parseInt(Math.abs(dateTo-dateFrom)/(60*60*24),10)+1};renderTools.getBirthday=function(id){if(id===undefined||id===null){return null}if(!$IU.isString(id)){return null}if(id.length!==15&&id.length!==18){return null}var year,month,day;if(id.length===15){for(var i=6;i<=13;i++){if(isNaN(parseInt(id.charAt(i),10))){return null}}var y=parseInt(id.substr(6,2),10);if(y<20){year=2000+y}else{year=1900+y}month=parseInt(id.substr(8,2),10);if(!(month>=1&&month<=12)){return null}day=parseInt(id.substr(10,2),10);if(!(day>=1&&day<=31)){return null}return(new Date(year,month-1,day)).getTime()/1000}else{for(i=6;i<=15;i++){if(isNaN(parseInt(id.charAt(i),10))){return null}}year=parseInt(id.substr(6,4),10);if(year<1900||year>2100){return null}month=parseInt(id.substr(10,2),10);if(!(month>=1&&month<=12)){return null}day=parseInt(id.substr(12,2),10);if(!(day>=1&&day<=31)){return null}return(new Date(year,month-1,day)).getTime()/1000}};renderTools.chineseAmount=function(num){if(isNaN(num)){return""}var strPrefix="";if(num<0){strPrefix="()"}num=Math.abs(num);if(num>=1000000000000){return""}var strOutput="";var strUnit="";var strCapDgt="";num+="00";var intPos=num.indexOf(".");if(intPos>=0){num=num.substring(0,intPos)+num.substr(intPos+1,2)}strUnit=strUnit.substr(strUnit.length-num.length);for(var i=0;i<num.length;i++){strOutput+=strCapDgt.substr(num.substr(i,1),1)+strUnit.substr(i,1)}return strPrefix+strOutput.replace(/$/,"").replace(/[]/g,"").replace(/{2,}/g,"").replace(/([|])/g,"$1").replace(/+/,"").replace(/{0,3}/,"").replace(/^/,"")};renderTools.encodeURI=function(uri){return encodeURI(uri)};renderTools.encodeURIComponent=function(uri){return encodeURIComponent(uri)};renderTools.startWith=function(str,prefix){if(str==null||prefix==null){return false}return str.slice(0,prefix.length)===prefix};renderTools.endWith=function(str,suffix){if(str==null||suffix==null){return false}return str.indexOf(suffix,str.length-suffix.length)!==-1};renderTools.params=function(){return new InfoPlus.Dynamics.Params(arguments)};renderTools.isNaN=isNaN;renderTools.parseInt=parseInt;renderTools.parseFloat=parseFloat;var mathFunctionNames=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(var i=0,len=mathFunctionNames.length;i<len;i++){var name=mathFunctionNames[i];if(typeof Math[name]==="function"){renderTools[name]=Math[name]}}define("InfoPlus.Dynamics.Functions",renderTools)})(window);
(function(window,undefined){var utilities={};utilities.DIALOG_ID="_ID_INFOPLUS_MESSAGE_"+Math.round(Math.random()*1000);utilities.DYNAMIC_INVISIBLE_ATTRIBUTE="dynamic-invisible";utilities.isObject=function(obj){return Object.prototype.toString.call(obj)==="[object Object]"};utilities.isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};utilities.isDate=function(obj){return Object.prototype.toString.call(obj)==="[object Date]"};utilities.isString=function(obj){return Object.prototype.toString.call(obj)==="[object String]"};utilities.isBoolean=function(obj){return obj===true||obj===false||Object.prototype.toString.call(obj)==="[object Boolean]"};utilities.isNumberExactly=function(val){return Object.prototype.toString.call(val)==="[object Number]"};utilities.isInt=function(val){return !isNaN(parseInt(val))};utilities.isPositiveInt=function(val){var reg=/^\+?[1-9][0-9]*$/;return reg.test(val)};utilities.isNumber=function(val){return !isNaN(parseFloat(val))};utilities.isUrl=function(testUrl){if(!utilities.isString(testUrl)){return false}var pattern=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");return pattern.test(testUrl)};utilities.isEmptyStr=function(str){return str==null||str===""};utilities.cookie={setCookie:function(name,value,days){var exp=new Date();exp.setTime(exp.getTime()+days*24*60*60*1000);document.cookie=name+"="+encodeURI(value)+";expires="+exp.toGMTString()+";path=/"},getCookie:function(name){var arr=document.cookie.match(new RegExp("(^| )"+name+"=([^;]*)(;|$)"));if(arr!=null){return decodeURI(arr[2])}else{return null}},removeCookie:function(name){var val=$IU.cookie.getCookie(name);if(val!=null){$IU.cookie.setCookie(name,val,-1)}}};utilities.arrayContains=function(array,obj){if(this.isArray(array)===false){return false}var i=array.length;while(i--){if(array[i]===obj){return true}}return false};utilities.arrayAContainArrayB=function(arrayA,arrayB){if(!this.isArray(arrayA)||!this.isArray(arrayB)){return false}if(arrayB.length>arrayA.length){return false}for(var i=0;i<arrayB.length;i++){if(arrayA[i]!==arrayB[i]){return false}}return true};utilities.arrayUnique=function(array){var a=array.concat();for(var i=0;i<a.length;++i){for(var j=i+1;j<a.length;++j){if(a[i]===a[j]){a.splice(j--,1)}}}return a};utilities.chineseLength=function(str){return str.replace(/[^\x00-\xff]/g,"**").length};utilities.stringReplaceAll=function(originalString,searchString,replaceString,ignoreCase){if(originalString==null){return null}if(searchString==null||replaceString==null){return null}return originalString.replace(new RegExp(searchString,(ignoreCase?"gi":"g")),replaceString)};utilities.getElementsByClassName=function(className){var hasClassName=new RegExp("(?:^|\\s)"+className+"(?:$|\\s)");var allElements=document.getElementsByTagName("*");var results=[];var element;for(var i=0;(element=allElements[i])!=null;i++){var elementClass=element.className;if(elementClass&&elementClass.indexOf(className)!==-1&&hasClassName.test(elementClass)){results.push(element)}}return results};utilities.getDateIsoString=function(date){if(date==null){return""}if(Date.prototype.toISOString!==undefined){return date.toISOString()}var pad=function(number){var r=String(number);if(r.length===1){r="0"+r}return r};return date.getUTCFullYear()+"-"+pad(date.getUTCMonth()+1)+"-"+pad(date.getUTCDate())+"T"+pad(date.getUTCHours())+":"+pad(date.getUTCMinutes())+":"+pad(date.getUTCSeconds())+"."+String((date.getUTCMilliseconds()/1000).toFixed(3)).slice(2,5)+"Z"};utilities.stdTimezoneOffset=function(){var date=new Date();var jan=new Date(date.getFullYear(),0,1);var jul=new Date(date.getFullYear(),6,1);return Math.max(jan.getTimezoneOffset(),jul.getTimezoneOffset())};utilities.unixTimeToDate=function(timestamp){if(isNaN(timestamp)){return null}var date=new Date();date.setTime((timestamp+(infoCore.params.tenantTimeZoneOffset!=null?infoCore.params.tenantTimeZoneOffset:transformer.tenantTimeZoneOffset))*1000);var oldOffset=date.getTimezoneOffset();date.setTime((date.getTime()/1000+date.getTimezoneOffset()*60)*1000);var newOffset=date.getTimezoneOffset();if(newOffset!==oldOffset){date.setTime((date.getTime()/1000+(newOffset-oldOffset)*60)*1000)}return date};utilities.unixTimeToDateString=function(timestamp){var date=InfoPlus.Utilities.unixTimeToDate(timestamp);if(null==date){return null}return InfoPlus.Utilities.dateFormat(date,"yyyy-MM-dd")};utilities.unixTimeToString=function(timestamp){var date=InfoPlus.Utilities.unixTimeToDate(timestamp);if(null==date){return null}return InfoPlus.Utilities.dateFormat(date,"yyyy-MM-dd hh:mm:ss")};utilities.unixTimeToTimeString=function(timestamp){if(isNaN(timestamp)){return null}var date=new Date();date.setTime(timestamp*1000);date.setTime((date.getTime()/1000+date.getTimezoneOffset()*60)*1000);return InfoPlus.Utilities.dateFormat(date,"hh:mm")};utilities.unixTimeToLocalTime=function(timestamp){if(isNaN(timestamp)){return null}var date=new Date();date.setTime(timestamp*1000);return date};utilities.unixTimeToLocalTimeString=function(timestamp){if(isNaN(timestamp)){return null}var date=new Date();date.setTime(timestamp*1000);return InfoPlus.Utilities.dateFormat(date,"yyyy-MM-dd hh:mm:ss")};utilities.dateStringToUnixTime=function(date){try{date=date.replace(/-/g,"/");date=date.substr(0,10);var stamp=Date.parse(date);if(isNaN(stamp)){return null}return stamp/1000-(new Date(stamp)).getTimezoneOffset()*60-infoCore.params.tenantTimeZoneOffset}catch(exception){return null}};utilities.timeStringToUnixTime=function(time){try{var stamp=Date.parse("1970/01/01 "+time);if(isNaN(stamp)){return null}return stamp/1000-(new Date(stamp)).getTimezoneOffset()*60}catch(exception){return null}};utilities.isSameTimezone=function(){var date=new Date();return(infoCore.params.tenantTimeZoneOffset/60===-date.getTimezoneOffset())};utilities.getTimezoneString=function(offset){var hour=parseInt(offset/60,10),minute=Math.abs(offset-hour*60);var val="UTC";if(hour===0&&minute===0){return val}if(hour>=0){val+="+"}val+=hour.toString()+":";if(minute>0){val+=minute.toString()}else{val+="00"}if($$.timezone[val]!=null){return $$.lt("timezone."+val)+$$.lt("timezone.time")+val}return val};utilities.mobileExpandAllViews=function(){var expandedLabels={};if(!$$.MOBILE){return}$$.params.holder.form.find("."+InfoPlus.Layout.View.CLASS_VIEW).each(function(){var view=$(this).data("viewControl"),label=view.label;if(label!=null){if(!label.isExpanded()){label.expand(false);expandedLabels[label.getId()]=label}}});return expandedLabels};utilities.mobileShrinkViewsWithNoTips=function(expandedViewLabelsForCheck){if(!$$.MOBILE||expandedViewLabelsForCheck===undefined){return}var getContainTipViewLabels=function(){var containTipViewLabels={};var $errorDivs=$("body").children("div.formError");$errorDivs.each(function(){var $element=$(this).data("element");if($element!=null){var label=$element.parents(".infoplus_view_wrap_outer").children(".infoplus_view_label").data("label");if(label!==undefined){containTipViewLabels[label.getId()]=label}}});$("div.popTip").each(function(){var popTipControl=$(this).data(InfoPlus.Render.PopTip.DATA_TIP_CONTROL);if(popTipControl!=null){var $popper=$(popTipControl.options.popper);var label=$popper.parents(".infoplus_view_wrap_outer").children(".infoplus_view_label").data("label");if(label!==undefined){containTipViewLabels[label.getId()]=label}}});return containTipViewLabels};var containTipViewLabels=getContainTipViewLabels();for(var id in expandedViewLabelsForCheck){if(expandedViewLabelsForCheck.hasOwnProperty(id)&&containTipViewLabels[id]===undefined){expandedViewLabelsForCheck[id].shrink(false)}}};utilities.doValidate=function(fromSave,fromStartPage){var shouldProcessViewLabels=($$.MOBILE&&fromStartPage!==true);var getContainErrorViewLabels=function(){var containErrorViewLabels={};var $errorDivs=$("body").children("div.formError");$errorDivs.each(function(){var $element=$(this).data("element");if($element!=null){var label=$element.parents(".infoplus_view_wrap_outer").children(".infoplus_view_label").data("label");if(label!==undefined){containErrorViewLabels[label.getId()]=label}}});return containErrorViewLabels};var shrinkViewsWithNoError=function(expandedViewLabelsForCheck){if(!shouldProcessViewLabels){return}var containErrorViewLabels=getContainErrorViewLabels();if(expandedViewLabelsForCheck!==undefined){for(var id in expandedViewLabelsForCheck){if(expandedViewLabelsForCheck.hasOwnProperty(id)){if(containErrorViewLabels[id]===undefined){expandedViewLabelsForCheck[id].shrink(false)}}}}};utilities.clearAllError();if(shouldProcessViewLabels){var expandedViewLabelsForCheck=$IU.mobileExpandAllViews()}var checkRequire=(fromSave==null||fromSave===false),controls=$$.params.renderForm.find("*[class*='validate']").filter($IU.isValidateControlFilter);$$.dynamics.cache.build();if(fromSave){controls=controls.filter(function(){var $control=$(this);if($control.data($Control.DATA_ORIGIN_INPUT)!=null){var validator=$($control.data($Control.DATA_ORIGIN_INPUT)).data($Control.DATA_VALIDATOR)}else{validator=$control.data($Control.DATA_VALIDATOR)}if(validator!=null){if(validator.builtIn){return true}if(validator.dynamics!=null){for(var i=0,len=validator.dynamics.length;i<len;i++){if(validator.dynamics[i]["builtIn"]){return true}}}return false}else{return false}})}if($IU.checkControlValidation(controls,checkRequire,true)===false){var scrollToError=function(){var minTop=null;var $errorDivs=$("body").children("div.formError");$errorDivs.each(function(){var top=parseInt($(this).css("top"),10);if(!isNaN(top)){if(minTop==null){minTop=top}else{if(top<minTop){minTop=top}}}});if(minTop!=null&&minTop>60){$IU.scrollTo(minTop-60,500)}};if(shouldProcessViewLabels){$IU.mobileShrinkViewsWithNoTips(expandedViewLabelsForCheck)}var errorMessage=$$.lt("validation.ensure");var $errorContent=$(".formErrorContent");if($errorContent.length===1){errorMessage=$errorContent.text();if(errorMessage.substr(0,2)==="* "){errorMessage=errorMessage.substr(2)}if(fromStartPage!==true){var control=$errorContent.parent().data("element").data($Control.DATA_CONTROL_OBJECT);if(control!=null&&control.field!=null){if(control.field.label!=null&&$IU.trimString(control.field.label)!==""){errorMessage=$IU.trimString(control.field.label)+":"+errorMessage}}}}$IU.messageBox(null,errorMessage,null,350,function(){$(".formError").effect("bounce",{},150)});setTimeout(scrollToError,1000);return false}else{if(shouldProcessViewLabels){$IU.mobileShrinkViewsWithNoTips(expandedViewLabelsForCheck)}}return true};utilities.getPageScroll=function(){var x=0,y=0;if(window.pageYOffset){y=window.pageYOffset;x=window.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){y=document.documentElement.scrollTop;x=document.documentElement.scrollLeft}else{if(document.body){y=document.body.scrollTop;x=document.body.scrollLeft}}}return{X:x,Y:y}};utilities.getPageSize=function(){var scrW=0,scrH=0;if(window.innerHeight&&window.scrollMaxY){scrW=window.innerWidth+window.scrollMaxX;scrH=window.innerHeight+window.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){scrW=document.body.scrollWidth;scrH=document.body.scrollHeight}else{if(document.body){scrW=document.body.offsetWidth;scrH=document.body.offsetHeight}}}var winW=0,winH=0;if(window.innerHeight){winW=window.innerWidth;winH=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){winW=document.documentElement.clientWidth;winH=document.documentElement.clientHeight}else{if(document.body){winW=document.body.clientWidth;winH=document.body.clientHeight}}}var pageW=(scrW<winW)?winW:scrW;var pageH=(scrH<winH)?winH:scrH;return{PageW:pageW,PageH:pageH,WinW:winW,WinH:winH}};utilities.getElementPosition=function(element){var msie=+((/msie (\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1]);if(isNaN(msie)){msie=+((/trident\/.*; rv:(\d+)/.exec(navigator.userAgent.toLowerCase())||[])[1])}var t=element.offsetTop;var l=element.offsetLeft;element=element.offsetParent;while(element){if(isNaN(msie)||msie===9){var cssTransform=$(element).css("transform");if(cssTransform!==""&&cssTransform!=="none"&&cssTransform!=null){break}}t+=element.offsetTop;l+=element.offsetLeft;element=element.offsetParent}return{top:t,left:l}};utilities.getDialog=function(){var dialog=$("#"+InfoPlus.Utilities.DIALOG_ID);if(dialog.length===0){var dialogDiv=document.createElement("div");dialogDiv.id=InfoPlus.Utilities.DIALOG_ID;document.body.appendChild(dialogDiv);dialog=$(dialogDiv)}return dialog};utilities.setMessageBoxButtonText=function(buttonIndex,text){var $dialogParentElement=$(InfoPlus.Utilities.getDialog()).parent();var $buttons=$dialogParentElement.find(".ui-dialog-buttonset").children();if($buttons.length>0){if(buttonIndex<$buttons.length){var childButton=$buttons[buttonIndex];var buttonSpan=childButton.childNodes[0];$(buttonSpan).text(text)}}};utilities.backUrlSkip=function(val){var reg=/^(http|https|ftp):\/\/([\w-]+\.)+[\w-]+(:[0-9]+)?(\/[\w-.\/?%&=#]*)?$/;var sameDomain=false;if(reg.test(val)){var reg1=/([\w-]+\.)+[\w-]+/;var res=val.match(reg1);if(res){var domain=res[0];var host=location.hostname;if(host==domain){sameDomain=true}}if(sameDomain){location.href=val}else{var setTimeInterval=null;var buttons=[{name:$$.lt("common.ok"),callback:function(){if(setTimeInterval){clearInterval(setTimeInterval)}location.href=val},defaultButton:true,preventDefault:true},{name:$$.lt("common.cancel"),callback:function(){if(setTimeInterval){clearInterval(setTimeInterval)}},}];var count=5;var content=$("<div class='backUrlTip'>"+$$.lt("back.dialog.content","<span>"+count+"</span>")+"</div>");var dialog=new InfoPlus.Render.Dialog({content:content,maxWidth:450,buttons:buttons});dialog.show();setTimeInterval=setInterval(function(){count--;content.find("span").html(count);if(count==0){clearInterval(setTimeInterval);location.href=val}},1000)}}};utilities.processBack=function(back){if(utilities.isEmptyStr(back)){return}if(utilities.isPositiveInt(back)){if(utilities.historyAdd()>0){back=parseInt(back,10)+utilities.historyAdd()}var goBack=-parseInt(back,10);window.history.go(goBack)}else{$IU.backUrlSkip(back)}};utilities.historyAdd=function(){var historyDiff=0;if($IU.isPositiveInt($$.params.nowHistory)){if(window.history.length>parseInt($$.params.nowHistory,10)){historyDiff=window.history.length-parseInt($$.params.nowHistory,10)}}return historyDiff};utilities.browserCloseable=function(){if(navigator.userAgent.match(/TaskCenterApp/)){return true}return !(window.opener==null||window.top!==window)};utilities.closeWindow=function(){if($$.APP){if(window.webViewInterface!==undefined&&window.webViewInterface["close"]!==undefined){try{window.webViewInterface.close()}catch(ignore){console.error("TaskCenterApp/webViewInterface.close exception:"+ignore)}return}window.close();return}var back=$$.params.back||transformer.back;if($$.MINIPROGRAM){if(utilities.isEmptyStr(back)){if(wx&&wx.miniProgram&&(typeof wx.miniProgram.navigateBack==="function")){wx.miniProgram.navigateBack();return}}else{if(utilities.isPositiveInt(back)){if(utilities.historyAdd()>0){back=parseInt(back,10)+utilities.historyAdd()}if(wx&&wx.miniProgram&&(typeof wx.miniProgram.navigateBack==="function")){var historyLength=window.history.length;var back=parseInt(back,10);if(historyLength>back){window.history.go(-back)}else{wx.miniProgram.navigateBack({delta:parseInt(back,10)-window.history.length+1})}return}}else{$IU.backUrlSkip(back);return}}}if($IU.isPositiveInt(back)){if(parseInt(back,10)>=window.history.length){back=undefined;$$.params.back=undefined}}if(!utilities.isEmptyStr(back)){utilities.processBack(back)}else{if(typeof window.WeixinJSBridge==="object"&&typeof window.WeixinJSBridge.invoke==="function"){window.WeixinJSBridge.invoke("closeWindow");var userAgent=navigator.userAgent.toLowerCase();if(userAgent.indexOf("windowswechat")>-1&&userAgent.indexOf("wxwork")>-1){window.close()}}else{if(window.WhistleBrowser!==undefined&&window.WhistleBrowser["close"]!==undefined){try{window.WhistleBrowser.close()}catch(ignore){console.error("WhistleBrowser.close exception:"+ignore)}return}window.open("","_self","");window.close();if(!window.closed){setTimeout(function(){window.location.reload()},500)}}}};utilities.setDocumentTitle=function(title){if($$.DINGTALK){if(!$$.dingTalkJSLoaded){var dingTalkReady=setInterval(function(){if($$.dingTalkJSLoaded){clearInterval(dingTalkReady);dd.ready(function(){dd.biz.navigation.setTitle({title:title,})})}},100)}else{dd.ready(function(){dd.biz.navigation.setTitle({title:title,})})}}else{document.title=title}};utilities.wxWebviewDownloadFile=function(fileUri,fileName){if(wx&&wx.miniProgram&&(typeof wx.miniProgram.navigateTo==="function")){var fileInfo={uri:fileUri,name:fileName};wx.miniProgram.navigateTo({url:"/pages/fileDownload/fileDownload?fileInfo="+JSON.stringify(fileInfo)})}};utilities.delayedErrorMessageBox=function(message){if(utilities.errorMessage==null){utilities.errorMessage=message;setTimeout(function(){utilities.errorMessageBox(utilities.errorMessage,null,$$.lt("error.error"),null,null,false,false,"#ff0000");utilities.errorMessage=null},0)}else{utilities.errorMessage=utilities.errorMessage+"\n"+message}};utilities.errorMessageBox=function(message,detailMessage,title,entities,errorCode,showErrorTip,fromLoad,titleColor,maxWidth){var dialogDiv;dialogDiv=$(document.createElement("div"));if(showErrorTip===true){var span=document.createElement("span");span.style.color="#FF0000";$(span).text($$.lt("error.occur"));dialogDiv.append(span)}span=document.createElement("span");$(span).addClass("error_message_content").html($IU.linkifyStr($IU.htmlEncode(message)));dialogDiv.append(span);if(detailMessage!=null){var spaceDiv=document.createElement("div");spaceDiv.style.height="5px";var div=document.createElement("div");var link=document.createElement("a");link.href="#";link.style.color="#2446AB";link.title=$$.lt("error.showDetail");$(link).text($$.lt("error.detail")).addClass("moreDetail");$(link).one("click",{link:link,dialogDiv:dialogDiv},InfoPlus.Utilities.moreDetailClick);var detailDiv=document.createElement("div");var detailMessageDiv=document.createElement("div");$(detailMessageDiv).html($IU.linkifyStr($IU.htmlEncode(detailMessage))).addClass("error_detail_message");$(detailDiv).addClass("error_detail_message_container").append(detailMessageDiv);detailDiv.style.display="none";$(div).append(link);$(div).append(detailDiv);dialogDiv.append(spaceDiv);dialogDiv.append(div)}var buttons=[];if(fromLoad){buttons.push({name:$$.lt("common.close"),defaultButton:true,callOnClose:true,callback:function(){$IU.closeWindow()}})}if(errorCode==="ENTRUST_MOCK_NOT_ALLOWED"||errorCode==="ENTRUST_MODE_NOT_ALLOWED"){if(entrusts!=null&&entrusts.app!=null&&entrusts.app.id!=null){var appId=entrusts.app.id,entrustInterface=transformer.interface_entrust;var isEntrust=errorCode==="ENTRUST_MODE_NOT_ALLOWED";buttons.push({name:isEntrust?$$.lt("entrust.abort.entrust"):$$.lt("entrust.abort.debug"),callback:function(){$$.blockUI({message:(isEntrust?$$.lt("entrust.request.abort.requesting.entrust"):$$.lt("entrust.request.abort.requesting.debug"))});$$.ajax({type:"POST",url:entrustInterface,data:{entrusted:false,app:appId},requestMsg:(isEntrust?$$.lt("entrust.request.abort.request.entrust"):$$.lt("entrust.request.abort.request.debug")),errorTitle:(isEntrust?$$.lt("entrust.request.abort.fail.entrust"):$$.lt("entrust.request.abort.fail.debug")),beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){if($$.MOBILE){setTimeout(function(){window.location.reload()},600)}else{window.location.reload()}})}})}}if(errorCode==="INSTANCE_START_EXCEEDED"&&entities!=null&&entities.length>0){buttons=[{name:$$.lt("common.close")},{defaultButton:true,name:$$.lt("start.viewInstance"),callback:function(){window.location.href=utilities.processUrl(entities[0])}}]}var dialog=new InfoPlus.Render.Dialog({title:title,titleColor:titleColor,content:dialogDiv,maxWidth:maxWidth!=null?maxWidth:800,buttons:buttons});dialog.show();return false};utilities.getMaxZIndex=function(){var $divs=$("div");var maxZIndex=0;for(var i=0;i<$divs.length;i++){if(maxZIndex<$divs[i].style.zIndex){maxZIndex=$divs[i].style.zIndex}}return maxZIndex+1};utilities.confirmBox=function(text,title,okText,w,callback){var cancelText=$$.lt("common.cancel");var dialog=new InfoPlus.Render.Dialog({title:title!==okText?title:null,content:text,maxWidth:w,buttons:[{name:okText,defaultButton:true,callback:callback},{name:cancelText}]});dialog.show()};utilities.yesNoBox=function(text,w,callback){var dialog=new InfoPlus.Render.Dialog({title:null,content:text,maxWidth:w,buttons:[{name:$$.lt("common.yes"),defaultButton:true,callback:callback},{name:$$.lt("common.no")}]});dialog.show()};utilities.messageBox=function(title,text,buttonText,maxWidth,callback){if(buttonText==null||buttonText===""){buttonText=$$.lt("common.ok")}var dialog=new InfoPlus.Render.Dialog({title:title,content:text,maxWidth:maxWidth,buttons:[{name:buttonText,defaultButton:true,callback:callback,callOnClose:callback!=null}]});dialog.show()};utilities.debugBox=function(title,text,buttonText,maxWidth,callback){if($$.params.isRelease===false){utilities.messageBox(title,text,buttonText,maxWidth,callback)}};utilities.iframeBox=function(uri,title,modal,allowOpenNewWindow,width,height){var iframe=document.createElement("iframe");iframe.src=uri;iframe.setAttribute("width","100%");iframe.setAttribute("height",(height===0||height==null?$(window).height()*0.75:height)+"px");var dialog=new InfoPlus.Render.Dialog({title:title,content:iframe,maxWidth:(width==null||width===0?$(window).width:width),openNewUrl:uri,showFooter:false,showCloseButton:true,showOpenNewButton:allowOpenNewWindow,showMinimiseButton:!modal,modal:modal});dialog.show()};utilities.tip=function(text,type,position){new InfoPlus.Tip({text:text,type:type,position:position})};utilities.debugTip=function(text,type){if($$.params.isRelease===false){utilities.tip(text,type,"left");console.log(text)}};utilities.infoTip=function(text){utilities.tip(text,"info","right")};utilities.shouldShowSuggesterPage=function(){return $$.MOBILE&&!(/iPad/i.test(navigator.userAgent))};utilities.showSuggester2PageOnce=function(originControl){var exists=false;$(".mobile_page_div").each(function(){if($(this).data($Control.DATA_ORIGIN_CONTROL)===originControl){exists=true;return false}});if(!exists){var page=utilities.showSuggester2Page(originControl);$(page.element).data($Control.DATA_ORIGIN_CONTROL,originControl)}};utilities.showSuggester2Page=function(originControl){var originValue=originControl.getValue();var control=new $Controls.Suggester2(originControl.path,originControl.field,originControl.render,originValue.value,originValue.displayValue,originControl.parentValue,originControl.suggestService,originControl.getAttributes(),originControl);$(control.element).removeClass("xdTextBox");control.initSelect2();control.onFieldRefer=originControl.onFieldRefer;var tooltip=originControl.tooltip,content=control.getControlContainer();if(tooltip!=null&&tooltip.tip!=null&&tooltip.tip!==""){content=document.createElement("div");var tipDiv=document.createElement("div");$(tipDiv).text(tooltip.tip).addClass("infoplus_suggester_tooltip");$(content).append(tipDiv).append(control.getControlContainer())}var options={title:originControl.field.label,content:content,onShow:function(){var select=$(control.element).data($Control.DATA_ORIGIN_INPUT);$(select).select2("open")},onClose:function(){var select=$(control.element).data($Control.DATA_ORIGIN_INPUT);$(select).select2("destroy");originControl.onSuggestPage=false}};var page=new InfoPlus.Render.Mobile.Page(options);page.show();return page};utilities.showSuggester2ThisPage=function(originControl){var originValue=originControl.getValue();var controlContainer=originControl.controlContainer;var control=new $Controls.Suggester2(originControl.path,originControl.field,originControl.render,originValue.value,originValue.displayValue,originControl.parentValue,originControl.suggestService,originControl.getAttributes(),originControl);$(control.element).removeClass("xdTextBox");control.initSelect2();control.onFieldRefer=originControl.onFieldRefer;var tooltip=originControl.tooltip,content=control.getControlContainer();if(tooltip!=null&&tooltip.tip!=null&&tooltip.tip!==""){content=document.createElement("div");var tipDiv=document.createElement("div");$(tipDiv).text(tooltip.tip).addClass("infoplus_suggester_tooltip");$(content).append(tipDiv).append(control.getControlContainer())}$(content).find(".select2-container").attr("ispagepopup",false);$(controlContainer).empty().append(content);var select=$(control.element).data($Control.DATA_ORIGIN_INPUT);$(select).select2("open")};utilities.getTransitionEndEventName=function(){var el=document.createElement("fake"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"};for(var t in transEndEventNames){if(transEndEventNames.hasOwnProperty(t)){if(el.style[t]!==undefined){return transEndEventNames[t]}}}return null};utilities.initValidationEngine=function(){$$.params.renderForm.validationEngine("attach",{validationEventTriggers:"blur",success:false,promptPosition:$$.MOBILE?"topLeft":"topRight"})};utilities.rebindValidationEngine=function(){$$.params.renderForm.validationEngine("detach");utilities.initValidationEngine()};utilities.clearErrorPrompt=function(element){var $controls=$(element).find("*[class*='validate']");for(var i=0;i<$controls.length;i++){$($controls[i]).validationEngine("hidePrompt")}};utilities.clearAllError=function(){$("div.formError").stop(true,true).remove();$("div.ui-effects-wrapper").remove()};utilities.adjustRenderWidth=function(){if($$.params.currentWidth==null){$$.params.currentWidth=0}if($$.MOBILE){var width=$(window).width();if(width>0){$$.params.holder.remark.css("width",width+"px");$$.params.holder.form.css("width",width+"px");if(width!==$$.params.currentWidth){$$.params.currentWidth=width;$$.resize(width)}}}else{width=$$.params.holder.form[0].clientWidth;if(width!==$$.params.currentWidth){$$.params.currentWidth=width;$$.resize(width)}}};utilities.updateFormTips=function(animate){$IU.updateErrorPromptPosition(animate);InfoPlus.Render.PopTip.fixPosition(animate)};utilities.updateFormTipsAndViews=function(animate){$IU.checkViewVisibility();$IU.updateFormTips(animate)};utilities.checkViewVisibility=function(fromInit){if($$.PREVIEW===true){return}var hideZeroHeightView=function(view,show){var $view=$(view.element);var $firstTable=$view.find("table").first();if($view.height()===0||(!$firstTable.hasClass("uploadProgressTable")&&$firstTable.height()===0)){view.hide()}else{if(show){view.show()}}};var views=$$.params.formRender.views;for(var i=0,len=views.length;i<len;i++){var view=views[i],$view=$(view.element),expandForCheck=false;if(fromInit===true){hideZeroHeightView(view)}else{if($$.MOBILE&&(view.expanded===false)){view.expand(false,true);expandForCheck=true}if($view.is(":visible")){hideZeroHeightView(view)}else{if(!$IU.isDynamicInvisible($view)){$view.show();hideZeroHeightView(view,true)}}if(expandForCheck){view.shrink(false,true)}}}};utilities.updateErrorPromptPosition=function(animate){var getElementId=function(elementClasses){for(var index=0;index<elementClasses.length;index++){var className=elementClasses[index];if(className.indexOf("formError")!==-1&&className!=="formError"){return className.substring(0,className.indexOf("formError"))}}return null};var $errorDivs=$("body").children("div.formError");for(var i=0;i<$errorDivs.length;i++){var $errorDiv=$($errorDivs[i]),$element=$errorDiv.data("element");if($element!=null){if($element.is(":visible")){$element.validationEngine("updatePromptPosition",animate)}else{if(!$errorDiv.hasClass("hideShrink")){$element.validationEngine("hide",true)}}}}};utilities.setFocusToFirstEditableTextBox=function(){var windowHeight=document.documentElement.clientHeight,$text=$(".infoplus_editControl.infoplus_writable:visible,.infoplus_textareaControl.infoplus_writable:visible,.infoplus_richTextControl.infoplus_writable:visible").first();if($text.length>0&&$text.offset().top<windowHeight){if($text.hasClass("infoplus_richTextControl")){var richText=$text.data("controlObject");if(richText.editor!=null){setTimeout(function(){richText.editor.focus()},500)}}else{$text.focus()}}};var delayTimer;utilities.fixPopTipPosition=function(atOnce){$($$.params.renderContainer).children(".popTip").each(function(){var tipControl=$(this).data("tipControl");if(tipControl!=null){tipControl.fixPosition()}})};utilities.isControlFilter=function(){if(this.tagName==="OBJECT"){return false}var isControl=$(this).data($Control.DATA_IS_CONTROL);if(isControl==null){return false}return isControl===true};utilities.isSuggesterFilter=function(){if(this.tagName==="OBJECT"){return false}return($(this).data($Control.DATA_SUGGESTER)!=null)};utilities.isValidateControlFilter=function(){if(this.tagName==="OBJECT"){return false}var $element=$(this);var isControl=$element.data($Control.DATA_IS_CONTROL);if(isControl==null){return false}if(isControl===false){return false}var control=$element.data("controlObject");if(control==null){var originInput=$element.data($Control.DATA_ORIGIN_INPUT);if(originInput!=null){control=$(originInput).data("controlObject");if(control.isDynamicReadonly()||(!control.isWritable())){return false}}}else{if(control.isDynamicReadonly()||(!control.isWritable())){return false}}if($element.parents(".detailCell").length>0){if($element.css("display")==="none"){return false}if($element.parents("["+utilities.DYNAMIC_INVISIBLE_ATTRIBUTE+"]").length>0){return false}}else{if(!$element.is(":visible")){return false}}return true};utilities.isValidateFilter=function(){if(this.tagName==="OBJECT"){return false}var classValue=this.getAttribute("class");if(classValue==null){return false}return(classValue.indexOf("validate")!==-1)};utilities.addElementValidateClass=function(element){$(element).addClass("validate[funcCall[checkRenderFormFields]]")};utilities.removeElementValidateClass=function(element){$(element).removeClass("validate[funcCall[checkRenderFormFields]]")};utilities.trimString=function(str){if(str==null){return null}else{return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}};utilities.clearSuggester=function(element){var $controls=$(element).find("*").filter(InfoPlus.Utilities.isSuggesterFilter);for(var i=0;i<$controls.length;i++){var suggester=$($controls[i]).data($Control.DATA_SUGGESTER);suggester.dispose()}};utilities.highLightElement=function(element){var controlType=$(element).data($Control.DATA_CONTROL_TYPE);if(controlType===$Control.CONTROL_TYPE_IFRAME){return}if(!(controlType===$Control.CONTROL_TYPE_SUGGESTER||controlType===$Control.CONTROL_TYPE_SUGGESTER2)&&!$(element).is(":visible")){return}var updateControlBackgroundColor=function(effectElement){if($.browser.msie){try{var org=document.body.createTextRange();org.moveToElementText(effectElement);var iClr=org.queryCommandValue("BackColor");effectElement.style.backgroundColor=(iClr==null?"rgb(255,255,255)":"rgb("+(iClr&255)+","+((iClr&65280)>>8)+","+((iClr&16711680)>>16)+")")}catch(e){}}};var highlightEffect=function(effectElement){if($(effectElement).data("isEffecting")!==undefined){return}updateControlBackgroundColor(effectElement);$(effectElement).data("isEffecting",true).effect("highlight",{},1000,function(){$(this).removeData("isEffecting")})};if(controlType!=null){switch(controlType){case $Control.CONTROL_TYPE_REMARK:case $Control.CONTROL_TYPE_ANCHOR:case $Control.CONTROL_TYPE_ACTION:case $Control.CONTROL_TYPE_HIDDEN:break;case $Control.CONTROL_TYPE_LABEL:var labelControl=$(element).data($Control.DATA_CONTROL_OBJECT);if(labelControl!=null){highlightEffect(labelControl.element)}break;case $Control.CONTROL_TYPE_SUGGESTER:var suggester=$(element).data($Control.DATA_SUGGESTER);if(suggester!=null){highlightEffect(suggester.activeInput)}break;case $Control.CONTROL_TYPE_SUGGESTER2:var select2=$(element).data("select2Object");if(select2!=null){highlightEffect($(element).siblings(".select2").find(".select2-selection")[0])}break;default:highlightEffect(element);break}}};utilities.htmlEncode=function(str){var s="";if(str.length===0){return""}for(var i=0;i<str.length;i++){switch(str.substr(i,1)){case"<":s+="&lt;";break;case">":s+="&gt;";break;case"&":s+="&amp;";break;case" ":s+="&ensp;";break;case'"':s+="&quot;";break;case"\n":s+="<br>";break;default:s+=str.substr(i,1);break}}return s};utilities.moreDetailClick=function(event){var link=event.data.link;var siblingDiv=$(link).siblings("div")[0];var dialogDiv=event.data.dialogDiv;if(siblingDiv!=null){dialogDiv.dialog("option","width",850);dialogDiv.dialog("option","position","center");siblingDiv.style.display="block";$(link).empty()}return false};utilities.dateFormat=function(date,format){var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3),S:date.getMilliseconds()};if(/(y+)/.test(format)){format=format.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(o.hasOwnProperty(k)){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,RegExp.$1.length===1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}}return format};utilities.variablesFormat=function(format,contentList){var matchList=format.match(/\${\w+}/g);if(matchList!=null){for(var i=0;i<matchList.length;i++){var matchContent=matchList[i];var contentName=matchContent.substring(2,matchContent.length-1);if(contentList[contentName]!=null){format=format.replace(matchContent,InfoPlus.Utilities.trimString(contentList[contentName]))}else{format=format.replace(matchContent,"")}}}return InfoPlus.Utilities.trimString(format)};utilities.checkFieldEmpty=function(field,options){var ruleName="required";if(field.hasClass("infoplus_richTextControl")){if(!utilities.trimString(CKEDITOR.instances[field.attr("id")+"_text"].getData())){return options?options.allrules[ruleName].alertText:true}if(!options){return false}else{return undefined}}switch(field.attr("type")){case"text":case"password":case"textarea":case"file":default:if(!utilities.trimString(field.val())){return options?options.allrules[ruleName].alertText:true}break;case"radio":case"checkbox":var name=field.attr("name");if($("input[name='"+name+"']:checked").size()===0){if($("input[name='"+name+"']").size()===1){return options?options.allrules[ruleName].alertTextCheckboxe:true}else{return options?options.allrules[ruleName].alertTextCheckboxMultiple:true}}break;case"select-one":if(!field.val()){return options?options.allrules[ruleName].alertText:true}break;case"select-multiple":if(!field.find("option:selected").val()){return options?options.allrules[ruleName].alertText:true}break}if(!options){return false}else{return undefined}};utilities.getReferedControlPaths=function(controlPath){var referedControlPaths=[],pathArray=controlPath.split("_"),len=pathArray.length;for(var i=0;i<len;i++){var path=pathArray[i];if(i===0){referedControlPaths.push(path)}else{referedControlPaths.push(referedControlPaths[referedControlPaths.length-1]+"_"+path)}}return referedControlPaths};utilities.isSibling=function(path1,path2){if(path1==null||path2==null||path1===""||path2===""){return false}var pathArray1=path1.split("_"),pathArray2=path2.split("_");if(pathArray1.length!==pathArray2.length){return false}for(var i=0,len=pathArray1.length;i<len-1;i++){if(pathArray1[i]!==pathArray2[i]){return false}}return pathArray1[len-1]!==pathArray2[len-1]};utilities.convertFileSize=function(size){if(size==null||!InfoPlus.Utilities.isNumber(size)){return{size:"",unit:""}}if(size<1024){return{size:size.toString(),unit:"B"}}size=size/1024;if(size<1024){return{size:size.toFixed(1).toString(),unit:"K"}}size=size/1024;if(size<1024){return{size:size.toFixed(1).toString(),unit:"M"}}size=size/1024;return{size:size.toFixed(1).toString(),unit:"G"}};utilities.getElementStyle=function(element,name){var elementStyle=element.getAttribute("style");if(elementStyle==null){return null}var styles=elementStyle.split(";");for(var i=styles.length-1;i>=0;i--){var style=$IU.trimString(styles[i]);if(style!==""){var styleSplit=style.split(":");if(styleSplit.length===2){if($IU.trimString(styleSplit[0].toLowerCase())===$IU.trimString(name.toLowerCase())){return $IU.trimString(styleSplit[1])}}}}return null};utilities.saveOriginStyles=function(element){if($(element).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE)!==undefined){return null}var originStyles={},originStyle=$(element).attr("style");if(originStyle==null){$(element).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE,originStyles);return originStyles}var originStyleArray=originStyle.split(";"),len=originStyleArray.length;for(var styleIndex=0;styleIndex<len;styleIndex++){var style=$IU.trimString(originStyleArray[styleIndex]);if(style!==""){var styleSplit=style.split(":");if(styleSplit.length===2){originStyles[$IU.trimString(styleSplit[0]).toLowerCase()]=$IU.trimString(styleSplit[1])}}}$(element).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE,originStyles);return originStyles};utilities.setDynamicStyle=function(element,style,value){var getElementStyle=function(ele,styleName){styleName=styleName.toLowerCase();var attrStyle=ele.getAttribute("style"),styleArray=attrStyle.split(";"),len=styleArray.length;for(var i=0;i<len;i++){var s=InfoPlus.Utilities.trimString(styleArray[i]);if(s!==""){var styleSplit=s.split(":");if(styleSplit.length===2){if(styleSplit[0].toLowerCase()===styleName){return InfoPlus.Utilities.trimString(styleSplit[1])}}}}return""};var setElementStyle=function(ele,styleName,styleValue){styleName=InfoPlus.Utilities.trimString(styleName.toLowerCase());styleValue=InfoPlus.Utilities.trimString(styleValue);var attrStyle=ele.getAttribute("style");if(attrStyle==null){ele.setAttribute("style",styleName+":"+styleValue)}else{var styleArray=attrStyle.split(";"),len=styleArray.length,newStyle="";for(var i=0;i<len;i++){var s=InfoPlus.Utilities.trimString(styleArray[i]);if(s!==""){var styleSplit=s.split(":");if(styleSplit.length===2){if(styleSplit[0].toLowerCase()!==styleName){newStyle=newStyle+(newStyle!==""?";":"")+s}else{if(styleValue!==""){newStyle=newStyle+(newStyle!==""?";":"")+styleName+":"+styleValue}}}}}ele.setAttribute("style",newStyle)}};style=InfoPlus.Utilities.trimString(style.toLowerCase());var originStyles=$(element).data(InfoPlus.Controls.Control.DATA_ORIGIN_STYLE);if(originStyles===undefined){originStyles=$IU.saveOriginStyles(element)}value=InfoPlus.Utilities.trimString(value);if(value==="null"||value===""){if(originStyles[style]!==undefined){setElementStyle(element,style,originStyles[style])}else{setElementStyle(element,style,"")}}else{$(element).css(style,value)}};utilities.setElementValue=function(fieldName,fieldValue,fieldDisplayValue,attributes){if(fieldValue==null){fieldValue=""}if(fieldDisplayValue==null){fieldDisplayValue=""}var elements=document.getElementsByName(fieldName);for(var index=0;index<elements.length;index++){var changeValueElement=elements[index],changeValueControl=$(changeValueElement).data($Control.DATA_CONTROL_OBJECT),changed=false;if(changeValueControl!=null&&changeValueControl.isWritable()){var oldValue=changeValueControl.getValue();if(oldValue!=null&&oldValue.value!==undefined){oldValue=oldValue.value}changed=oldValue!==fieldValue;if(changed){if(changeValueControl.field.type===InfoPlus.Controls.Control.DATA_TYPE_DATE&&$IU.isString(fieldValue)){var newValue=$IU.dateStringToUnixTime(fieldValue);if(newValue!==oldValue){changeValueControl.setValue(newValue)}else{changed=false}}else{changeValueControl.setValue(fieldValue,fieldDisplayValue,$$.params.initializing,attributes)}if(changed&&changeValueControl.autoTriggerFieldChangeEvent&&(changeValueControl.onFieldChange||changeValueControl.onFieldRefer)&&!changeValueControl.clickFireFieldChange){$(changeValueControl.element).change()}}else{if(attributes!=null){changeValueControl.setValue(fieldValue,fieldDisplayValue,$$.params.initializing,attributes)}}if($$.params.fieldChanging!=null){$$.params.fieldChanging.controls.push(changeValueControl)}}if(changed){$IU.highLightElement(changeValueElement)}}};utilities.getFieldNamesFromFieldChangeOldData=function(entities){var names={};for(var i=0;i<entities.length;i++){names[entities[i].fieldName]=null}return names};utilities.getFieldNamesFromFieldChangeData=function(data){var names={};var getFieldName=function(name){if(name.length>0){return"field"+name.substring(0,1).toUpperCase()+name.substring(1)}return null};var getGroupName=function(name){if(name.length>0){return"group"+name.substring(0,1).toUpperCase()+name.substring(1)}return null};var mergeNames=function(mNames){for(var k in mNames){if(mNames.hasOwnProperty(k)){addName(k)}}};var addName=function(name){if(name!=null){if(!names.hasOwnProperty(name)){names[name]=null}}};for(var key in data){if(data.hasOwnProperty(key)){if(key==="entityIndex"){continue}var value=data[key];if(!$IU.isArray(value)){addName(getFieldName(key))}else{addName(getGroupName(key));for(var i=0,len=value.length;i<len;i++){var rowFieldNames=$IU.getFieldNamesFromFieldChangeData(value[i]);mergeNames(rowFieldNames)}}}}return names};utilities.setFormData=function(data,path,isNew){var fields=$$.entity.fields;var getField=function(name){if(name.length>0){return fields["field"+name.substring(0,1).toUpperCase()+name.substring(1)]}return null};var getFieldName=function(name,fieldPath){if(name.length>0){return"field"+name.substring(0,1).toUpperCase()+name.substring(1)+(fieldPath!==undefined?fieldPath:"")}return null};var getGroupName=function(name,groupPath){if(name.length>0){return"group"+name.substring(0,1).toUpperCase()+name.substring(1)+groupPath}return null};var isParent=function(fieldName1,fieldName2){if(fields[fieldName2]==null){return false}var parentField=fields[fieldName2]["parent"];var parents=[];while(parentField!==undefined){parents.push(parentField);if(fieldName1===parentField){return true}if(fields[parentField]==null){return false}parentField=fields[parentField]["parent"];if(parentField!==undefined&&$IU.arrayContains(parents,parentField)){utilities.errorMessageBox($$.lt("validation.selfLoop",fieldName1));return false}}return false};var reindexData=function(data){var indexedData=[];var groupData=[];for(var key in data){if(data.hasOwnProperty(key)){if(key==="entityIndex"){continue}var value=data[key],field=key,newData={key:field,value:value};if($IU.isArray(value)){groupData.push(newData);continue}for(var i=0,len=indexedData.length;i<len;i++){var dataField=indexedData[i].key;if(isParent(getFieldName(field),getFieldName(dataField))){indexedData.splice(i,0,newData);break}}if(len===indexedData.length){indexedData.push({key:field,value:value})}}}return indexedData.concat(groupData)};var reIndexedData=reindexData(data);for(var i=0,len=reIndexedData.length;i<len;i++){var key=reIndexedData[i].key,value=reIndexedData[i].value;if(!$IU.isArray(value)){if(!isNew){var fieldName=getFieldName(key,path);var field=getField(key);if(fieldName!=null&&field!=null){if($IU.isString(value)){$IU.setElementValue(fieldName,value);continue}if(value.hasOwnProperty("codeId")){$IU.setElementValue(fieldName,value.codeId,value.codeName,value.attributes);continue}if(field.type===$Control.DATA_TYPE_CODE){$IU.setElementValue(fieldName,value.codeId,value.codeName,value.attributes);continue}$IU.setElementValue(fieldName,value)}}}else{var groupDivName=getGroupName(key,path);if(groupDivName!=null){var $groupDiv=$("#"+groupDivName);if($groupDiv.length>0){var repeatParentElement=$groupDiv[0];var repeatControl=$(repeatParentElement).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(repeatControl!=null){repeatControl.setData(value);if($$.params.fieldChanging!=null){$$.params.fieldChanging.controls.push(repeatControl)}}}}}}};utilities.setFocusToElement=function(elementName){if($$.MOBILE){return}var controlElements=document.getElementsByName(elementName);if(controlElements.length>0){var controlElement=controlElements[0];var setFocus=function(){var suggester=$(controlElement).data($Control.DATA_SUGGESTER);if(suggester!=null){suggester.containerClick()}else{try{document.getElementById(controlElement.id).focus()}catch(e){}}};var isIe=(navigator.appVersion.indexOf("MSIE")!==-1);if(isIe){setTimeout(setFocus,1000)}else{setFocus()}}};utilities.getComputedStyle=function(element,style){if(element==null||style==null){return null}if(window.getComputedStyle!=null){var styles=window.getComputedStyle(element);return styles[style]}else{if(element.currentStyle!=null){return element.currentStyle[style]}}return null};utilities.fireClick=function(element){if(typeof element==="string"){element=document.getElementById(element)}if(!element){return}if(document.dispatchEvent){var oEvent=document.createEvent("MouseEvents");oEvent.initMouseEvent("click",true,true,window,1,1,1,1,1,false,false,false,false,0,element);element.dispatchEvent(oEvent)}else{if(document.fireEvent){element.click()}}};utilities.openLink=function(url,inNewWindow){var a=document.createElement("a");if(inNewWindow){a.setAttribute("target","_blank")}else{a.setAttribute("target","_self")}a.setAttribute("href",url);document.body.appendChild(a);$IU.fireClick(a);document.body.removeChild(a)};utilities.splitAttribute=function(attrs){if(attrs==null){return[]}var s=attrs.split("\r\n");if(s.length===1){return attrs.split("\n")}else{return s}};utilities.beginWith=function(searchStr,beginStr){if(searchStr==null||searchStr===""||beginStr==null||beginStr===""){return false}if(beginStr.length>searchStr.length){return false}return(searchStr.substr(0,beginStr.length)===beginStr)};utilities.endWith=function(searchStr,endStr){if(searchStr==null||searchStr===""||endStr==null||endStr===""){return false}if(endStr.length>searchStr.length){return false}return(searchStr.lastIndexOf(endStr)===(searchStr.length-endStr.length))};utilities.checkControlValidation=function(controls,checkRequire,showMasterError){var getCheckControl=function(checkControl){if(checkControl instanceof InfoPlus.Controls.Suggester){return $(checkControl.element).data($Control.DATA_SUGGESTER).activeInput}else{if(checkControl instanceof InfoPlus.Controls.Control){return checkControl.element}else{return checkControl}}};var showMasterErrorPrompt=function($repeatRow){if($repeatRow.is(":visible")){$repeatRow.validationEngine("showPrompt",$$.lt("validation.detailError"),null,"row",true);$repeatRow.data("showDetailError",true)}};var checkValid=function(chkCtrl){var validator,$control=$(chkCtrl),inDetailCell=$control.parents(".detailCell").size()>0;var id="#"+$control[0].id;if(!checkRequire){if($control.data($Control.DATA_ORIGIN_INPUT)!=null){validator=$($control.data($Control.DATA_ORIGIN_INPUT)).data($Control.DATA_VALIDATOR)}else{validator=$control.data($Control.DATA_VALIDATOR)}var oldValidatorRequired=validator.required;validator.required=false;if($$.params.renderForm.validationEngine("validateField",id,(!inDetailCell||!showMasterError))===true){validator.required=oldValidatorRequired;if(inDetailCell&&showMasterError){showMasterErrorPrompt($control.parents(".detailCell").parent())}return false}validator.required=oldValidatorRequired}else{if($$.params.renderForm.validationEngine("validateField",id,(!inDetailCell||!showMasterError))===true){if(inDetailCell&&showMasterError){showMasterErrorPrompt($control.parents(".detailCell").parent())}return false}}return true};var retValue=true;for(var i=0,len=controls.length;i<len;i++){var control=getCheckControl(controls[i]);if(checkValid(control)===false){retValue=false}}return retValue};utilities.clacImgZoomParam=function(maxWidth,maxHeight,width,height){var param={top:0,left:0,width:width,height:height};if(width>maxWidth||height>maxHeight){var rateWidth=width/maxWidth,rateHeight=height/maxHeight;if(rateWidth>rateHeight){param.width=maxWidth;param.height=Math.round(height/rateWidth)}else{param.width=Math.round(width/rateHeight);param.height=maxHeight}}param.left=Math.round((maxWidth-param.width)/2);param.top=Math.round((maxHeight-param.height)/2);return param};utilities.dynamicReferControl=function(dynamic,control){var controlFieldName=control.getDynamicKeyName();var controlName=control.getDynamicContextControlName();return utilities.arrayContains(dynamic.references,controlFieldName)||utilities.arrayContains(dynamic.references,controlName)};utilities.scrollTo=function(top,time,callback){$("html,body").animate({scrollTop:top},time,callback)};utilities.adjustWidth=function(widths,total,coefficient){var adjustTotal=0;for(var i=0,len=widths.length;i<len;i++){widths[i]=Math.round(widths[i]*coefficient);adjustTotal+=widths[i]}if(adjustTotal!==total){var deltaAvg=Math.ceil((total-adjustTotal)/widths.length);for(i=0,len=widths.length;i<len;i++){if(total===adjustTotal){break}if((deltaAvg>0&&deltaAvg<(total-adjustTotal))||(deltaAvg<0&&deltaAvg>(total-adjustTotal))){widths[i]+=deltaAvg;adjustTotal+=deltaAvg}else{widths[i]+=(total-adjustTotal);adjustTotal=total}if((adjustTotal!==total)&&i===(len-1)){widths[i]+=(total-adjustTotal)}}}};utilities.addVariableControl=function(name,value,displayValue,attributes){if(value==null){value=""}var $variableHidden=$("#"+name);if($variableHidden.length>0){var hiddenControl=$variableHidden.data($Control.DATA_CONTROL_OBJECT);if(hiddenControl!=null){hiddenControl.setValue(value,displayValue,true,attributes)}}else{var $variablesDiv=$("#variables_container");var fakeField={name:name,type:displayValue==null&&name!=="_VAR_URL"?$Control.DATA_TYPE_STRING:$Control.DATA_TYPE_CODE,permission:"rw"};var fakeRender={renderCategory:"Boundable",controlId:name,field:name};hiddenControl=new $Controls.Hidden("",fakeField,fakeRender,value,displayValue,attributes);$variablesDiv.append(hiddenControl.element);if($IU.beginWith(name,"_VAR_")){$(hiddenControl.element).addClass($Control.CLASSNAME_VAR)}}return hiddenControl};utilities.getAllControls=function(parentElement){if(parentElement===undefined){parentElement=$$.params.renderForm}var controls=[];$(parentElement).find("."+$Control.CLASSNAME_CONTROL+",."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT+",."+InfoPlus.Layout.View.CLASS_VIEW).each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);if(control==null){control=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(control==null){control=$(this).data(InfoPlus.Layout.View.DATA_CONTROL_OBJECT);if(control==null){return}}}controls.push(control)});return controls};utilities.pathInclude=function(path,includePath){var pa=path.split("_"),ipa=includePath.split("_");if(ipa.length>pa.length){return false}for(var i=0,len=ipa.length;i<len;i++){if(ipa[i]!==pa[i]){return false}}return true};utilities.processUrl=function(url,skipParamName){var containParameter=function(param){return url.indexOf("&"+param+"=")!==-1||url.indexOf("?"+param+"=")!==-1};var addParam=function(paramName,urlName){if(skipParamName===paramName){return}if(urlName===undefined){urlName=paramName}if($$.params[paramName]!=null&&$$.params[paramName]!==""&&!containParameter(urlName)){if(paramName==="back"){if($IU.isPositiveInt($$.params.back)){var back=$$.params.back;if(utilities.historyAdd()>0){back=parseInt(back,10)+utilities.historyAdd()}url+=((url.indexOf("?")!==-1)?"&":"?")+urlName+"="+(parseInt(back,10)+1)}else{url+=((url.indexOf("?")!==-1)?"&":"?")+urlName+"="+encodeURIComponent($$.params[paramName])}}else{url+=((url.indexOf("?")!==-1)?"&":"?")+urlName+"="+encodeURIComponent($$.params[paramName])}}};if($$.getTestFile()!=null){url+=((url.indexOf("?")!==-1)?"&":"?")+"jsTestFile="+$$.getTestFile()}addParam("back");addParam("membership");addParam("showRemark");addParam("theme");addParam("urlLang","lang");addParam("entrust");return url};utilities.getParamFromUrl=function(url){var result={};if(!utilities.isString(url)||url==null){return result}var paramStrings=[];var s=url.split("?");if(s.length>1){paramStrings=s[0].split("#").concat(s[1].split("#"));paramStrings.splice(0,1)}else{paramStrings=s[0].split("#")}for(var i=0,len=paramStrings.length;i<len;i++){var ps=paramStrings[i].split("&");for(var pi=0,pl=ps.length;pi<pl;pi++){var nv=ps[pi].split("=");if(nv.length===2){result[nv[0]]=decodeURIComponent(nv[1])}}}return result};utilities.openUrl=function(url,linkAppendToElement,target){var link=document.createElement("a");link.href=url;link.target=(target===undefined?"_self":target);$(link).css("display","none");if(linkAppendToElement!=null){$(linkAppendToElement).append(link)}else{$(document.body).append(link)}$IU.fireClick(link)};utilities.getWindowWidth=function(){var width=$(window).width();if(width===0){width=window.outerWidth}if(width===0){width=window.screen.width}return width};utilities.getBarcodePrintUrl=function(value){if(value==null||value===""){return null}var url=$$.params.uriBarcode;if(url==null){return null}var DEFAULT_PRINT_PARAM_TEXT=1,DEFAULT_PRINT_PARAM_WIDTH=300;var paramString=url.split("?");if(paramString.length>1){var params=paramString[1].split("&");url=paramString[0]+"?";var foundWidth=false,foundText=false;for(var i=0,len=params.length;i<len;i++){var p=params[i].split("=");if(p.length>1){if(p[0].toLocaleLowerCase()==="width"){foundWidth=true}if(p[0]==="isTextDrawn"){foundText=true}}url+=(i===0)?params[i]:"&"+params[i]}if(!foundWidth){url+="&width="+DEFAULT_PRINT_PARAM_WIDTH}if(!foundText){url+="&isTextDrawn="+DEFAULT_PRINT_PARAM_TEXT}}else{url=url+"?isTextDrawn="+DEFAULT_PRINT_PARAM_TEXT+"&width="+DEFAULT_PRINT_PARAM_WIDTH}return url.replace("%s",value)};utilities.analysisTable=function($row){var $table=$row.closest("table"),$trs=$row.parent().children("tr");if($table.data("analysed")==null){for(var trIndex=0,trLen=$trs.size();trIndex<trLen;trIndex++){var $tr=$($trs[trIndex]),$tds=$tr.children("td");for(var tdIndex=0,tdLen=$tds.size();tdIndex<tdLen;tdIndex++){var $td=$($tds[tdIndex]);if($td.attr("colspan")!=null){var fakeCount=parseInt($td.attr("colspan"),10)-1;for(var i=0;i<fakeCount;i++){var fakeTd=document.createElement("td");$(fakeTd).addClass("fake").css("display","none");$td.after(fakeTd)}}if($td.attr("rowspan")!=null){var rowCount=parseInt($td.attr("rowspan"),10)-1;fakeCount=$td.attr("colspan")!=null?parseInt($td.attr("colspan"),10):1;for(var rowIndex=1;rowIndex<=rowCount;rowIndex++){if(trIndex+rowIndex<$trs.size()){var $nextTr=$($trs[trIndex+rowIndex]);if($td.index()>0){for(i=0;i<fakeCount;i++){fakeTd=document.createElement("td");$(fakeTd).addClass("fake").css("display","none");var insertAfterIndex=$td.index()-1,$nextTds=$nextTr.children("td");for(var nextTdIndex=0,totalIndex=0,nextTdLen=$nextTds.size();nextTdIndex<nextTdLen;nextTdIndex++){var $nextTd=$($nextTds[nextTdIndex]);if(totalIndex===insertAfterIndex){$nextTd.after(fakeTd);break}else{if($nextTd.attr("colspan")!=null){totalIndex+=parseInt($nextTd.attr("colspan"),10)-1}}totalIndex++}}}else{for(i=0;i<fakeCount;i++){fakeTd=document.createElement("td");$(fakeTd).addClass("fake").css("display","none");$nextTr.prepend(fakeTd)}}}}}}}$trs.each(function(){var log=$(this).index()+":";$(this).children("td").each(function(){log+=$(this).index();$(this).data("rawTdIndex",$(this).index())});$(this).children("td.fake").remove()});$table.data("analysed",true)}};utilities.processTrRowVisible=function($row,isVisible,fromInit){var removeNextRowsFakeTd=function($nextRows,$td){var affectRowCount=parseInt($td.attr("rowspan"),10)-1,rawIndex=$td.data("rawTdIndex"),nextRowNumber=0,rowIndex=0;while(nextRowNumber<affectRowCount&&rowIndex<$nextRows.size()){var $nextRow=$($nextRows[rowIndex]),$nextRowTds=$nextRow.children("td");for(var tdIndex=0,tdLen=$nextRowTds.size();tdIndex<tdLen;tdIndex++){var $nextRowTd=$($nextRowTds[tdIndex]);if($nextRowTd.data("rawTdIndex")===rawIndex&&$nextRowTd.hasClass("fake")){$nextRowTd.remove()}}if(!$nextRow.hasClass("fake")){nextRowNumber++}rowIndex++}};var processNextRows=function(){var foundFirstVisible=false,nextRows=[];$row.nextAll("tr:not(.fake)").each(function(){if(!foundFirstVisible){nextRows.push($(this));if($(this).css("display")!=="none"){foundFirstVisible=true}}});var $tds=$row.children("td");for(var i=0,len=$tds.size();i<len;i++){var $td=$($tds[i]);if($td.attr("rowspan")!=null){insertNextRowFakeTd($td,nextRows)}}};var insertNextRowFakeTd=function($td,nextRows){var appendTdToRow=function($row,rowspanCount){var $cloneTd=$td.clone();$cloneTd.attr("rowspan",rowspanCount);$cloneTd.data("rawTdIndex",$td.data("rawTdIndex"));$cloneTd.addClass("fake");var rawIndex=$td.data("rawTdIndex");var $nextTds=$row.children("td");for(var i=0,len=$nextTds.size();i<len;i++){var $nextTd=$($nextTds[i]);if($nextTd.data("rawTdIndex")!=null){if($nextTd.data("rawTdIndex")>rawIndex){$nextTd.before($cloneTd);return}}}$row.append($cloneTd)};var rowspanCount=parseInt($td.attr("rowspan"),10);for(var rowIndex=0,rowLen=nextRows.length;rowIndex<rowLen;rowIndex++){if(rowspanCount>1){var $nextRow=nextRows[rowIndex];appendTdToRow($nextRow,--rowspanCount)}}};var processPrevRowsBorderBottom=function($row,visible){var prevNumber=1;$row.prevAll("tr").not(".fake").each(function(){$(this).children("td").each(function(){var $td=$(this);var rowAffectNumber=$td.attr("rowspan")==null?1:parseInt($td.attr("rowspan"),10);if(prevNumber===rowAffectNumber){if(visible){if($td.data("oldBorderBottomStyle")!=null){$td.css("border-bottom-style",$td.data("oldBorderBottomStyle"))}}else{if($td.data("oldBorderBottomStyle")==null){$td.data("oldBorderBottomStyle",$td.css("border-bottom-style"))}$td.css("border-bottom-style","none")}}});prevNumber++})};var insertFakeRow=function($row){var $fakeRow=$row.clone();$fakeRow.children("td").removeAttr("rowspan").css("border-width","0").css("border-style","none").css("padding","0").empty();$fakeRow.addClass("fake").removeClass(InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_TABLE_ROW);if($fakeRow.css("min-height")!=null){$fakeRow.css("min-height","")}if($fakeRow.css("display")!=null){$fakeRow.css("display","")}$row.before($fakeRow)};if($row.closest("table").data("analysed")==null){$IU.analysisTable($row)}if(isVisible){if($row.css("display")==="none"){if($row.prev("tr").size()>0){$row.prev("tr.fake").remove()}var $nextRows=$row.nextAll("tr");$row.children("td").each(function(){if($(this).attr("rowspan")!=null){removeNextRowsFakeTd($nextRows,$(this))}})}$IU.dynamicShowElement($row);$row.removeData("visible")}else{if($row.data("visible")!==false){if($row.prev("tr").size()>0){insertFakeRow($row)}processNextRows()}$IU.dynamicHideElement($row);$row.data("visible",false)}};utilities.convertData=function(data){var getKeys=function(){var keys=[];for(var key in data){if(data.hasOwnProperty(key)&&!isGroup(key)){keys.push(key)}}keys.sort();return keys};var isGroup=function(fieldName){return $$.entity.groups.hasOwnProperty(fieldName)};var isAttr=function(fieldName){return $IU.endWith(fieldName,"_Attr")};var isCode=function(fieldName){return $IU.endWith(fieldName,"_Code")||$IU.endWith(fieldName,"_code")};var isCodes=function(fieldName){return $IU.endWith(fieldName,"_Codes")||$IU.endWith(fieldName,"_codes")};var isName=function(fieldName){return $IU.endWith(fieldName,"_Name")||$IU.endWith(fieldName,"_name")};var isNames=function(fieldName){return $IU.endWith(fieldName,"_Names")||$IU.endWith(fieldName,"_names")};var findField=function(fieldName){if(isAttr(fieldName)||isName(fieldName)){fieldName=fieldName.substr(0,fieldName.length-5)}return $$.entity.fields[fieldName]};var findFieldName=function(fieldName){var field=findField(fieldName);return(field==null)?null:field.name};var setCode=function(dat,fieldName,value){if(dat[fieldName]==null){dat[fieldName]={value:value}}else{if($IU.isObject(dat[fieldName])){dat[fieldName]["value"]=value}else{dat[fieldName]={value:value}}}};var setCodes=function(dat,fieldName,value){var codes=$IU.splitAttribute(value);if(dat[fieldName]!=null){if(!$IU.isArray(dat[fieldName])){dat[fieldName]=[]}for(var i=0,len=codes.length;i<len;i++){if(dat[fieldName][i]==null){dat[fieldName][i]={value:codes[i]}}else{if($IU.isObject(dat[fieldName][i])){dat[fieldName][i]["value"]=codes[i]}else{dat[fieldName][i]={value:codes[i]}}}}}else{dat[fieldName]=[];for(i=0,len=codes.length;i<len;i++){dat[fieldName].push({value:codes[i]})}}};var setNames=function(dat,fieldName,value){var names=$IU.splitAttribute(value);if(dat[fieldName]!=null){if(!$IU.isArray(dat[fieldName])){dat[fieldName]=[]}for(var i=0,len=names.length;i<len;i++){if(dat[fieldName][i]==null){dat[fieldName][i]={name:names[i]}}else{if($IU.isObject(dat[fieldName][i])){dat[fieldName][i]["name"]=names[i]}else{dat[fieldName][i]={value:dat[fieldName][i],name:names[i]}}}}}else{dat[fieldName]=[];for(i=0,len=names.length;i<len;i++){dat[fieldName].push({name:names[i]})}}};var setCodeName=function(dat,fieldName,value){if(dat[fieldName]!=null){if($IU.isObject(dat[fieldName])){dat[fieldName]["name"]=value}else{dat[fieldName]={value:dat[fieldName],name:value}}}};var setCodeAttr=function(dat,fieldName,value){var processAttr=function(){var attr={},obj=$.parseJSON(value);for(var key in obj){if(obj.hasOwnProperty(key)){if(isCode(key)){var propName=key.substr(0,key.length-5);setCode(attr,propName,obj[key]);continue}if(isName(key)){propName=key.substr(0,key.length-5);setCodeName(attr,propName,obj[key]);continue}if(isNames(key)){propName=key.substr(0,key.length-6);setNames(attr,propName,obj[key]);continue}if(isCodes(key)||(obj.hasOwnProperty(key+"_Names")||obj.hasOwnProperty(key+"_names"))){propName=isCodes(key)?key.substr(0,key.length-6):key;setCodes(attr,propName,obj[key]);continue}if(obj.hasOwnProperty(key+"_Name")||obj.hasOwnProperty(key+"_name")){setCode(attr,key,obj[key]);continue}attr[key]=obj[key]}}return attr};if(dat[fieldName]!=null){if($IU.isObject(dat[fieldName])){dat[fieldName]["attributes"]=processAttr()}else{dat[fieldName]={value:dat[fieldName],attributes:processAttr()}}}};var setValue=function(dat,field,fieldName,value){var fieldSupportNameAttr=(field.type==="User"||field.type==="Organize"||field.type==="Code"||field.type==="Thing");var isFieldName=fieldSupportNameAttr&&isName(fieldName),isFieldAttr=fieldSupportNameAttr&&isAttr(fieldName);if(!isFieldAttr&&!isFieldName){if(dat[fieldName]!=null&&$IU.isObject(dat[fieldName])){dat[fieldName]["value"]=value}else{dat[fieldName]=value}}else{fieldName=findFieldName(fieldName);if(isFieldName){setCodeName(dat,fieldName,value)}if(isFieldAttr){setCodeAttr(dat,fieldName,value)}}};var setGlobalVarValue=function(dat,fieldName,value){var isFieldName=isName(fieldName),isFieldAttr=isAttr(fieldName),isFieldCodes=isCodes(fieldName),isFieldNames=isNames(fieldName);if(isFieldName||isFieldAttr){fieldName=fieldName.substr(0,fieldName.length-5);if(isFieldName){setCodeName(dat,fieldName,value)}if(isFieldAttr){setCodeAttr(dat,fieldName,value)}return}if(isFieldCodes||isFieldNames){fieldName=fieldName.substr(0,fieldName.length-6);if(isFieldCodes){setCodes(dat,fieldName,value)}if(isFieldNames){setNames(dat,fieldName,value)}return}if(dat[fieldName]!=null&&$IU.isObject(dat[fieldName])){dat[fieldName]["value"]=value}else{dat[fieldName]=value}};var addValue=function(data,value,fieldName,group){var isFieldName=isName(fieldName),isFieldAttr=isAttr(fieldName),field=findField(fieldName);var findNextGroup=function(){if(group==null){return field.groupArray[1]}else{for(var i=1,len=field.groupArray.length;i<len;i++){var groupName=field.groupArray[i];if(group===groupName&&i!==len-1){return field.groupArray[i+1]}}return null}};if(!$IU.isArray(value)){setValue(data,field,fieldName,value)}else{var nextGroup=findNextGroup();if(data[nextGroup]==null){data[nextGroup]=[]}for(var i=0,len=value.length;i<len;i++){if(data[nextGroup][i]==null){if(!isFieldName&&!isFieldAttr){data[nextGroup][i]={}}}var newData=data[nextGroup][i];if(newData!=null){addValue(newData,value[i],fieldName,nextGroup)}}}};var keys=getKeys(),d={};for(var i=0,len=keys.length;i<len;i++){var key=keys[i],value=data[key],field=findField(key);if(field==null){setGlobalVarValue(d,key,value)}else{var groupArray=field.groupArray;if(groupArray==null){setValue(d,field,key,value)}else{if(groupArray.length===1){setValue(d,field,key,value)}else{addValue(d,value,key)}}}}return d};utilities.linkifyStr=function(str){var pattern=/\[([\u4e00-\u9fa5_A-Z0-9]+)\]\((\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])\)/gim;if(str.match(pattern)){return str.replace(pattern,'<a href="$2" target="_blank">$1</a>')}else{pattern=/(\b(https?):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;return str.replace(pattern,'<a href="$1" target="_blank">$1</a>')}};utilities.createReviewPopTip=function(container,popper,data){var containerDiv=document.createElement("div"),$containerDiv=$(containerDiv),contentDiv=document.createElement("div"),$contentDiv=$(contentDiv);$contentDiv.attr("contenteditable","true").addClass("memo_input_div");if(data!=null){if(data.html!=null){$contentDiv.html(data.html)}if(data.remark!=null){$contentDiv.html($IU.htmlEncode(data.remark))}}$containerDiv.append(contentDiv);var tip=new InfoPlus.Render.PopTip({popper:popper,container:container,content:containerDiv,colorClass:"remarkTip",placement:"top",location:"top",unclearable:true,onMaximized:function(){popMenu.showMenuItems(["minimize","remove"])},onClose:$IU.refreshReviewByForm});var popMenu=new InfoPlus.Render.PopMenu({container:tip.element,items:[{id:"maximize",text:$$.lt("review.menu.maximize"),iconClass:"i-icon-triangle-up",initVisible:false,switchItems:["minimize","remove"],click:function(){tip.maximize();popMenu.show()}},{id:"minimize",text:$$.lt("review.menu.minimize"),iconClass:"i-icon-triangle-down",switchItems:["maximize"],click:function(){tip.minimize()}},{id:"remove",text:$$.lt("review.menu.remove"),iconClass:"i-icon-delete",click:function(){tip.close(true)}}]})};utilities.refreshReviewByForm=function($renderContainer){var data=[];if($renderContainer==null){$renderContainer=$$.params.renderContainer}$renderContainer.find(".memo_input_div").each(function(){if(utilities.trimString(this.innerText)!==""){var tipControl=$(this).parents(".popTip").data("tipControl");var control=$(tipControl.options.popper).data($Control.DATA_CONTROL_OBJECT);if(control!=null){if(tipControl.isHideByShrinkView()){data.push({field:control.field.name,path:control.path,remark:utilities.trimString(this.innerText),html:this.innerHTML})}else{if((control.controlContainer!=null&&$(control.controlContainer).is(":visible"))||$(control.element).is(":visible")){data.push({field:control.field.name,path:control.path,remark:utilities.trimString(this.innerText),html:this.innerHTML})}}}}});$$.params.review=data;$IU.refreshReviewButton(data.length)};utilities.refreshFormReviews=function(){var total=0;if($$.params.review.length>0){for(var i=0,len=$$.params.review.length;i<len;i++){var review=$$.params.review[i];if(review.remark==null||review.remark===""){continue}var $$control=$$("&"+review.field).filter({path:review.path});if($$control.length>0){var control=$$control[0].control;if((control.controlContainer!=null&&$(control.controlContainer).is(":visible"))||$(control.element).is(":visible")){var popper=control.controlContainer||control.element;$IU.createReviewPopTip($$.params.renderContainer[0],popper,review);total++}}}}return total};utilities.refreshReviewButton=function(total){var reviewToolButton=$("#FormCommandReview").data("buttonControl");if(reviewToolButton!=null){if(total>0){reviewToolButton.mark();reviewToolButton.setTip($$.lt("review.buttonTip")+"<br>"+$$.lt("review.tipCount",total))}else{reviewToolButton.removeMark();reviewToolButton.setTip($$.lt("review.buttonTip"))}}};utilities.createFormReviews=function(step){if(!$$.params.readOnly&&step!=null&&step.review!=null){var review;try{review=$.parseJSON(step.review)}catch(e){}if(review!=null&&review.remarks!=null&&$IU.isArray(review.remarks)){$$.params.review=review.remarks;var total=$IU.refreshFormReviews();$IU.refreshReviewButton(total)}}};utilities.getReviewData=function(){var data=$$.params.review;if(data==null){return null}if($IU.isArray(data)&&data.length>0){var remarks=[];for(var i=0,len=data.length;i<len;i++){remarks.push({field:data[i].field,path:data[i].path,remark:data[i].remark})}return{remarks:remarks}}else{return null}};utilities.clearStack=function(){utilities.stack=null};utilities.pushStack=function(o){if(utilities.stack==null){utilities.stack=[]}utilities.stack.push(o)};utilities.popStack=function(){if(utilities.stack==null){return null}else{return utilities.stack.pop()}};utilities.removePrintZeroHeightView=function(){if(!$$.PRINT){return}$$.params.holder.form.find(".infoplus_view").each(function(){if($(this).find("table").first().height()===0){$(this).remove()}})};utilities.localeCompare=function(a,b){try{return a.localeCompare(b)}catch(e){a=a||"";b=b||"";if(a.length===0||b.length===0){if(a.length===b.length){return 0}return a.length===0?-1:1}return(a.charAt(0)===b.charAt(0))?0:(a.charAt(0)>b.charAt(0)?1:-1)}};utilities.processEmptyDiv=function(render,parentRenders){var isLeaf=function(render){return render.renders==null||render.renders.length===0};var isSpace=function(render){return render.renderType==="DisplayText"&&utilities.trimString(render.text)===""};if(isLeaf(render)){if(isSpace(render)){if(parentRenders!=null){parentRenders.length=parentRenders.length-1}var o=utilities.popStack();if(o!=null){utilities.processEmptyDiv(o.renders[o.index],o.renders)}else{utilities.clearStack()}}else{utilities.clearStack()}}else{for(var i=0,len=render.renders.length;i<len-1;i++){utilities.pushStack({index:i,renders:render.renders})}utilities.processEmptyDiv(render.renders[render.renders.length-1],render.renders)}};utilities.processStepName=function(stepName){return"<span class='color_b2'>"+stepName+"</span>"};utilities.listSteps=function(actionId,hideConfirmWhenNoNextStep,transferToes,hideWaiting){var defer=$.Deferred();if(actionId==null){return defer.reject({error:$$.lt("submit.needAction")})}var distinguishSteps=function(steps){var endStep=null;if(null!=steps&&0<steps.length){for(var i=0;i<steps.length;i++){var step=steps[i];if(step.type===InfoPlus.Settings.STEP_TYPE_AUTO){endStep=step;steps.splice(i,1);break}}}return endStep};var data=$$.params.formRender.save(null,false);var jsonData=$.toJSON(data);if(!hideWaiting){$$.blockUI({message:"<span class='loading'>"+$$.lt("submit.prepare")+"</span>"})}var data={stepId:$$.params.formStepId==null?-1:$$.params.formStepId,actionId:actionId,formData:jsonData,timestamp:$$.params.timestamp,rand:Math.random()*999,boundFields:$$.params.boundFields.toString()};if(transferToes){data.transferToes=transferToes}$$.ajax({type:"POST",url:$$.params.uriListNextSteps,data:data,requestMsg:$$.lt("submit.request"),errorTitle:"",beforeShowErrorMsg:function(){$.unblockUI()}}).always(function(){$.unblockUI()}).done(function(result){var steps=result.entities,len=steps.length,skipSelectUser=false,endStep=distinguishSteps(steps);if(endStep==null&&len>0){skipSelectUser=true;for(var i=0;i<len;i++){if(steps[i].executorSelection!==3){skipSelectUser=false;break}}}else{skipSelectUser=hideConfirmWhenNoNextStep}if(skipSelectUser===true){defer.resolve({showSelectUser:false,steps:[],jsonData:jsonData,remark:result.error})}else{defer.resolve({showSelectUser:true,steps:steps,isEndStep:endStep!=null,jsonData:jsonData,remark:result.error})}}).fail(function(error){defer.reject(error)});return defer.promise()};utilities.closeAllDoc=function(){var closed=false;$$("*doc").each(function(){var docControl=this.control;if(docControl.hasFile()&&(docControl.isWritable()||docControl.isEditable())){docControl.closeIframe();closed=true}});return closed};utilities.reopenAllDoc=function(){$$("*doc").each(function(){var docControl=this.control;docControl.reopenIframe()})};utilities.showDoAction=function($button,listUserResult,actions,isTransferGroup){var title=$button.children("nobr").text(),description=$button.data("description"),initRemark=$IU.isEmptyStr(listUserResult.remark)?$button.data("lastRemark"):listUserResult.remark,remarkRequired=$button.data("remarkRequired"),remarkRequiredTip=$button.data("remarkRequiredTip"),hidePrintPrompt=$button.data("hidePrintPrompt"),actionPrintable=$button.data("actionPrintable"),actionId=$button.data("actionId"),jsonData=listUserResult.jsonData,steps=listUserResult.steps,isEndStep=listUserResult.isEndStep,$formDoActionRemark=$("#form_do_action_remark"),$formDoActionDialog=$("#form_do_action_dialog"),transferTo=$button.data("transferTo"),transferToes=[],transferBack=false;if(isTransferGroup){actionId=-1}else{isTransferGroup=false}var mustInputRemark=remarkRequired==null?false:remarkRequired;var remarkTip=$IU.trimString(remarkRequiredTip);if(remarkTip==null||remarkTip===""){remarkTip="*"}if(actionId==null){$IU.messageBox(null,$$.lt("submit.noAction"),null,300);return false}var $showRemark=$("#form_do_action_show_remark"),$remarkTip=$("#form_do_action_remark_tip"),$remarkDiv=$("#form_do_action_remark_div");$showRemark.empty().html("<span class='form_do_action_info ui-icon ui-icon-info'></span><span>"+$$.lt("submit.clickComment")+"</span><a href='#' class='show_comment'>"+$$.lt("submit.linkComment")+"</a><span>"+$$.lt("submit.orComment")+"</span><a class='make_remark' href='#'>"+$$.lt("submit.makeRemark")+"</a><span class='form_do_action_remark_made'></span><span>"+$$.lt("submit.remarkInForm")+"</span></span>");$(".form_do_action_next_steps").html($$.lt("submit.nextSteps"));if(transferTo&&actions.length>1){$(".form_do_action_next_steps").append("<a class='add_forward_button' href='#'>"+$$.lt("forward.addForwardButton")+"</a>");$(".add_forward_button").click(function(){isTransferGroup=true;$(".form_do_transfer_list").addClass("is_transfer_group");$(this).remove()})}if(initRemark!=null){$formDoActionRemark.val(initRemark)}else{$formDoActionRemark.val("")}if(remarkRequired===true){$remarkTip.html($$.lt("submit.inputRemark")+"<span>"+$$.lt("submit.orComment")+"</span><a href='#' class='make_remark'>"+$$.lt("submit.makeRemark")+"</a><span class='form_do_action_remark_made'></span><span>"+$$.lt("submit.remarkInForm")+'</span><span style="color:red">('+remarkTip+')</span><span class="form_do_action_must_input_remark" style="display:none">'+$$.lt("submit.mustInputRemark")+"</span>")}else{$remarkTip.html($$.lt("submit.inputRemark"))}if($button&&!$IU.isEmptyStr($button.data("lastRemark"))&&!$IU.isEmptyStr(listUserResult.remark)&&($button.data("lastRemark")!==listUserResult.remark)){if($remarkDiv.find(".hint_div").length===0){var hintDiv=document.createElement("div"),$hintDiv=$(hintDiv),hintLink=document.createElement("a"),$hintLink=$(hintLink);$hintDiv.addClass("hint_div");$hintLink.attr("href","#").text($$.lt("submit.lastRemark")).addClass("last_remark_link");$hintLink.attr("original-title",$IU.htmlEncode($button.data("lastRemark")));$hintDiv.html($$.lt("submit.lastRemarkDiff",$hintLink[0].outerHTML));$remarkDiv.append(hintDiv);$hintLink=$hintDiv.find(".last_remark_link");$hintLink.tipsy({html:true,fade:true,gravity:"n",trigger:"manual",opacity:0.8}).data("lastRemark",$button.data("lastRemark")).data("copied",false).click(function(){if(!$$.MOBILE){$(this).tipsy("show")}if(!$(this).data("copied")){$formDoActionRemark.val($formDoActionRemark.val()+"\n"+$button.data("lastRemark"));$(this).data("copied",true)}});if(!$$.MOBILE){$hintLink.mouseenter(function(){$(this).tipsy("show")}).mouseleave(function(){$(this).tipsy("hide")})}}else{$remarkDiv.find(".last_remark_link").attr("original-title",$IU.htmlEncode($button.data("lastRemark"))).data("copied",false);$remarkDiv.find(".hint_div").show()}}else{$remarkDiv.find(".hint_div").hide()}if($$.params.review!=null&&$$.params.review.length>0){$(".form_do_action_remark_made").html($$.lt("submit.remarkDone",$$.params.review.length))}if(remarkRequired===true){$showRemark.hide();$remarkDiv.show()}else{if(initRemark!=null&&initRemark!==""){$showRemark.show();$remarkDiv.show()}else{$showRemark.show();$remarkDiv.hide()}}var $descriptionDiv=$("#form_do_action_message_description");if(description==null||description===""){$descriptionDiv.hide().text("")}else{$descriptionDiv.text(description).show()}var doAction=function(actionId,jsonData){var nextUsers={},foundSelectUserError=false,selectUserMessenger="",remark="";if($("#form_do_action_next_steps").css("display")!=="none"){var $userList=$("#form_do_action_user_list");if(isTransferGroup||transferTo){$userList=$(".form_do_tansfer_user_list")}$userList.find("select").each(function(){var $formDoTansferUserList=$(this).parents(".form_do_tansfer_user_list");var $transferStepTitle=$formDoTansferUserList.parents(".transfer_step_title");if((!isTransferGroup)||$transferStepTitle.find(".transferToStepCheckBox:checked").size()>0){var val=$(this).val();if(val===InfoPlus.Settings.NOBODY_ACCOUNT){if($(this).data("mustSelectNextUser")){if(!$$.MOBILE){var $selectUserTip=$(this).parent().siblings(".form_do_action_must_select_user");if(!$selectUserTip.is(":visible")){$selectUserTip.show().effect("highlight")}else{$selectUserTip.effect("pulsate")}}selectUserMessenger+=(selectUserMessenger!==""?"<br>":"")+$$.lt("submit.chooseStepExecutor",$(this).data("stepName"));foundSelectUserError=true;return}val=""}nextUsers[$(this).data("stepId")]=val}});$userList.find("input[type*=hidden]").each(function(){nextUsers[$(this).data("stepId")]=$(this).val()});if(foundSelectUserError){if($$.MOBILE){$IU.messageBox($$.lt("common.choose"),selectUserMessenger,null,400)}return false}}else{}var $remark=$("#form_do_action_remark");if($$.MOBILE){if($remark.is(":visible")){remark=$remark.val()}}else{if($("#form_do_action_remark_div").css("display")==="block"){remark=$remark.val()}}if(mustInputRemark===true&&$IU.trimString(remark).length===0){if($$.MOBILE){$IU.messageBox(null,remarkTip,null,300);return false}else{var $inputRemarkTip=$("#form_do_action_remark_tip").children(".form_do_action_must_input_remark");if(!$inputRemarkTip.is(":visible")){$inputRemarkTip.show().effect("highlight")}else{$inputRemarkTip.effect("pulsate")}return false}}var review=$IU.getReviewData();var beforeAction=function(){var docClosed=$IU.closeAllDoc();$$.blockUI({message:"<span class='loading'>"+$$.lt("submit.submitting")+"</span>"});if(docClosed){return 3000}};var afterAction=function(){$IU.reopenAllDoc();$.unblockUI()};var actionData={actionId:actionId,formData:jsonData,remark:remark,rand:Math.random()*999};if(review!=null){actionData.review=$.toJSON(review)}if(isTransferGroup||transferTo){transferBack=$("#return_this_step_chb").prop("checked");if(isTransferGroup){$(".transferToStepCheckBox:checked").each(function(){transferToes.push($(this).data("transferTo"))});if($(".transferToStepCheckBox:checked").size()==1){actionData.actionId=$(".transferToStepCheckBox:checked").data("actionId")}else{actionData.actionId=-1}}else{transferToes.push(transferTo)}if(transferToes.length>0){transferToes=transferToes.join(",");$$.doAction(actionData,nextUsers,false,beforeAction,afterAction,transferToes,transferBack,hidePrintPrompt)}else{$IU.messageBox(null,$$.lt("forward.chooseMessage"),null,300)}}else{$$.doAction(actionData,nextUsers,false,beforeAction,afterAction,null,null,hidePrintPrompt)}};var buttons=[];if($$.params.printable&&actionPrintable===true){buttons.push({name:$$.lt("common.print"),callback:function(){$("#linkPrint").attr("href",$IU.processUrl($$.params.printUrl));$IU.fireClick("linkPrint")}})}buttons=buttons.concat([{name:$$.lt("common.confirmAction"),callback:function(){return doAction(actionId,jsonData)},preventDefault:true,defaultButton:true},{name:$$.lt("common.cancel"),callback:function(){$button.data("lastRemark",$formDoActionRemark.val())},callOnClose:true}]);var $nextStepDiv=$("#form_do_action_next_steps");$nextStepDiv.hide();var stepList=$("#form_do_action_user_list")[0];$(stepList).empty();var showStepUserList=function(steps,stepList){if(isEndStep===true){}else{if(steps.length>0){var createSelect=function(thisStep,createUsers,mustSelectUser){var buildUserDisplayName=function(){var changeDisplayName=function(u){if(u.tenantUserId!=null){u.displayName=u.trueName+"("+u.tenantUserId+")"}else{u.displayName=u.trueName}};var userNames={};for(var n=0,l=createUsers.length;n<l;n++){var u=createUsers[n];if(userNames.hasOwnProperty(u.trueName)){var dpUser=userNames[u.trueName];changeDisplayName(dpUser);changeDisplayName(u)}else{userNames[u.trueName]=u;u.displayName=u.trueName}}};buildUserDisplayName();var select=document.createElement("select");for(var n=0;n<createUsers.length;n++){var thisUser=createUsers[n];var text=thisUser.displayName;var org=thisUser.organizeName;if(org!=null&&org!==""){text=text+"("+org+")"}var option=new Option(text,thisUser.userId);if($.browser.msie){select.add(option)}else{select.add(option,null)}}var identifier=(thisStep.splitIdentifier)==null?"":thisStep.splitIdentifier;$(select).data("stepId",thisStep.stepId+","+identifier).data("stepName",thisStep.name).data("mustSelectNextUser",mustSelectUser);var span=document.createElement("span");$(span).append(select).addClass("userSpan");return span};var sortUsers=function(users){var sortArray=new InfoPlus.QuickSortArray();for(var i=0,len=users.length;i<len;i++){sortArray.push(users[i])}sortArray.sort(function(u1,u2){return $IU.localeCompare(u1.trueName,u2.trueName)});return sortArray};var pleaseSelect={trueName:$$.lt("submit.choose"),userId:InfoPlus.Settings.NOBODY_ACCOUNT};var allUsers={trueName:$$.lt("submit.allUser"),userId:InfoPlus.Settings.NOBODY_ACCOUNT};var user,hiddenInput,helpSpan;for(var i=0,len=steps.length;i<len;i++){var step=steps[i],users=sortUsers(step.users),stepLi=document.createElement("li");if(isTransferGroup||transferTo){stepLi.innerHTML="<span class='stepName'>:"+step.name+"&nbsp;</span>"+$$.lt("submit.executor")+"&nbsp;"}else{stepLi.innerHTML="<span class='stepName'>"+step.name+"</span>"+$$.lt("submit.executor")+"&nbsp;"}$(stepLi).addClass("userLi");switch(step.executorSelection){case 0:users.splice(0,0,allUsers);stepLi.appendChild(createSelect(step,users,false));helpSpan=document.createElement("span");$(helpSpan).attr("class","tip_help").attr("original-title",$$.hlt("submit.helper.title")).data("selectUser",step.executorSelection).data("tipContent",$$.lt("submit.helper.content"));stepLi.appendChild(helpSpan);break;case 1:if(users.length===1){user=users[0];stepLi.innerHTML=stepLi.innerHTML+("<b>"+user.trueName+"</b>");hiddenInput=document.createElement("input");hiddenInput.type="hidden";hiddenInput.value=user.userId;stepLi.appendChild(hiddenInput);var identifier=(step.splitIdentifier)==null?"":step.splitIdentifier;$(hiddenInput).data("stepId",step.stepId+","+identifier)}else{users.splice(0,0,pleaseSelect);stepLi.appendChild(createSelect(step,users,true));var span=document.createElement("span");$(span).text("(*)").css("color","red");stepLi.appendChild(span);span=document.createElement("span");$(span).text($$.lt("submit.helper.mustChoose")).addClass("form_do_action_must_select_user").css("display","none");stepLi.appendChild(span);helpSpan=document.createElement("span");$(helpSpan).attr("class","tip_help").attr("original-title",$$.lt("submit.helper.mustChoose")).data("selectUser",step.executorSelection).data("tipContent",$$.lt("submit.helper.mustChoose"));stepLi.appendChild(helpSpan)}break;case 2:case 3:stepLi.innerHTML=stepLi.innerHTML+"<b>"+$$.lt("submit.helper.chooseBySystem")+"</b>";break;case 4:stepLi.innerHTML=stepLi.innerHTML+"<b>"+$$.lt("submit.helper.chooseOneBySystem")+"</b>";break}stepList.appendChild(stepLi)}$(helpSpan).tipsy({html:true,fade:true,gravity:"w",trigger:"manual",opacity:0.8});$("#form_do_action_show_next_steps").show()}else{$("#form_do_action_show_next_steps").hide()}$nextStepDiv.show()}};if(!(isTransferGroup||transferTo)){showStepUserList(steps,stepList);$(".form_do_transfer_list").remove();$("#form_do_action_return_this_step").remove()}else{var $transferList=$(".form_do_transfer_list");if($transferList.size()==0){$transferList=$("<ul class='form_do_transfer_list'></ul>");$nextStepDiv.append($transferList)}$transferList.empty();if(isTransferGroup){$transferList.addClass("is_transfer_group")}else{$transferList.removeClass("is_transfer_group")}var createTransferLi=function(actions){if(!isTransferGroup){actions=actions.sort(function(a,b){return b.id==actionId?1:-1})}for(var i=0;i<actions.length;i++){var $transferLi=$("<li><div class='transfer_step_title'><input type='checkbox' id='transferToStepCheckBox_"+i+"' class='transferToStepCheckBox' /><label for='transferToStepCheckBox_"+i+"'>"+actions[i].name+"</label><span class='user_loading'></span><div class='form_do_tansfer_user_list'></div></div></li>");$transferLi.find(".transferToStepCheckBox").data("transferTo",actions[i].transferTo);$transferLi.find(".transferToStepCheckBox").data("actionId",actions[i].id);$transferList.append($transferLi);if(actions[i].id==actionId){$transferLi.find(".transferToStepCheckBox").prop("checked",true);$transferLi.find("label").hide();var stepList=$transferLi.find(".form_do_tansfer_user_list")[0];showStepUserList(steps,stepList)}else{$transferLi.addClass("other_transfer_li")}$("form_do_tansfer_user_list").hide()}};createTransferLi(actions);var $transferToStepCheckBoxes=$transferList.find(".transferToStepCheckBox");if($transferToStepCheckBoxes.size()>0){$transferToStepCheckBoxes.change(function(){var self=$(this);var transferToStepCheckBoxCheckedLength=$transferList.find(".transferToStepCheckBox:checked").length;if(transferToStepCheckBoxCheckedLength>1){$("#return_this_step_chb").prop("checked",true).prop("disabled",true)}else{$("#return_this_step_chb").prop("checked",true).prop("disabled",false)}var stepList=$(this).parents("li").find(".form_do_tansfer_user_list")[0];var action=actions[$(this).parents("li").index()];var checkedActionId=action.id;var checkedTransferTo=action.transferTo;var hideConfirmWhenNoNextStep=true;if($(this).prop("checked")){if($(stepList).find("li").size()>0){$(stepList).show();$(this).next("label").hide()}else{$(this).siblings(".user_loading").show();var defer=utilities.listSteps(checkedActionId,hideConfirmWhenNoNextStep,checkedTransferTo,true);defer.done(function(result){$IU.refreshReviewByForm();var steps=result.steps;self.siblings(".user_loading").hide();self.next("label").hide();jsonData=result.jsonData;showStepUserList(steps,stepList)})}}else{$(this).next("label").show();$(stepList).hide()}})}$nextStepDiv.show()}if(transferTo||isTransferGroup){buttons=[{name:$$.lt("forward.forwardButton"),callback:function(){return doAction(actionId,jsonData)},preventDefault:true,defaultButton:true},{name:$$.lt("common.cancel"),callback:function(){$button.data("lastRemark",$formDoActionRemark.val())},callOnClose:true}];var $returnThisStepChb=$("#form_do_action_return_this_step");if($returnThisStepChb.size()==0){$returnThisStepChb=$("<div id='form_do_action_return_this_step'><input type='checkbox' name='return_this_step_chb' id='return_this_step_chb' checked /><label for='return_this_step_chb'>"+$$.lt("forward.returnMessage")+"</label></div>");$nextStepDiv.after($returnThisStepChb)}else{$("#return_this_step_chb").prop("disabled",false);$("#return_this_step_chb").prop("checked",true)}}var $tipHelp=$(".tip_help");$(".show_comment").one("click",function(){$("#form_do_action_remark_div").show();return false});if($$.MOBILE){if($$.WECHAT&&/(iPhone|iPad)/i.test(navigator.userAgent)){$formDoActionRemark.blur(function(){document.body.scrollTop=document.body.scrollTop});$("#form_do_action_user_list").on("blur","select",function(){document.body.scrollTop=document.body.scrollTop})}var sheet=new InfoPlus.Render.Mobile.BottomSheet({content:$formDoActionDialog,onClose:function(){$formDoActionDialog.detach().hide().appendTo(document.body)},buttons:buttons});sheet.show();$nextStepDiv.delegate(".tip_help","click",function(){$(this).next("div").remove();var div=document.createElement("div");$(div).html($(this).data("tipContent")).css("display","none");var $span=$(this);if($span.data("selectUser")===0){$(div).css("color","#616161")}else{$(div).css("color","red")}$span.parent().append(div);$span.hide();$(div).slideDown("slow")})}else{var dialog=new InfoPlus.Render.Dialog({title:title,content:$formDoActionDialog,maxWidth:650,onClose:function(){$formDoActionDialog.detach().hide().appendTo(document.body)},buttons:buttons});dialog.show();$nextStepDiv.delegate(".tip_help","click",function(){$(this).tipsy("show")});$nextStepDiv.delegate(".tip_help","mouseenter",function(){$(this).tipsy("show")});$nextStepDiv.delegate(".tip_help","mouseleave",function(){$(this).tipsy("hide")})}$(".make_remark").click(function(){var $remarkMade=$(".form_do_action_remark_made");if($$.MOBILE){$IU.mobileExpandAllViews();var memoMaker=new InfoPlus.MemoMaker({data:$$.params.review,onFinish:function(){$IU.refreshReviewByForm($(memoMaker.maskDiv));var remark=$formDoActionRemark.val()||"";if($$.params.review.length>0){$remarkMade.html($$.lt("submit.remarkDone",$$.params.review.length))}else{$remarkMade.empty()}if($IU.trimString(remark)===""&&$$.params.review.length>0){$formDoActionRemark.val($$.lt("submit.viewRemarks"));$("#form_do_action_remark_div").show()}memoMaker.close();sheet.animateShow();$IU.refreshFormReviews()},onCancel:function(){memoMaker.close();sheet.animateShow();$IU.refreshFormReviews()}});memoMaker.render();sheet.animateHide(memoMaker.getMenuDivPosition(["left","bottom","width","height"]),function(){memoMaker.show()})}else{memoMaker=new InfoPlus.MemoMaker({data:$$.params.review,onFinish:function(){$IU.refreshReviewByForm($(memoMaker.maskDiv));var remark=$formDoActionRemark.val()||"";if($$.params.review.length>0){$remarkMade.html($$.lt("submit.remarkDone",$$.params.review.length))}else{$remarkMade.empty()}if($IU.trimString(remark)===""&&$$.params.review.length>0){$formDoActionRemark.val($$.lt("submit.viewRemarks"));$("#form_do_action_remark_div").show()}memoMaker.close();dialog.animateShow();$IU.refreshFormReviews()},onCancel:function(){memoMaker.close();dialog.animateShow();$IU.refreshFormReviews()}});memoMaker.render();dialog.animateHide(memoMaker.getMenuDivPosition(["margin-top","margin-left","width","height"]),function(){memoMaker.show()})}return false});return false};utilities.chooseEntrust=function(entrusts,error,continueCallback,uriEntrust){var appId=entrusts.app.id,entrustInterface=($$.params.uriEntrust!==undefined)?$$.params.uriEntrust:uriEntrust;var buttons=[{defaultButton:true,preventDefault:true,name:$$.lt("entrust.continueButton"),callback:function(){var $checkedRadio=$chooseUserListDiv.find("input[type=radio]:checked");if($checkedRadio.length===0){if(continueCallback!=null&&(typeof continueCallback==="function")){continueCallback()}}else{var account=$checkedRadio.data("account");if(account==null){account=$checkedRadio.siblings(".entrust_specifiedUser").val();if($IU.trimString(account)===""){$IU.messageBox(null,$$.lt("entrust.chooseSpecifiedAccount"),null,200);return false}}else{if(account===currentEntrusterAccount||account===currentEntrusteeAccount){if(continueCallback!=null&&(typeof continueCallback==="function")){continueCallback();return true}else{return true}}}var entrusted=$checkedRadio.data("entrusted");$$.blockUI({message:(entrusted?$$.lt("entrust.request.entrust.requesting.entrust"):$$.lt("entrust.request.entrust.requesting.debug"))});$$.ajax({type:"POST",url:entrustInterface,data:{entrustee:account,entrusted:$checkedRadio.data("entrusted"),app:appId},requestMsg:(entrusted?$$.lt("entrust.request.entrust.request.entrust"):$$.lt("entrust.request.entrust.request.debug")),errorTitle:(entrusted?$$.lt("entrust.request.entrust.fail.entrust"):$$.lt("entrust.request.entrust.fail.debug")),beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){if($$.MOBILE){setTimeout(function(){window.location.reload()},600)}else{window.location.reload()}})}}}];if(entrusts.entruster!=null){buttons.push({name:(entrusts.entrusted?$$.lt("entrust.abort.entrust"):$$.lt("entrust.abort.debug")),callback:function(){$$.blockUI({message:(entrusts.entrusted?$$.lt("entrust.request.abort.requesting.entrust"):$$.lt("entrust.request.abort.requesting.debug"))});$$.ajax({type:"POST",url:entrustInterface,data:{entrusted:false,app:appId},requestMsg:(entrusts.entrusted?$$.lt("entrust.request.abort.request.entrust"):$$.lt("entrust.request.abort.request.debug")),errorTitle:(entrusts.entrusted?$$.lt("entrust.request.abort.fail.entrust"):$$.lt("entrust.request.abort.fail.debug")),beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){if($$.MOBILE){setTimeout(function(){window.location.reload()},600)}else{window.location.reload()}})}})}var appendUser=function(entrust){const label=document.createElement("label"),input=document.createElement("input"),span=document.createElement("span");$(input).attr("type","radio").attr("name","chooseEntrustee").data("entrusted",entrust.entrusted).data("account",entrust.entruster.account);const entrusterUserName=entrust.entruster.userName||entrust.entruster.account;var text=((entrust.tip!=null?(entrust.tip+" "):"")+entrust.entruster.name)+"("+entrusterUserName+")";if(entrust.from!=null&&entrust.to!=null){text+="  "+$IU.unixTimeToDateString(entrust.from)+"  "+$IU.unixTimeToDateString(entrust.to)}$(span).text(text);$(label).append(input).append(span).addClass("entrust_label");$chooseUserListDiv.append(label)};var appendSpecifiedUser=function(){var label=document.createElement("label"),input=document.createElement("input"),span=document.createElement("span"),userInput=document.createElement("input");$(input).attr("type","radio").attr("name","chooseEntrustee").data("entrusted",false);$(span).text($$.lt("entrust.specified"));$(userInput).addClass("entrust_specifiedUser").focus(function(){$(input).attr("checked",true)});$(label).append(input).append(span).append(userInput).addClass("entrust_label");$chooseUserListDiv.append(label)};var content=document.createElement("div"),$content=$(content),userListDiv=document.createElement("div"),$userListDiv=$(userListDiv),chooseDiv=document.createElement("div"),chooseUserListDiv=document.createElement("div"),$chooseUserListDiv=$(chooseUserListDiv),currentEntrusteeAccount=(entrusts.entrustee!=null?entrusts.entrustee.account:null),currentEntrusterAccount=(entrusts.entruster!=null?entrusts.entruster.account:null);$userListDiv.append(chooseDiv).append(chooseUserListDiv);$chooseUserListDiv.addClass("entrust_choose_user_div");var otherEntrusts=[];if(entrusts.entrusts!=null){for(var i=0,len=entrusts.entrusts.length;i<len;i++){var entruster=entrusts.entrusts[i].entruster;if(entruster.account===currentEntrusterAccount||entruster.account===currentEntrusteeAccount){continue}otherEntrusts.push(entrusts.entrusts[i])}}if(entrusts.entruster!=null){const entrusterUserName=entrusts.entruster.userName||entrusts.entruster.account;const entrusteeUserName=entrusts.entrustee.userName||entrusts.entrustee.account;var entrusterName="<span class='entruster'>"+entrusts.entruster.name+"("+entrusterUserName+")</span>",entrusteeName=entrusts.entrustee.name+"("+entrusteeUserName+")",currentUserDiv=document.createElement("div"),$currentUserDiv=$(currentUserDiv),attentionDiv=document.createElement("div"),$attentionDiv=$(attentionDiv);$currentUserDiv.addClass("entrust_current_user");$attentionDiv.addClass("entrust_current_user_attention");var icon=document.createElement("i");$(icon).addClass("i-icon-user-secret").addClass("entrust_mark");var userSpan=document.createElement("span");$(userSpan).html(entrusts.entrusted?$$.lt("entrust.tip.entrust",entrusterName):$$.lt("entrust.tip.debug",entrusterName));$currentUserDiv.append(icon).append(userSpan);if(error!=null){var errorSpan=document.createElement("span");$(errorSpan).text("("+error.msg+")").addClass("entrust_error");$currentUserDiv.append(errorSpan)}$attentionDiv.html($$.lt("entrust.attention",entrusterName,entrusteeName));if(otherEntrusts.length>0){appendUser({entruster:entrusts.entruster,entrusted:entrusts.entrusted,from:entrusts.from,to:entrusts.to,tip:entrusts.entrusted?$$.lt("entrust.current.entrust"):$$.lt("entrust.current.debug")});if(entrusts.released===false){appendSpecifiedUser()}for(i=0,len=otherEntrusts.length;i<len;i++){appendUser(otherEntrusts[i])}$(chooseDiv).text($$.lt("entrust.continueDo")+$$.lt("entrust.choose"))}else{if(entrusts.released===false){appendUser({entruster:entrusts.entruster,entrusted:entrusts.entrusted,from:entrusts.from,to:entrusts.to,tip:entrusts.entrusted?$$.lt("entrust.current.entrust"):$$.lt("entrust.current.debug")});appendSpecifiedUser();$(chooseDiv).text($$.lt("entrust.continueDo")+$$.lt("entrust.choose"))}else{$(chooseDiv).text($$.lt("entrust.continueDo"))}}$content.append(currentUserDiv).append(attentionDiv)}else{if(otherEntrusts.length>0){appendUser({entruster:entrusts.entrustee,entrusted:false,tip:$$.lt("entrust.current.login")});if(entrusts.released===false){appendSpecifiedUser()}for(i=0,len=otherEntrusts.length;i<len;i++){appendUser(otherEntrusts[i])}icon=document.createElement("i");$(icon).addClass("i-icon-user-secret").addClass("entrust_mark");var span=document.createElement("span");$(span).text($$.lt("entrust.support")+$$.lt("entrust.continueDo")+$$.lt("entrust.choose"));$(chooseDiv).append(icon).append(span)}else{if(entrusts.released===false){appendUser({entruster:entrusts.entrustee,entrusted:false,tip:$$.lt("entrust.current.login")});appendSpecifiedUser();icon=document.createElement("i");$(icon).addClass("i-icon-user-secret").addClass("entrust_mark");span=document.createElement("span");$(span).text($$.lt("entrust.support")+$$.lt("entrust.continueDo")+$$.lt("entrust.choose"));$(chooseDiv).append(icon).append(span)}else{$chooseUserListDiv.text($$.lt("entrust.noUser"))}}}var $radios=$chooseUserListDiv.find("input[type=radio]");if($radios.length>0){$radios.first().attr("checked","true");$radios.click(function(){var account=$(this).data("account");if(account===currentEntrusterAccount||account===currentEntrusteeAccount){if($$.MOBILE){page.changeButton(0,{name:$$.lt("entrust.continueButton")})}else{dialog.changeButton(0,{name:$$.lt("entrust.continueButton")})}}else{if($$.MOBILE){page.changeButton(0,{name:$$.lt("entrust.switchButton")})}else{dialog.changeButton(0,{name:$$.lt("entrust.switchButton")})}}})}$content.append(userListDiv).addClass("entrust_choose");if($$.MOBILE){var page=new InfoPlus.Render.Mobile.Page({isDoAction:true,omitReturn:true,content:content,buttons:buttons});page.show()}else{var dialog=new InfoPlus.Render.Dialog({content:content,maxWidth:600,buttons:buttons});dialog.show()}};utilities.mobileDebug=function(text){var DEBUG_DIV_ID="mobileDebugDiv",$debugDiv=$("#"+DEBUG_DIV_ID);if($debugDiv.length===0){var clearDiv=document.createElement("div");$(clearDiv).attr("style","position:fixed;top:40px;right:0;font-size:2rem;color:red").text("clear").click(function(){debugDiv.innerHTML=""});$(document.body).append(clearDiv);var debugDiv=document.createElement("div");$debugDiv=$(debugDiv);$debugDiv.css("position","fixed").css("top","0").attr("id",DEBUG_DIV_ID);$(document.body).append(debugDiv)}$debugDiv.html($debugDiv[0].innerHTML+"<br>"+text)};utilities.showBackIcon=function(){if(!$IU.isEmptyStr($$.params.back)){if($IU.isPositiveInt($$.params.back)){var value=parseInt($$.params.back,10);if(value<window.history.length){$$.params.nowHistory=window.history.length}return value<window.history.length}else{return true}}return false};utilities.compareInitData=function(compareInitDataIndex){if(compareInitDataIndex==null||!$$.params.sameStepHistoryList){return}var initData=$IU.convertData($$.params.sameStepHistoryList[compareInitDataIndex].data),currentData=$IU.convertData($$.params.formRender.save({}));var comparer=new InfoPlus.Comparer(initData,currentData);comparer.compare()};utilities.isDynamicActionCallWithParams=function(actionName,expression){var checkAction=function(){var supportParamsActionNames=["dataSource","readOnly"];for(var i=0;i<supportParamsActionNames.length;i++){if(actionName===supportParamsActionNames[i]){return true}}return false};if(!checkAction()){return false}expression=utilities.trimString(expression);if(!($IU.beginWith(expression,"(")&&$IU.endWith(expression,")"))){return false}var stack=[0];for(var i=1,len=expression.length;i<len;i++){var c=expression[i];if(c==="("){stack.push(i);continue}if(c===")"){stack.pop();if(stack.length===0){return(i===(len-1))}}}return false};utilities.dynamicShowElement=function($element,duration){$element.show(duration).removeAttr(utilities.DYNAMIC_INVISIBLE_ATTRIBUTE)};utilities.dynamicHideElement=function($element){$element.hide().attr(utilities.DYNAMIC_INVISIBLE_ATTRIBUTE,"true")};utilities.isDynamicInvisible=function($element){return $element.attr(utilities.DYNAMIC_INVISIBLE_ATTRIBUTE)==="true"};define("InfoPlus.Utilities",utilities);window.$IU=utilities;window.checkRenderFormFields=function(field,rules,i,options){var checkField=field[0];if(checkField.style.display==="none"){return}if(checkField.type==="hidden"){return}var $checkField=$(checkField);var promptPosition=$checkField.data($Control.DATA_VALIDATOR_PROMPT_POSITION);if(promptPosition!==undefined){options.promptPosition=promptPosition}if($checkField.data($Control.DATA_ORIGIN_INPUT)!=null){$checkField=$($checkField.data($Control.DATA_ORIGIN_INPUT))}var validator=$checkField.data($Control.DATA_VALIDATOR);if(!validator){return}var control=$checkField.data($Control.DATA_CONTROL_OBJECT);if(control==null){return}if(control.onSuggestPage===true){return}if(!control.isWritable()||control.isDynamicReadonly()){return}var getValue=function(){if($checkField.hasClass("infoplus_richTextControl")){return CKEDITOR.instances[checkField.id+"_text"].getData()}else{return checkField.type==="checkbox"?checkField.checked:checkEditFormat()}};var checkEditFormat=function(){if($checkField.hasClass("hasCleaveFormat")){return $checkField.val().replace(/,/g,"")}else{return $checkField.val()}};var value=getValue();var errorMsg=undefined;if(validator.required){errorMsg=InfoPlus.Utilities.checkFieldEmpty($checkField,options)}if(validator.required||(!validator.required&&value!=="")){if(validator.regEx){try{var pattern=new RegExp(validator.regEx)}catch(e){var fieldName=control.field.name;$$.log("invalid reg("+fieldName+"):"+validator.regEx);return undefined}if(!pattern.test(value)){var prompt=validator.prompt!=null&&validator.prompt!==""?validator.prompt:options.allrules.formatError.alertText;if(errorMsg!==undefined){errorMsg+="<br/>"+prompt}else{errorMsg=prompt}}}}if(validator.dynamics!=null&&validator.dynamics.length>0){var validations=$$.dynamics.validations[control.getDynamicKeyName()];if($IU.isArray(validations)){var context=control.dynamicProcessor.getControlContext(control);for(var validationIndex=0,len=validations.length;validationIndex<len;validationIndex++){var validation=validations[validationIndex];var compiler=new InfoPlus.Dynamics.Parser.Compile(validation.conditionAsts);if(validation.ignoreCondition===true||compiler.evaluate(context)===true){compiler=new InfoPlus.Dynamics.Parser.Compile(validation.tipAsts);var tip=compiler.evaluate(context);if(tip!=null&&tip!==""){if(errorMsg!==undefined){errorMsg+="<br/>"+tip}else{errorMsg=tip}}}}}}return errorMsg}})(window);
(function(window,undefined){var quickSortArray=function(){Array.call(this,arguments)};quickSortArray.prototype=new Array();quickSortArray.prototype.numberQuickSort=function(){return quickSort(this,0,this.length-1);function quickSort(arr,l,r){if(l<r){var mid=arr[parseInt((l+r)/2)],i=l-1,j=r+1;while(true){while(arr[++i].value<mid.value){}while(arr[--j].value>mid.value){}if(i>=j){break}var temp=arr[i];arr[i]=arr[j];arr[j]=temp}quickSort(arr,l,i-1);quickSort(arr,j+1,r)}}};define("InfoPlus.QuickSortArray",quickSortArray)})(window);
(function(window,undefined){var timezone={time:"","UTC-12:00":"","UTC-11:00":"-11","UTC-10:00":"","UTC-9:00":"","UTC-8:00":"","UTC-7:00":"","UTC-6:00":"","UTC-5:00":"","UTC-4:30":"","UTC-4:00":"","UTC-3:30":"","UTC-3:00":"","UTC-2:00":"-02","UTC-1:00":"",UTC:"","UTC+1:00":"","UTC+2:00":"","UTC+3:00":"","UTC+3:30":"","UTC+4:00":"","UTC+4:30":"","UTC+5:00":"","UTC+5:30":"","UTC+5:45":"","UTC+6:00":"","UTC+6:30":"","UTC+7:00":"","UTC+8:00":"","UTC+8:30":"","UTC+9:00":"","UTC+9:30":"","UTC+10:00":"","UTC+11:00":"","UTC+12:00":"","UTC+13:00":"","UTC+14:00":""};$$.timezone=timezone})(window);
(function(window,undefined){var tip=function(options){this.options=$.extend({},tip.DEFAULT_OPTIONS,options);if($$.MOBILE===true){this.options.position=this.options.position+" bottom"}this.init(this.options);this.strategy=new InfoPlus.Tip.Strategy()};tip.CLASSNAME_TIP="infoplus_tip";tip.CLASSNAME_CLOSE="infoplus_tip_close";tip.DEFAULT_OPTIONS={color:"#FFFFFF",type:"info",text:"",position:"left",hideClose:false,autoClose:false,unique:false};tip.SPACE_HEIGHT=8;tip.prototype={options:{},element:null,getMinTop:function(){var $body=$("body"),top=$(window).height(),minTop=top,$topTip=null,count=0,totalHeight=0;$body.children("."+tip.CLASSNAME_TIP+"."+this.options.position).each(function(){var thisTop=parseFloat($(this).css("top"));if(thisTop<minTop){minTop=thisTop;$topTip=$(this)}count++;totalHeight+=$(this).outerHeight()+tip.SPACE_HEIGHT});if($topTip!=null){$topTip.css("z-index",2)}if(count>0&&(top-totalHeight<minTop)){minTop=top-totalHeight}return minTop},render:function(){var options=this.options;if(options.unique===true){$("."+tip.CLASSNAME_TIP).remove()}var div=document.createElement("div"),$div=$(div),$body=$("body"),minTop=this.getMinTop();if(options.content!=null){$div.append(options.content).addClass("custom");if(options.hideClose===true){$div.addClass("noCloseButton")}}else{$div.html(options.text).addClass(options.type+"_tip")}$div.css("top",minTop).addClass(tip.CLASSNAME_TIP).addClass(options.position).addClass("z-depth-1");if(options.width!=null){$div.css("width",options.width+"px")}if(options.maxWidth!=null){$div.css("max-width",maxWidth+"px")}if(options.minWidth!=null){$div.css("min-width",options.minWidth+"px")}if(options.color!=null){$div.css("color",options.color)}if(options.backgroundColor!=null){$div.css("background-color",options.backgroundColor)}if(!$$.MOBILE){}else{}if(options.hideClose!==true){var close=document.createElement("i");$(close).addClass("i-icon-close2").addClass(tip.CLASSNAME_CLOSE).data("position",options.position);$div.append(close)}$body.append(div);var instance=this;setTimeout(function(){var selfHeight=$div.outerHeight();$div.css("top",minTop-selfHeight-tip.SPACE_HEIGHT);if(instance.strategy!==undefined){instance.strategy.adjustTop($div)}if(options.autoClose===true){setTimeout(function(){instance.hide()},2000)}},0);return div},init:function(){this.element=this.render();this.initEvents()},initEvents:function(){var instance=this;var $close=$(this.element).children("."+tip.CLASSNAME_CLOSE);$close.click(function(){instance.hide();return false})},remove:function(){var top=this.options.position.indexOf("bottom")!==-1?parseFloat($(this.element).data("oldTop")):parseFloat($(this.element).css("top")),height=$(this.element).outerHeight()+tip.SPACE_HEIGHT;$(this.element).siblings("."+tip.CLASSNAME_TIP+"."+this.options.position).each(function(){var thisTop=parseFloat($(this).css("top"));if(thisTop<top){$(this).css("top",(thisTop+height)+"px")}});$(this.element).remove()},hide:function(){var instance=this,$element=$(this.element);var transitionEventName=$IU.getTransitionEndEventName();if(transitionEventName!=null){var positions=this.options.position.split(" ");if(positions.length>0){switch(positions[positions.length-1]){case"left":$element.css("left","-"+$element.outerWidth()+"px");break;case"right":$element.css("right","-"+$element.outerWidth()+"px");break;case"bottom":$element.data("oldTop",$element.css("top"));$element.css("top",$(window).height()+"px");break}}$element.one(transitionEventName,function(){instance.remove()})}else{this.remove()}}};define("InfoPlus.Tip",tip);var strategy=function(){};strategy.prototype={adjustTop:function(){}};define("InfoPlus.Tip.Strategy",strategy)})(window);
(function(window,undefined){var debugConsole=function(){this.init()};debugConsole.CLASSNAME_CONSOLE="infoplus_debugConsole";debugConsole.CLASSNAME_TITLE="infoplus_debugConsole_title";debugConsole.CLASSNAME_COMMAND="infoplus_debugConsole_command";debugConsole.CLASSNAME_CONTROL="infoplus_debugConsole_control";debugConsole.CLASSNAME_CLOSE="infoplus_debugConsole_close";debugConsole.CLASSNAME_TO_RIGHT="infoplus_debugConsole_toRight";debugConsole.CLASSNAME_TO_BOTTOM="infoplus_debugConsole_toBottom";debugConsole.CLASSNAME_TITLE="infoplus_debugConsole_title";debugConsole.CLASSNAME_CONTENT="infoplus_debugConsole_content";debugConsole.CLASSNAME_CONTENT_OUTER="infoplus_debugConsole_content_outer";debugConsole.CLASSNAME_CONTENT_INNER="infoplus_debugConsole_content_inner";debugConsole.CLASSNAME_COMMAND_BAR="infoplus_debugConsole_command_bar";debugConsole.CONTENT_PADDING=20;debugConsole.CONTENT_MAX_LINE_COUNT=100;var appendHead=function($container,name,isFirstLevel){var div=document.createElement("div");var nameSpan=document.createElement("span");$(nameSpan).addClass("debug_content_name").text(name);if(isFirstLevel===true){$(nameSpan).addClass("firstLevel")}var colonSpan=document.createElement("span");$(colonSpan).addClass("debug_content_colon").text(": ");$(div).append(nameSpan).append(colonSpan).addClass("line");$container.append(div);return $(div)};var appendNormal=function($container,name,value,isFirstLevel){var $div=appendHead($container,name,isFirstLevel);var valueSpan=document.createElement("span");$(valueSpan).addClass("debug_content_normal").text(value);$div.append(valueSpan)};var appendNull=function($container,name,value,isFirstLevel){var $div=appendHead($container,name,isFirstLevel);var valueSpan=document.createElement("span");$(valueSpan).addClass("debug_content_null").text(value);$div.append(valueSpan)};var appendText=function($container,name,value,isFirstLevel){var $div=appendHead($container,name,isFirstLevel);var valueSpan=document.createElement("span");$(valueSpan).addClass("debug_content_string").text('"'+value+'"');$div.append(valueSpan)};var appendNumber=function($container,name,value,isFirstLevel){var $div=appendHead($container,name,isFirstLevel);var valueSpan=document.createElement("span");$(valueSpan).addClass("debug_content_number").text(value);$div.append(valueSpan)};var appendBoolean=function($container,name,value,isFirstLevel){var $div=appendHead($container,name,isFirstLevel);var valueSpan=document.createElement("span");$(valueSpan).addClass("debug_content_boolean").text(value);$div.append(valueSpan)};var appendDate=function($container,name,value,isFirstLevel){var $div=appendHead($container,name,isFirstLevel);var valueSpan=document.createElement("span");$(valueSpan).addClass("debug_content_date").text($IU.dateFormat(value,"yyyy-MM-dd hh:mm:ss.S"));$div.append(valueSpan)};var appendArrow=function($container){var arrowDiv=document.createElement("div"),icon=document.createElement("i");$(icon).addClass("i-icon-triangle-right");$(arrowDiv).append(icon).addClass("arrowDiv").data("expand",false);$container.append(arrowDiv);$container.children(".debug_content_name").addClass("expandable");$container.children(".debug_content_value").addClass("expandable")};var appendContent=function($container,name,content,padding,isFirstLevel){if(padding!=null){$container.css("padding-left",padding+"px")}if(!$IU.isObject(content)){if(content===null){appendNull($container,name,"null",isFirstLevel);return}if(content===undefined){appendNull($container,name,"undefined",isFirstLevel);return}if($IU.isString(content)){appendText($container,name,content,isFirstLevel);return}if($IU.isBoolean(content)){appendBoolean($container,name,content,isFirstLevel);return}if($IU.isNumberExactly(content)){appendNumber($container,name,content,isFirstLevel);return}if($IU.isDate(content)){appendDate($container,name,content,isFirstLevel);return}if($IU.isArray(content)){var $arrayDiv=appendHead($container,name,isFirstLevel);var arraySpan=document.createElement("span");$(arraySpan).text("Array["+content.length+"]").addClass("debug_content_value");$arrayDiv.append(arraySpan).addClass("array");var innerArrayDiv=document.createElement("div"),$innerArrayDiv=$(innerArrayDiv);$arrayDiv.append(innerArrayDiv);for(var i=0,len=content.length;i<len;i++){appendContent($innerArrayDiv,i+"",content[i],debugConsole.CONTENT_PADDING,false)}$innerArrayDiv.addClass("innerDiv").hide();appendArrow($arrayDiv);return}appendNormal($container,name,content)}else{var $objDiv=appendHead($container,name,isFirstLevel);var objSpan=document.createElement("span");$(objSpan).text("Object").addClass("debug_content_value");$objDiv.append(objSpan).addClass("object");var innerObjDiv=document.createElement("div"),$innerObjDiv=$(innerObjDiv);$objDiv.append($innerObjDiv);var keys=[];for(var key in content){if(content.hasOwnProperty(key)){keys.push(key)}}keys.sort();for(i=0,len=keys.length;i<len;i++){key=keys[i];appendContent($innerObjDiv,key,content[key],debugConsole.CONTENT_PADDING,false)}$innerObjDiv.addClass("innerDiv").hide();appendArrow($objDiv)}};debugConsole.prototype={element:null,createCommand:function(text,callback){var li=document.createElement("li");$(li).addClass(debugConsole.CLASSNAME_COMMAND).addClass("round-corner").text(text).click(callback);return li},createMockSelect2:function(){var li=document.createElement("li"),$li=$(li);$li.addClass(debugConsole.CLASSNAME_CONTROL);var select=document.createElement("select");$(select).attr("id","mockUser").addClass(debugConsole.CLASSNAME_CONTROL).css("width","100%");$li.append(select);$(select).select2({dropdownAutoWidth:"true",dropdownCssClass:"infoplus_debugConsole_dropdown",placeholder:"",ajax:{url:$$.params.uriUsers,dataType:"json",type:"POST",delay:250,data:function(params){return{prefix:params.term,type:"User",code:"",parent:"",isTopLevel:true,pageNo:0,settings:"{}",stepId:$$.params.formStepId,csrfToken:$(document).find("meta[itemscope=csrfToken]").attr("content")}},processResults:function(data,params){if(data.errno!==undefined){console.log(data);return{results:[{id:data.errno,name:data.ecode,text:data.error}]}}else{var items=data.items;for(var i=0,len=items.length,results=[];i<len;i++){var item=items[i];results.push({id:item.codeId,name:$IU.trimString(item.codeName)||"",text:($IU.trimString(item.codeName)||"")+"("+item.codeId+")",item:item})}return{results:results}}}},language:{errorLoading:function(){return $$.lt("suggester2.errorLoading")},noResults:function(){return $$.lt("suggester2.noResult")}},escapeMarkup:function(markup){return markup},minimumInputLength:2});return li},changeContentTop:function(){var $console=$(this.element),$title=$console.find("."+debugConsole.CLASSNAME_TITLE),$content=$console.find("."+debugConsole.CLASSNAME_CONTENT_OUTER);$content.css("top",$title.outerHeight()+"px")},addContent:function(name,content){var $console=$(this.element),$content=$console.find("."+debugConsole.CLASSNAME_CONTENT),$inner=$console.find("."+debugConsole.CLASSNAME_CONTENT_INNER),$outer=$console.find("."+debugConsole.CLASSNAME_CONTENT_OUTER),$lines=$content.children(".line");if($lines.length>debugConsole.CONTENT_MAX_LINE_COUNT){$($lines[0]).remove()}appendContent($content,name,content,null,true);$inner.scrollTop($content.height()-$outer.height()-parseInt($inner.css("top"),10))},clearContent:function(){var $console=$(this.element),$content=$console.find("."+debugConsole.CLASSNAME_CONTENT);$content.children(".line").remove()},render:function(){var div=document.createElement("div"),$div=$(div),$body=$("body");$div.addClass(debugConsole.CLASSNAME_CONSOLE).addClass("z-depth-1");var titleDiv=document.createElement("div"),$titleDiv=$(titleDiv),commandBar=document.createElement("ul"),$commandBar=$(commandBar);$commandBar.addClass(debugConsole.CLASSNAME_COMMAND_BAR);var close=document.createElement("i");$(close).addClass("i-icon-close2").addClass(debugConsole.CLASSNAME_CLOSE).attr("title","");var toRight=document.createElement("i");$(toRight).addClass("i-icon-keyboard-tab").addClass(debugConsole.CLASSNAME_TO_RIGHT).attr("title","");var toBottom=document.createElement("i");$(toBottom).addClass("i-icon-vertical-align-bottom").addClass(debugConsole.CLASSNAME_TO_BOTTOM).attr("title","");var instance=this;$commandBar.append(this.createCommand("",function(){var entity=$$.entity;instance.addContent("",{app:entity.app,step:entity.step,actions:entity.actions,permission:entity.permission,fields:entity.fields,groups:entity.groups});return false})).append(this.createCommand("",function(){instance.addContent("",$IU.convertData($$.entity.data));return false})).append(this.createCommand("",function(){instance.addContent("",$IU.convertData(transformer.render.save({})));return false})).append(this.createCommand("",function(){var param={};for(var key in $$.params){if($$.params.hasOwnProperty(key)){if(key!=="formRender"&&key!=="renderForm"){param[key]=$$.params[key]}}}instance.addContent("",param);return false})).append(this.createCommand("",function(){var info={"":$$.params.entrusts.entrustee.name};if($$.params.entrusts.entruster!=null){info[""]=$$.params.entrusts.entruster.name+($$.params.entrusts.entrusted?"()":"()")}else{info[""]=$$.params.entrusts.entrustee.name}instance.addContent("",info);return false})).append(this.createCommand("",function(){instance.clearContent();return false})).append(this.createMockSelect2()).append(this.createCommand("",function(){var data=$("#mockUser").select2("data");if(data.length>0){var userAccount=data[0].id,userName=data[0].name;if(userAccount!=null&&userAccount!==""){$IU.confirmBox(""+userName+"("+userAccount+")<br>","",$$.lt("common.ok"),400,function(){$$.blockUI({message:"..."});$$.ajax({type:"POST",url:$$.params.uriEntrust,data:{entrustee:userAccount,entrusted:false,app:$$.entity.app.id},requestMsg:"",errorTitle:"",beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){window.location.reload()})})}}return false})).append(this.createCommand("",function(){$IU.confirmBox("<br>","",$$.lt("common.ok"),400,function(){$$.blockUI({message:"..."});$$.ajax({type:"POST",url:$$.params.uriEntrust,data:{entrusted:false,app:$$.entity.app.id},requestMsg:"",errorTitle:"",beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(){window.location.reload()})});return false}));$titleDiv.append(commandBar).append(close).append(toRight).append(toBottom).addClass(debugConsole.CLASSNAME_TITLE);var contentOuterWrapDiv=document.createElement("div"),contentInnerWrapDiv=document.createElement("div"),contentDiv=document.createElement("div"),$contentDiv=$(contentDiv);$contentDiv.addClass(debugConsole.CLASSNAME_CONTENT);$(contentOuterWrapDiv).append(contentInnerWrapDiv).addClass(debugConsole.CLASSNAME_CONTENT_OUTER);$(contentInnerWrapDiv).append(contentDiv).addClass(debugConsole.CLASSNAME_CONTENT_INNER).css("width","calc(100% + 10px)").css("height","calc(100% + 45px)");$div.append(titleDiv).append(contentOuterWrapDiv);$body.append(div);setTimeout(function(){instance.changeContentTop()},500);$div.css("left","20px").css("top","100px").css("width","400px").css("height","400px");return div},init:function(){this.element=this.render();this.initEvents()},initEvents:function(){var instance=this,$console=$(this.element),$close=$console.find("."+debugConsole.CLASSNAME_CLOSE),$toRight=$console.find("."+debugConsole.CLASSNAME_TO_RIGHT),$toBottom=$console.find("."+debugConsole.CLASSNAME_TO_BOTTOM),$title=$console.find("."+debugConsole.CLASSNAME_TITLE);$close.click(function(){$console.hide()});$toRight.click(function(){var top=0,margin=3;var $header=$("#header_holder");if($header.length>0){top=parseInt($header.css("top"),10)+$header.height()+margin}$console.css("top",top+"px");$console.css("left",($(window).width()-parseInt($console.css("min-width"),10))+"px");$console.css("width",$console.css("min-width"));$console.css("height",($(window).height()-top-margin)+"px");instance.changeContentTop()});$toBottom.click(function(){$console.css("top",($(window).height()-parseInt($console.css("min-height"),10))+"px");$console.css("height",$console.css("min-height"));$console.css("left","0px");$console.css("width",$(window).width()+"px");instance.changeContentTop()});$title.mousedown(function(e){if($(e.srcElement).hasClass(debugConsole.CLASSNAME_COMMAND)){return false}if($(e.srcElement).hasClass(debugConsole.CLASSNAME_CONTROL)){return true}var $console=$title.parent();if($console.data("resize")!=="top"){var os=$title.offset(),dx=e.pageX-os.left,dy=e.pageY-os.top;$(document).on("mousemove.drag",function(e){$console.offset({top:e.pageY-dy,left:e.pageX-dx})});return false}});$title.mouseup(function(e){$(document).off("mousemove.drag");var $console=$(this).parent();if($console.data("resize")!=null){$console.removeData("resize");$(document).off("mousemove.drag")}});$console.mousemove(function(e){var BORDER_WIDTH=5,$console=$(this),left=$console.offset().left,top=$console.offset().top;if((e.pageX-left)<BORDER_WIDTH){$console.data("resize","left");$console.css("cursor","w-resize");return false}if(($console.outerWidth()-(e.pageX-left))<BORDER_WIDTH){$console.data("resize","right");$console.css("cursor","e-resize");return false}if((e.pageY-top)<BORDER_WIDTH){$console.data("resize","top");$console.css("cursor","n-resize");return false}if(($console.outerHeight()-(e.pageY-top))<BORDER_WIDTH){$console.data("resize","bottom");$console.css("cursor","s-resize");return false}if(($console.css("cursor")!=="default")&&(e.which===0)){$console.removeData("resize");$console.css("cursor","default")}});$console.mousedown(function(e){var $console=$(this),os=$console.offset(),oh=$console.height(),ow=$console.width(),ox=e.pageX,oy=e.pageY,dx=e.pageX-os.left,dy=e.pageY-os.top;if($console.data("resize")!=null){$(document).on("mousemove.drag",function(e){switch($console.data("resize")){case"left":var oldLeft=$console.offset().left,newLeft=e.pageX-dx,newWidth=$console.width()+oldLeft-newLeft;if(newWidth>parseInt($console.css("min-width"),10)){$console.offset({left:newLeft});$console.width(newWidth);instance.changeContentTop()}break;case"right":newWidth=ow+e.pageX-ox;if(newWidth>parseInt($console.css("min-width"),10)){$console.width(newWidth);instance.changeContentTop()}break;case"top":var oldTop=$console.offset().top,newTop=e.pageY-dy,newHeight=$console.height()+oldTop-newTop;if(newHeight>parseInt($console.css("min-height"),10)){$console.offset({top:newTop});$console.height(newHeight)}break;case"bottom":newHeight=oh+e.pageY-oy;if(newHeight>parseInt($console.css("min-height"),10)){$console.height(newHeight)}break}})}});$console.mouseup(function(e){var $console=$(this);if($console.data("resize")!=null){$console.removeData("resize");$(document).off("mousemove.drag")}});$console.on("click",".arrowDiv",function(){var $arrowDiv=$(this);if($arrowDiv.data("expand")===false){$arrowDiv.siblings(".innerDiv").show();$arrowDiv.data("expand",true);$arrowDiv.children("i").removeClass("i-icon-triangle-right").addClass("i-icon-triangle-down")}else{$arrowDiv.siblings(".innerDiv").hide();$arrowDiv.data("expand",false);$arrowDiv.children("i").removeClass("i-icon-triangle-down").addClass("i-icon-triangle-right")}});$console.on("click",".expandable",function(){$(this).siblings(".arrowDiv").click()})}};define("InfoPlus.DebugConsole",debugConsole)})(window);
(function(window,undefined){var comparer=function(oldData,newData){this.oldData=oldData;this.newData=newData};comparer.clearAll=function(clearAtOnce){InfoPlus.Render.PopTip.clear(clearAtOnce);var $detailCells=$(".detailCell");$detailCells.children().removeData("diffs");if($$.params.diffHelper!=null){$$.params.diffHelper.hide(clearAtOnce);$$.params.diffHelper=null}$detailCells.parent().removeData("detailModified")};var getField=function(name){var fields=$$.entity.fields;for(var fieldName in fields){if(fields.hasOwnProperty(fieldName)){if(fieldName===name){return fields[fieldName]}}}return null};var isGroups=function(name){var groups=$$.entity.groups;for(var groupName in groups){if(groups.hasOwnProperty(groupName)){if(groupName===name){return true}}}return false};var isEmpty=function(value,fieldType){value=$IU.isBoolean(value)?value:value||"";if(fieldType==="User"||fieldType==="Organize"||fieldType==="Code"||fieldType==="Thing"){return(value.value||"")===""}else{return value===""}};var isSame=function(v1,v2,fieldType){v1=$IU.isBoolean(v1)?v1:v1||"";v2=$IU.isBoolean(v2)?v2:v2||"";if(fieldType==="User"||fieldType==="Organize"||fieldType==="Code"||fieldType==="Thing"){return(v1.value||"")===(v2.value||"")}if(fieldType==="File"){if(((v1||"")==="")&&((v2||"")==="")){return true}var fileInfo1=$.parseJSON(v1),fileInfo2=$.parseJSON(v2);return fileInfo1!=null&&fileInfo2!=null&&fileInfo1.id===fileInfo2.id}return v1===v2};var getHoverText=function(value,fieldType){switch(fieldType){case"User":case"Organize":case"Code":case"Thing":if(value!=null&&value.name!=null){return value.name}else{return""}case"string":case"anyURI":return value||"";case"File":var fileInfo=$.parseJSON(value);if(fileInfo!=null){return fileInfo.name}else{return""}case"integer":case"double":return(value||"")+"";case"boolean":return(value===false?"false":value||"");case"date":return $IU.unixTimeToDateString(value)||"";case"XHTML":return value||"";case"time":return $IU.unixTimeToTimeString(value)||"";case"dateTime":break;default:return value||""}};var compare=function(oldData,newData,path,diff){for(var key in newData){if(!newData.hasOwnProperty(key)){continue}var field=getField(key);if(field!=null){var newValue=newData[key],oldValue=oldData[key],fieldType=field.type;if(!isSame(newValue,oldValue,fieldType)){var hover=getHoverText(oldValue,fieldType);if(isEmpty(oldValue,fieldType)&&!isEmpty(newValue,fieldType)){diff[key]={value:hover,type:"new",path:path};continue}if(!isEmpty(oldValue,fieldType)&&isEmpty(newValue,fieldType)){diff[key]={value:hover,type:"delete",path:path};continue}diff[key]={value:hover,type:"modify",path:path}}}if(isGroups(key)){var newGroup=newData[key],oldGroup=oldData[key];if(oldGroup!=null&&$IU.isArray(oldGroup)){diff[key]={rows:[],path:path};var minRowCount=(newGroup.length>oldGroup.length?oldGroup.length:newGroup.length);if(oldGroup.length>newGroup.length){diff[key]["deleteRows"]=(oldGroup.length-newGroup.length)}else{if(oldGroup.length<newGroup.length){diff[key]["newRowIndex"]=oldGroup.length}}for(var i=0;i<minRowCount;i++){var currentPath=path+"_"+i;var rowDiff=diff[key]["rows"][i]={};compare(oldGroup[i],newGroup[i],currentPath,rowDiff)}}else{diff[key]={newRowIndex:0,rows:[],path:path}}}}for(key in oldData){if(!oldData.hasOwnProperty(key)){continue}if(isGroups(key)){newGroup=newData[key];oldGroup=oldData[key];if(newGroup==null&&oldGroup!=null){if(oldGroup.length>0){diff[key]={rows:[],path:path,deleteRows:oldGroup.length}}}}}};comparer.prototype={oldData:{},newData:{},compare:function(){var diff={};compare(this.oldData,this.newData,"",diff);this.showDiff(diff);this.createCompareHelper($(".popTip").not(".remarkTip").length>0)},showDiff:function(diff){var types={"new":"infoTip",modify:"warningTip","delete":"errorTip"};var onClose=function(control){return function(){control.clearModified()}};var onRepeatClose=function(repeatControl){return function(){repeatControl.removeClass("modified")}};var onDetailClick=function(repeatControl,masterRow){return function(){if(repeatControl!=null){repeatControl.showDetail(masterRow);return true}return false}};var expandedViewLabelsForCheck=$IU.mobileExpandAllViews();for(var key in diff){if(!diff.hasOwnProperty(key)){continue}var diffObj=diff[key];if(diffObj.rows!=null){var $$repeatControl=$$("&"+key).filter({path:diffObj.path});if($$repeatControl.length>0){var repeatControl=$$repeatControl[0].control,parent=repeatControl.repeatParentElement;if($(parent).is(":visible")){if(diffObj.deleteRows!=null&&diffObj.deleteRows>0){new InfoPlus.Render.PopTip({popper:parent,text:(diffObj.rows.length===0?$$.lt("compare.compareType.typeDeleteAll"):$$.lt("compare.compareType.typeDeleteRows",diffObj.deleteRows)),colorClass:"errorTip",placement:"top",onClose:onRepeatClose(repeatControl)});repeatControl.setClass("modified")}if(diffObj.newRowIndex!=null&&diffObj.newRowIndex>=0){var $children=repeatControl.getRepeatChildren();for(var i=diffObj.newRowIndex,len=$children.length;i<len;i++){new InfoPlus.Render.PopTip({popper:$children[i],text:repeatControl.isRepeatTable()?$$.lt("compare.compareType.typeNewRow"):$$.lt("compare.compareType.typeNewSection"),colorClass:"infoTip",placement:"top",onClose:onRepeatClose(repeatControl)});var $repeatChildren=repeatControl.getRepeatChildren();if(i<$repeatChildren.length){$($repeatChildren[i]).addClass("modified")}}}for(i=0,len=diffObj.rows.length;i<len;i++){this.showDiff(diffObj.rows[i])}}}}else{var $$control=$$("&"+key).filter({path:diffObj.path});if($$control.length>0){var findValueInItems=function(items,value){for(var i=0,len=items.length;i<len;i++){if(value===items[i].codeId){return items[i].codeName}}return value};var findNameInOptionNodes=function(nodes,value){for(var i=0,len=nodes.length;i<len;i++){var node=nodes[i];if(node.nodeType===1&&node.nodeName.toLocaleLowerCase()==="input"){if(node.value===value){if(i+1<len){var nextNode=nodes[i+1];if(nextNode.nodeType===3){return nextNode.nodeValue}}}}}return value};for(i=0,len=$$control.length;i<len;i++){var control=$$control[i].control,$detailCell=$(control.element).parents(".detailCell");if(control.controlType==="BoundCheckList"&&control.field.code!=null){var codes=$$.entity.codes;if(codes!=null&&codes[control.field.code]!=null){var codeItems=codes[control.field.code].items;if(diffObj.value!=null){var convertValue="";var checkListValues=diffObj.value.split(",");for(var index=0,l=checkListValues.length;index<l;index++){convertValue+=findValueInItems(codeItems,checkListValues[index])+(index===l-1?"":",")}diffObj.value=convertValue}}}if(control.controlType==="BoundOption"){if(diffObj.value!=null){diffObj.value=findNameInOptionNodes($(control.element).parent()[0].childNodes,diffObj.value)}}if($detailCell.size()>0){var $detailContent=$detailCell.children();var detailDiffs=$detailContent.data("diffs");if(detailDiffs==null){detailDiffs=[]}detailDiffs.push({control:control,diff:diffObj});$detailContent.data("diffs",detailDiffs);if(i===0){var $masterRow=$detailCell.parent(),masterRowRepeatControl=$masterRow.parents(".infoplus_repeatParentElement").first().data("repeatControl");if($masterRow.data("detailModified")!==true){$masterRow.data("detailModified",true);new InfoPlus.Render.PopTip({popper:$masterRow[0],text:$$.lt("compare.compareType.typeDetail"),colorClass:"warningTip",placement:"top-right",onClick:onDetailClick(masterRowRepeatControl,$masterRow[0])})}}}else{if((control.controlContainer!=null&&$(control.controlContainer).is(":visible"))||$(control.element).is(":visible")){var hoverText=null;if(diffObj.type==="delete"||diffObj.type==="modify"){hoverText=(diffObj.value===""?$$.lt("compare.previousValue.empty"):($$.lt("compare.previousValue.previous")+diffObj.value))}new InfoPlus.Render.PopTip({popper:control.controlContainer||control.element,text:$$.lt("compare.compareType.type"+diffObj.type.substr(0,1).toUpperCase()+diffObj.type.substr(1)),hoverText:hoverText,colorClass:types[diffObj.type],placement:"top-left",onClose:onClose(control)});control.markModified()}}if(i===0&&control.controlType==="BoundOption"){break}}}}}$IU.mobileShrinkViewsWithNoTips(expandedViewLabelsForCheck)},createCompareHelper:function(diffFound){var contentDiv=document.createElement("div"),$contentDiv=$(contentDiv),textSpan=document.createElement("span"),$textSpan=$(textSpan),closeI=document.createElement("i"),$closeI=$(closeI);if(diffFound){var clearLink=document.createElement("a");var compareNode=document.createTextNode($$.lt("compare.compared")),clearNode=document.createTextNode($$.lt("compare.removeTips"));$(clearLink).text($$.lt("compare.clickHereToRemove")).css("font-weight","bold").css("margin","0 2px 0 0").css("cursor","pointer");$textSpan.append(compareNode).append(clearLink).append(clearNode);var scrollToPopTip=function(){var minTop=null;var $popTips=$("#div_render_container").children("div.popTip");$popTips.each(function(){var top=parseInt($(this).css("top"),10);if(!isNaN(top)){if(minTop==null){minTop=top}else{if(top<minTop){minTop=top}}}});if(minTop!=null&&minTop>60){$IU.scrollTo(minTop-60,500);setTimeout(function(){$(".popTip").effect("bounce",{},150)},500)}};setTimeout(scrollToPopTip,1000)}else{$(textSpan).text($$.lt("compare.same"))}$closeI.addClass("i-icon-close2 infoplus_tip_close").attr("title",$$.lt("entrust.close"));$contentDiv.append(textSpan).append(closeI);var helper=new InfoPlus.Render.CommandBarHelper({content:contentDiv,position:"top",backgroundColor:"#fff9c4"});var $commandBar=$("#form_command_bar");if($commandBar.length>0){$commandBar.append(helper.element)}else{$(document.body).append(helper.element)}$(clearLink).click(function(){comparer.clearAll();return false});$(closeI).click(function(){comparer.clearAll();return false});setTimeout(function(){helper.show($commandBar.length===0)},500);$$.params.diffHelper=helper}};define("InfoPlus.Comparer",comparer)})(window);
(function(window,undefined){var memoMaker=function(options){this.options=options;this.init()};var controls=[],blocks=[],x=[],y=[];var findControls=function(){var compareNumber=function(a,b){return a-b};var pushArray=function(array,val){for(var i=0,len=array.length;i<len;i++){if(array[i]===val){return}}array.push(val)};$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){if(!$(this).is(":visible")){return}var control=$(this).data($Control.DATA_CONTROL_OBJECT);if(control==null){var originInput=$(this).data($Control.DATA_ORIGIN_INPUT);control=$(originInput).data($Control.DATA_CONTROL_OBJECT)}if(control!=null){var position=control.getPosition();if(position!=null){controls.push({control:control,position:position});pushArray(x,Math.ceil(position.left));pushArray(x,Math.floor(position.left+position.width));pushArray(y,Math.ceil(position.top));pushArray(y,Math.floor(position.top+position.height))}}});controls.sort(function(a,b){return a.position.top-b.position.top});x.unshift(0);x.push(document.body.scrollWidth);y.unshift(0);y.push(document.body.scrollHeight);x.sort(compareNumber);y.sort(compareNumber)};var getBlocks=function(){var filterControls=function(y1,y2,controls){var fc=[];for(var i=0,len=controls.length;i<len;i++){var position=controls[i].position;if(y2>Math.ceil(position.top)){if(y1<Math.floor(position.top+position.height)){fc.push(controls[i])}}else{break}}return fc};var findControlInRect=function(rect,controls){var rectInControlArea=function(control){var position=control.position;return rect.x2>Math.ceil(position.left)&&rect.x1<Math.floor(position.left+position.width)};for(var i=0,len=controls.length;i<len;i++){var control=controls[i];if(rectInControlArea(control)){return control.control}}return null};var shouldMerge=function(block,prevRow){for(var i=0,len=prevRow.length;i<len;i++){var prevBlock=prevRow[i];if(block.rect.x1===prevBlock.rect.x1&&block.rect.x2===prevBlock.rect.x2&&block.rect.y1===prevBlock.rect.y2){prevBlock.rect.y2=block.rect.y2;return true}}return false};for(var indexY=1,lenY=y.length;indexY<lenY;indexY++){var y1=y[indexY-1],y2=y[indexY];var judgeControls=filterControls(y1,y2,controls);var rowBlocks=[];if(judgeControls.length===0){rowBlocks.push({rect:{x1:0,y1:y1,x2:x[x.length-1],y2:y2}})}else{for(var indexX=1,lenX=x.length;indexX<lenX;indexX++){var x1=x[indexX-1],x2=x[indexX];var rect={x1:x1,y1:y1,x2:x2,y2:y2};var control=findControlInRect(rect,judgeControls);if(rowBlocks.length>0){var lastBlock=rowBlocks[rowBlocks.length-1];if(lastBlock.control==null){if(control==null){lastBlock.rect.x2=rect.x2;lastBlock.rect.y2=rect.y2}else{rowBlocks.push({rect:rect,control:control})}}else{if(control!=null){if(lastBlock.control.field.name===control.field.name){lastBlock.rect.x2=rect.x2;lastBlock.rect.y2=rect.y2}else{rowBlocks.push({rect:rect,control:control})}}else{rowBlocks.push({rect:rect,control:control})}}}else{rowBlocks.push({rect:rect,control:control})}}}blocks.push(rowBlocks)}for(var rowIndex=blocks.length-1;rowIndex>0;rowIndex--){var currentRow=blocks[rowIndex],prevRow=blocks[rowIndex-1],newRow=[];for(var colIndex=0;colIndex<currentRow.length;colIndex++){var block=currentRow[colIndex];if(!shouldMerge(block,prevRow)){newRow.push(block)}}blocks[rowIndex]=newRow}};memoMaker.prototype={init:function(){InfoPlus.Render.PopTip.clear(true,true);findControls();getBlocks()},renderRemarkDiv:function(){var options=this.options,data=options.data;var checkFlag;var checkMemoCount=function(){count=0;var tipCount=0;$maskDiv.find(".popTip.remarkTip").each(function(){tipCount++;var $memoInputDiv=$(this).find(".memo_input_div");if($memoInputDiv.length>0){if($IU.trimString($memoInputDiv[0].innerText)!==""){count++}}});if(count!==$tipDiv.data("count")){if(count>0){$tipDiv.html($$.lt("review.tipCount",count,count>1?"s":""))}else{$tipDiv.text($$.lt("review.tip"))}$menuDiv.css("left","0").css("margin-left","-"+$menuDiv.outerWidth()/2+"px").css("left","");$tipDiv.data("count",count)}};var startCheck=function(){checkFlag=setInterval(checkMemoCount,100)};var stopCheck=function(){clearInterval(checkFlag)};var createTip=function(maskDiv,whiteBlock,data){var containerDiv=document.createElement("div"),$containerDiv=$(containerDiv),contentDiv=document.createElement("div"),$contentDiv=$(contentDiv);$contentDiv.attr("contenteditable","true").addClass("memo_input_div");if(data!=null){$contentDiv.html(data.html)}$containerDiv.append(contentDiv);var tip=new InfoPlus.Render.PopTip({popper:whiteBlock,container:maskDiv,content:containerDiv,colorClass:"remarkTip",placement:"top",location:"bottom",onMaximized:function(){popMenu.showMenuItems(["minimize","remove"])}});var popMenu=new InfoPlus.Render.PopMenu({container:tip.element,items:[{id:"maximize",text:$$.lt("review.menu.maximize"),iconClass:"i-icon-triangle-up",initVisible:false,switchItems:["minimize","remove"],click:function(){stopCheck();tip.maximize(function(){startCheck()});popMenu.show()}},{id:"minimize",text:$$.lt("review.menu.minimize"),iconClass:"i-icon-triangle-down",switchItems:["maximize"],click:function(){stopCheck();tip.minimize(function(){startCheck()})}},{id:"remove",text:$$.lt("review.menu.remove"),iconClass:"i-icon-delete",click:function(){tip.close();$(whiteBlock).removeData("memoContentDiv")}}]});if(data==null){$contentDiv.focus()}$(whiteBlock).data("memoContentDiv",contentDiv)};var maskDiv=document.createElement("div"),$maskDiv=$(maskDiv);this.maskDiv=maskDiv;$maskDiv.attr("id","memo_mask_div");var divCount=0;for(var rowIndex=0,rowLen=blocks.length;rowIndex<rowLen;rowIndex++){var row=blocks[rowIndex];for(var colIndex=0,colLen=row.length;colIndex<colLen;colIndex++){var block=row[colIndex];var blockDiv=document.createElement("div"),$blockDiv=$(blockDiv);if(block.control==null){$blockDiv.addClass("memo_dark_block_div")}else{$blockDiv.addClass("memo_white_block_div");var innerDiv=document.createElement("div");$(innerDiv).addClass("memo_white_inner_block_div");$blockDiv.append(innerDiv)}$blockDiv.css("left",block.rect.x1+"px").css("top",block.rect.y1+"px").css("width",(block.rect.x2-block.rect.x1)+"px").css("height",(block.rect.y2-block.rect.y1)+"px").data("position",{left:block.rect.x1,top:block.rect.y1,width:block.rect.x2-block.rect.x1,height:block.rect.y2-block.rect.y1}).data($Control.DATA_CONTROL_OBJECT,block.control);$maskDiv.append(blockDiv);divCount++}}$maskDiv.on("click",".memo_white_block_div",function(event){if($(event.target).hasClass("memo_white_inner_block_div")){if($(this).data("memoContentDiv")!=null){$($(this).data("memoContentDiv")).focus()}else{createTip(maskDiv,this)}return false}});var menuDiv=document.createElement("div"),$menuDiv=$(menuDiv);this.menuDiv=menuDiv;var tipDiv=document.createElement("div"),$tipDiv=$(tipDiv),toolDiv=document.createElement("div"),$toolDiv=$(toolDiv);$tipDiv.text($$.lt("review.tip"));$menuDiv.addClass("memo_input_menu round-corner z-depth-1").append(tipDiv).append(toolDiv);$tipDiv.addClass("memo_input_tip");var cancelLink=document.createElement("a"),okLink=document.createElement("a");$(cancelLink).attr("href","#").text($$.lt("review.cancel")).hide();$(okLink).attr("href","#").text($$.lt("review.ok")).addClass("default");$toolDiv.addClass("memo_input_tool").append(cancelLink).append(okLink);$maskDiv.append(menuDiv);$(document.body).append(maskDiv);$(okLink).click(function(){clearInterval(checkFlag);options.onFinish();return false});$(cancelLink).click(function(){clearInterval(checkFlag);options.onCancel();return false});$tipDiv.data("count",0);if(data!=null&&data.length>0){var findWhiteBlockDiv=function(fieldName,path){var whiteBlock=null;$maskDiv.children(".memo_white_block_div").each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);if(control.field.name===fieldName&&control.path===path){whiteBlock=this}});return whiteBlock};var count=0;for(var i=0,len=data.length;i<len;i++){var whiteBlock=findWhiteBlockDiv(data[i].field,data[i].path);if(whiteBlock!=null){createTip(maskDiv,whiteBlock,data[i]);count++}}if(count>0){$tipDiv.html($$.lt("review.tipCount",count,count>1?"s":""));$tipDiv.data("count",count)}}$menuDiv.css("left","0").css("margin-left","-"+$menuDiv.outerWidth()/2+"px").css("left","");$menuDiv.data("position",{"margin-top":"-"+($(window).height()/2-$menuDiv.offset().top)+"px","margin-left":$menuDiv.css("margin-left"),left:$menuDiv.offset().left+"px",top:$menuDiv.offset().top+"px",bottom:($(window).height()-$menuDiv.offset().top-$menuDiv.outerHeight())+"px",width:$menuDiv.outerWidth()+"px",height:$menuDiv.outerHeight()+"px"});$maskDiv.hide();setTimeout(startCheck,1000)},getMenuDivPosition:function(positions){var position=$(this.menuDiv).data("position");var retVal={};for(var i=0,len=positions.length;i<len;i++){if(position.hasOwnProperty(positions[i])){retVal[positions[i]]=position[positions[i]]}}return retVal},render:function(){this.renderRemarkDiv()},show:function(){$(this.maskDiv).show()},close:function(){controls=[];blocks=[];x=[];y=[];$(this.maskDiv).empty().remove()}};define("InfoPlus.MemoMaker",memoMaker)})(window);
(function(window,undefined){var x_PI=3.141592653589793*3000/180;var PI=3.141592653589793;var a=6378245;var ee=0.006693421622965943;var bd09togcj02=function bd09togcj02(bd_lon,bd_lat){var bd_lon=+bd_lon;var bd_lat=+bd_lat;var x=bd_lon-0.0065;var y=bd_lat-0.006;var z=Math.sqrt(x*x+y*y)-0.00002*Math.sin(y*x_PI);var theta=Math.atan2(y,x)-0.000003*Math.cos(x*x_PI);var gg_lng=z*Math.cos(theta);var gg_lat=z*Math.sin(theta);return[gg_lng,gg_lat]};var gcj02tobd09=function gcj02tobd09(lng,lat){var lat=+lat;var lng=+lng;var z=Math.sqrt(lng*lng+lat*lat)+0.00002*Math.sin(lat*x_PI);var theta=Math.atan2(lat,lng)+0.000003*Math.cos(lng*x_PI);var bd_lng=z*Math.cos(theta)+0.0065;var bd_lat=z*Math.sin(theta)+0.006;return[bd_lng,bd_lat]};var wgs84togcj02=function wgs84togcj02(lng,lat){var lat=+lat;var lng=+lng;if(out_of_china(lng,lat)){return[lng,lat]}else{var dlat=transformlat(lng-105,lat-35);var dlng=transformlng(lng-105,lat-35);var radlat=lat/180*PI;var magic=Math.sin(radlat);magic=1-ee*magic*magic;var sqrtmagic=Math.sqrt(magic);dlat=(dlat*180)/((a*(1-ee))/(magic*sqrtmagic)*PI);dlng=(dlng*180)/(a/sqrtmagic*Math.cos(radlat)*PI);var mglat=lat+dlat;var mglng=lng+dlng;return[mglng,mglat]}};var gcj02towgs84=function gcj02towgs84(lng,lat){var lat=+lat;var lng=+lng;if(out_of_china(lng,lat)){return[lng,lat]}else{var dlat=transformlat(lng-105,lat-35);var dlng=transformlng(lng-105,lat-35);var radlat=lat/180*PI;var magic=Math.sin(radlat);magic=1-ee*magic*magic;var sqrtmagic=Math.sqrt(magic);dlat=(dlat*180)/((a*(1-ee))/(magic*sqrtmagic)*PI);dlng=(dlng*180)/(a/sqrtmagic*Math.cos(radlat)*PI);var mglat=lat+dlat;var mglng=lng+dlng;return[lng*2-mglng,lat*2-mglat]}};var transformlat=function transformlat(lng,lat){var lat=+lat;var lng=+lng;var ret=-100+2*lng+3*lat+0.2*lat*lat+0.1*lng*lat+0.2*Math.sqrt(Math.abs(lng));ret+=(20*Math.sin(6*lng*PI)+20*Math.sin(2*lng*PI))*2/3;ret+=(20*Math.sin(lat*PI)+40*Math.sin(lat/3*PI))*2/3;ret+=(160*Math.sin(lat/12*PI)+320*Math.sin(lat*PI/30))*2/3;return ret};var transformlng=function transformlng(lng,lat){var lat=+lat;var lng=+lng;var ret=300+lng+2*lat+0.1*lng*lng+0.1*lng*lat+0.1*Math.sqrt(Math.abs(lng));ret+=(20*Math.sin(6*lng*PI)+20*Math.sin(2*lng*PI))*2/3;ret+=(20*Math.sin(lng*PI)+40*Math.sin(lng/3*PI))*2/3;ret+=(150*Math.sin(lng/12*PI)+300*Math.sin(lng/30*PI))*2/3;return ret};var out_of_china=function out_of_china(lng,lat){var lat=+lat;var lng=+lng;return !(lng>73.66&&lng<135.05&&lat>3.86&&lat<53.55)};var transform={bdtowgs:function(lng,lat){var mid=bd09togcj02(lng,lat);return gcj02towgs84(mid[0],mid[1])},wgstobd:function(lng,lat){var mid=wgs84togcj02(lng,lat);return gcj02tobd09(mid[0],mid[1])},bdtogcj:bd09togcj02,gcjtobd:gcj02tobd09};define("InfoPlus.CoordTransform",transform)})(window);
(function(window,undefined){var suggester=function(field,dataElement,data,text,type,code,mode,tipFormat,suggestService,suggestInitializeService){this.field=field;this.mode=mode;this.tipFormat=tipFormat;this.type=type;this.code=code;this.data=data;this.text=text;this.dataElement=dataElement;this.path=$(dataElement).data($Control.DATA_PATH);this.suggestService=suggestService||"";this.suggestMinimizeSize=(this.type===$Control.DATA_TYPE_USER?2:0);if(this.type===$Control.DATA_TYPE_USER&&field.settings!=null&&field.settings.userTraversal===true){this.suggestMinimizeSize=0}this.suggestInitializeService=suggestInitializeService;this.clearFocusFlag();this.createSuggester()};suggester.KEY_CODE_ENTER=13;suggester.KEY_CODE_BACKSPACE=8;suggester.KEY_CODE_ESC=27;suggester.KEY_CODE_PAGE_UP=33;suggester.KEY_CODE_PAGE_DOWN=34;suggester.KEY_CODE_UP=38;suggester.KEY_CODE_DOWN=40;suggester.KEY_CODE_DELETE=46;suggester.KEY_CODE_TAB=9;suggester.CLASSNAME_SUGGESTER_ITEM="infoplus_suggester_item";suggester.CLASSNAME_SUGGESTER_ITEM_SELECT="suggest_selected";suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT="suggest_unselected";suggester.CLASSNAME_SUGGESTER_DIV="suggest_div";suggester.CLASSNAME_SUGGESTER_LOADING="suggest_loading";suggester.CLASSNAME_SUGGESTER_FRAME_OUTER="suggest_frame_outer";suggester.CLASSNAME_SUGGESTER_FRAME_INNER="suggest_frame_inner";suggester.CLASSNAME_SUGGESTER_ACTIVE_DIV="active_div";suggester.CLASSNAME_SUGGESTER_ACTIVE_TIP_CONTAINER="active_tip_container";suggester.CLASSNAME_SUGGESTER_BUTTON="suggest_button";suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT="active_input";suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT_GRAY="active_input_gray";suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT_FOCUS="active_input_focus";suggester.CLASSNAME_SUGGESTER_MORE_ITEM="infoplus_suggester_item_more";suggester.CLASSNAME_SUGGESTER_MORE_USER="infoplus_suggester_user_more";suggester.CLASSNAME_SUGGESTER_MORE_ITEM_DOWN="infoplus_suggester_item_more_down";suggester.CLASSNAME_SUGGESTER_MORE_ITEM_LOADING="infoplus_suggester_item_more_loading";suggester.CLASSNAME_SUGGESTER_EMPTY_ITEM="infoplus_suggester_item_empty";suggester.CLASSNAME_CONTROL="infoplus_control";suggester.CLASSNAME_READONLY="infoplus_readonly";suggester.DATA_SUGGESTER_ATTRIBUTES="attributes";suggester.DATA_SUGGESTER_MORE_ITEM="moreItem";suggester.DATA_SUGGESTER_EMPTY_ITEM="emptyItem";suggester.PAGE_ITEM_COUNT=15;suggester.PAGE_ITEM_HEIGHT=25;suggester.PAGE_ITEM_PADDING_TOP=2;suggester.PAGE_ITEM_PADDING_BOTTOM=2;suggester.SUGGEST_DIV_PADDING_TOP=2;suggester.SUGGEST_DIV_PADDING_BOTTOM=2;suggester.MODE_FLAG_EXTERNAL_VALUE=1;suggester.MODE_FLAG_AUTOSIZE=2;suggester.MODE_FLAG_READONLY=4;suggester.MODE_FLAG_DISAPPEAR=8;suggester.MODE_FLAG_DISABLE_MULTIPAGE=16;suggester.MODE_FLAG_EMPTY_ITEM_APPEAR=32;suggester.SUBMIT_DELAY=500;suggester.isPagePopup=function(){return true};suggester.prototype={activeInputValidateClass:null,createSuggester:function(){this.initOuterFrame();this.initInnerFrame();this.initData();this.initActiveDiv();this.initActiveInput();this.initSuggestDiv();this.initEmptyDiv();this.initSuggestButton();this.initFieldChange();this.initValidateClass();this.delegateEvent()},initOuterFrame:function(){var div=document.createElement("div");this.container=div;if(this.dataElement.style!=null){var isNeededCss=function(name){name=name.toLowerCase();return name.indexOf("font")!==-1||name==="height"||name==="width"};var cssArray=this.dataElement.style.cssText.split(";");for(var cssIndex=0;cssIndex<cssArray.length;cssIndex++){var cssDetail=cssArray[cssIndex].split(":");if(cssDetail.length===2){var cssName=$IU.trimString(cssDetail[0]);var cssValue=$IU.trimString(cssDetail[1]);if(isNeededCss(cssName)){$(div).css(cssName,cssValue)}}}}this.dataElement.style.display="none";div.appendChild(this.dataElement);div.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_OUTER;if(this.isDisappear()){div.style.display="none"}},initInnerFrame:function(){var div=document.createElement("div"),$div=$(div);this.inputDiv=div;$(div).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_INNER);$div.css("width",this.container.style.width);var containerHeight=$(this.container).outerHeight();$div.css("height",(containerHeight<22?24:(containerHeight+2))+"px");this.container.appendChild(this.inputDiv)},initData:function(){this.suggestData=[];this.suggestItems=[];this.currentLastPageNo=1;this.lastSubmitTime=0;this.lastInitialize=0;this.initializeInterval=30*1000;this.lastSubmitValue="";this.prefix=this.container.id;if(null==this.prefix||""===this.prefix){this.prefix=this.dataElement.id}this.prefix+=Math.round(Math.random()*1000)},initActiveDiv:function(){var activeDiv=document.createElement("div");activeDiv.setAttribute("id",this.prefix+"_activeDiv");activeDiv.setAttribute("class",InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_DIV);this.inputDiv.appendChild(activeDiv);this.activeDiv=activeDiv},initActiveInput:function(){var activeInput=document.createElement("input");activeInput.style.width="100%";if(this.dataElement.style!=null){if(this.dataElement.style.cssText!=null){var isNeededCss=function(name){name=name.toLowerCase();return name.indexOf("font")!==-1||name==="height"};var cssArray=this.dataElement.style.cssText.split(";");for(var cssIndex=0;cssIndex<cssArray.length;cssIndex++){var cssDetail=cssArray[cssIndex].split(":");if(cssDetail.length===2){var cssName=$IU.trimString(cssDetail[0]).toLowerCase();var cssValue=$IU.trimString(cssDetail[1]).toLowerCase();if(isNeededCss(cssName)){$(activeInput).css(cssName,cssValue)}}}}}activeInput.setAttribute("id",this.prefix+"_activeInput");activeInput.setAttribute("type","text");activeInput.setAttribute("maxlength","100");$(activeInput).data($Control.DATA_ORIGIN_INPUT,this.dataElement).data($Control.DATA_IS_CONTROL,true).css("display","block");if(this.isReadOnly()){activeInput.setAttribute("readOnly","true")}activeInput.value=this.text||"";activeInput.setAttribute("class",this.getActiveInputClass(false));this.activeDiv.appendChild(activeInput);this.activeInput=activeInput},initSuggestDiv:function(){var suggestDiv=document.createElement("div");suggestDiv.id=this.prefix+"_suggestDiv";suggestDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV;suggestDiv.style.display="none";$(suggestDiv).attr("tabindex",Math.random()*1000+100000);this.activeDiv.appendChild(suggestDiv);this.suggestDiv=suggestDiv},initEmptyDiv:function(){var emptyDiv=document.createElement("div");this.emptyDiv=emptyDiv;emptyDiv.id=this.prefix+"_emptyDiv";emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV;emptyDiv.style.backgroundColor="#eeeeee";this.setEmptyDivContent();emptyDiv.style.display="none";this.activeDiv.appendChild(emptyDiv)},initSuggestButton:function(){var activeTip=document.createElement("div");var suggestButton=document.createElement("div"),$suggestButton=$(suggestButton);activeTip.setAttribute("class",InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_TIP_CONTAINER);$suggestButton.attr("id",this.prefix+"_suggestButton").addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_BUTTON);switch(this.type){case"User":$suggestButton.css("backgroundPosition","-80px 0px");break;case"Organize":$suggestButton.css("backgroundPosition","-128px 0px");break;case"Code":default:$suggestButton.css("backgroundPosition","0px 0px");break}var styleHeight=this.container.style.height,containerHeight=$(this.activeInput).height();if(containerHeight!==0){if($IU.endWith(styleHeight,"rem")){var rootFontSize=parseFloat($("html").css("font-size"));$suggestButton.css("top",((containerHeight-16/rootFontSize)/2)+"rem")}else{$suggestButton.css("top",((containerHeight-16)/2)+"px")}}activeTip.appendChild(suggestButton);this.activeDiv.appendChild(activeTip);this.activeTip=activeTip;this.suggestButton=suggestButton},initValidateClass:function(){var classes=this.dataElement.className.split(" ");for(var i=0;i<classes.length;i++){var className=classes[i];if(className.substr(0,9)==="validate["){this.activeInputValidateClass=className;$(this.activeInput).addClass(className).data($Control.DATA_VALIDATOR,$(this.dataElement).data($Control.DATA_VALIDATOR)).data($Control.DATA_VALIDATOR_PROMPT_POSITION,$(this.dataElement).data($Control.DATA_VALIDATOR_PROMPT_POSITION));$(this.dataElement).removeClass(className)}}},setSuggesterStyle:function(name,value){$IU.setDynamicStyle(this.container,name,value);$IU.setDynamicStyle(this.activeInput,name,value)},getSuggesterStyle:function(name){$IU.getElementStyle(this.container,name)},delegateEvent:function(){$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM,"mouseenter",{suggester:this},this.onSuggesterItemMouseEnter);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM,"mousedown",{suggester:this},this.onSuggesterItemMouseDown);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM,"click",{suggester:this},this.onSuggesterMoreItemClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_OUTER,"click",{suggester:this},this.onSuggesterContainerClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_FRAME_INNER,"click",{suggester:this},this.onSuggesterContainerClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_BUTTON,"click",{suggester:this},this.onSuggesterContainerClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"blur",{suggester:this},this.onSuggesterActiveInputBlur);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"focus",{suggester:this},this.onSuggesterActiveInputFocus);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"keydown",{suggester:this},this.onSuggesterActiveInputKeyDown);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"keyup",{suggester:this},this.onSuggesterActiveInputKeyUp);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT,"keypress",{suggester:this},this.onSuggesterActiveInputKeyPress);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_BUTTON,"click",{suggester:this},this.onSuggesterButtonClick);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"focus",{suggester:this},this.onSuggesterDivFocus);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"blur",{suggester:this},this.onSuggesterDivBlur);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"mouseup",{suggester:this},this.onSuggesterDivMouseUp);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"mouseenter",{suggester:this},this.onSuggesterDivMouseEnter);$(this.container).delegate("."+InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV,"mouseleave",{suggester:this},this.onSuggesterDivMouseLeave)},initFieldChange:function(){var field=this.field;if(field!=null){if(field.fieldChanging===true){this.onFieldChange=true}}},dispose:function(){this.field=null;this.suggestData=null;this.suggestItems=null;this.dataElement=null;if(this.container!=null){$(this.container).undelegate()}this.container=null;$(this.container).empty()},isAutoSize:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_AUTOSIZE)!==0},isAllowExtern:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_EXTERNAL_VALUE)!==0},isReadOnly:function(){return(this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_READONLY)!==0)||this.dataElement.readOnly===true},isDisappear:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_DISAPPEAR)!==0},isMultiPageDisabled:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_DISABLE_MULTIPAGE)!==0},isEmptyItemAppear:function(){return this.mode!=null&&(this.mode&InfoPlus.Suggester.MODE_FLAG_EMPTY_ITEM_APPEAR)!==0},setData:function(data,text,init,external){text=$IU.trimString(text);if(data==null){this.data=this.text=null}else{this.data=data.codeId!=null?data.codeId:data;if(null!=text){this.text=text}else{this.text=(null!=data.codeName)?data.codeName:data}}var control=$(this.dataElement).data($Control.DATA_CONTROL_OBJECT);var fireChangeEvent=false;var oldData=this.getData();if(data==null||(!(oldData===data||oldData===data.codeId))){if(this.children!=null){for(var i=0;i<this.children.length;i++){this.children[i].setData(null)}}if(control.onFieldChange||control.onFieldRefer||control.onFieldSync){fireChangeEvent=true}}if(null!=this.dataElement){var tag=this.dataElement.tagName.toLowerCase();if("select"===tag){var sel=this.dataElement;sel.options.length=0;var opt=document.createElement("option");opt.value=this.data||"";$(opt).text(this.text);sel.appendChild(opt);opt.value=this.data||""}else{this.dataElement.value=this.data||""}}this.activeInput.value=this.text||"";var attributes=null;if(data!=null&&data.attributes!=null){attributes=data.attributes}control.setAttributes(attributes);if(fireChangeEvent===true){$(this.dataElement).change()}},getData:function(){if(this.dataElement==null){return""}return this.dataElement.value},setCursor:function(element,pos){var range=element.createTextRange();range.collapse(true);range.moveStart("character",pos);range.select()},activeFocus:function(){for(var i=0;i<1;i++){if(this.activeInput){this.activeInput.focus()}}},getActiveInputClass:function(focused){var className=InfoPlus.Suggester.CLASSNAME_CONTROL;className+=" "+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT;if(this.activeInputValidateClass!=null){className+=" "+this.activeInputValidateClass}if(this.isReadOnly()){className+=" "+InfoPlus.Suggester.CLASSNAME_READONLY}else{if(focused){className+=" "+InfoPlus.Suggester.CLASSNAME_SUGGESTER_ACTIVE_INPUT_FOCUS}}return className},adjustView:function(){var bStrlen=function(fData){var intLength=0;for(var i=0;i<fData.length;i++){if((fData.charCodeAt(i)<0)||(fData.charCodeAt(i)>255)){intLength=intLength+2}else{intLength=intLength+1}}return intLength};if(this.isAutoSize()){var groupSize=10;var length=bStrlen(this.activeInput.value);var w=((length/groupSize)+1)*groupSize*6+5;if(!this.isMobileView()){this.activeInput.style.width=w+"px"}else{var rootFontSize=parseFloat($("html").css("font-size"));this.activeInput.style.width=((w*1.35)/rootFontSize)+"rem"}}else{this.activeInput.style.width="100%"}bStrlen=null},getSuggest:function(){for(var i=0;i<this.suggestItems.length;i++){if($(this.suggestItems[i]).hasClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT)){return i}}return -1},emptyItemIsSelected:function(){var emptyItem=this.getEmptyItem();if(emptyItem==null){return false}return $(emptyItem).hasClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT)},selectSuggesterItem:function(item){$(item).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT);$(item).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT)},unselectSuggesterItem:function(item){$(item).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_SELECT);$(item).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT)},requestCode:function(prefixValue,parent){var instance=this,codes=$$.entity.codes,code=this.code,pageNo=this.currentLastPageNo;var needCheckCache=function(){if(prefixValue!==""){return false}if(pageNo!==1){return false}if(code==null){return false}return(codes[code]!=null&&codes[code].codeType==="Internal")};var getCacheData=function(){if(codes[code].cache!=null&&codes[code].cache[parent]!=null){return codes[code].cache[parent]}return null};var lastSubmitTime=new Date().getTime();if(needCheckCache()){var cacheData=getCacheData();if(cacheData!=null){this.onAjaxCallback(prefixValue,cacheData,lastSubmitTime);instance.emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV;return}}this.lastSubmitTime=lastSubmitTime;var d={prefix:prefixValue,type:this.type,code:this.code||null,parent:parent,isTopLevel:this.field.parent==null,pageNo:this.currentLastPageNo-1,rand:Math.random()*999,settings:$.toJSON(this.field.settings==null?{}:this.field.settings)};$$.ajax({type:"POST",url:this.suggestService,data:d,needParse:false,showParseErrMsg:false,showAjaxErrMsg:false,addFormParam:true}).done(function(data){instance.onAjaxCallback(prefixValue,data,lastSubmitTime);if(needCheckCache()){if(codes[code].cache==null){codes[code].cache={}}codes[code].cache[parent]=data}}).always(function(){instance.emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV})},suggestAjaxSubmit:function(){if(this.activeInput.value.length<this.suggestMinimizeSize){this.suggestData=[];this.suggestDiv.style.display="none";this.emptyDiv.style.display="block";this.setEmptyDivContent();return}if(this.suggestService!==""){this.emptyDiv.className=InfoPlus.Suggester.CLASSNAME_SUGGESTER_DIV+" "+InfoPlus.Suggester.CLASSNAME_SUGGESTER_LOADING;this.changeLoadingStatus(true);var control=$(this.dataElement).data($Control.DATA_CONTROL_OBJECT);var parentValue=control.parentValue;if(this.field.parent!=null&&parentValue==null){var referedControlPaths=$IU.getReferedControlPaths(this.path);var parentFieldName=this.field.parent;$(document).find("."+$Control.CLASSNAME_CONTROL).each(function(){var thisControl=$(this).data($Control.DATA_CONTROL_OBJECT);if(thisControl==null||thisControl.path==null||thisControl.field==null||thisControl.field.name!==parentFieldName){return}var controlPath=thisControl.path;var len=referedControlPaths.length;for(var index=0;index<len;index++){if(referedControlPaths[index]===controlPath){var val=thisControl.getValue();if(val instanceof $Controls.Data.ValuePair||val instanceof $Controls.Data.Uri){parentValue=val.value}else{parentValue=val}control.parentValue=parentValue;return}}})}var prefixValue=this.activeInput.value,parent=parentValue==null?"":parentValue;this.requestCode(prefixValue,parent)}},onAjaxCallback:function(prefixValue,resData,lastSubmitTime){if(this.lastSubmitTime>lastSubmitTime){return}if(this.focused===false){return}var getCodeList=function(){var codes;if(resData.items===undefined){if("undefined"!==typeof(JSON)){codes=JSON.parse(resData.d)}else{codes=$.parseJSON(resData.d)}}else{codes=resData}for(var codeIndex=0,len=codes.items.length;codeIndex<len;codeIndex++){var data=codes.items[codeIndex];data.codeName=$IU.trimString(data.codeName);data.description=$IU.trimString(data.description)}return codes};this.changeLoadingStatus(false);var codeList=getCodeList();var originSuggestDataLength=(this.currentLastPageNo===1||this.suggestData==null)?0:this.suggestData.length;if(this.currentLastPageNo===1){this.suggestData=codeList.items;this.totalResults=codeList.total}else{for(var i=0;i<codeList.items.length;i++){this.suggestData[this.suggestData.length]=codeList.items[i]}if(codeList.items.length<InfoPlus.Suggester.PAGE_ITEM_COUNT){this.removeMoreItem()}}if(this.suggestData==null||this.suggestData.length===0){this.suggestData=[];this.totalResults=null;this.suggestDiv.style.display="none";this.emptyDiv.style.display="block";if(this.activeInput.value.length<this.suggestMinimizeSize){this.setEmptyDivContent()}else{this.emptyDiv.innerHTML=$$.lt("suggester.noData")}this.currentLastPageNo=1;return}if(codeList.items.length===0){if(this.currentLastPageNo>1){this.currentLastPageNo-=1;for(i=0;i<this.suggestData.length;i++){var item=this.suggestItems[i];if(item!=null){item.style.background=""}}this.adjustSuggestDiv((this.currentLastPageNo-1)*InfoPlus.Suggester.PAGE_ITEM_COUNT,InfoPlus.Suggester.PAGE_ITEM_COUNT);this.lastNextPageRequest=null;return}}this.suggestAjaxShow(originSuggestDataLength,prefixValue);var control=$(this.dataElement).data($Control.DATA_CONTROL_OBJECT);$$(control).fieldSuggested(prefixValue,codeList.items)},hasMoreItem:function(){if(this.isMultiPageDisabled()){return false}return $(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)!=null},shouldShowMoreItemInSuggestDiv:function(pageFirstItemIndex,pageItemCount){if(this.isMultiPageDisabled()){return false}var moreItem=this.getMoreItem();if(moreItem==null){return false}if(this.suggestItems.length<InfoPlus.Suggester.PAGE_ITEM_COUNT){return false}if(pageItemCount<InfoPlus.Suggester.PAGE_ITEM_COUNT){return false}return(pageFirstItemIndex+pageItemCount>=this.suggestItems.length)},getMoreItem:function(){if(this.isMultiPageDisabled()){return null}return $(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)},removeMoreItem:function(){var moreItem=this.getMoreItem();if(moreItem!=null){$(moreItem).remove();$(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)}},changeLoadingStatus:function(loading){for(var i=0;i<this.suggestItems.length;i++){var item=this.suggestItems[i];if(loading){$(item).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_LOADING)}else{$(item).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_LOADING)}}},changeMoreItemIcon:function(loading){var moreItem=this.getMoreItem();if(moreItem==null){return}if(loading===true){$(moreItem).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_DOWN);$(moreItem).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_LOADING)}else{$(moreItem).removeClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_LOADING);$(moreItem).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM_DOWN)}},getEmptyItem:function(){return $(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_EMPTY_ITEM)},suggestAjaxShow:function(originSuggestDataLength,prefixValue){var strViewWidth=function(fData){var rootFontSize=parseFloat($("html").css("font-size"));if(fData==null){return 0}var intLength=0;for(var index=0;index<fData.length;index++){if((fData.charCodeAt(index)<0)||(fData.charCodeAt(index)>255)){intLength=intLength+($$.MOBILE?rootFontSize*1.2:13)}else{intLength=intLength+($$.MOBILE?Math.ceil(rootFontSize*1.2/2):7)}}return intLength};var calculateMaxWidth=function(contents,oldMaxWidth){viewWidth=strViewWidth(contents);if(oldMaxWidth<viewWidth){return viewWidth}return oldMaxWidth};var calculateMoreItemWidth=function(moreItem){var moreContent=moreItem.innerHTML;var moreLines=moreContent.split("<br>");var result=0;for(var i=0,len=moreLines.length;i<len;i++){var width=strViewWidth(moreLines[i]);if(result<width){result=width}}return result};var changeItemContent=function(code,item,oldMaxWidth){var contents=$IU.trimString(code.codeName);if(code.description!=null&&code.description!==""){contents+="("+$IU.trimString(code.description)+")"}const readableId=code.codeIdReadable||code.codeId;$(item).html('<div class="item_code_id">'+replacePrefix($IU.trimString(readableId))+"</div>"+replacePrefix(contents)).addClass("infoplus_suggester_item_duplicated");contents+=$IU.trimString(readableId);return calculateMaxWidth(contents,oldMaxWidth)};var adjustDuplicateItem=function(suggestItems,maxWidth){var keyObj={};for(var index=0,len=suggestItems.length;index<len;index++){item=suggestItems[index];if(item==null){continue}var code=$(item).data("code");var key=code.codeName;if(!keyObj.hasOwnProperty(key)){keyObj[key]=item}else{maxWidth=changeItemContent(code,item,maxWidth);maxWidth=changeItemContent($(keyObj[key]).data("code"),keyObj[key],maxWidth)}}return maxWidth};var findIndexOf=function(content,fromIndex){var searchArray=prefixValue.toLocaleLowerCase().split(/[ ]|,/);if(searchArray.length===0){return{index:-1,len:0}}var index=-1,searchLen=0;for(var i=0,len=searchArray.length;i<len;i++){if(searchArray[i].length===0){continue}var thisIndex=content.indexOf(searchArray[i],fromIndex);if(thisIndex!==-1&&(index===-1||thisIndex<index)){index=thisIndex;searchLen=searchArray[i].length}}return{index:index,len:searchLen}};var replacePrefix=function(text){var lowerCaseText=text.toLocaleLowerCase(),currentIndex=0,resultText="";var findResult=findIndexOf(lowerCaseText,currentIndex);while(findResult.index!==-1){resultText+=text.substring(currentIndex,findResult.index);resultText+="<u>"+text.substr(findResult.index,findResult.len)+"</u>";currentIndex=findResult.index+findResult.len;findResult=findIndexOf(lowerCaseText,currentIndex)}resultText+=text.substr(currentIndex);return resultText};var adjustSearchResultItem=function(suggestItems,maxWidth){for(var index=0,len=suggestItems.length;index<len;index++){item=suggestItems[index];if(item==null){continue}var code=$(item).data("code");const readableId=code.codeIdReadable||code.codeId;var findResult=findIndexOf(readableId.toLocaleLowerCase(),0);if(findResult.index!==-1){maxWidth=changeItemContent(code,item,maxWidth)}}return maxWidth};var getInaccurateTotal=function(total){if(total>100000){return $$.lt("suggester.inaccurateTotal.hundredThousand")}if(total>10000){return $$.lt("suggester.inaccurateTotal.tenThousand")}if(total>1000){return $$.lt("suggester.inaccurateTotal.thousand")}return total};if(this.currentLastPageNo===1){this.suggestItems=[];$(this.suggestDiv).empty();if(this.isEmptyItemAppear()){var emptyItem=document.createElement("div");$(emptyItem).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM);emptyItem.innerHTML=$$.lt("suggester.emptyItem");$(emptyItem).data("code",null);this.suggestDiv.appendChild(emptyItem);$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_EMPTY_ITEM,emptyItem)}if(!this.isMultiPageDisabled()){$(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM);if(this.suggestData.length>=InfoPlus.Suggester.PAGE_ITEM_COUNT){var moreItem=document.createElement("div");$(moreItem).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_ITEM);moreItem.innerHTML=$$.lt("suggester.moreItem");this.suggestDiv.appendChild(moreItem);$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM,moreItem)}}else{if(this.type==="User"){var field=this.field;if(field.settings!=null&&field.settings.userTraversal===true){$(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)}else{if(this.suggestData.length>=InfoPlus.Suggester.PAGE_ITEM_COUNT){moreItem=document.createElement("div");$(moreItem).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_MORE_USER);moreItem.innerHTML=$$.hlt("suggester.moreUser",this.totalResults!=null?getInaccurateTotal(this.totalResults):this.suggestData.length);this.suggestDiv.appendChild(moreItem);$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM,moreItem)}else{$(this.suggestDiv).removeData(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)}}}}}var maxWidth=(this.currentLastPageNo===1?0:parseInt($(this.suggestDiv).width())-20);var currentPageItemCount=0;moreItem=(this.type!=="User")?this.getMoreItem():$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM);for(var i=0;i<this.suggestData.length;i++){if(i<originSuggestDataLength){var item=this.suggestItems[i];if(item!=null){item.style.background=""}}else{var code=this.suggestData[i];item=document.createElement("div");$(item).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM_UNSELECT);$(item).addClass(InfoPlus.Suggester.CLASSNAME_SUGGESTER_ITEM);if(this.tipFormat!=null&&code.attributes!=null){$(item).attr("title",$IU.variablesFormat(this.tipFormat,code.attributes))}var contents=$IU.trimString(code.codeName);if(null!=code.description&&""!==code.description){contents+="("+$IU.trimString(code.description)+")"}var viewWidth=strViewWidth(contents);if(maxWidth<viewWidth){maxWidth=viewWidth}$(item).html(replacePrefix(contents));$(item).data("code",code);this.suggestItems[i]=item;if(moreItem!=null){$(moreItem).before(item)}else{this.suggestDiv.appendChild(item)}currentPageItemCount++}}maxWidth=adjustDuplicateItem(this.suggestItems,maxWidth);maxWidth=adjustSearchResultItem(this.suggestItems,maxWidth);var minWidth=this.activeInput.offsetWidth;if(moreItem!=null){var moreItemWidth=calculateMoreItemWidth(moreItem);if(minWidth<moreItemWidth){minWidth=moreItemWidth}}if(maxWidth>minWidth){var w=maxWidth+20}else{w=minWidth+20}if(!this.isMobileView()){$(this.suggestDiv).width(w)}else{var rootFontSize=parseFloat($("html").css("font-size"));$(this.suggestDiv).width((w/rootFontSize)+"rem")}this.suggestDiv.style.display="block";this.emptyDiv.style.display="none";if(this.currentLastPageNo!==1){var selectIndex;if(this.lastNextPageRequest.key==="down"){selectIndex=this.lastNextPageRequest.selectIndex+1}else{selectIndex=this.lastNextPageRequest.selectIndex>0?this.lastNextPageRequest.selectIndex+InfoPlus.Suggester.PAGE_ITEM_COUNT:InfoPlus.Suggester.PAGE_ITEM_COUNT}if(selectIndex>=this.suggestItems.length){selectIndex=this.suggestItems.length-1}var pageFirstItemIndex=0;if(this.suggestItems.length-InfoPlus.Suggester.PAGE_ITEM_COUNT>0){pageFirstItemIndex=this.suggestItems.length-InfoPlus.Suggester.PAGE_ITEM_COUNT}this.adjustSuggestDiv(pageFirstItemIndex,InfoPlus.Suggester.PAGE_ITEM_COUNT);if(this.suggestDiv.style.display==="block"){this.changeSelectedSuggesterItemStyle(this.lastNextPageRequest.selectIndex,selectIndex)}this.lastNextPageRequest=null}else{if(this.suggestDiv.style.display==="block"){if(!this.isAllowExtern()){if(this.isEmptyItemAppear()){if(this.suggestData.length===1){this.selectSuggesterItem(this.suggestItems[0])}else{var foundMatchItem=false;for(i=0;i<this.suggestData.length;i++){if(this.activeInput.value===this.suggestData[i].codeName){this.selectSuggesterItem(this.suggestItems[i]);this.unselectSuggesterItem(this.getEmptyItem());foundMatchItem=true;break}}if(!foundMatchItem){this.selectSuggesterItem(this.getEmptyItem())}}}else{if(null!=this.suggestItems[0]){this.selectSuggesterItem(this.suggestItems[0])}}}this.adjustSuggestDiv(0,currentPageItemCount)}}strViewWidth=null},getSuggestDivScrollTop:function(pageItem){if(pageItem==null){return 0}return pageItem.offsetTop-InfoPlus.Suggester.SUGGEST_DIV_PADDING_TOP},requestNextPage:function(currentSelectIndex,key){if(this.lastNextPageRequest!=null){return}this.currentLastPageNo++;this.lastNextPageRequest={selectIndex:currentSelectIndex,requestPageNo:this.currentLastPageNo,key:key};this.suggestAjaxSubmit()},containerClick:function(){if(this.isReadOnly()){return}if(this.activeInput){this.activeInput.focus()}},getCurrentPageTopIndex:function(){var currentSelectIndex=this.getSuggest();var suggestItems=this.suggestItems;var pos=currentSelectIndex;while(pos>=0){if(suggestItems[pos].offsetTop-InfoPlus.Suggester.SUGGEST_DIV_PADDING_TOP<this.suggestDiv.scrollTop){pos=pos+1;break}pos--}return((pos<0)?0:pos)},moveDownOneRow:function(forceDown){var currentPageTopIndex=this.getCurrentPageTopIndex();var suggestItems=this.suggestItems;if(forceDown||currentPageTopIndex+1<suggestItems.length){this.suggestDiv.scrollTop=this.getSuggestDivScrollTop(suggestItems[currentPageTopIndex+1])}},changeSelectedSuggesterItemStyle:function(currentSelectIndex,changedSelectIndex){if(this.isEmptyItemAppear()){if(currentSelectIndex===-1){this.unselectSuggesterItem(this.getEmptyItem())}else{if(this.suggestItems[currentSelectIndex]!=null){this.unselectSuggesterItem(this.suggestItems[currentSelectIndex])}}if(changedSelectIndex===-1){this.selectSuggesterItem(this.getEmptyItem())}else{if(this.suggestItems[changedSelectIndex]!=null){this.selectSuggesterItem(this.suggestItems[changedSelectIndex])}}}else{if(this.suggestItems[currentSelectIndex]!=null){this.unselectSuggesterItem(this.suggestItems[currentSelectIndex])}if(this.suggestItems[changedSelectIndex]!=null){this.selectSuggesterItem(this.suggestItems[changedSelectIndex])}}},isMobileView:function(){return $(document.body).hasClass("infoplus_mobile_view")},adjustSuggestDiv:function(pageFirstItemIndex,pageItemCount){var rootFontSize=parseFloat($("html").css("font-size"));if(this.shouldShowMoreItemInSuggestDiv(pageFirstItemIndex,pageItemCount)){pageItemCount++}var showEmptyItem=(this.isEmptyItemAppear()&&pageFirstItemIndex===0);if(showEmptyItem){pageItemCount++}if(!this.isMobileView()){var rowHeight=InfoPlus.Suggester.PAGE_ITEM_HEIGHT;if(this.type==="User"&&$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)!=null){var moreUserItemHeight=$($(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)).outerHeight()}var height=(pageItemCount*rowHeight+8+(moreUserItemHeight!=null?moreUserItemHeight:0));this.suggestDiv.style.height=height+"px"}else{rowHeight=2;if(this.type==="User"&&$(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)!=null){moreUserItemHeight=$($(this.suggestDiv).data(InfoPlus.Suggester.DATA_SUGGESTER_MORE_ITEM)).outerHeight()/rootFontSize}height=(pageItemCount*rowHeight+(8/rootFontSize)+(moreUserItemHeight!=null?moreUserItemHeight:0));this.suggestDiv.style.height=height+"rem"}this.suggestDiv.scrollTop=showEmptyItem===true?0:this.getSuggestDivScrollTop(this.suggestItems[pageFirstItemIndex])},activeInputKeyDown:function(keyCode){this.activeInput.className=this.getActiveInputClass(true);var currentSelectIndex=this.getSuggest(),suggestItems=this.suggestItems,suggestDiv=this.suggestDiv,currentPageNo,selectIndex,currentPageItemCount;switch(keyCode){case InfoPlus.Suggester.KEY_CODE_BACKSPACE:if(this.activeDiv.value===""){this.setData(null)}break;case InfoPlus.Suggester.KEY_CODE_UP:if(suggestItems[0]!=null&&suggestDiv.style.display==="block"){if(currentSelectIndex===-1){}else{var previousIndex=currentSelectIndex-1;if(previousIndex<0){if(this.isEmptyItemAppear()){previousIndex=-1}else{previousIndex=0}}this.changeSelectedSuggesterItemStyle(currentSelectIndex,previousIndex);if(previousIndex!==-1){if(suggestItems[previousIndex].offsetTop<this.suggestDiv.scrollTop){this.adjustSuggestDiv(previousIndex,InfoPlus.Suggester.PAGE_ITEM_COUNT)}}}}break;case InfoPlus.Suggester.KEY_CODE_DOWN:if(suggestItems[0]!=null&&suggestDiv.style.display==="block"){if(currentSelectIndex===-1){if(this.isEmptyItemAppear()){if(this.emptyItemIsSelected()){this.unselectSuggesterItem(this.getEmptyItem());this.selectSuggesterItem(suggestItems[0])}else{this.selectSuggesterItem(this.getEmptyItem())}}else{this.selectSuggesterItem(suggestItems[0])}}else{var nextIndex=currentSelectIndex+1;if(nextIndex>=suggestItems.length){if(this.hasMoreItem()){this.moveDownOneRow(true);this.requestNextPage(currentSelectIndex,"down")}return}this.changeSelectedSuggesterItemStyle(currentSelectIndex,nextIndex);if(this.suggestDiv.scrollTop+this.suggestDiv.offsetHeight<suggestItems[nextIndex].offsetTop+InfoPlus.Suggester.PAGE_ITEM_HEIGHT){this.adjustSuggestDiv(nextIndex-InfoPlus.Suggester.PAGE_ITEM_COUNT+1,InfoPlus.Suggester.PAGE_ITEM_COUNT)}}}break;case InfoPlus.Suggester.KEY_CODE_PAGE_UP:if(this.isMultiPageDisabled()){return}currentPageNo=currentSelectIndex>0?(Math.floor(currentSelectIndex/InfoPlus.Suggester.PAGE_ITEM_COUNT)+1):1;var previousPageNo=currentPageNo-1;selectIndex=currentSelectIndex-InfoPlus.Suggester.PAGE_ITEM_COUNT;if(selectIndex<0){selectIndex=0;previousPageNo=1}currentPageItemCount=InfoPlus.Suggester.PAGE_ITEM_COUNT;if(previousPageNo*InfoPlus.Suggester.PAGE_ITEM_COUNT>suggestItems.length){currentPageItemCount=suggestItems.length%InfoPlus.Suggester.PAGE_ITEM_COUNT}this.adjustSuggestDiv((previousPageNo-1)*InfoPlus.Suggester.PAGE_ITEM_COUNT,currentPageItemCount);this.changeSelectedSuggesterItemStyle(currentSelectIndex,selectIndex);break;case InfoPlus.Suggester.KEY_CODE_PAGE_DOWN:if(this.isMultiPageDisabled()){return}currentSelectIndex=this.getSuggest();currentPageNo=currentSelectIndex>0?(Math.floor(currentSelectIndex/InfoPlus.Suggester.PAGE_ITEM_COUNT)+1):1;suggestItems=this.suggestItems;selectIndex=currentSelectIndex>0?currentSelectIndex+InfoPlus.Suggester.PAGE_ITEM_COUNT:InfoPlus.Suggester.PAGE_ITEM_COUNT;if(selectIndex>=suggestItems.length&&this.hasMoreItem()){this.requestNextPage(currentSelectIndex,"pageDown")}else{var scrollTopIndex=currentPageNo*InfoPlus.Suggester.PAGE_ITEM_COUNT;if(selectIndex>=suggestItems.length){selectIndex=suggestItems.length-1;if(scrollTopIndex>=suggestItems.length){scrollTopIndex=suggestItems.length-InfoPlus.Suggester.PAGE_ITEM_COUNT;if(scrollTopIndex<0){scrollTopIndex=0}}}currentPageItemCount=InfoPlus.Suggester.PAGE_ITEM_COUNT;if(currentPageNo===1){if(suggestItems.length<InfoPlus.Suggester.PAGE_ITEM_COUNT){currentPageItemCount=suggestItems.length%InfoPlus.Suggester.PAGE_ITEM_COUNT}}this.adjustSuggestDiv(scrollTopIndex,currentPageItemCount);this.changeSelectedSuggesterItemStyle(currentSelectIndex,selectIndex)}break}},setFocusToNextControl:function(controls,counter){var control=controls.eq(counter+1)[0];if(control==null){return}if(control.disabled||control.style.display==="none"){this.setFocusToNextControl(controls,counter+1)}else{$(control).trigger("focus")}},activeInputKeyPress:function(keyCode){switch(keyCode){case InfoPlus.Suggester.KEY_CODE_ENTER:var currentSelectIndex=this.getSuggest();var value=this.activeInput.value;if(this.isEmptyItemAppear()&&currentSelectIndex===-1){if(this.emptyItemIsSelected()){this.setData("")}else{if(this.isAllowExtern()){if(this.text!==value){this.setData(value,value,false,true)}}else{this.setData("")}}}else{var hasSuggest=this.suggestDiv.style.display==="block"&&currentSelectIndex!==-1&&this.suggestItems.length>0;if(hasSuggest){this.setData(this.suggestData[currentSelectIndex])}else{if(this.isAllowExtern()){if(this.text!==value){this.setData(value,value,false,true)}}else{}}}this.activeInputBlur();break}},activeInputKeyUp:function(keyCode){this.adjustView();switch(keyCode){case InfoPlus.Suggester.KEY_CODE_ESC:this.activeInput.value=this.text||"";this.activeInputBlur();break}},clearFocusFlag:function(){this.focused=false;this.activeInputOnFocus=false;this.mouseInSuggestDiv=false;this.suggestDivScrolled=false},activeInputBlur:function(){this.clearFocusFlag();this.suggestDiv.style.display="none";this.emptyDiv.style.display="none";if(!this.isAllowExtern()){this.activeInput.value=this.text||""}else{if(this.dataElement.options[0].text!==this.activeInput.value){this.setData(this.activeInput.value,this.activeInput.value,false,true)}}this.activeInput.className=this.getActiveInputClass(false);this.activeInput.blur()},setEmptyDivContent:function(){if(this.type===$Control.DATA_TYPE_USER){this.emptyDiv.style.width=$$.MOBILE?"32rem":($$.params.lang==="zh"?"320px":"400px");this.emptyDiv.innerHTML=$$.lt("suggester.emptyUser")}else{this.emptyDiv.style.width=$$.MOBILE?"25rem":"250px";this.emptyDiv.innerHTML=$$.lt("suggester.emptyHint")}},activeInputFocus:function(){this.focused=true;this.activeInput.className=this.getActiveInputClass(true);this.activeDiv.style.position="relative";if(this.activeInput.value===""){this.emptyDiv.style.display="block";this.setEmptyDivContent()}else{this.emptyDiv.style.display="none"}this.currentLastPageNo=1;this.suggestAjaxSubmit()},onSuggesterItemMouseEnter:function(event){var suggesterControl=event.data.suggester;for(var i=0;i<suggesterControl.suggestItems.length;i++){suggesterControl.unselectSuggesterItem(suggesterControl.suggestItems[i])}if(suggesterControl.isEmptyItemAppear()){suggesterControl.unselectSuggesterItem(suggesterControl.getEmptyItem())}suggesterControl.selectSuggesterItem(this)},onSuggesterItemMouseDown:function(event){var suggesterControl=event.data.suggester;suggesterControl.setData($(this).data("code"));suggesterControl.suggestDiv.style.display="none";suggesterControl.emptyDiv.style.display="none";suggesterControl.activeInput.className=suggesterControl.getActiveInputClass(false);suggesterControl.focused=false;suggesterControl.activeInput.blur();return false},onSuggesterMoreItemClick:function(event){var suggesterControl=event.data.suggester;var currentSelectIndex=suggesterControl.getSuggest();suggesterControl.moveDownOneRow(true);suggesterControl.requestNextPage(currentSelectIndex,"down");return false},onSuggesterContainerClick:function(event){var suggesterControl=event.data.suggester;suggesterControl.containerClick()},onSuggesterActiveInputKeyDown:function(event){var suggesterControl=event.data.suggester;if(suggesterControl.isReadOnly()){return false}suggesterControl.activeInputKeyDown(event.keyCode);return event.keyCode!==InfoPlus.Suggester.KEY_CODE_PAGE_DOWN},onSuggesterActiveInputKeyUp:function(event){var suggesterControl=event.data.suggester;if(suggesterControl.isReadOnly()){return}suggesterControl.activeInputKeyUp(event.keyCode)},onSuggesterActiveInputKeyPress:function(event){var suggesterControl=event.data.suggester;if(suggesterControl.isReadOnly()){return}suggesterControl.activeInputKeyPress(event.keyCode);return event.keyCode!==InfoPlus.Suggester.KEY_CODE_ENTER},onSuggesterActiveInputFocus:function(event){var suggesterControl=event.data.suggester;suggesterControl.activeInputOnFocus=true;if(suggesterControl.isReadOnly()){return}if(suggesterControl.mouseInSuggestDiv===false){if($IU.shouldShowSuggesterPage()){$IU.clearAllError();var originControl=$(suggesterControl.dataElement).data($Control.DATA_CONTROL_OBJECT);originControl.onSuggestPage=true;var instance=this;setTimeout(function(){instance.blur();if(InfoPlus.Suggester.isPagePopup()==false){$IU.showSuggester2ThisPage(originControl)}else{$IU.showSuggester2PageOnce(originControl)}},0);return false}else{suggesterControl.activeInputFocus();setTimeout($.proxy(suggesterControl.submitSuggester,suggesterControl),InfoPlus.Suggester.SUBMIT_DELAY)}}},onSuggesterActiveInputBlur:function(event){var suggesterControl=event.data.suggester;suggesterControl.activeInputOnFocus=false;if(suggesterControl.isReadOnly()){return}if(suggesterControl.mouseInSuggestDiv===false){suggesterControl.activeInputBlur()}},onSuggesterDivFocus:function(event){var suggesterControl=event.data.suggester},onSuggesterDivBlur:function(event){var suggesterControl=event.data.suggester;if(suggesterControl.activeInputOnFocus===false&&suggesterControl.suggestDivScrolled===false){suggesterControl.activeInputBlur()}},onSuggesterDivMouseUp:function(event){var suggesterControl=event.data.suggester;suggesterControl.suggestDivScrolled=true;suggesterControl.activeInput.focus()},onSuggesterDivMouseEnter:function(event){var suggesterControl=event.data.suggester;suggesterControl.mouseInSuggestDiv=true},onSuggesterDivMouseLeave:function(event){var suggesterControl=event.data.suggester;suggesterControl.mouseInSuggestDiv=false},onSuggesterButtonClick:function(event){var suggesterControl=event.data.suggester;if(suggesterControl.isReadOnly()){return false}return false},submitSuggester:function(){if(this.focused){if(this.lastSubmitValue!==this.activeInput.value){this.currentLastPageNo=1;this.suggestAjaxSubmit();this.lastSubmitValue=this.activeInput.value}setTimeout($.proxy(this.submitSuggester,this),InfoPlus.Suggester.SUBMIT_DELAY)}}};define("InfoPlus.Suggester",suggester)})(window);
(function(window,undefined){var settings={};settings.DEFINITION_STATUS_ONLINE=1;settings.DEFINITION_STATUS_OFFLINE=2;settings.INSTANCE_STATE_UNKNOWN=-1;settings.INSTANCE_STATE_CREATED=0;settings.INSTANCE_STATE_ONLINE=1;settings.INSTANCE_STATE_OFFLINE=2;settings.INSTANCE_STATE_TERMINATED=3;settings.INSTANCE_STATE_COMPLETE=4;settings.STEP_STATE_TODO=1;settings.STEP_STATE_DONE=2;settings.STEP_STATE_DRAFT=3;settings.STEP_STATE_SUB=4;settings.STEP_TYPE_MANUAL="Manual";settings.STEP_TYPE_AUTO="Auto";settings.STEP_TYPE_SPLIT="Split";settings.STEP_TYPE_JOIN="Join";settings.STEP_TYPE_CONDITIONAL="Conditional";settings.NOBODY_ACCOUNT="__INFOPLUS_SELECT_USER__";settings.MESSAGE_BOX_TITLE="InfoPlus";define("InfoPlus.Settings",settings)})(window);
(function(window,undefined){var formRender=function(config){this.initializeConfig(config);this.dynamicAnalyzer=new InfoPlus.Dynamics.Analyzer()};var DEFAULT_SETTINGS={autoSize:true};formRender.prototype={holder:null,entity:null,prefix:"infoplus_view_"+Math.round(Math.random()*9000+1000)+"_",selectedDiv:null,events:[],initializeConfig:function(config){this.config={};for(var prop in config){if(config.hasOwnProperty(prop)){if(typeof(config[prop]!=="function")){this.config[prop]=config[prop]}}}return this.assertConfig()},assertConfig:function(){var formStepId=this.config.formStepId,workflowId=this.config.workflowId;if(formStepId===undefined&&workflowId===undefined){return false}this.formStepId=formStepId;var holderId=this.config.holderId;if(holderId===undefined){return false}var holder=document.getElementById(holderId);if(holder===null){return false}this.holder=holder;var entity=this.config.entity;if(entity===undefined){return false}this.entity=entity;if(this.config.suggest==null){return false}this.suggestService=this.config.suggest;if(this.config.suggestInitialize==null){return false}this.suggestInitializeService=this.config.suggestInitialize;if(this.config.fieldChange==null){return false}this.fieldChangeService=this.config.fieldChange;if(this.config.buttonService==null){return false}this.buttonService=this.config.buttonService;if(this.config.thingService==null){return false}this.thingService=this.config.thingService;if(this.config.tenantTimeZoneOffset==null){return false}this.tenantTimeZoneOffset=this.config.tenantTimeZoneOffset;this.discard();this.events=[];return true},dispose:function(){this.holder=null;this.entity=null;this.selectedDiv=null},addViewCss:function(){var views=this.entity.views;for(var i=0;i<views.length;i++){var id=this.prefix+i;this.addCssStyle(views[i],id);this.addCssStyleSheet(views[i],id)}},addCssStyle:function(view,id){var cssList=view.styleSheet;var styleId=id+"_style";if($IU.isArray(cssList)){var styleEle=null;if(document.getElementById(styleId)==null){styleEle=document.createElement("style");styleEle.type="text/css";styleEle.media="all";styleEle.id=styleId;document.getElementsByTagName("head")[0].appendChild(styleEle);styleEle=document.styleSheets[document.styleSheets.length-1]}else{for(var n=0;n<document.styleSheets.length;n++){styleEle=document.styleSheets[n];if(styleEle.id===styleId){break}}}if(styleEle.rules){while(styleEle.rules.length>0){styleEle.removeRule(0)}}else{if(styleEle.cssRules){while(styleEle.cssRules.length>0){styleEle.deleteRule(0)}}}for(n=0;n<cssList.length;n++){var cssRule=cssList[n];if(styleEle.rules){var rule=cssRule.split("{");var classes=rule[0].split(/,/);var style=rule[1].split("}")[0];for(var c=0;c<classes.length;c++){styleEle.addRule(classes[c],style)}}else{if(styleEle.cssRules){if(!/\s$/.test(cssRule)){styleEle.insertRule(cssRule,0)}}}}}},addCssStyleSheet:function(view,id){var cssUri=view.styleSheetUri;if(null!=cssUri&&""!==cssUri){for(var l=0;l<document.styleSheets.length;l++){var href=document.styleSheets[l].href;if(null!=href&&href.length>=cssUri.length){if(href.substr(href.length-cssUri.length)===cssUri){break}}}var linkId=id+"_cached_link";var linkEle;if(l>=document.styleSheets.length){linkEle=document.getElementById(linkId);if(null==linkEle){linkEle=document.createElement("link");linkEle.type="text/css";linkEle.media="all";linkEle.rel="stylesheet";linkEle.id=linkId;document.getElementsByTagName("head")[0].appendChild(linkEle)}linkEle.href=cssUri}else{var cssEle=document.styleSheets[l];linkEle=cssEle.ownerNode||cssEle.owningElement||document.getElementById(linkId);document.getElementsByTagName("head")[0].removeChild(linkEle);document.getElementsByTagName("head")[0].appendChild(linkEle)}}},processEvent:function(){$(document.body).on("change","."+InfoPlus.Controls.Control.CLASSNAME_FIELD_CHANGE,{render:this},this.onFieldChange);$(document.body).on("focus","."+InfoPlus.Controls.Control.CLASSNAME_CONTROL,this.onFieldFocus);var instance=this;$$.addedRepeat(function(repeat,row){instance.initSelect2($(row).find(".infoplus_select2"));instance.initRichText($(row).find(".infoplus_richTextControl"));instance.initLabel($(row).find(".infoplus_labelControl"));instance.initRadio($(row).find(".infoplus_radioControl"));instance.initCheck($(row).find(".infoplus_checkControl"))})},initVarControls:function(){var variablesDiv=document.createElement("div");variablesDiv.setAttribute("id","variables_container");$(this.holder).append(variablesDiv);var data=this.entity.data;for(var key in data){if(data.hasOwnProperty(key)){if(key.substr(0,5)!=="field"){$IU.addVariableControl(key,data[key])}}}var urlAttr=$IU.getParamFromUrl(window.location.href);if(this.data._VAR_URL_Attr!=null){urlAttr=$.extend($.parseJSON(this.data._VAR_URL_Attr),urlAttr)}$IU.addVariableControl("_VAR_URL",window.location.href,window.location.href,urlAttr);$IU.addVariableControl("_VAR_ENTRY_NAME",$$.params.instanceName);$IU.addVariableControl("_VAR_ENTRY_TAGS",$$.params.instanceTags)},initDynamicParallel:function(){if($$.params.dynamicParallel==null){return}var splitPath=$$.params.dynamicParallel.splitPath;var splitGroup=$$.params.dynamicParallel.splitPathGroup;var getVisibleGroupPath=function(index){var path="";for(var i=0;i<=index;i++){path+="_"+splitPath[i]}return path};for(var i=0,len=splitGroup.length;i<len;i++){var groupName=splitGroup[i];var permission=this.entity.groups[groupName].permission||"";permission=permission.replace(/[w|i|d]/g,"");this.entity.groups[groupName].permission=permission;var visiblePath=getVisibleGroupPath(i);$$("&"+groupName).each(function(){var children=this.getChildren(),allRowInvisible=true;for(var gi=0,gl=children.length;gi<gl;gi++){var $row=$(children[gi]),thisRowPath=this.getPath()+"_"+gi;if(visiblePath===thisRowPath){if(permission.indexOf("r")!==-1){$row.show();allRowInvisible=false}else{$row.hide()}}else{if(permission.indexOf("R")!==-1){$row.show();$row.find("."+$Control.CLASSNAME_CONTROL).each(function(){var $element=$(this),control=$element.data($Control.DATA_CONTROL_OBJECT);if(control!=null){control.setDynamicParallelReadOnly()}});$row.find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var repeatControl=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(repeatControl!=null){repeatControl.readOnly=true;if(repeatControl.repeatAddLink!=null){repeatControl.repeatAddLink.hideLink()}}});allRowInvisible=false}else{$row.hide()}}}if(allRowInvisible){this.visible(false,true)}})}},convertSize:function(){var calcRootFontSize=function(){var screenWidth=window.screen.width;if(screenWidth<600){var calcSize=Math.floor(16+2*(screenWidth-375)/225)}else{if((screenWidth<1000)){calcSize=Math.floor(18+4*(screenWidth-600)/400)}else{calcSize=Math.floor(22+5*(screenWidth-1000)/1000)}}return calcSize};var rootFontSize=calcRootFontSize();$("html").css("font-size",rootFontSize+"px");var getUnit=function(value){if(value==null||value.length<2){return null}return value.substr(value.length-2).toLocaleLowerCase()};var convertRemValue=function(value,coefficient){var unit=getUnit(value),result=parseFloat(value);if(isNaN(result)){return value}switch(unit){case"cm":result=result*96/2.54;break;case"mm":result=result*9.6/2.54;break;case"in":result=result*96;break;case"pt":result=result*4/3;break;case"px":break;case"pc":result=result*12*4/3;break;default:return value}return(result/rootFontSize*coefficient)+"rem"};var convertRelativeValue=function(value){switch(value){case"xx-small":case"1":case"x-small":case"2":return"12px";case"small":case"3":return"14px";case"medium":case"4":return"16px";case"large":case"5":return"18px";case"x-large":case"6":return"32px";case"xx-large":case"7":return"48px"}return null};this.eachLayout(function(render){if(render.attributes==null||!$IU.isArray(render.attributes)){return}if(render.renderType==="LayoutFont"){var styleIndex=-1;for(var i=0,len=render.attributes.length;i<len;i++){if(render.attributes[i]["key"]!=null&&render.attributes[i]["value"]!=null&&render.attributes[i]["key"].toLocaleLowerCase()==="style"){styleIndex=i}}for(i=0,len=render.attributes.length;i<len;i++){if(render.attributes[i]["key"]!=null&&render.attributes[i]["value"]!=null&&render.attributes[i]["key"].toLocaleLowerCase()==="size"){var value=convertRelativeValue($IU.trimString(render.attributes[i]["value"]));if(value!=null){if(styleIndex!==-1){render.attributes[styleIndex]["value"]+=";font-size:"+value}else{render.attributes[i]["key"]="style";render.attributes[i]["value"]="font-size:"+value}}}}}for(i=0,len=render.attributes.length;i<len;i++){if(render.attributes[i]["key"]!=null&&render.attributes[i]["value"]!=null&&render.attributes[i]["key"].toLocaleLowerCase()==="style"){var styles=render.attributes[i]["value"].split(";");var convertStyles=[];for(var si=0,sl=styles.length;si<sl;si++){var style=styles[si].split(":");if(style.length===2){var styleName=$IU.trimString(style[0]),styleValue=$IU.trimString(style[1]);switch(styleName.toLocaleLowerCase()){case"height":case"min-height":if($$.MOBILE){if(render.renderType!=="BoundPicture"){convertStyles.push(styleName+":"+convertRemValue(styleValue,1))}}break;case"font-size":styleValue=convertRelativeValue(styleValue);if($$.MOBILE){if(styleValue==null){styleValue=$IU.trimString(style[1])}convertStyles.push(styleName+":"+convertRemValue(styleValue,1.2))}else{if(styleValue!=null){convertStyles.push(styleName+":"+styleValue)}}}}}var convertedStyle="";for(var ci=0,cl=convertStyles.length;ci<cl;ci++){convertedStyle+=convertStyles[ci]+";"}if(convertedStyle!==""){render.attributes[i]["value"]=render.attributes[i]["value"]+";"+convertedStyle}}}})},processEmptyDiv:function(){var views=this.entity.views;for(var viewIndex=0;viewIndex<views.length;viewIndex++){var view=views[viewIndex];$IU.clearStack();$IU.processEmptyDiv(view)}},processAutoViewWidth:function(){var views=this.entity.views;var attrHasValue=function(attr){return attr.key!=null&&attr.value!=null};var processWidthStyle=function(viewWidth,render,index){var styles=render.attributes[index]["value"].split(";");for(var si=0,sl=styles.length;si<sl;si++){var style=styles[si].split(":");if(style.length===2){var styleName=$IU.trimString(style[0]),styleValue=$IU.trimString(style[1]);if(styleName.toLocaleLowerCase()==="width"){if(styleValue.substr(styleValue.length-1)!=="%"){var cssWidth=parseInt(styleValue,10);if(cssWidth<=viewWidth*1.1&&cssWidth>=viewWidth*0.9){render.attributes[index]["value"]=render.attributes[index]["value"]+";width:100%"}}}}}};var allAuto=true;for(var viewIndex=0;viewIndex<views.length;viewIndex++){var view=views[viewIndex];if(view.autoWidth===true){if(view.width!==undefined&&view.width<=$(window).width()){this.eachLayout(function(render){if(render.attributes==null||!$IU.isArray(render.attributes)){return}if(render.renderType==="LayoutTable"){for(var i=0,len=render.attributes.length;i<len;i++){if(attrHasValue(render.attributes[i])){if(render.attributes[i]["key"].toLocaleLowerCase()==="style"){processWidthStyle(view.width,render,i)}}}}if(render.renderType==="LayoutDivision"){var isRepeatSectionDiv=false;for(i=0,len=render.attributes.length;i<len;i++){if(render.attributes[i]["key"]!=null&&render.attributes[i]["value"]!=null){if(render.attributes[i]["key"].toLocaleLowerCase()==="class"&&render.attributes[i]["value"].indexOf("xdRepeatingSection")!==-1){isRepeatSectionDiv=true}if(render.attributes[i]["key"].toLocaleLowerCase()==="xctname"&&render.attributes[i]["value"].indexOf("RepeatingSection")!==-1){isRepeatSectionDiv=true}}}if(isRepeatSectionDiv){for(i=0,len=render.attributes.length;i<len;i++){if(attrHasValue(render.attributes[i])){if(render.attributes[i]["key"].toLocaleLowerCase()==="style"){processWidthStyle(view.width,render,i)}}}}}},view)}}else{allAuto=false}}$$.params.allAutoWidth=allAuto},createViews:function(){var views=this.entity.views,len=views.length,multiView=(len>1);if($$.MOBILE&&len>0&&views[0].mobileFont===true){this.convertSize()}this.findSyncFields();this.convertReadOnlyControls();this.findMasterDetailGroups();this.filterUnusableAttributes();this.changeFontStyle();this.processAutoViewWidth();this.processEmptyDiv();this.addViewCss();$$.params.printInvoice=$$.params.printInvoice&&this.findBoundThingControl();this.views=[];for(var i=0;i<len;i++){this.createView(views[i],i,(!$$.PREVIEW&&!$$.PRINT&&multiView===true))}this.initSpecialControls();this.initVarControls();this.initDynamicParallel()},initSpecialControls:function(){this.initSelect2($(".infoplus_select2"));this.initRichText($(".infoplus_richTextControl"));this.initRadio($(".infoplus_radioControl"));this.initCheck($(".infoplus_checkControl"))},initCheck:function($checks){if($checks==null||$checks.length===0){return}$checks.each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);control.initCheck()})},initRadio:function($radios){if($radios==null||$radios.length===0){return}$radios.each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);control.initRadio()})},initSelect2:function($select2s){if($select2s==null||$select2s.length===0){return}$select2s.each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);control.initSelect2()})},initRichText:function($richTexts){if($richTexts==null||$richTexts.length===0){return}var init=function(element){var richTextControl=$(element).data($Control.DATA_CONTROL_OBJECT);richTextControl.init()};if(window.CKEDITOR==null){loadAllScript([$$.params.libs.ckeditor],function(){$richTexts.each(function(){if(window.CKEDITOR!=null){init(this)}else{$IU.debugTip("ckeditor","warning")}})})}else{$richTexts.each(function(){init(this)})}},initLabel:function($labels){if($labels==null||$labels.length===0){return}$labels.each(function(){var labelControl=$(this).data($Control.DATA_CONTROL_OBJECT);labelControl.addRepeatInitHeightStyle()})},findSyncFields:function(){var instance=this,fields={};this.eachLayout(function(render){var fieldName=render.field;if(fields.hasOwnProperty(fieldName)){fields[fieldName].needSync=true}else{var field=instance.getField(fieldName);if(field!=null){fields[fieldName]=field}}},null,"Boundable")},convertReadOnlyControls:function(){if($$.params.tenantReadOnlyStyle==="None"){return}var instance=this,convertControlTypes=["BoundEdit","BoundTextArea","BoundRichText","BoundDate","BoundTime","BoundSuggester","BoundSuggester2","BoundSelect","BoundOptionList"];var fieldReadOnly=function(permission){permission=permission||"";return permission.indexOf("r")!==-1&&permission.indexOf("w")===-1};this.eachLayout(function(render){var field=instance.getField(render.field);if(field!=null){if(fieldReadOnly(field.permission)&&$IU.arrayContains(convertControlTypes,render.renderType)){render.convertFromText=(render.renderType==="BoundTextArea"||render.renderType==="BoundRichText");render.renderType="BoundConvertedLabel"}}},null,"Boundable")},findBoundThingControl:function(){var found=false;this.eachLayout(function(render){if(render.renderType==="BoundThing"){found=true}},null,"Boundable");return found},changeFontStyle:function(){var instance=this;var findStyleAttribute=function(attributes){if(!$IU.isArray(attributes)){return null}for(var i=0,len=attributes.length;i<len;i++){var attribute=attributes[i];if(attribute.key!=null&&attribute.key.toLocaleLowerCase()==="style"){return attribute}}return null};var getIosFontName=function(font){switch(font){case"":case"Microsoft YaHei":return"'PingFang SC',"+font;case"":case"SimSun":return"'Songti SC',"+font;case"":case"SimHei":return"'Heiti SC',"+font;case"":case"KaiTi":return"'Kaiti SC',"+font}return""};var changeStyleAttr=function(styleAttr,iosFont){var styles=styleAttr.value.split(";");var found=false;for(var i=0,len=styles.length;i<len;i++){if(styles[i].toLocaleLowerCase().indexOf("font-family")!==-1){styles[i]+=","+iosFont;found=true;break}}if(found){var value="";for(i=0,len=styles.length;i<len;i++){value+=styles[i]+";"}styleAttr.value=value}else{styleAttr.value+=";font-family:"+iosFont}};var convertFontFamilyCss=function(){instance.eachLayout(function(render){if(render.attributes!=null){var styleAttr=findStyleAttribute(render.attributes);if(styleAttr!=null&&styleAttr.value!=null){var styles=styleAttr.value.split(";");var found=false;for(var i=0,len=styles.length;i<len;i++){if(styles[i].toLocaleLowerCase().indexOf("font-family")!==-1){var fontValueArray=styles[i].toLocaleLowerCase().split(":");if(fontValueArray[1]!==undefined){var iosFont=getIosFontName($IU.trimString(fontValueArray[1]));if(iosFont!==""){styles[i]="font-family:"+iosFont;found=true}}break}}if(found){var value="";for(i=0,len=styles.length;i<len;i++){value+=styles[i]+";"}styleAttr.value=value}}}})};var convertFontTag=function(){instance.eachLayout(function(render){if(render.renderType==="LayoutFont"&&render.attributes!=null){var styleAttr=findStyleAttribute(render.attributes);for(var i=0,len=render.attributes.length;i<len;i++){var attr=render.attributes[i];if(attr.key.toLocaleLowerCase()==="face"){var iosFont=getIosFontName(attr.value);if(iosFont!==""){if(styleAttr!=null){changeStyleAttr(styleAttr,iosFont)}else{render.attributes[len]={key:"style",value:"font-family:"+iosFont}}}}}}},null,"Layoutable")};convertFontFamilyCss();convertFontTag()},filterUnusableAttributes:function(){var unusableAttrNames=["type","binding","ctrlid","xctname","tabindex","hidefocus","onvalue","boundprop"];var isUnusableAttr=function(name){for(var i=0,len=unusableAttrNames.length;i<len;i++){if(unusableAttrNames[i]===name.toLocaleLowerCase()){return true}}return false};this.eachLayout(function(render){if(render.attributes==null||!$IU.isArray(render.attributes)){return}var index=0;while(index<render.attributes.length){if(isUnusableAttr(render.attributes[index]["key"])){render.attributes.splice(index,1)}else{index++}}},null,"Boundable")},findMasterDetailGroups:function(){if($$.PRINT){return}var instance=this,groups={};var putGroups=function(groupName,isRepeatTable,render){if(!groups.hasOwnProperty(groupName)){groups[groupName]={}}if(isRepeatTable){groups[groupName].rtRender=render}else{groups[groupName].rsRender=render}};this.eachLayout(function(render){if(render.repeatable===true){var groupName=render.groupName,isRepeatTable=render.renderType==="LayoutTable";putGroups(groupName,isRepeatTable,render)}},null,"Layoutable");var changeControlTypes=["BoundEdit","BoundTextArea","BoundRichText","BoundDate","BoundTime","BoundSuggester","BoundSuggester2","BoundSelect","BoundOption","BoundOptionList","BoundCheckList","BoundThing"];var shouldChangeControlTypeToLabel=function(type){if(type==null){return false}for(var i=0,len=changeControlTypes.length;i<len;i++){if(changeControlTypes[i]===type){return true}}return false};var findFields=function(repeatRender){var fields=[];instance.eachLayout(function(render){fields.push(render.field)},repeatRender,"Boundable");return fields};for(var name in groups){if(groups.hasOwnProperty(name)){if(groups[name].rtRender!=null&&groups[name].rsRender!=null){var group=instance.entity.groups[name];group.isMasterDetail=true;var rsRender=$.extend(true,{},groups[name].rsRender);rsRender.repeatable=false;groups[name].rtRender.columns.push({renderType:"Renderable",renderCategory:"Renderable",width:0,attributes:[{key:"style",value:"WIDTH: 0px"}]});var contentRowIndex=-1;for(var rowIndex=0,len=groups[name].rtRender.renders.length;rowIndex<len;rowIndex++){if(groups[name].rtRender.renders[rowIndex]["repeating"]!==true){groups[name].rtRender.renders[rowIndex].renders.push({renderCategory:"Layoutable",renderType:"LayoutTableCell",repeatable:false,attributes:[{key:"class",value:"detailCell"}],renders:[]})}else{contentRowIndex=rowIndex}}var detailFields=findFields(rsRender);if(contentRowIndex!==-1){this.eachLayout(function(render){if(shouldChangeControlTypeToLabel(render.renderType)){if($IU.arrayContains(detailFields,render.field)){render.renderType="BoundLabel"}}},groups[name].rtRender.renders[contentRowIndex],"Boundable");groups[name].rtRender.renders[contentRowIndex].renders.push({renderCategory:"Layoutable",renderType:"LayoutTableCell",repeatable:false,attributes:[{key:"class",value:"detailCell"}],renders:[rsRender]})}}}}},draw:function(){var deferred=$.Deferred();if(null==this.holder||null==this.entity){return deferred.reject()}var $holder=$(this.holder);$holder.undelegate();$holder.empty();try{CollectGarbage()}catch(exp){}if(this.entity.step!=null){var documentTitle=(this.entity.step.name!=null?this.entity.step.name+" - ":"")+this.entity.app.name;$IU.setDocumentTitle(documentTitle);if($$.WECHAT){var $body=$("body");var $iframe=$("<iframe style='display:none;' src='/static/img/favicon.ico'></iframe>");$iframe.on("load",function(){setTimeout(function(){$iframe.off("load").remove()},0)}).appendTo($body)}}$$.dynamics.globalContext=$$.getGlobalContext(this.data);var instance=this;var functionCall=function(){var fns=Array.prototype.slice.call(arguments);if(fns.length>0){fns[0].apply();fns.splice(0,1);setTimeout(function(){functionCall.apply(null,fns)},0)}};this.doDynamicFormulaControls=[];functionCall(function(){instance.createViews();progress($$.lt("load.loadPage"),80)},function(){instance.initDynamicStyles();progress($$.lt("load.loadPage"),83)},function(){instance.initDynamicActions();progress($$.lt("load.loadPage"),87)},function(){instance.initDynamicValues();progress($$.lt("load.loadPage"),90)},function(){$$.params.initControls=[];instance.initFieldReferedClass();instance.processEvent();instance.triggerVarUrlChange();$$.codeManager.requestCodes();progress($$.lt("load.loadPage"),95);setTimeout(function(){deferred.resolve()},0)});return deferred.promise()},triggerVarUrlChange:function(){$("#_VAR_URL").change()},doDynamicFormulas:function(formControls,fromInit){if(formControls==null){return}var dynamicFormulas=$$.dynamics.formulas;for(var i=0,len=formControls.length;i<len;i++){var control=formControls[i],dynamicKeyName=control.getDynamicKeyName();if(dynamicKeyName==null){continue}if(dynamicFormulas.hasOwnProperty(dynamicKeyName)){control.setDynamicValue(this,fromInit)}}},doDynamicStyles:function(formControls,fromInit){var dynamicStyles=$$.dynamics.styles;for(var i=0,len=formControls.length;i<len;i++){var control=formControls[i],dynamicKeyName=control.getDynamicKeyName();if(dynamicKeyName==null){continue}if(dynamicStyles.hasOwnProperty(dynamicKeyName)){control.setDynamicStyle(this,fromInit)}}},doDynamicActions:function(formControls,fromInit){var dynamicActions=$$.dynamics.actions;for(var i=0,len=formControls.length;i<len;i++){var control=formControls[i],dynamicKeyName=control.getDynamicKeyName();if(dynamicKeyName==null){continue}if(dynamicActions.hasOwnProperty(dynamicKeyName)){control.doDynamicAction(this,fromInit)}}},doDynamicValidations:function(formControls,fromInit){var dynamicValidations=$$.dynamics.validations;for(var i=0,len=formControls.length;i<len;i++){var control=formControls[i],dynamicKeyName=control.getDynamicKeyName();if(dynamicKeyName==null){continue}if(dynamicValidations.hasOwnProperty(dynamicKeyName)){control.doDynamicValidation(this,fromInit)}}},initDynamicValues:function(){this.doDynamicFormulas(this.doDynamicFormulaControls,true)},initDynamicStyles:function(){this.doDynamicStyles($IU.getAllControls(),true)},initDynamicActions:function(){this.doDynamicActions($IU.getAllControls(),true)},initFieldReferedClass:function(){var referedFormulas=$$.dynamics.referedFormulas,referedStyles=$$.dynamics.referedStyles,referedActions=$$.dynamics.referedActions,referedValidations=$$.dynamics.referedValidations;$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);if(control==null||control.field===undefined){return}if(control.onFieldRefer===false){var keyName=control.getDynamicKeyName(),refKeyName=control.getDynamicContextControlName();if(referedFormulas[keyName]!==undefined||referedStyles[keyName]!==undefined||referedActions[keyName]!==undefined||referedValidations[keyName]!==undefined||referedFormulas[refKeyName]!==undefined||referedStyles[refKeyName]!==undefined||referedActions[refKeyName]!==undefined||referedValidations[refKeyName]!==undefined){control.onFieldRefer=true;control.addFieldChangeClass()}}})},updateAllRowIndex:function(){$$.params.renderForm.find("."+$Control.CLASSNAME_ROWINDEX).each(function(){var element=this;setTimeout(function(){$(element).change()},0)})},doDynamicsAfterFieldChange:function(){$$.dynamics.cache.build();var allControls=$IU.getAllControls();this.doDynamicStyles(allControls,false);this.doDynamicActions(allControls,false);this.doDynamicValidations(allControls,false);this.updateAllRowIndex()},getEntity:function(field,path,entity){var splits=path.split("_");splits.shift();var data=entity[field];if(data==null){return null}for(var i=0;i<splits.length;i++){var index=parseInt(splits[i]);if($IU.isArray(data)&&index<data.length){data=data[index]}else{return null}if(data==null){return null}}return data},setEntity:function(val,field,path,entity,omitIfExist){if(null==entity){entity=this.data}var splits=[];var i;if(null!=path&&""!==path.length){splits=path.split("_");i=0;var s=splits[i];while(null!=s){if($IU.trimString(s)===""){splits.splice(i,1)}else{i++}s=splits[i]}}if(splits.length>0){i=0;if(null==entity[field]){entity[field]=[]}var data=entity[field];var index;while(i<splits.length-1){index=parseInt(splits[i++]);if(null==data[index]){data[index]=[]}data=data[index]}index=parseInt(splits[splits.length-1]);if(null==val){data.splice(index,1)}else{if(data[index]==null||!omitIfExist){data[index]=val}}}else{if(entity[field]==null||!omitIfExist){entity[field]=val}}return entity},diceLayout:function(layout){var dice=[];this.eachLayout(function(render){var field=render.field;if(field!=null&&!$IU.arrayContains(dice,field)){dice.push(field)}},layout,"Boundable");return dice},createView:function(viewRender,index,hasLabel){var viewDom=this.createLayout(viewRender,this.data,"");if(viewDom!=null){var view=new InfoPlus.Layout.View({prefix:this.prefix,index:index,render:viewRender,element:viewDom,holder:this.holder,hasLabel:hasLabel});this.views.push(view);this.dynamicAnalyzer.analysisDynamic(viewRender.properties,view.getDynamicKeyName())}},createDisplayElement:function(render){var element;switch(render.renderType){case"DisplayText":if(render.syntax==="mdx"){element=document.createElement("span");if(render.cssClass!=null){$(element).addClass(render.cssClass)}if(render.emoji!=null){var emojiSpan=document.createElement("span");$(emojiSpan).addClass("mdx_emoji mdx_emoji_"+render.emoji);$(element).append(emojiSpan)}$(element).append(document.createTextNode(render.text))}else{element=document.createTextNode(render.text)}break;case"DisplayBreak":element=document.createElement("br");break;case"DisplayAnchor":element=document.createElement("a");element.setAttribute("href",render.uri||"");element.setAttribute("target","_blank");$(element).text(render.text||"");break;case"DisplayImage":element=document.createElement("img");element.setAttribute("border","0");if(render.uri!=null){element.setAttribute("src",$$.params.baseUrl+"file/form/"+this.entity.viewId+"/"+render.uri)}if(render.attributes!=null&&$IU.isArray(render.attributes)){for(var i=0,len=render.attributes.length;i<len;i++){var attr=render.attributes[i];if(attr.key==="style"){element.setAttribute("style",attr.value);break}}}break;case"DisplayLabel":element=document.createElement("label");element.innerText=render.text;element.setAttribute("for",render.labelFor||"");if(render.attributes!=null&&$IU.isArray(render.attributes)){for(var x=0;x<render.attributes.length;x++){if(render.attributes[x]["key"]==="class"){element.className+=(" "+render.attributes[x]["value"])}}}break}return element},createLayout:function(layout,data,path){var getAddLinkText=function(nextRender){if(nextRender!=null&&nextRender.renders!==undefined&&nextRender.renders.length>0&&nextRender.renders[0].text!==undefined){return nextRender.renders[0].text}return null};var element=this.createLayoutElement(layout);var elementContainer=element;this.createAttributes(element,layout.attributes);if(layout.renderType==="LayoutTable"){var tbody=document.createElement("tbody");element.appendChild(tbody);elementContainer=tbody}var renderList=layout.renders;var lastIsRepeatable=false;for(var i=0;i<renderList.length;i++){var render=renderList[i];if(render==null){continue}var cate=render.renderCategory;if(cate==null){continue}var child;switch(cate){case"Boundable":child=this.createControl(render,data,path);if(elementContainer!=null&&child!=null){elementContainer.appendChild(child)}break;case"Displayable":child=this.createDisplayElement(render);if(elementContainer!=null&&child!=null){elementContainer.appendChild(child)}break;case"Layoutable":if(render.repeatable===true){var repeatParentElement=elementContainer,isRepeatTable=(render.renderType==="LayoutTable");var groupName=render.groupName;if(groupName==null){$IU.debugTip("","warning");break}if(!isRepeatTable){var fieldNames=this.diceLayout(render)}else{var contentRowIndex=-1;for(var rowIndex=0,len=render.renders.length;rowIndex<len;rowIndex++){if(render.renders[rowIndex]["repeating"]===true){contentRowIndex=rowIndex;break}}if(contentRowIndex!==-1){fieldNames=this.diceLayout(render.renders[contentRowIndex])}else{$IU.debugTip(""+groupName+"","warning");break}}var firstControlNamePrefix=fieldNames.length>0?fieldNames[fieldNames.length-1]:null;var groupInformation=this.entity.groups[groupName];if(groupInformation.isMasterDetail===true&&!isRepeatTable){groupInformation.detailRender=render}else{var addLinkText=getAddLinkText(renderList[i+1]);var repeatControl=new InfoPlus.Repeat.RepeatControl({initData:data,formRender:this,render:render,path:path,repeatParentElement:repeatParentElement,repeatContentParentElement:repeatParentElement,firstControlNamePrefix:firstControlNamePrefix,repeatType:isRepeatTable?InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_TABLE:InfoPlus.Repeat.RepeatControl.REPEAT_TYPE_SECTION,addLinkText:addLinkText,fieldNames:fieldNames,groupInformation:groupInformation});this.dynamicAnalyzer.analysisDynamic(render.properties,repeatControl.getDynamicKeyName(),repeatControl.rowIndexFieldName,repeatControl.groupCountFieldName)}lastIsRepeatable=true}else{if(lastIsRepeatable===true){lastIsRepeatable=false}else{child=this.createLayout(render,data,path);if(elementContainer!=null){elementContainer.appendChild(child);if($$.params.mobileAutoView){if($(child).hasClass("infoplus_auto_view_repeatTable_wrap_outer")){var $addLink=$(child).children().children(".infoplus_addLinkContainerDiv").first();if($addLink.length>0){$addLink.detach().appendTo(elementContainer)}}}}}}break}}return element},createColGroup:function(layout,tableElement){var columns=layout.columns;if(columns!=null){var colgroup=document.createElement("colgroup");for(var i=0;i<columns.length;i++){var col=document.createElement("col");if(columns[i].width>0){col.width=columns[i].width}this.createAttributes(col,columns[i]["attributes"]);colgroup.appendChild(col)}tableElement.appendChild(colgroup)}},createLayoutElement:function(layout){var element=null;switch(layout.renderType){case"FormView":case"LayoutDivision":element=document.createElement("div");break;case"LayoutTable":element=document.createElement("table");this.createColGroup(layout,element);break;case"LayoutTableRow":element=document.createElement("tr");break;case"LayoutTableCell":element=document.createElement("td");break;case"LayoutHeader":element=document.createElement("h"+layout.size);break;case"LayoutFont":element=document.createElement("font");break;case"LayoutPhrase":switch(layout.phraseType){case"Emphasized":element=document.createElement("em");break;case"Strong":element=document.createElement("strong");break;case"Definition":element=document.createElement("dfn");break;case"Code":element=document.createElement("code");break;case"Keyboard":element=document.createElement("kbd");break;case"Sample":element=document.createElement("samp");break;case"Variable":element=document.createElement("var");break;case"Citation":element=document.createElement("cite");break;case"Superscript":element=document.createElement("sup");break;case"Subscript":element=document.createElement("sub");break;case"Underline":element=document.createElement("u");break;case"Italic":element=document.createElement("i");break;case"Small":element=document.createElement("small");break;case"StrikeThrough":element=document.createElement("s");break;case"Big":element=document.createElement("big");break}break;case"LayoutOrderedList":element=document.createElement("ol");break;case"LayoutUnorderedList":element=document.createElement("ul");break;case"LayoutListItem":element=document.createElement("li");break;case"LayoutAnchor":element=document.createElement("a");element.setAttribute("href",layout.uri||"");element.setAttribute("target","_blank");break;case"LayoutLabel":element=document.createElement("label");break;default:element=document.createElement("div")}return element},getDisplayText:function(render,data,path,key){var text;if(data[key+"_displayText"]!==undefined){text=data[key+"_displayText"]}else{var keyText=render.fieldText||key+"_Name";text=this.getEntity(keyText,path,this.data)}return text},getAttributeValue:function(path,fieldName,data){if($$.params.initializing===true){var attribute=this.getEntity(fieldName+"_Attr",path,this.data);if(attribute!=null){return $.parseJSON(attribute)}}if(data!=null&&data.hasOwnProperty(fieldName+"_Attr")){return data[fieldName+"_Attr"]}return null},getParentValue:function(path,fieldName,parentFieldName){var attribute=this.getAttributeValue(path,fieldName);if(attribute!=null&&attribute._parent!=null){return attribute._parent}if(parentFieldName!==undefined){return this.getParentValueOrAttributes(path,parentFieldName,true)}return null},getParentValueOrAttributes:function(path,parentFieldName,isGetValue){var paths=[],pathSplit=path.split("_");paths.push("");for(var i=1;i<pathSplit.length;i++){paths.push(paths[paths.length-1]+"_"+pathSplit[i])}var nowPath=paths.pop(),value=null;while(nowPath!==undefined){value=(isGetValue===true)?this.getEntity(parentFieldName,nowPath,this.data):this.getAttributeValue(nowPath,parentFieldName);if(value!=null){break}nowPath=paths.pop()}return value},getParentAttributes:function(path,parentFieldName){return this.getParentValueOrAttributes(path,parentFieldName,false)},getField:function(fieldName){var field=null;if(null!=fieldName&&null!=this.entity.fields){field=this.entity.fields[fieldName];if(field==null){$IU.debugTip(""+fieldName+",","warning")}}return field},createControl:function(render,data,path){var fieldName=render.field;if(fieldName==null){return null}var field=this.getField(fieldName);if(field==null){return null}var val=data[fieldName],text="",parentValue=null;if(val!==undefined&&val!==""){text=this.getDisplayText(render,data,path,fieldName)}if(field.parent!==undefined){parentValue=this.getParentValue(path,fieldName,field.parent)}var attributes=this.getAttributeValue(path,field.name,data);return this.createControlElement(path,field,render,val,text,parentValue,attributes)},getSelectDataSource:function(field){var items=null;if(field.code!=null){if(this.entity.codes[field.code]!=null){items=this.entity.codes[field.code].items}}return items},createControlElement:function(path,field,render,value,text,parentValue,attributes){var element=null;var control=null;render.settings=$.extend(DEFAULT_SETTINGS,render.settings);switch(render.renderType){case $Control.CONTROL_TYPE_EDIT:control=new $Controls.Edit(path,field,render,value);break;case $Control.CONTROL_TYPE_PASSWORD:control=new $Controls.Password(path,field,render,value);break;case $Control.CONTROL_TYPE_TEXT:control=new $Controls.Text(path,field,render,value);break;case $Control.CONTROL_TYPE_RICHTEXT:control=new $Controls.RichText(path,field,render,value);break;case $Control.CONTROL_TYPE_DATE:control=new $Controls.Date(path,field,render,value);break;case $Control.CONTROL_TYPE_TIME:control=new $Controls.Time(path,field,render,value);break;case $Control.CONTROL_TYPE_CHECKBOX:control=new $Controls.Check(path,field,render,value);break;case $Control.CONTROL_TYPE_CHECKBOX_LIST:control=new $Controls.CheckList(path,field,render,value,text);break;case $Control.CONTROL_TYPE_RADIO:if(field.type===$Control.DATA_TYPE_BOOL){control=new $Controls.RadioGroup(path,field,render,value)}else{control=new $Controls.Radio(path,field,render,value)}break;case $Control.CONTROL_TYPE_RADIO_LIST:control=new $Controls.RadioList(path,field,render,value,text,parentValue,attributes);break;case $Control.CONTROL_TYPE_SELECT:control=new $Controls.Select(path,field,render,value,text,parentValue,attributes);break;case $Control.CONTROL_TYPE_REMARK:control=new $Controls.Remark(path,field,render,value);break;case $Control.CONTROL_TYPE_BUTTON:control=new $Controls.Button(path,field,render,value,text);break;case $Control.CONTROL_TYPE_CHECK_BUTTON:control=new $Controls.CheckButton(path,field,render,value,text,attributes);break;case $Control.CONTROL_TYPE_LINK_BUTTON:control=new $Controls.LinkButton(path,field,render,value,text);break;case $Control.CONTROL_TYPE_ANCHOR:control=new $Controls.Anchor(path,field,render,value,text);break;case $Control.CONTROL_TYPE_LABEL:control=new $Controls.Label(path,field,render,value,text,attributes);break;case $Control.CONTROL_TYPE_CONVERTED_LABEL:control=new $Controls.Label(path,field,render,value,text,attributes,true);break;case $Control.CONTROL_TYPE_HIDDEN:control=new $Controls.Hidden(path,field,render,value,text,attributes);break;case $Control.CONTROL_TYPE_SUGGESTER:var tipFormat=(field.code!=null)?this.entity.codes[field.code].tipFormat:null;control=new $Controls.Suggester(path,field,render,this,value,text,parentValue,tipFormat,this.suggestService,this.suggestInitializeService,attributes);break;case $Control.CONTROL_TYPE_SUGGESTER2:control=new $Controls.Suggester2(path,field,render,value,text,parentValue,this.suggestService,attributes);break;case $Control.CONTROL_TYPE_DOC:control=new $Controls.Doc(path,field,render,value);break;case $Control.CONTROL_TYPE_FILE:control=new $Controls.File(path,field,render,value);break;case $Control.CONTROL_TYPE_HELP:control=new $Controls.Help(path,field,render,value);break;case $Control.CONTROL_TYPE_IMAGE:control=new $Controls.Image(path,field,render,value,text,attributes);break;case $Control.CONTROL_TYPE_PICTURE:control=new $Controls.Picture(path,field,render,value);break;case $Control.CONTROL_TYPE_IFRAME:control=new $Controls.Iframe(path,field,render,value);break;case $Control.CONTROL_TYPE_THING:control=new $Controls.Thing(path,field,render,value,text,attributes);break;case $Control.CONTROL_TYPE_SWITCH:control=new $Controls.Switch(path,field,render,value);break;case $Control.CONTROL_TYPE_MAP:control=new $Controls.Map(path,field,render,value,text,attributes);break;case $Control.CONTROL_TYPE_SIGNATURE:control=new $Controls.Signature(path,field,render,value,text);break;case $Control.CONTROL_TYPE_SEAL:control=new $Controls.Seal(path,field,render,value,text);break}if(control!=null){this.dynamicAnalyzer.analysisDynamic(render.properties,control.getDynamicKeyName(),control.getGroupRowIndexName(),control.getGroupCountName(),field.parent);element=control.getControlContainer();$$.registerControlEvents(control);if(!(control instanceof $Controls.Edit)){$(control.element).removeClass("xdTextBox");$(element).removeClass("xdTextBox")}}return element},createAttributes:function(element,attributes){if(element==null){return}if(attributes==null||!$IU.isArray(attributes)){return}var isTableElement=function(){if(element.nodeName==null){return false}var name=element.nodeName.toLocaleLowerCase();return name==="table"||name==="tbody"||name==="tr"||name==="td"||name==="th"};var filterMinHeight=function(originalStyle){if(originalStyle==null||originalStyle===""){return""}if(originalStyle.toLocaleLowerCase().indexOf("min-height")===-1){return originalStyle}var styles=originalStyle.split(";");var newStyles=[];for(var i=0,len=styles.length;i<len;i++){var style=$IU.trimString(styles[i]);if(style!==""){if(style.toLocaleLowerCase().indexOf("min-height")===-1){newStyles.push(style)}}}return newStyles.join(";")};for(var i=0;i<attributes.length;i++){var attribute=attributes[i];var key=attribute.key;if(null!=attribute.namespace&&""!==attribute.namespace){key=attribute.namespace+":"+key}try{switch(key.toLocaleLowerCase()){case"class":$(element).addClass(attribute.value);break;case"onclick":case"value":break;case"style":if(isTableElement()){var filterStyle=filterMinHeight(attribute.value);if(filterStyle!==""){element.setAttribute(key,filterStyle)}}else{element.setAttribute(key,attribute.value)}break;default:element.setAttribute(key,attribute.value);break}}catch(exception){}}},saveAttributes:function(control,fieldName,path,entity,omitIfExist){var attr=control.getAttributes(),parentValue=control.getParentValue();if(attr!=null||parentValue!=null){if(attr==null){attr={}}if(parentValue!=null){attr._parent=parentValue}}if(attr!=null){this.setEntity($.toJSON(attr),fieldName+"_Attr",path,entity,omitIfExist)}else{if(control.initAttributes!=null){this.setEntity("",fieldName+"_Attr",path,entity,omitIfExist)}}},save:function(entity,detailAdv){if(detailAdv===undefined){detailAdv=false}if(null==this.holder||null==this.entity){return entity}if(null==entity){var fields=this.entity.fields;for(var formField in fields){if(fields.hasOwnProperty(formField)){if(this.data.hasOwnProperty(formField)){delete this.data[formField]}if(this.data.hasOwnProperty(formField+"_Name")){delete this.data[formField+"_Name"]}if(this.data.hasOwnProperty(formField+"_Attr")){delete this.data[formField+"_Attr"]}}}entity=this.data}var $repeatParentElements=$("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT);for(var i=0,len=$repeatParentElements.length;i<len;i++){var repeatControl=$($repeatParentElements[i]).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(repeatControl==null){continue}this.setEntity(repeatControl.keyIndex,repeatControl.groupName,repeatControl.path,entity,false)}var instance=this;$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var $element=$(this);if($element.hasClass($Control.CLASSNAME_ROWINDEX)){return}if($element.hasClass($Control.CLASSNAME_GROUP_COUNT)){return}var path=$element.data($Control.DATA_PATH);var field=$element.data($Control.DATA_FIELD);var control=$element.data($Control.DATA_CONTROL_OBJECT);if(field!=null&&control!=null){var omitIfExist=(detailAdv===true&&!control.isDetailControl())||(detailAdv===false&&control.isDetailControl());var isSave=true;var val=control.getValue(isSave);if(val instanceof $Controls.Data.ValuePair){instance.setEntity(val.value,field,path,entity,omitIfExist);instance.setEntity(val.displayValue,field+"_Name",path,entity,omitIfExist);instance.saveAttributes(control,field,path,entity,omitIfExist)}else{if(val instanceof $Controls.Data.Uri){instance.setEntity(val.value,field,path,entity,omitIfExist)}else{if(val!=null){instance.setEntity(val,field,path,entity,omitIfExist)}}}}});return entity},discard:function(){if(null==this.entity.data){this.entity.data={}}this.data=$.extend(true,{},this.entity.data)},eachLayout:function(callback,layout,category){if(null==layout){var allRenders=[];for(var i=0;i<this.entity.views.length;i++){var view=this.entity.views[i];if(null!=view){var renders=this.eachLayout(callback,view,category);for(var n=0;n<renders.length;n++){allRenders.push(renders[n])}}}return allRenders}var entities=[];if(null==category||category===layout.renderCategory){if(typeof callback==="function"){callback(layout)}entities.push(layout)}var stack=[];var current=layout;while(null!=current){var renderList=current.renders;for(i=0;i<renderList.length;i++){var render=renderList[i];var cate=render.renderCategory;if(null==category||category===render.renderCategory){if(typeof callback==="function"){callback(render)}entities.push(render)}if(cate==="Layoutable"){stack.push(render)}}current=stack.pop()}return entities},onFieldChange:function(event){if($$.params.fieldSyncing===true){return}var control=$(this).data($Control.DATA_SOURCE_CONTROL);if(control===undefined){control=$(this).data($Control.DATA_CONTROL_OBJECT)}if(control!=null){var render=event.data.render;var doFieldChange=function(){if($$.params.fieldChanging!=null&&!control.clickFireFieldChange){return}if(control instanceof InfoPlus.Controls.Suggester2&&control.isOnPagePopup&&control.originSuggester!=null){control=control.originSuggester}var data={};data=render.save(data,control.isDetailControl());control.fieldChangeEvent(data).done(function(){render.doDynamicsAfterFieldChange();$$.fieldChanged($$(control));$$(control).fieldChanged()}).fail(function(data){if(data.errCode==="EVENT_CANCELLED"){render.doDynamicsAfterFieldChange()}}).always(function(){if(control instanceof $Controls.Button||control instanceof $Controls.LinkButton||control instanceof $Controls.CheckButton){$(control.element).removeAttr("disabled")}})};if(control.onFieldSync){control.fieldSyncEvent()}if(control.onFieldRefer){$$.dynamics.cache.build();control.fieldReferEvent(render,true,true,true,true,true);$$.fieldRefered($$(control));$$(control).fieldRefered()}if(control.onFieldChange&&($$.params.fieldChanging==null||control.clickFireFieldChange)){if(control.onFieldRefer){setTimeout(doFieldChange,200)}else{doFieldChange()}}}},onFieldFocus:function(){var control=$(this).data($Control.DATA_SOURCE_CONTROL);if(control==null){control=$(this).data($Control.DATA_CONTROL_OBJECT)}if(control==null){control=$($(this).data($Control.DATA_ORIGIN_INPUT)).data($Control.DATA_CONTROL_OBJECT)}if(control!=null){control.showTooltip()}}};define("InfoPlus.FormRender",formRender)})(window);
(function(window,undefined){var remarkRender=function(options){this.progress=options.progress;this.stepId=options.stepId;this.instanceId=options.instanceId;this.userId=options.userId;this.readOnly=options.readOnly;this.administrable=options.administrable;this.subEntryId=options.subEntryId;this.slide=options.slide};var HIDDEN_TEXT="[Hidden]";var PUBLIC="PUBLIC";var getPopTipPlacement=function(popper){var placement="top-left";if($$.MOBILE){if($(popper).offset().left>($(window).width()/2)){placement="top-right"}}return placement};var createPopTip=function(popper,text){return new InfoPlus.Render.PopTip({popper:popper,container:$$.params.renderContainer[0],text:text,colorClass:"remarkTip",placement:getPopTipPlacement(popper),effect:"bounce",onClick:function(){return false},onClose:$IU.refreshReviewByForm})};var moveToTip=function(popper,poppers){var getTotalOffsetTop=function(obj){var top=0;if(obj.offsetParent){do{top+=obj.offsetTop;obj=obj.offsetParent}while(obj)}return top};if($(popper).data("popTip")!=null){var top=parseInt($($(popper).data("popTip").element).css("top"),10);$IU.scrollTo(top>60?top-60:0,500);setTimeout(function(){$($(popper).data("popTip").element).effect("bounce",{},150)},500)}else{top=getTotalOffsetTop(popper);var tip=createPopTip(popper,$(popper).data("remark"));createPopMenu(poppers,tip);$IU.scrollTo(top>100?top-100:0,500)}return false};var getMenuItems=function(poppers){return function(){var element=this.element;var findVisiblePoppers=function(){var visiblePoppers=[];for(var j=0;j<poppers.length;j++){var p=poppers[j];if($(p).is(":visible")){visiblePoppers.push(p)}}return visiblePoppers};var getThisPopperIndex=function(){var thisTipControl=$(element).parent().data("tipControl");for(var j=0;j<visiblePoppers.length;j++){var p=visiblePoppers[j];if(p===thisTipControl.options.popper){return j}}return -1};var visiblePoppers=findVisiblePoppers();visiblePoppers.sort(function(a,b){var offsetA=$(a).offset(),offsetB=$(b).offset();if(offsetA.top===offsetB){return offsetA.left-offsetB.left}else{return offsetA.top-offsetB.top}});var thisPopperIndex=getThisPopperIndex(visiblePoppers);var hasPrev=thisPopperIndex!==-1&&thisPopperIndex>0,hasNext=thisPopperIndex!==-1&&thisPopperIndex<visiblePoppers.length-1;var items=[];if(hasPrev){items.push({id:"prev",text:$$.lt("remarkHistory.review.previous"),iconClass:"i-icon-triangle-left",click:function(){return moveToTip(visiblePoppers[thisPopperIndex-1],visiblePoppers)}})}if(hasNext){items.push({id:"next",text:$$.lt("remarkHistory.review.next"),iconClass:"i-icon-triangle-right",click:function(){return moveToTip(visiblePoppers[thisPopperIndex+1],visiblePoppers)}})}items.push({id:"close",text:$$.lt("remarkHistory.review.close"),iconClass:"i-icon-cross",click:function(){var tipControl=$(element).parent().data("tipControl");tipControl.close();return false}});return items}};var createPopMenu=function(poppers,tip){new InfoPlus.Render.PopMenu({container:tip.element,items:getMenuItems(poppers)})};remarkRender.prototype={progress:null,stepId:null,instanceId:null,prefix:"infoplus_remark_"+Math.round(Math.random()*9000+1000)+"_",sortSteps:function(){var doneSteps=[],undoSteps=[],thisUndoStep,allSteps=this.progress.remarks,activities=this.progress.activities,status=this.progress.status,administrable=this.administrable,thisStepId=this.stepId;var insertStepToArray=function(stepArray,insertStep,isDone){var arrayLength=stepArray.length;for(var n=0;n<arrayLength;n++){if(isDone){if(stepArray[n].actionTime>insertStep.actionTime){break}}else{if(stepArray[n].assignTime>insertStep.assignTime){break}}}stepArray.splice(n,0,insertStep)};var mergeActivities=function(){if(administrable||$$.params.adminView){for(var i=0,len=activities.length;i<len;i++){var activity=activities[i];allSteps.push({actionTime:activity.timestamp,trueName:activity.user!=null?activity.user.name:$$.lt("remarkHistory.user.system"),userName:activity.user!=null?activity.user.id:"",activityType:activity.tags,remark:activity.description})}}else{if(status==="killed"){for(i=activities.length-1;i>=0;i--){activity=activities[i];if(activity.tags==="INSTANCE_KILL"){allSteps.push({actionTime:activity.timestamp,trueName:activity.user!=null?activity.user.name:$$.lt("remarkHistory.user.system"),userName:activity.user!=null?activity.user.id:"",activityType:activity.tags,remark:activity.description});break}}}}};var sortAllSteps=function(){for(var i=0,len=allSteps.length;i<len;i++){var step=allSteps[i];if(step.actionTime!==undefined){if(!administrable&&step.withdrawTo!=null){continue}insertStepToArray(doneSteps,step,true)}else{if(step.formStepId===thisStepId){thisUndoStep=step}else{insertStepToArray(undoSteps,step,false)}}}};var markPreviousDoneStep=function(){if($$.params.snapshot!==true&&!this.readOnly){if(thisUndoStep!==undefined&&thisUndoStep.prevStepId!==undefined){for(var i=doneSteps.length-1;i>=0;i--){var doneStep=doneSteps[i];if(doneStep.formStepId===thisUndoStep.prevStepId){doneStep.isPreviousDone=true;break}}}}};mergeActivities();sortAllSteps();markPreviousDoneStep();if(this.progress.status==="doing"){var steps=doneSteps.concat(undoSteps);if(thisUndoStep!==undefined){steps.push(thisUndoStep)}return steps}else{return doneSteps}},showReviews:function(step){var count=0;if(step.review==null){return count}var review;try{review=$.parseJSON(step.review)}catch(e){}if(review!=null&&review.remarks!=null&&$IU.isArray(review.remarks)){var poppers=[];for(var i=0,len=review.remarks.length;i<len;i++){var formRemark=review.remarks[i];if(formRemark.remark==null||formRemark.remark===""){continue}var $$control=$$("&"+formRemark.field).filter({path:formRemark.path});if($$control.length>0){var control=$$control[0].control;if($$.MOBILE){var $viewOuterWrap=$(control.element).parents(".infoplus_view_wrap_outer");if($viewOuterWrap.hasClass("unexpanded")){var viewLabel=$viewOuterWrap.children(".infoplus_view_label").data("label");if(viewLabel!=null){viewLabel.expand(false)}}}if((control.controlContainer!=null&&$(control.controlContainer).is(":visible"))||$(control.element).is(":visible")){count++;var popper=control.controlContainer||control.element;poppers.push(popper);createPopTip(popper,formRemark.remark)}}}for(i=0,len=poppers.length;i<len;i++){createPopMenu(poppers,$(poppers[i]).data("popTip"))}}return count},showPreviousStepRemark:function(step){var instance=this;var contentDiv=document.createElement("div"),$contentDiv=$(contentDiv),userDiv=document.createElement("div"),$userDiv=$(userDiv),remarkDiv=document.createElement("div"),$remarkDiv=$(remarkDiv),timeDiv=document.createElement("div"),$timeDiv=$(timeDiv);$userDiv.addClass("done_remark_user").text(step.trueName===HIDDEN_TEXT?$$.lt("remarkHistory.user.related"):step.trueName);$remarkDiv.html($IU.htmlEncode(step.remark===HIDDEN_TEXT?$$.lt("remarkHistory.hideRemark"):step.remark)).addClass("done_remark_content");$timeDiv.text($IU.unixTimeToString(step.actionTime)).addClass("done_remark_time");$contentDiv.append(userDiv).append(remarkDiv);if(step.review!=null){var remarkCount=this.showReviews(step);if(remarkCount>0){var reviewDiv=document.createElement("div"),$reviewDiv=$(reviewDiv),reviewLink=document.createElement("a"),$reviewLink=$(reviewLink);$reviewLink.attr("href","#").text($$.lt("remarkHistory.showReview",remarkCount,remarkCount>1?"s":""));$reviewDiv.append(reviewLink).addClass("done_remark_review");$contentDiv.append(reviewDiv);$reviewLink.click(function(){InfoPlus.Render.PopTip.clear(true);instance.showReviews(step);var minTop=null;$(".popTip.remarkTip").each(function(){var tipControl=$(this).data("tipControl");if(tipControl!=null){var top=$(tipControl.options.popper).offset().top;minTop=(minTop==null)?top:(top<minTop?top:minTop)}});if(minTop!=null){$IU.scrollTo(minTop>100?minTop-100:0,500)}return false})}}$contentDiv.append(timeDiv);new InfoPlus.Tip({content:contentDiv,position:"right",width:"310"})},createHistoryList:function(steps,$remarkItemSub){var instance=this;var addStepItemClass=function(item,step,isFirst,isLast){var $item=$(item);$item.addClass("remark_item");switch(step.activityType){case"INSTANCE_ADMIN":$item.addClass("remark_admin");instance.showAdminButton=true;break;case"INSTANCE_WITHDRAW":$item.addClass("remark_withdraw");instance.showAdminButton=true;break;case"INSTANCE_KILL":$item.addClass("remark_kill");if(isFirst){$item.addClass("firstStep")}else{instance.showAdminButton=true}break;default:if(step.withdrawTo!=null){$item.addClass("remark_withdrawn");instance.showAdminButton=true}else{$item.css("display","block")}break}if(isLast){$item.css("border-bottom","none")}};var createHideHistoryStepDiv=function(hideHistoryCount,lastVisibleMore){var div=document.createElement("div"),innerDiv=document.createElement("div"),span=document.createElement("span");$(innerDiv).css("height","0px");$(span).addClass("moreHistory").html("<i class='i-icon-angle-double-down'></i> "+$$.lt("remarkHistory.showHide",hideHistoryCount)).attr("title","");if(lastVisibleMore){$(div).addClass("lastMore")}$(div).click(function(){$(this).hide();$(this).nextAll().not(".remark_admin,.remark_withdraw,.remark_withdrawn,.remark_kill").filter("li:lt("+$(this).data("hideHistoryCount")+")").show("slide",{direction:"up"},"slow",function(){$$.params.holder.remark.css("height","100%")});$(this).prev("li").css("border-bottom","")});innerDiv.appendChild(span);div.appendChild(innerDiv);$(div).data("hideHistoryCount",hideHistoryCount);return div};var findLastVisibleStep=function(historyStep,historyList){var filterVisibleNormal=function(){return $(this).css("display")!=="none"&&(!$(this).hasClass("remark_admin")&&!$(this).hasClass("remark_withdraw")&&!$(this).hasClass("remark_withdrawn")&&(!$(this).hasClass("remark_kill")||$(this).hasClass("firstStep")))};var filterVisible=function(){return $(this).css("display")!=="none"};if(historyStep!=null){var $lastVisibleStep=$(historyStep).prevAll().filter(filterVisibleNormal);if($lastVisibleStep.length===0){$lastVisibleStep=$(historyStep).prevAll().filter(filterVisible)}return $lastVisibleStep.first()}else{return $(historyList).children("li").filter(filterVisibleNormal).last()}};var getSnapshotUrl=function(step){return $$.params.baseUrl+"form/"+step.formStepId+"/render?snapshot=true"};var getSnapshotLink=function(step){return"<a target='_blank' title='"+$$.lt("remarkHistory.snapshotTitle")+"' href='"+getSnapshotUrl(step)+"'>"+(step.stepName||"")+"</a>"};var getStepLink=function(stepName){return"<a target='_blank' href='"+$$.params.baseUrl+"form/"+step.formStepId+"/render?entrust=true'>"+stepName+"</a>"};var getUserName=function(step,isCurrent,isSubWorkflow){if(isSubWorkflow===true){return $$.lt("remarkHistory.user.related")}var getName=function(){if(step.userVisibility===PUBLIC){return"<a class='relatedUser' stepId='"+step.formStepId+"'>"+$$.lt("remarkHistory.user.related")+"</a>"}else{return $$.lt("remarkHistory.user.related")}};var userName=step.trueName||step.userName||"",hideUser=(userName===HIDDEN_TEXT);if(hideUser){userName=$$.lt("remarkHistory.user.related")}else{if(userName===""){if(!instance.readOnly){userName=isCurrent?$$.lt("remarkHistory.user.you"):getName()}else{userName=getName()}}else{if(step.userName===instance.userId){userName=$$.lt("remarkHistory.user.you")+"("+userName+")"}}}if(($$.params.adminView===true||instance.userId===step.userName||instance.userId===step.entrusteeId)&&step.entrusteeName!=null){userName+="("+(step.entrusted===true?($$.lt("remarkHistory.entrust")+(hideUser?$$.lt("remarkHistory.user.related"):step.entrusteeName)):(step.entrusteeName+$$.lt("remarkHistory.debug")))+")"}return userName};var getStepName=function(step){return step.actionTime!=null?getSnapshotLink(step):($$.params.entrust==="true"?getStepLink(step.stepName||""):(step.stepName||""))};var getActionDescription=function(status,activityType,isSelf,isSubWorkflow){var actionDescription;if(activityType==null){switch(status){case InfoPlus.Settings.STEP_STATE_TODO:case InfoPlus.Settings.STEP_STATE_DRAFT:actionDescription=isSelf?$$.lt("remarkHistory.action.youDoing"):$$.lt("remarkHistory.action.doing");break;case InfoPlus.Settings.STEP_STATE_SUB:actionDescription=$$.lt("remarkHistory.action.sub");break;default:if(isSubWorkflow===true){actionDescription=$$.lt("remarkHistory.action.doneSub")}else{actionDescription=$$.lt("remarkHistory.action.done")}}}else{switch(activityType){case"INSTANCE_ADMIN":actionDescription=$$.lt("remarkHistory.action.admin");break;case"INSTANCE_KILL":actionDescription=$$.lt("remarkHistory.action.kill");break;case"INSTANCE_WITHDRAW":actionDescription=$$.lt("remarkHistory.action.withdraw");break;default:actionDescription=$$.lt("remarkHistory.action.done2")}}return actionDescription};var getReviewCount=function(step){var count=0;if(step.review==null){return count}var review;try{review=$.parseJSON(step.review)}catch(e){}if(review!=null&&review.remarks!=null&&$IU.isArray(review.remarks)){for(var i=0,len=review.remarks.length;i<len;i++){var formRemark=review.remarks[i];if(formRemark.remark==null||formRemark.remark===""){continue}count++}}return count};var createItemRemark=function(item,step){var divContent=document.createElement("div");$(divContent).addClass("form_remark_content");if(step.activityType!=null){$(divContent).addClass("activity")}var remarkContent=(step.remark===HIDDEN_TEXT?$$.lt("remarkHistory.hideRemark"):(step.remark||""));var remarkHtml=$IU.htmlEncode(remarkContent);$(divContent).html(remarkHtml);item.appendChild(divContent)};var createItemReviewOrCc=function(item,step){var containerDiv=document.createElement("div"),$containerDiv=$(containerDiv);$containerDiv.addClass("form_remark_review_cc");item.appendChild(containerDiv);if(hasReview){var reviewLink=document.createElement("a"),count=getReviewCount(step);$(reviewLink).attr("href",getSnapshotUrl(step)).attr("target","_blank").attr("title",$$.lt("remarkHistory.viewReviews")).text($$.lt("remarkHistory.viewReviewLink",count,count>1?"s":""));$containerDiv.append(reviewLink)}if(hasCc){var ccLink=document.createElement("a");count=step.ccUsers.length;$(ccLink).attr("href","#").addClass("ccUser").data("stepId",step.formStepId).attr("title",$$.lt("remarkHistory.viewCcs")).text($$.lt("remarkHistory.viewCcLink",count)).click(function(){if(!$ccUserDiv.is(":visible")){$ccUserDiv.show("slide",{direction:"up"},"slow");$(this).text($$.lt("remarkHistory.searchCc")).append("<i class='i-icon-search'/>")}else{var link=this,stepId=$(this).data("stepId");if(stepId!=null){var csrfToken=$(document).find("meta[itemscope=csrfToken]").attr("content");var requestData="{reviewers(stepId:"+stepId+",keyword:?){id,name,account,userName,email}}";var candidates=new InfoPlus.Render.Candidates({popper:link,requestUrl:$$.params.graphqlUrl+"?csrfToken="+csrfToken,requestData:requestData,dataEntityName:"reviewers"})}}return false});$containerDiv.append(ccLink);var ccUserDiv=document.createElement("div"),$ccUserDiv=$(ccUserDiv);$ccUserDiv.addClass("form_remark_ccUser_div");for(var i=0,len=step.ccUsers.length;i<len;i++){var ccUser=step.ccUsers[i],userSpan=document.createElement("span"),$userSpan=$(userSpan);$userSpan.text(ccUser.trueName).attr("title",ccUser.trueName+"("+ccUser.tenantUserId+")");$ccUserDiv.append(userSpan)}$containerDiv.append(ccUserDiv)}};var hideItem=function(historyList,item,step,hasRemark,hasReview){var showPrevHideItem=function($item){var $prevs=$item.prevAll();for(var i=0,len=$prevs.length;i<len;i++){if($($prevs[i]).data("hide")===true){$($prevs[i]).show();break}}};var $item=$(item);if(!hasRemark&&!hasReview){if(!step.isPreviousDone&&step.activityType==null&&step.withdrawTo==null&&!isFirst){$item.css("display","none").data("hide",true);hideCount++}}if(hideCount>0){if((hasRemark||hasReview||step.isPreviousDone)&&!(step.activityType==="INSTANCE_ADMIN"||step.activityType==="INSTANCE_WITHDRAW"||step.activityType==="INSTANCE_KILL"||step.withdrawTo!=null)){if(hideCount!==1){findLastVisibleStep(item,historyList).after(createHideHistoryStepDiv(hideCount,false))}else{showPrevHideItem($item)}hideCount=0}else{if(isLast){if(hideCount!==1){findLastVisibleStep(item,historyList).after(createHideHistoryStepDiv(hideCount,true))}else{if($item.data("hide")===true){$item.show()}else{showPrevHideItem($item)}}hideCount=0}}}};var createHistoryTitleDiv=function(item,step,isCurrent){var divTitle=document.createElement("div");$(divTitle).addClass("form_remark_title");var isSubWorkflow=(step.sub!==undefined||step.subEntry!==undefined),stepName=getStepName(step),userName=getUserName(step,isCurrent,isSubWorkflow),actionDescription=getActionDescription(step.status,step.activityType,isCurrent,isSubWorkflow);if(step.thing==null){if(step.activityType!=null){divTitle.innerHTML="<span class='color_b4'><b>"+userName+"</b>   "+actionDescription+"</span>"}else{var actionName=(step.actionName!=null&&step.actionName!="")?"(<span class='color_b3'><b>"+step.actionName+"</b></span>)":"";divTitle.innerHTML="<span class='color_b2' style='"+(step.withdrawTo!=null?"text-decoration:line-through":"")+"'><span class='"+(isCurrent?"color_o1":"")+"'>"+(isSubWorkflow?"":"<b>"+userName+"</b></span>   "+actionDescription)+"<b>"+stepName+"</b>"+actionName+"</span>"}}else{if(step.activitytype!=null){divTitle.innerHTML="<span class='color_b4'><b>"+userName+"</b>   "+actionDescription+"</span>"}else{stepName=step.stepName!=null?"(<span><b>"+stepName+"</b></span>)":"";if(step.actionName!=null){divTitle.innerHTML="<span class='color_b2' style='"+(step.withdrawTo!=null?"text-decoration:line-through":"")+"'><span class='"+(isCurrent?"color_o1":"")+"'><b>"+userName+"</b></span>   <span class='color_b4' style='font-weight:bold'>"+step.actionName+"</span> "+step.thing.thingName+" "+stepName+"</span>"}else{divTitle.innerHTML="<span class='color_b2'><span class='"+(isCurrent?"color_o1":"")+"'><b>"+userName+"</b></span>   <span class='color_b4' style='font-weight:bold'>"+$$.lt("remarkHistory.action.receiving")+"</span> "+step.thing.thingName+" "+stepName+"</span>"}}var iconSpan=document.createElement("span");var icon=document.createElement("i");$(icon).addClass("i-icon-truck");$(iconSpan).append(icon).css("margin-right","6px").addClass("color_b4");$(divTitle).addClass("thing").prepend(iconSpan)}if(!isCurrent){var dateFormat="yyyy/MM/dd hh:mm";var spanTime=document.createElement("span");$(spanTime).addClass("form_remark_time");if(step.assignTime!=null){var dateAttachment=new Date(step.assignTime*1000);var divTimeTitle=$$.lt("remarkHistory.createTime")+":"+$IU.dateFormat(dateAttachment,dateFormat)}else{divTimeTitle=""}if(step.actionTime!=null){var dateAction=new Date(step.actionTime*1000);divTimeTitle+=("  "+$$.lt("remarkHistory.actionTime")+":"+$IU.dateFormat(dateAction,dateFormat))}else{$(spanTime).addClass("form_remark_todo")}var dateDisplay=null==step.actionTime?step.assignTime:step.actionTime;spanTime.innerHTML=$IU.dateFormat(new Date(dateDisplay*1000),dateFormat);spanTime.title=divTimeTitle;var now=(new Date()).getTime();if((now-dateDisplay*1000)<1000*3600*12){$(spanTime).attr("datetime",$IU.getDateIsoString(new Date(dateDisplay*1000))).addClass("remark_display_time").data("originDisplayTime",$IU.dateFormat(new Date(dateDisplay*1000),dateFormat)).click(function(){this.innerHTML=$(this).data("originDisplayTime")})}if(step.status===InfoPlus.Settings.STEP_STATE_TODO&&step.renderTime!=null){var readSpan=document.createElement("span");$(readSpan).addClass("form_remark_read round-corner").text($$.lt("remarkHistory.read"));var containerSpan=document.createElement("span");$(containerSpan).append(spanTime).append(readSpan).css("float","right");divTitle.appendChild(containerSpan)}else{divTitle.appendChild(spanTime)}}item.appendChild(divTitle);return divTitle};var createSubEntryHistoryTitleDiv=function($remarkItemSub,subEntryId){if(subEntryId==null){return}var titleDiv=document.createElement("div");$(titleDiv).text($$.lt("remarkHistory.subHistory.title",subEntryId)).addClass("sub_entry_title");if($remarkItemSub&&$remarkItemSub.size()>0){var $formRemarkTitle=$remarkItemSub.children(".form_remark_title");$formRemarkTitle.find(".show_sub_workflow").remove();$formRemarkTitle.append($(titleDiv))}};var createSubHistory=function(item,step){if(step.sub===undefined&&step.subEntry===undefined){return}$(item).addClass("remark_item_sub");var subProgress=step.sub||{entry:step.subEntry};var divSubHistory=document.createElement("div");$(divSubHistory).addClass("form_remark_sub");item.appendChild(divSubHistory);if(subProgress.remarks!=null&&subProgress.remarks.length>0){var subRemarkRender=new InfoPlus.RemarkRender({subEntryId:subProgress.entry,stepId:instance.stepId,progress:subProgress,userId:instance.userId,readOnly:$$.params.readOnly,administrable:$$.params.administrable});subRemarkRender.draw(divSubHistory,$(item))}else{if(subProgress.entry==null){return}var showSubLink=document.createElement("a");$(showSubLink).attr("href","#").addClass("show_sub_workflow").text($$.lt("remarkHistory.subHistory.link")).click(function(){$$.loadHistory({entryId:subProgress.entry,stepId:$$.params.formStepId,includingTop:false}).done(function(data){var progress=data.entities[0];var subRemarkRender=new InfoPlus.RemarkRender({subEntryId:progress.entry,stepId:instance.stepId,progress:progress,userId:instance.userId,readOnly:$$.params.readOnly,administrable:$$.params.administrable,slide:true});subRemarkRender.draw(divSubHistory,$(item))});return false});var $formRemarkTitle=$(item).find(".form_remark_title");if($formRemarkTitle.size()>0){$formRemarkTitle.append(showSubLink)}}};this.showAdminButton=false;var historyList=document.createElement("ul");if($remarkItemSub&&$remarkItemSub.size()>0){createSubEntryHistoryTitleDiv($remarkItemSub,this.subEntryId)}var hideCount=0;for(var i=steps.length-1;i>=0;i--){var step=steps[i],isCurrent=this.readOnly?false:(this.stepId===step.formStepId),isLast=(i===0),isFirst=(i===steps.length-1),hasRemark=!$IU.isEmptyStr(step.remark),hasReview=(step.status!==InfoPlus.Settings.STEP_STATE_TODO)&&(!$IU.isEmptyStr(step.review)),hasCc=(step.ccUsers!==undefined&&$IU.isArray(step.ccUsers)&&step.ccUsers.length>0);if($$.params.snapshot===true&&step.formStepId===$$.params.formStepId){this.currentSnapshotStep=step}var item=document.createElement("li");addStepItemClass(item,step,isFirst,isLast);createHistoryTitleDiv(item,step,isCurrent);if(hasRemark){createItemRemark(item,step)}if(hasReview||hasCc){createItemReviewOrCc(item,step)}createSubHistory(item,step);historyList.appendChild(item);hideItem(historyList,item,step,hasRemark,hasReview)}findLastVisibleStep(null,historyList).css("border-bottom","none");if($$.params.adminView){$(historyList).children(".remark_admin,.remark_withdraw,.remark_withdrawn,.remark_kill").addClass("show")}return historyList},draw:function(holder,$remarkItemSub){var instance=this;var $remarkHolder=(holder==null?$$.params.holder.remark:$(holder));if($remarkHolder.length===0||this.progress==null){return}$remarkHolder.hide().empty();var createAdminLink=function(historyList){if(instance.showAdminButton&&instance.administrable){var showAdminLi=document.createElement("li"),showAdminLink=document.createElement("a"),$showAdminLink=$(showAdminLink);$showAdminLink.attr("href","#");if($remarkHolder.find(".ccUser").length>0){$showAdminLink.text($$.lt("remarkHistory.showAdminOrCc"))}else{$showAdminLink.text($$.lt("remarkHistory.showAdmin"))}$(showAdminLi).addClass("remark_show_admin").append(showAdminLink).css("border-bottom","none");historyList.appendChild(showAdminLi);$(showAdminLink).click(function(){var $showLiItems=$(this).parent().siblings(".remark_admin,.remark_withdraw,.remark_withdrawn,.remark_kill");$showLiItems.addClass("show");$(this).parent().hide();$remarkHolder.children("ul").children("li").not(".remark_show_admin").not(":last").css("border-bottom","");$remarkHolder.find("ul li:visible:last").css("border-bottom","none");$IU.scrollTo($showLiItems.first().offset().top-40,500);$(".ccUser").each(function(){var $ccUserDiv=$(this).siblings(".form_remark_ccUser_div");if(!$ccUserDiv.is(":visible")){$ccUserDiv.show("slide",{direction:"up"},"slow");$(this).text($$.lt("remarkHistory.searchCc")).append("<i class='i-icon-search'/>")}});return false})}};var initDisplayTime=function(){$("span.remark_display_time").timeago({selector:"span.remark_display_time"})};var showPreviousDoneStepHintWindow=function(steps){if($$.params.snapshot!==true&&!instance.readOnly){for(var i=steps.length-1;i>=0;i--){if(steps[i].isPreviousDone){var prevStep=steps[i];break}}if(prevStep!=null&&(!$IU.isEmptyStr(prevStep.remark)||!$IU.isEmptyStr(prevStep.review))){$$.visible(function(){instance.showPreviousStepRemark(prevStep)})}}};var showSnapshotStepReviews=function(){if($$.params.snapshot===true&&instance.currentSnapshotStep!=null&&instance.currentSnapshotStep.review!=null){$$.visible(function(){instance.showReviews(instance.currentSnapshotStep)})}};var registerRelatedUserEvents=function(){$(historyList).find(".relatedUser").click(function(){var link=this,stepId=$(this).attr("stepId");if(stepId!=null){var csrfToken=$(document).find("meta[itemscope=csrfToken]").attr("content");var requestData="{candidates(stepId:"+stepId+",keyword:?){id,name,account,userName,email}}";var candidates=new InfoPlus.Render.Candidates({popper:link,requestUrl:$$.params.graphqlUrl+"?csrfToken="+csrfToken,requestData:requestData,dataEntityName:"candidates"})}})};var showHistory=function(){if($remarkHolder.children("ul").children().length>0){if(instance.slide===true){$remarkHolder.show("slide",{direction:"up"},"slow")}else{$remarkHolder.show()}}};var steps=this.sortSteps();var historyList=this.createHistoryList(steps,$remarkItemSub);$remarkHolder.append(historyList);createAdminLink(historyList);initDisplayTime();showPreviousDoneStepHintWindow(steps);showSnapshotStepReviews();registerRelatedUserEvents();showHistory()}};remarkRender.processSubProgress=function(progress){var findRemark=function(ancestorProgress,subProgress){var found=false;if(!$IU.isArray(ancestorProgress.remarks)){return false}for(var i=0,len=ancestorProgress.remarks.length;i<len;i++){var remark=ancestorProgress.remarks[i];if(remark.subEntry!==undefined){if(remark.subEntry===subProgress.entry){remark.sub=subProgress;found=true}else{remark.sub={entry:remark.subEntry}}}}return found};var ancestors=progress.ancestors;if(progress.entryTop!==undefined&&$IU.isArray(ancestors)){if(ancestors.length>0&&ancestors[0].entry===progress.entryTop){var currentProgress=progress;for(var i=ancestors.length-1;i>=0;i--){var ancestorProgress=ancestors[i];if(!findRemark(ancestorProgress,currentProgress)){return}currentProgress=ancestorProgress}return ancestors[0]}}};define("InfoPlus.RemarkRender",remarkRender)})(window);
(function(window,undefined){var milestoneRender=function(config){this.milestones=config.milestones;this.status=config.status;this.milestoneHolder=$("#form_milestone_holder")[0]};milestoneRender.prototype={milestoneHolder:null,status:null,drawMilestone:function(){var $holder=$(this.milestoneHolder),$holderInner=$holder.find(".form_milestone_holder_wrap_inner"),$viewer=$holderInner.children(".form_milestone_view");if(this.milestones==null||this.milestones.length===0){$holder.remove();return}if(this.milestoneHolder==null){return}var workflowDone=(this.status==="done");var getColorClass=function(done,current){var color="gray";if(done===true||(current===true&&workflowDone)){color="green"}else{if(current===true){color="blue"}}return color};$holder.hide();$viewer.empty();var milestones=this.milestones;for(var i=0,len=milestones.length,lastColor="";i<len;i++){var milestone=milestones[i];var stepLi=document.createElement("li"),$stepLi=$(stepLi);var color=getColorClass(milestone.done,milestone.current);$stepLi.addClass("form_milestone_step").addClass(color);if(i===0){$stepLi.addClass("first")}if(i===(len-1)){$stepLi.addClass("last")}var floater=document.createElement("div"),$floater=$(floater);$floater.addClass("floater").addClass(color);var contentWrap=document.createElement("div"),$contentWrap=$(contentWrap);$contentWrap.addClass("content");var content=document.createElement("div");$(content).text(milestone.name);$(content).addClass("content_name");$contentWrap.append(content);var tip=document.createElement("div");$(tip).addClass("milestone_tip").addClass("round-corner").addClass("z-depth-1");if(milestone.current===true&&!workflowDone){$floater.addClass("singleLine");$(tip).text($$.lt("milestone.doing")).addClass("singleLine")}else{if(milestone.done===true||(milestone.current===true&&workflowDone)){if(milestone.actionTime!==undefined){$floater.addClass("doubleLine");var time=document.createElement("div");$(time).attr("datetime",$IU.getDateIsoString($IU.unixTimeToLocalTime(milestone.actionTime))).addClass("content_time");$contentWrap.append(time);$(tip).text($$.lt("milestone.doAt",$IU.unixTimeToLocalTimeString(milestone.actionTime)))}else{$floater.addClass("singleLine");$(tip).text($$.lt("milestone.done")).addClass("singleLine")}}else{$floater.addClass("singleLine");$(tip).text($$.lt("milestone.todo")).addClass("singleLine")}}if(!$$.MOBILE){$contentWrap.append(tip)}if(i>0){var arrowLi=document.createElement("li");$(arrowLi).addClass("form_milestone_step_arrow_li").addClass(color);var arrow=document.createElement("div");$(arrow).addClass("form_milestone_step_arrow").addClass(lastColor);var arrowWhite=document.createElement("div");$(arrowWhite).addClass("form_milestone_step_arrow").addClass("white");var arrowWrapDiv=document.createElement("div");$(arrowWrapDiv).addClass("form_milestone_step_arrow_wrap").append(arrow).append(arrowWhite);$(arrowLi).append(arrowWrapDiv);$viewer.append(arrowLi)}$stepLi.append($floater).append($contentWrap);$viewer.append(stepLi);lastColor=color}if($$.visibility.milestone){$holder.show()}$("div.content_time").timeago({selector:"div.content_time"});if($$.MOBILE){$holderInner.find(".clear").css("height","10px");$holder.addClass("round-corner")}var instance=this;if($$.visibility.milestone){$$.visible(function(){instance.adjustMilestoneWidth(true);$holder.find(".form_milestone_step .milestone_tip").each(function(){var $tip=$(this),$parent=$tip.parent();$tip.css("left",($parent.outerWidth()-$tip.outerWidth())/2+"px")})});$holder.css("visibility","visible")}},adjustMilestoneWidth:function(isInit){if(!$$.visibility.milestone){return}var instance=this,$holder=$(this.milestoneHolder),$holderInner=$holder.find(".form_milestone_holder_wrap_inner"),$viewer=$holderInner.children(".form_milestone_view"),$holderOuter=$holder.find(".form_milestone_holder_wrap_outer"),formWidth=$("#form_holder").outerWidth(),clientWidth=$("#div_render_container").outerWidth(),$steps=$holderInner.find(".form_milestone_step");if($holder.length===0){return}if($holder.data("originalTotalWidth")==null){var stepWidth=[],paddingArray=[],totalBarWidth=0;$steps.each(function(){var $stepLi=$(this);stepWidth.push($stepLi.width());paddingArray.push(parseInt($stepLi.css("padding-left"),10)+parseInt($stepLi.css("padding-right"),10));var outerWidth=$stepLi.outerWidth();$stepLi.data("originalWidth",outerWidth);totalBarWidth+=outerWidth});var $arrows=$holderInner.find(".form_milestone_step_arrow_li"),arrowWidth=0;$arrows.each(function(){arrowWidth+=($(this).outerWidth()||$(this).children().outerWidth())});totalBarWidth+=arrowWidth;$holder.data("stepWidthArray",stepWidth);$holder.data("stepPaddingArray",paddingArray);$holder.data("originalTotalWidth",totalBarWidth);$holder.data("arrowTotalWidth",arrowWidth)}else{totalBarWidth=$holder.data("originalTotalWidth")}if(!$$.MOBILE){if(isInit===true){if(totalBarWidth<formWidth){var adjustToWidth=formWidth}else{if(totalBarWidth>clientWidth){adjustToWidth=formWidth>clientWidth?formWidth:clientWidth-5}else{adjustToWidth=totalBarWidth}}if(adjustToWidth!==totalBarWidth){var newWidthArray=this.adjustWidth($holder,adjustToWidth);for(var index=0,l=$steps.length;index<l;index++){$($steps[index]).width(newWidthArray[index])}$holderInner.width(adjustToWidth)}}else{if(totalBarWidth>formWidth){if(totalBarWidth>clientWidth){adjustToWidth=formWidth>clientWidth?formWidth:clientWidth-5;newWidthArray=this.adjustWidth($holder,adjustToWidth);for(index=0,l=$steps.length;index<l;index++){$($steps[index]).width(newWidthArray[index])}$holderInner.width(adjustToWidth)}else{for(index=0,l=$steps.length;index<l;index++){$($steps[index]).css("width","")}$holderInner.css("width","")}}}}else{if(totalBarWidth<=clientWidth){adjustToWidth=clientWidth;newWidthArray=this.adjustWidth($holder,adjustToWidth);for(index=0,l=$steps.length;index<l;index++){$($steps[index]).width(newWidthArray[index])}$holderOuter.width(clientWidth);$viewer.width(clientWidth);$holder.width(clientWidth)}else{$holderOuter.width(clientWidth);$viewer.width(totalBarWidth+1);$holder.css("width","");$steps.css("width","");var foundGray=false,scrollLeft=0,lastStepWidth=0,totalWidth=0;$steps.each(function(){if(!foundGray&&$(this).hasClass("gray")){scrollLeft=totalWidth-clientWidth/2;scrollLeft-=lastStepWidth/2;foundGray=true}lastStepWidth=$(this).outerWidth();totalWidth+=lastStepWidth;var $prev=$(this).prev();if($prev.hasClass("form_milestone_step_arrow_li")){totalWidth+=$prev.outerWidth()}});if(scrollLeft>0){$holderInner.scrollLeft(scrollLeft)}else{$holderInner.scrollLeft(0)}}}},adjustWidth:function($holder,total){var widths=$holder.data("stepWidthArray").slice(0),paddingArray=$holder.data("stepPaddingArray"),originalTotalWidth=$holder.data("originalTotalWidth"),adjustTotal=0;adjustTotal+=$holder.data("arrowTotalWidth");for(var i=0,len=widths.length;i<len;i++){var padding=paddingArray[i];widths[i]=Math.round((total-originalTotalWidth)/len+padding+widths[i]);adjustTotal+=widths[i]}if(adjustTotal!==total){var deltaAvg=Math.ceil((total-adjustTotal)/widths.length);for(i=0,len=widths.length;i<len;i++){if(total===adjustTotal){break}if((deltaAvg>0&&deltaAvg<(total-adjustTotal))||(deltaAvg<0&&deltaAvg>(total-adjustTotal))){widths[i]+=deltaAvg;adjustTotal+=deltaAvg}else{if(i===0&&deltaAvg===0){var minDelta=total>adjustTotal?1:-1;for(var index=0,length=Math.abs(total-adjustTotal);index<length;index++){widths[index]+=minDelta}adjustTotal=total}else{widths[i]+=(total-adjustTotal);adjustTotal=total}}if((adjustTotal!==total)&&i===(len-1)){widths[i]+=(total-adjustTotal)}}}return widths},processEvent:function(){var instance=this;if(!$$.MOBILE){var $steps=$(".form_milestone_step");$steps.mouseenter(function(){var setWidth=function($step,width){if(width>0){$step.data("widthBeforeReduce",$step.outerWidth());$step.width(width)}};var $current=$(this),$prev=$(this).prevAll(".form_milestone_step").first(),$next=$(this).nextAll(".form_milestone_step").first(),newWidth=$current.data("originalWidth")+1;var expandWidth=newWidth-$current.outerWidth();if(expandWidth>1){if($prev.length>0){if($next.length>0){var prevReduce=Math.ceil(expandWidth/2),nextReduce=expandWidth-prevReduce,newPrevWidth=$prev.outerWidth()-prevReduce,newNextWidth=$next.outerWidth()-nextReduce;setWidth($prev,newPrevWidth);setWidth($next,newNextWidth);setWidth($current,newWidth)}else{setWidth($prev,$prev.outerWidth()-expandWidth);setWidth($current,newWidth)}}else{if($next.length>0){setWidth($next,$next.outerWidth()-expandWidth);setWidth($current,newWidth)}}}});$steps.mouseleave(function(){var setWidth=function($step){if($step.data("widthBeforeReduce")!=null){$step.width($step.data("widthBeforeReduce"));$step.data("widthBeforeReduce",null)}};var $current=$(this),$prev=$(this).prevAll(".form_milestone_step").first(),$next=$(this).nextAll(".form_milestone_step").first();setWidth($prev);setWidth($next);setWidth($current)})}$$.visible(function(){$(window).resize(function(){instance.adjustMilestoneWidth(false)})})},draw:function(){this.drawMilestone();this.processEvent()}};define("InfoPlus.MilestoneRender",milestoneRender)})(window);
(function(window,undefined){var transformer=function(config){this.initializeConfig(config)};transformer.ACTION_TYPE_SAVE=0;transformer.ACTION_TYPE_OPERATE=1;transformer.ACTION_TYPE_UPLOAD=2;transformer.ACTION_TYPE_DELETE_ATTACHMENT=3;transformer.ACTION_TYPE_LOAD=4;transformer.INFOPLUS_SPLITER="|INFOPLUS_SPLITER|";var HIDDEN_TEXT="[Hidden]";var PUBLIC="PUBLIC";var blockUI=function(options){var default_css={border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:0.5,color:"#fff",cursor:"pointer",width:$$.MOBILE?"65%":"45%",top:"40%",left:$$.MOBILE?"17%":"28%",textAlign:"center"};options.css=$.extend({},default_css,options.css||{});$.blockUI(options)};var convertMobileView=function(view,isRepeat){var divRender={renderCategory:"Layoutable",renderType:"LayoutDivision",repeatable:false,renders:[]};var tableRowRender={renderCategory:"Layoutable",renderType:"LayoutTableRow",repeatable:false,renders:[{renderCategory:"Layoutable",renderType:"LayoutTableCell",repeatable:false,renders:[]}]};var tableRender={attributes:[{key:"class",value:"infoplus_auto_view_table"},{key:"style",value:(isRepeat?"width:100%":"width:98%")},{key:"cellspacing",value:"0"}],renderCategory:"Layoutable",renderType:"LayoutTable",repeatable:false,renders:[]};var frameTable=$.extend(true,{},tableRender);var findStyleAttributeIndex=function(attributes){if(attributes==null||!$IU.isArray(attributes)){return -1}for(var i=0,len=attributes.length;i<len;i++){if(attributes[i]["key"]!=null){if(attributes[i]["key"].toLowerCase()==="style"){return i}}}return -1};var findSizeStyle=function(styles){var result={};for(var i=0,len=styles.length;i<len;i++){var styleArray=styles[i].split(":");if(styleArray.length>1){var name=$IU.trimString(styleArray[0]).toLowerCase(),value=$IU.trimString(styleArray[1]).toLowerCase();if(name==="width"&&$IU.endWith(value,"px")){result.width=parseInt(value)}if(name==="height"&&$IU.endWith(value,"px")){result.height=parseInt(value)}}}return result};var isOneHundredPercentControl=function(type){var types=["BoundEdit","BoundTextArea","BoundRichText","BoundDate","BoundTime","BoundCheckList","BoundOptionList","BoundSelect","BoundAnchor","BoundLabel","BoundSuggester","BoundSuggester2","BoundFile","BoundPassword","BoundThing","BoundIFrame"];for(var i=0,len=types.length;i<len;i++){if(types[i]===type){return true}}return false};var replaceWidthStyle=function(styleAttribute){var result="";var styles=styleAttribute.split(";");for(var i=0,len=styles.length;i<len;i++){var style=styles[i].split(":");if(style.length===2&&$IU.trimString(style[0].toLocaleLowerCase())==="width"){result+="width:100%;"}else{result+=styles[i]+";"}}return result};if(view.title!=null){var titleRowRender=$.extend(true,{},tableRowRender),titleDivRender=$.extend(true,{},divRender);titleDivRender.attributes=[{key:"class",value:"title_div"}];titleRowRender.renders[0].renders.push(titleDivRender);titleDivRender.renders.push({renderCategory:"Displayable",renderType:"DisplayText",text:view.title});frameTable.renders.push(titleRowRender)}var index=0,len=view.entities.length,lastRowDivRender=null;while(index<len){var entity=view.entities[index];if(entity.field!=null){var controlRender=entity.render;if(isOneHundredPercentControl(controlRender.renderType)){if(controlRender.attributes==null){controlRender.attributes=[]}var styleAttributeIndex=findStyleAttributeIndex(controlRender.attributes);if(styleAttributeIndex===-1){controlRender.attributes.push({key:"style",value:"width:100%"})}else{var styleAttribute=controlRender.attributes[styleAttributeIndex];styleAttribute.value=replaceWidthStyle(styleAttribute.value)}}if(controlRender.renderType==="BoundImage"||controlRender.renderType==="BoundPicture"){styleAttributeIndex=findStyleAttributeIndex(controlRender.attributes);if(styleAttributeIndex!==-1){styleAttribute=controlRender.attributes[styleAttributeIndex];var styles=styleAttribute.value.split(";"),size=findSizeStyle(styles),windowWidth=Math.floor($(window).width()*0.98-6);if(size.width!=null&&size.width>windowWidth){controlRender.attributes[styleAttributeIndex].value=controlRender.attributes[styleAttributeIndex].value+";width:"+windowWidth+"px";if(size.height!=null){var newHeight=windowWidth/size.width*size.height;controlRender.attributes[styleAttributeIndex].value=controlRender.attributes[styleAttributeIndex].value+";height:"+newHeight+"px"}}}}if((controlRender.renderType==="BoundCheck"||controlRender.renderType==="BoundOption")&&lastRowDivRender!=null){lastRowDivRender.renders.push(controlRender);rowDivRender=lastRowDivRender}else{var rowRender=$.extend(true,{},tableRowRender),rowDivRender=$.extend(true,{},divRender);rowDivRender.attributes=[{key:"class",value:"row_div"}];rowRender.renders[0].renders.push(rowDivRender);if(entity.field.label!=null){rowDivRender.renders.push({attributes:[{key:"class",value:"label_div"}],renderCategory:"Layoutable",renderType:"LayoutDivision",repeatable:false,renders:[{renderCategory:"Displayable",renderType:"DisplayText",text:entity.field.label}]})}rowDivRender.renders.push(controlRender);frameTable.renders.push(rowRender)}if(controlRender.renderType==="BoundCheck"||controlRender.renderType==="BoundOption"){if(controlRender.label!=null){rowDivRender.renders.push({renderCategory:"Displayable",renderType:"DisplayText",text:controlRender.label+" "})}lastRowDivRender=rowDivRender}else{lastRowDivRender=null}if(controlRender.renderType==="BoundHidden"){rowRender.attributes=[{key:"class",value:"hidden_row"}]}if(entity.field!=null&&(index+1<len)&&view.entities[index+1].field!=null&&(view.entities[index+1].render.renderType==="BoundHelp"||view.entities[index+1].render.renderType==="BoundHidden")){var helperRender=view.entities[index+1].render;if(rowDivRender.renders.length>1){if(entity.field.label!=null){rowDivRender.renders.splice(1,0,helperRender);if(rowDivRender.renders[0].attributes==null){rowDivRender.renders[0].attributes=[]}rowDivRender.renders[0].attributes.push({key:"style",value:"display:inline-block"})}else{rowDivRender.renders.push(helperRender)}}else{rowDivRender.renders.push(helperRender)}index++}}else{lastRowDivRender=null;rowRender=$.extend(true,{},tableRowRender);rowDivRender=$.extend(true,{},divRender);if(entity.group.label!=null&&entity.group.label!==""){var repeatTitleDivRender=$.extend(true,{},divRender,{attributes:[{key:"class",value:"infoplus_repeat_title"}]});repeatTitleDivRender.renders.push({renderCategory:"Displayable",renderType:"DisplayText",text:entity.group.label});rowRender.renders[0].renders.push(repeatTitleDivRender)}if(entity.render.renderType==="LayoutTable"){var outWrapDivRender=$.extend(true,{},divRender,{attributes:[{key:"class",value:"infoplus_auto_view_repeatTable_wrap_outer"}]});var inWrapDivRender=$.extend(true,{},divRender,{attributes:[{key:"class",value:"infoplus_auto_view_repeatTable_wrap_inner"}]});inWrapDivRender.renders.push(entity.render);outWrapDivRender.renders.push(inWrapDivRender);rowDivRender.renders.push(outWrapDivRender)}else{var repeatSectionRender=$.extend(true,{},divRender,{groupName:entity.group.name,repeatable:true}),addButtonRender=$.extend(true,{},divRender);addButtonRender.renders.push({renderCategory:"Displayable",renderType:"DisplayText",text:entity.render.addText||$$.lt("repeatAddLink.defaultText")});rowDivRender.attributes=[{key:"class",value:"row_div"}];rowRender.renders[0].attributes=[{key:"style",value:"padding:0"}];rowDivRender.renders.push(repeatSectionRender);rowDivRender.renders.push(addButtonRender);repeatSectionRender.renders.push(convertMobileView(entity,true))}rowRender.renders[0].renders.push(rowDivRender);frameTable.renders.push(rowRender)}index++}return frameTable};const isFileSecure=function(settings){if(null==settings){return false}const fso=settings.fileSecure;return fso!=null&&fso!==false&&fso!=="False"};transformer.prototype={render:null,loadDefault:function(){this.container=$("#div_render_container");this.command_bar=$("#form_command_bar");this.printable=false;this.downloadable=true;this.withdrawable=false;this.killable=false;this.needSwitchMenu=false;this.printAfterAction=false;this.boundFields=[]},initPropFromUrl:function(){var urlParam=$IU.getParamFromUrl(window.location.href);this.urlLang=urlParam.lang;this.back=urlParam.back;this.membership=urlParam.membership;this.showRemark=urlParam.showRemark;this.theme=urlParam.theme;this.snapshot=urlParam.snapshot;this.entrust=urlParam.entrust;this.mobileAutoView=urlParam.mobileAutoView;this.previewReadOnly=urlParam.previewReadOnly;this.entrance=urlParam.entrance;this.cc=(urlParam.cc!=null)?true:undefined;this.width=urlParam.width},initializeConfig:function(config){this.loadDefault();for(var prop in config){if(config.hasOwnProperty(prop)){if(typeof(config[prop])!=="function"){this[prop]=config[prop]}}}this.initPropFromUrl()},refreshRemarks:function(isDoing){if(!$$.visibility.remark){return}if($$.params.holder.remark.length===0){return}var instance=this;if(!$$.MOBILE){$$.params.holder.remark.addClass("loading").block({message:"<span class='loading'>"+$$.lt("remarkHistory.loading")+"</span>",css:{margin:"0 auto",left:"0",right:"0",padding:"6px","border-radius":"5px","background-color":"#000000",opacity:"0.4","min-width":"300px",border:"none"}})}$$.loadHistory({includingTop:true}).done(function(data){if(!$$.MOBILE){$$.params.holder.remark.removeClass("loading")}var entity=data.entities[0];instance.layout.remarkReady({progress:entity,userId:instance.userId,isDoing:isDoing})})},redraw:function(){if(null==this.render){return false}this.render.draw();return false},draw:function(formEntity){$$.params.holder.form.hide();this.render=new InfoPlus.FormRender({formStepId:this.formStepId,workflowId:this.workflowId,holderId:$$.params.holder.form.attr("id"),entity:formEntity,suggest:this.interface_suggest,suggestInitialize:this.interface_suggestInitialize,fieldChange:this.interface_fieldChange,buttonService:this.interface_buttonClick,tenantTimeZoneOffset:this.tenantTimeZoneOffset,thingService:this.interface_thing});$$.initCore({viewToken:this.viewToken,formRender:this.render,userId:formEntity.userId,timestamp:this.timestamp,tenantTimeZoneOffset:this.tenantTimeZoneOffset,tenantReadOnlyStyle:this.tenantReadOnlyStyle,tenantDomain:this.tenantDomain,synthesizeEmail:this.synthesizeEmail,formInstanceId:this.instanceId,formEntryId:this.entryId,formEntryIdTop:this.entryIdTop,formEntryIdDisplay:this.entryIdDisplay,formStepId:this.formStepId,workflowId:this.workflowId,release:this.release,isRelease:this.entryRelease,doActionUrl:this.interface_do_action,boundFields:this.boundFields,instanceView:this.instanceView,adminView:this.adminView,baseUrl:this.base_url,printAfterAction:this.printAfterAction&&this.printable,downloadAfterAction:this.printAfterAction&&this.downloadable,saveable:!(this.readOnly&&(!this.adminView||this.withdrawable)),printable:this.printable,downloadable:this.downloadable,withdrawable:this.withdrawable,killable:this.killable,administrable:this.administrable,instructionUrl:this.instructionUrl,printUrl:this.url_print,supportUrl:this.url_support,entrustUrl:this.url_entrust,adminViewUrl:this.url_admin_view,adminUrl:this.url_admin,downloadWordUrl:this.url_download_word,downloadPdfUrl:this.url_download_pdf,reLoginUrl:this.url_reLogin,membership:this.membership,back:this.back,showRemark:this.showRemark,theme:this.theme,lang:this.lang,urlLang:this.urlLang,dynamicParallel:this.dynamicParallel,printInvoice:((this.interface_printInvoice||"")!==""),instanceName:this.instanceName,instanceTags:this.instanceTags,receiveThing:this.receiveThing,entrust:this.entrust,entrusts:this.entrusts,uriHistory:this.interface_list_remarks,uriBarcode:this.interface_printInvoice,uriFilePreview:this.interface_filePreviewUrl,uriWordEdit:this.interface_wordEditUrl,uriWordDown:this.interface_wordDownUrl,uriSealSelector:this.interface_sealSelector,uriSave:this.interface_save,uriUsers:this.interface_users,uriEntrust:this.interface_entrust,uriCompare:this.interface_compare,uriCkUploadImage:this.interface_ckUploadImage,uriChangePriority:this.interface_changePriority,uriKill:this.interface_kill,uriWithdraw:this.interface_withdraw,uriListNextSteps:this.interface_list_next_steps,mobileAutoView:this.mobileAutoView,snapshot:(this.snapshot==="true"),readOnly:this.readOnly,exportReadOnly:this.exportReadOnly,exportSignature:this.exportSignature,attachmentUrl:this.interface_attachment,attachmentTokenUrl:this.interface_attachmentToken,graphqlUrl:this.interface_graphql,copyright:this.copyright,cc:this.cc,mapKey:this.mapKey,defaultLocation:this.defaultLocation,libs:{ckeditor:this.lib_ckeditor}});this.layout=new InfoPlus.Render.Layout({formEntity:formEntity,formRender:this.render});$$.params.layout=this.layout;$$.beforeRender();return this.render.draw()},processGroups:function(groups){if(groups!=null){for(var key in groups){if(groups.hasOwnProperty(key)){var group=groups[key];if(group.groupName!=null){group.groupArray=group.groupName.split("//")}}}}},processFields:function(fields){var boundFields=[];var dataObject={fields:{}};if(fields!=null){for(var key in fields){if(fields.hasOwnProperty(key)){var field=fields[key];if(field.groupName!=null){field.groupArray=field.groupName.split("//")}if(field.bound===true&&field.name!==undefined){boundFields.push(field.name);if(field.groupArray!=null){if(field.groupArray.length>1){var currentObject=dataObject;for(var i=1;i<field.groupArray.length;i++){var groupName=field.groupArray[i];if(currentObject.groups==null){currentObject.groups={}}if(currentObject.groups[groupName]==null){currentObject.groups[groupName]={fields:{}}}currentObject=currentObject.groups[groupName]}currentObject.fields[field.name]=field}else{dataObject.fields[field.name]=field}}}}}}this.boundFields=boundFields;this.dataObject=dataObject},traverse:function(layout){var result={renders:[]};var stack=[];var current=layout;while(current!=null){if(current.renderCategory==="Boundable"){result.renders.push(current)}if(current.repeatable===true){result.renders.push(current)}if(result.title==null){if(current.renderCategory==="Layoutable"&&current.renderType==="LayoutHeader"){if(current.renders!=null&&current.renders.length>0){var titleRender=current.renders[0];if(titleRender.text!=null){result.title=titleRender.text}}}}var renderList=current.renders;if(renderList!=null){for(var i=renderList.length-1;i>=0;i--){var render=renderList[i];var cate=render.renderCategory;if(cate==="Boundable"&&(render.renderType==="BoundCheck"||render.renderType==="BoundOption")){if((i+1)<renderList.length){var nextRender=renderList[i+1];if(nextRender.renderCategory==="Displayable"&&nextRender.renderType==="DisplayText"){render.label=nextRender.text}}}if(cate==="Layoutable"&&render.repeatable===true){if((i+1)<renderList.length){nextRender=renderList[i+1];if(nextRender.renders!=null&&nextRender.renders.length>0){var childRender=nextRender.renders[0];if(childRender.renderCategory==="Displayable"&&childRender.renderType==="DisplayText"){render.addText=childRender.text}}}}if(cate==="Layoutable"||cate==="Boundable"){stack.push(render)}}}current=stack.pop()}return result},getRenderWidth:function(){if(this.width==null||this.width===""){return $IU.getWindowWidth()}else{var width=parseInt(this.width,10);if(isNaN(width)){return $IU.getWindowWidth()}else{return width}}},preview:function(config){var deferred=$.Deferred();var loadError=function(errorMessage,detailMessage,errorCode,showErrorTip){loadFormError();if(errorCode==="ENTRUST_MOCK_NOT_ALLOWED"||errorCode==="ENTRUST_MODE_NOT_ALLOWED"){var isEntrust=errorCode==="ENTRUST_MODE_NOT_ALLOWED";var entrustInterface=instance.interface_entrust;var buttons=[];buttons.push({name:$$.lt("common.close"),defaultButton:true,callback:function(){$IU.closeWindow()}});buttons.push({name:isEntrust?lt("entrust.abort.entrust"):$$.lt("entrust.abort.debug"),callback:function(){blockUI({message:(isEntrust?$$.lt("entrust.request.abort.requesting.entrust"):$$.lt("entrust.request.abort.requesting.debug"))});$.ajax({type:"POST",url:entrustInterface,data:{entrusted:false,app:entrusts.app.id,csrfToken:$(document).find("meta[itemscope=csrfToken]").attr("content")}}).always(function(){$.unblockUI()}).done(function(){if($$.MOBILE){setTimeout(function(){window.location.reload()},600)}else{window.location.reload()}})}});var title=$$.lt("preview.loadError");dialogDiv=$(document.createElement("div"));if(showErrorTip===true){var span=document.createElement("span");span.style.color="#FF0000";$(span).text($$.lt("error.occur"));dialogDiv.append(span)}span=document.createElement("span");$(span).addClass("error_message_content").html(errorMessage);dialogDiv.append(span);var dialog=new InfoPlus.Render.Dialog({title:title,content:dialogDiv,maxWidth:800,buttons:buttons});dialog.show()}else{$IU.errorMessageBox(errorMessage,detailMessage,$$.lt("preview.loadError"),null,errorCode,showErrorTip,true)}};var processPreviewPermission=function(formEntity){var fields=formEntity.fields;for(var key in fields){if(fields.hasOwnProperty(key)){var field=fields[key];field.permission="rw"}}var groups=formEntity.groups;for(key in groups){if(groups.hasOwnProperty(key)){var group=groups[key];group.permission="r"}}};progress($$.lt("load.workflowInfo"),20,60,5000);if(this.workflowId==null){loadError($$.lt("error.parameter"),null,null,true);return deferred.reject()}var instance=this;$$.ajax({type:"POST",url:this.interface_preview,data:{workflowId:this.workflowId,rand:Math.random()*999,width:this.getRenderWidth()},requestMsg:$$.lt("load.loadWorkflow"),beforeShowErrorMsg:function(){$.unblockUI()},showParseErrMsg:false}).fail(function(error){var errorMessage=error.msg,errorCode=error.errCode,detailMessage=null;if(errorMessage==null){errorMessage=$$.lt("error.unknown")}var messageArray=errorMessage.split("|INFOPLUS_SPLITER|");if(messageArray.length>1){errorMessage=messageArray[0];detailMessage=messageArray[1]}loadError(errorMessage,detailMessage,errorCode,error.errno<0)}).done(function(data){progress($$.lt("load.loading"),60,80,1000);var formEntity=data.entities[0];instance.processFields(formEntity.fields);instance.processGroups(formEntity.groups);if(instance.previewReadOnly==="true"){instance.removePagePermission(formEntity)}var permission=formEntity.permission;config.startable=(permission.startable===true)&&(config.clear!==true);instance.release=config.release;instance.draw(formEntity).done(function(){var introduce=new InfoPlus.Preview.Introduce({hide:(config.clear===true),app:config.app}),start=new InfoPlus.Preview.Start({startable:config.startable,onClick:function(){if(!config.startable){return false}if($IU.doValidate(false,true)===false){return false}if($$.PREVIEW_APP_URI!==undefined){document.body.onbeforeunload=null;window.location.href=$$.PREVIEW_APP_URI;return false}var data={};data=instance.render.save(data,false);var jsonData=$.toJSON(data);$$.blockUI({message:"<span class='loading'>"+$$.lt("preview.starting")+"</span>",css:{width:$$.MOBILE?"80%":"45%",left:$$.MOBILE?"10%":"28%"}});$$.ajax({type:"POST",url:instance.interface_start,data:{idc:config.idc,release:config.release,csrfToken:$(document).find("meta[itemscope=csrfToken]").attr("content"),formData:jsonData,entrance:instance.entrance},requestMsg:$$.lt("preview.start"),errorTitle:$$.lt("preview.refused"),beforeShowErrorMsg:function(){$.unblockUI()}}).done(function(data){var href=data.entities[0];document.body.onbeforeunload=null;window.location.href=$IU.processUrl(href)})}}),previewLayout=new InfoPlus.Preview.Layout({views:instance.render.views,introduce:introduce,start:start});instance.layout.createEntrustHelper();instance.layout.showForm();deferred.resolve()})});return deferred.promise()},convertMobileView:function(view){return{id:view.id,index:view.index,name:view.name,mobile:true,renderCategory:"Layoutable",renderType:"FormView",repeatable:false,styleSheetUri:view.styleSheetUri,attributes:[{key:"class",value:"infoplus_auto_view"}],renders:[{attributes:[{key:"align",value:"center"}],display:"Inline",renderCategory:"Layoutable",renderType:"LayoutDivision",repeatable:false,renders:[convertMobileView(view,false)]}]}},getViewEntity:function(view,fields,groups){var findEntity=function(parentEntityArray,name,type){for(var i=parentEntityArray.length-1;i>=0;i--){var entity=parentEntityArray[i];if(entity.type===type&&entity.name===name){return entity}}return null};var addField=function(parentEntityArray,field,render){if(findEntity(parentEntityArray,field.name,"field")==null||render.renderType==="BoundOption"){parentEntityArray.push({name:field.name,type:"field",render:render,field:field})}};var addGroup=function(parentEntityArray,group,render){if(findEntity(parentEntityArray,group.name,"group")==null||render.renderType!=="LayoutTable"){parentEntityArray.push({name:group.name,type:"group",render:render,group:group,entities:[]})}};var viewObj=this.traverse(view),renders=viewObj.renders;var viewRoot={id:view.id,index:view.index,name:view.name,type:"rootView",title:viewObj.title,styleSheetUri:view.styleSheetUri,entities:[]};for(var n=0;n<renders.length;n++){var render=renders[n];if(render.renderCategory==="Layoutable"){var group=groups[render.groupName];if(group!=null){var currentParent=viewRoot;var groupNames=group.groupArray;if(groupNames!=null&&groupNames.length>2){for(var index=1;index<groupNames.length-1;index++){var groupEntity=findEntity(currentParent.entities,groupNames[index],"group");if(groupEntity!=null){currentParent=groupEntity}else{hasError=true;$IU.debugTip(""+group.name+"","warning");break}}if(!hasError){addGroup(currentParent.entities,group,render)}}else{addGroup(viewRoot.entities,group,render)}}}else{var field=fields[render.field];if(field!=null){currentParent=viewRoot;groupNames=field.groupArray;if(groupNames!=null&&groupNames.length>1){var hasError=false;for(index=1;index<groupNames.length;index++){groupEntity=findEntity(currentParent.entities,groupNames[index],"group");if(groupEntity!=null){currentParent=groupEntity}else{hasError=true;$IU.debugTip(""+field.name+"","warning");break}}if(!hasError){addField(currentParent.entities,field,render)}}else{addField(viewRoot.entities,field,render)}}}}return viewRoot},initParameter:function(formEntity,step){var processSplitPath=function(path){if(path==null){return[]}var pathArray=path.split("/");pathArray.splice(0,1);return pathArray};this.instanceId=step.instanceId;this.entryId=step.entryId;this.entryIdTop=step.entryIdTop;this.entryIdDisplay=step.entryIdDisplay;this.entryRelease=step.entryRelease;this.formStepId=step.flowStepId;this.timestamp=step.timestamp;this.printAfterAction=step.printAfterAction;this.exportReadOnly=step.exportReadOnly;this.exportSignature=step.exportSignature;this.dynamicParallel={splitPath:processSplitPath(step.splitPath),splitPathGroup:processSplitPath(step.splitPathGroup)};this.instanceName=step.instanceName;this.instanceTags=step.instanceTags;this.receiveThing=(step.thing!=null);this.readOnly=!formEntity.permission.executable;this.printable=formEntity.permission.printable;this.downloadable=formEntity.permission.exportable;this.withdrawable=formEntity.permission.withdrawable;this.killable=formEntity.permission.killable;this.administrable=this.instanceView===true&&formEntity.permission.administrable===true;this.instructionUrl=null;if(formEntity.previewId!=null&&formEntity.step.definitionId!=null){this.instructionUrl=this.base_url+"form/"+formEntity.step.definitionId+"/start?clear=true&previewReadOnly=true&preview=true&release="+step.entryRelease;if(this.theme!=null){this.instructionUrl=this.instructionUrl+"&theme="+this.theme}}},preprocessFormEntity:function(formEntity){this.processFields(formEntity.fields);this.processGroups(formEntity.groups)},processMobileAutoView:function(formEntity){if(!$$.MOBILE){return}for(var i=0,len=formEntity.views.length;i<len;i++){if(this.mobileAutoView===true||formEntity.views[i].mobileView===true){var view=this.getViewEntity(formEntity.views[i],formEntity.fields,formEntity.groups);formEntity.views[i]=this.convertMobileView(view)}}},processSnapshots:function(formEntity){var snapshots=formEntity.snapshots;if($IU.isArray(snapshots)&&snapshots.length>0){$$.params.sameStepHistoryList=[];for(var i=0,len=snapshots.length,initCompared=false;i<len;i++){$$.params.sameStepHistoryList.push({name:snapshots[i].name,data:snapshots[i].data});if(snapshots[i].compare===true&&initCompared===false){initCompared=true;var compare=function(index){return function(){$IU.compareInitData(index)}}(i);$$.visible(function(){setTimeout(compare,1000)})}}}},removePrintPagePermission:function(formEntity){if($$.PRINT){this.removePagePermission(formEntity)}},removePagePermission:function(formEntity){var fields=formEntity.fields;for(var key in fields){if(fields.hasOwnProperty(key)){var field=fields[key];if(field.permission!==undefined){if(field.permission.indexOf("r")!==-1){field.permission="r"}else{field.permission=""}}if(field.fieldChanging!==undefined){field.fieldChanging=false}if(field.fieldChangeMappingList!==undefined){field.fieldChangeMappingList=null}}}var groups=formEntity.groups;for(key in groups){if(groups.hasOwnProperty(key)){var group=groups[key];if(group.permission!==undefined){if(group.permission.indexOf("r")!==-1){group.permission="r"}else{group.permission=""}}}}},load:function(){var instance=this;var originRenderHolderWidth=$("#renderContent_holder").width();var intervalFlag=setInterval(function(){if(instance.layout!=null){if(originRenderHolderWidth!==$("#renderContent_holder").width()){instance.layout.onResize(true);clearInterval(intervalFlag)}}},30);var loadError=function(errorMessage,detailMessage,errorCode,showErrorTip){if(window.loadFormError!==undefined&&(typeof window.loadFormError==="function")){loadFormError()}$IU.errorMessageBox(errorMessage,detailMessage,($$.PRINT?$$.lt("print.fail"):$$.lt("load.fail")),null,errorCode,showErrorTip,true)};var isDoing=function(step){return(step.entryStatus!==InfoPlus.Settings.INSTANCE_STATE_COMPLETE&&step.entryStatus!==InfoPlus.Settings.INSTANCE_STATE_TERMINATED&&step.entryStatus!==InfoPlus.Settings.INSTANCE_STATE_OFFLINE&&step.status===2)};progress($$.lt("load.loadPage"),20,60,5000);if(this.formStepId<0&&this.instanceId==null){loadError($$.lt("load.paramError"),null,null,true);return $.Deferred().reject()}var url=!$$.PRINT?this.interface_render:this.interface_print,deferred=$.Deferred(),data={stepId:this.formStepId==null?-1:this.formStepId,instanceId:this.instanceId,admin:this.adminView,rand:Math.random()*999,width:this.getRenderWidth(),lang:this.lang};if(this.cc===true){data.markAsRead=true}if(this.snapshot==="true"){data.snapshot=true}$$.ajax({type:"POST",url:url,data:data,requestMsg:$$.lt("load.loadForm"),beforeShowErrorMsg:function(){$.unblockUI()},showParseErrMsg:false}).fail(function(error){if(error.errCode==="STEP_PARALLEL"){window.location.href=$IU.processUrl(error.data.entities[0]["step"]["renderUri"]);deferred.reject();return}if(error.errCode==="ACCESS_DENIED"&&(instance.entrusts!=null&&instance.entrusts.entruster!=null)){$IU.chooseEntrust(instance.entrusts,error,($$.PREVIEW?startPreview:startLoad),instance.interface_entrust);return}var errorMessage=error.msg,detailMessage=null;if(errorMessage==null){errorMessage=$$.lt("load.unknownError")}var oldSpliter="|INFOPLUS_SPLITER|",newSpliter="\n\n";var pos=errorMessage.indexOf(oldSpliter);if(pos!==-1){detailMessage=errorMessage.substr(pos+oldSpliter.length);errorMessage=errorMessage.substring(0,pos)}else{pos=errorMessage.indexOf(newSpliter);if(pos!==-1){detailMessage=errorMessage.substr(pos+newSpliter.length);errorMessage=errorMessage.substring(0,pos)}}loadError(errorMessage,detailMessage,error.errCode,error.errno<0)}).done(function(data){progress($$.lt("load.loadPage"),60,80,1000);var formEntity=data.entities[0],step=formEntity.step;step.entryIdDisplay=step.entryId;if(step.entryIdTop!=null&&step.entryIdTop!=step.entryId){var entryIdDiff=step.entryId-step.entryIdTop;step.entryIdDisplay=step.entryIdTop+(entryIdDiff>0?"+":"-")+Math.abs(entryIdDiff)}instance.preprocessFormEntity(formEntity);instance.processMobileAutoView(formEntity);instance.initParameter(formEntity,step);instance.removePrintPagePermission(formEntity);instance.processSnapshots(formEntity);instance.draw(formEntity).done(function(){$IU.initValidationEngine();if(!$$.PRINT){instance.layout.render(formEntity,step)}instance.layout.adjustRender();instance.layout.showForm();if($$.visibility.remark){instance.refreshRemarks(isDoing(step))}deferred.resolve()}).always(function(){$$.params.initializing=false})}).always(function(){});return deferred.promise()},registerGlobalEvents:function(){var instance=this;$$.visible(function(){$(window).resize(function(){$IU.adjustRenderWidth();$IU.updateFormTipsAndViews(false)});if($$.MOBILE){$$.resize($(window).width())}});var lastEnter=null;$(window).on("dragenter",function(e){lastEnter=e.target;$(document.body).addClass("dragging-over")});$(window).on("dragleave",function(e){if(lastEnter===e.target){$(document.body).removeClass("dragging-over");e.stopPropagation();e.preventDefault()}});$(window).on("drop",function(e){$(document.body).removeClass("dragging-over")});$(document).bind("contextmenu",function(e){var source=e.srcElement||e.target;if($(source).parent().hasClass("infoplus_fileControl_link")){var fileControl=$(source).parents(".infoplus_fileControl").data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT);if(fileControl!=null){var field=fileControl.field;if(field!=null&&isFileSecure(field.settings)){return false}}}return true});if(!$IU.isEmptyStr($$.params.back)){if(!$IU.isPositiveInt($$.params.back)){window.history.pushState({title:"title",url:"#"},"title","#");window.addEventListener("popstate",function(e){$IU.backUrlSkip($$.params.back)})}else{}}var weixinJSBridgeReady=function(){$$.MINIPROGRAM=(navigator.userAgent.match(/miniprogram/i)||window.__wxjs_environment==="miniprogram");if($$.MINIPROGRAM){loadAllScript(["https://res.wx.qq.com/open/js/jweixin-1.3.2.js"])}};if(!window.WeixinJSBridge||!WeixinJSBridge.invoke){document.addEventListener("WeixinJSBridgeReady",weixinJSBridgeReady,false)}else{weixinJSBridgeReady()}var dingtalkJSBridgeReady=function(){if($$.DINGTALK){loadAllScript(["https://g.alicdn.com/dingding/dingtalk-jsapi/2.10.3/dingtalk.open.js"],function(){$$.dingTalkJSLoaded=true})}};dingtalkJSBridgeReady()}};define("InfoPlus.Transformer",transformer)})(window);
(function(window,undefined){var externalLink=function(endPoint,settings,text){if(settings==null){settings={}}this.settings=settings;this.endPoint=endPoint;if(endPoint.indexOf("http://")===-1){this.endPoint="http://"+endPoint}this.assignSize=false;this.mode=InfoPlus.ExternalLink.DEFAULT_MODE;if(settings.windowMode!=null&&$IU.isInt(settings.windowMode)){var m=parseInt(settings.windowMode,10);if(!isNaN(m)&&(m>=InfoPlus.ExternalLink.MODE_INNER_MODAL&&m<=InfoPlus.ExternalLink.MODE_SELF)){this.mode=m}}if(settings.windowWidth!=null&&$IU.isNumber(settings.windowWidth)){var w=parseFloat(settings.windowWidth);if(!isNaN(w)){this.width=w;this.assignSize=true}}if(settings.windowHeight!=null&&$IU.isNumber(settings.windowHeight)){var h=parseFloat(settings.windowHeight);if(!isNaN(h)){this.height=h;this.assignSize=true}}};externalLink.MODE_INNER_MODAL=1;externalLink.MODE_INNER_MODALESS=2;externalLink.MODE_OUTER_DIALOG=3;externalLink.MODE_OUTER_MODAL=4;externalLink.MODE_OUTER_MODALESS=5;externalLink.MODE_SELF=6;externalLink.DEFAULT_MODE=externalLink.MODE_INNER_MODAL;externalLink.DEFAULT_DIALOG_WIDTH=$(window).width();externalLink.DEFAULT_DIALOG_HEIGHT=$(window).height()*0.7;externalLink.prototype={assignSize:false,mode:externalLink.MODE_INNER_MODAL,width:externalLink.DEFAULT_DIALOG_WIDTH,height:externalLink.DEFAULT_DIALOG_HEIGHT,endPoint:null,dialogDiv:null,href:null,openWindow:function(){var retValue=true;switch(this.mode){case InfoPlus.ExternalLink.MODE_INNER_MODAL:case InfoPlus.ExternalLink.MODE_INNER_MODALESS:if(!$$.MOBILE){var $titleHolder=$("#title_holder"),titleHeight=$titleHolder.height(),commandHeight=$("#command_holder").height(),titleTop=parseInt($titleHolder.parent().css("top"),10),titleCommandHeight=titleHeight+commandHeight+(isNaN(titleTop)?0:titleTop),suggestHeight=$(window).height()-titleCommandHeight-40-48-4-20;$IU.iframeBox(this.href,this.settings.displayText,this.mode===InfoPlus.ExternalLink.MODE_INNER_MODAL,false,this.width,this.assignSize?this.height:suggestHeight)}else{var page=new InfoPlus.Render.Mobile.Page({title:this.settings.displayText,uri:this.href});page.show()}break;case InfoPlus.ExternalLink.MODE_OUTER_DIALOG:var options="directories=0,location=0,menubar=0,resizable=1,scrollbars=1,status=0,titlebar=0,toolbar=0";if(!this.assignSize){options+=",channelmode=1,fullscreen=1"}else{options+=",channelmode=0,fullscreen=0,width="+this.width+",height="+this.height+",top="+(screen.availHeight-this.height)/2+",left="+(screen.availWidth-this.width)/2}window.open(this.href,"",options);break;case InfoPlus.ExternalLink.MODE_OUTER_MODAL:$IU.messageBox($$.lt("anchor.closeAfterAction"),$$.hlt("anchor.closeAfterActionDescription"),null,300);retValue=false;break;case InfoPlus.ExternalLink.MODE_SELF:case InfoPlus.ExternalLink.MODE_OUTER_MODALESS:retValue=false;break}return retValue}};define("InfoPlus.ExternalLink",externalLink)})(window);
(function(window,undefined){var valuePair=function(value,displayValue,parentId){this.value=value;this.displayValue=displayValue;this.name=displayValue;this.parentId=parentId};valuePair.prototype={};define("InfoPlus.Controls.Data.ValuePair",valuePair)})(window);
(function(window,undefined){var thing=function(value,displayValue){InfoPlus.Controls.Data.ValuePair.call(this,value,displayValue)};thing.prototype=$.extend(new InfoPlus.Controls.Data.ValuePair(),{});define("InfoPlus.Controls.Data.Thing",thing)})(window);
(function(window,undefined){var uri=function(value){this.value=value};uri.prototype={};define("InfoPlus.Controls.Data.Uri",uri)})(window);
(function(window,undefined){var style=function(dynamicStyle){this.styles=this.splitStyles(dynamicStyle.style);this.condition=dynamicStyle.condition||"";this.isRowStyle=dynamicStyle.isRowStyle===true;this.isRepeatItemStyle=dynamicStyle.isRepeatItemStyle===true;this.keyName=dynamicStyle.keyName;var fieldRowIndexName=dynamicStyle.fieldRowIndexName||"";if(fieldRowIndexName!==""){if(this.condition.indexOf("$INDEX")!==-1){this.condition=this.condition.replace(/\$INDEX/g,"$"+fieldRowIndexName)}}var fieldGroupCountName=dynamicStyle.fieldGroupCountName||"";if(fieldGroupCountName!==""){if(this.condition.indexOf("$COUNT")!==-1){this.condition=this.condition.replace(/\$COUNT/g,"$"+fieldGroupCountName)}}if(this.condition===""||this.condition.toLowerCase()==="true"){this.ignoreCondition=true}else{this.conditionAsts=$$.parseDynamic(this.condition,this.keyName);var compiler=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts);this.references=compiler.getReferenceNameArray()}};style.prototype={styles:null,ignoreCondition:false,condition:"",conditionAsts:null,references:[],isRowStyle:false,isRepeatItemStyle:false,keyName:"",splitStyles:function(dynamicStyles){var retValue=[];var styleArray=dynamicStyles.split(";");for(var index=0;index<styleArray.length;index++){var s=styleArray[index];var stylePair=s.split(":");if(stylePair.length===2){retValue.push({name:stylePair[0],value:stylePair[1]})}}return retValue},getReferedStyle:function(targetFieldName){return new InfoPlus.Dynamics.ReferedStyle(targetFieldName,this)}};define("InfoPlus.Dynamics.Style",style)})(window);
(function(window,undefined){var formula=function(dynamicFormula){this.formula=dynamicFormula.formula;this.condition=dynamicFormula.condition||"";this.keyName=dynamicFormula.keyName;var fieldRowIndexName=dynamicFormula.fieldRowIndexName||"";if(fieldRowIndexName!==""){if(this.formula.indexOf("$INDEX")!==-1){this.formula=this.formula.replace(/\$INDEX/g,"$"+fieldRowIndexName);this.isRowIndex=true}if(this.condition.indexOf("$INDEX")!==-1){this.condition=this.condition.replace(/\$INDEX/g,"$"+fieldRowIndexName)}}var fieldGroupCountName=dynamicFormula.fieldGroupCountName||"";if(fieldGroupCountName!==""){if(this.formula.indexOf("$COUNT")!==-1){this.formula=this.formula.replace(/\$COUNT/g,"$"+fieldGroupCountName)}if(this.condition.indexOf("$COUNT")!==-1){this.condition=this.condition.replace(/\$COUNT/g,"$"+fieldGroupCountName)}}var conditionRefNames=[];if(this.condition===""||this.condition.toLowerCase()==="true"){this.ignoreCondition=true}else{this.conditionAsts=$$.parseDynamic(this.condition,this.keyName);var compiler=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts);conditionRefNames=compiler.getReferenceNameArray()}this.formulaAsts=$$.parseDynamic(this.formula,this.keyName);compiler=new InfoPlus.Dynamics.Parser.Compile(this.formulaAsts);var formulaRefNames=compiler.getReferenceNameArray();var refNames=[];for(var vrIndex=0;vrIndex<formulaRefNames.length;vrIndex++){var valueRefName=formulaRefNames[vrIndex];var found=false;for(var crIndex=0;crIndex<conditionRefNames.length;crIndex++){if(conditionRefNames[crIndex]===valueRefName){found=true;break}}if(!found){refNames.push(valueRefName)}}this.references=refNames.concat(conditionRefNames)};formula.prototype={formula:"",formulaAsts:null,ignoreCondition:false,condition:"",conditionAsts:null,references:[],isRowIndex:false,keyName:"",getReferedFormula:function(targetFieldName){return new InfoPlus.Dynamics.ReferedFormula(targetFieldName,this)}};define("InfoPlus.Dynamics.Formula",formula)})(window);
(function(window,undefined){var referedFormula=function(targetFieldName,formula){this.targetFieldName=targetFieldName;this.formula=formula.formula;this.formulaAsts=formula.formulaAsts;this.ignoreCondition=formula.ignoreCondition;this.condition=formula.condition;this.conditionAsts=formula.conditionAsts};referedFormula.prototype={targetFieldName:"",formula:"",formulaAsts:null,condition:"",conditionAsts:null,ignoreCondition:false};define("InfoPlus.Dynamics.ReferedFormula",referedFormula)})(window);
(function(window,undefined){var referedStyle=function(targetFieldName,style){this.targetFieldName=targetFieldName;this.styles=style.styles;this.ignoreCondition=style.ignoreCondition;this.condition=style.condition;this.conditionAsts=style.conditionAsts};referedStyle.prototype={targetFieldName:"",style:[],condition:"",conditionAsts:null,ignoreCondition:false};define("InfoPlus.Dynamics.ReferedStyle",referedStyle)})(window);
(function(window,undefined){var action=function(dynamicAction){this.action=dynamicAction.action;this.condition=dynamicAction.condition||"";this.isRepeatItemAction=dynamicAction.isRepeatItemAction===true;this.keyName=dynamicAction.keyName;var conditionRefNames=[];var fieldRowIndexName=dynamicAction.fieldRowIndexName||"";if(fieldRowIndexName!==""){if(this.action.indexOf("$INDEX")!==-1){this.action=this.action.replace(/\$INDEX/g,"$"+fieldRowIndexName)}if(this.condition.indexOf("$INDEX")!==-1){this.condition=this.condition.replace(/\$INDEX/g,"$"+fieldRowIndexName)}}var fieldGroupCountName=dynamicAction.fieldGroupCountName||"";if(fieldGroupCountName!==""){if(this.action.indexOf("$COUNT")!==-1){this.action=this.action.replace(/\$COUNT/g,"$"+fieldGroupCountName)}if(this.condition.indexOf("$COUNT")!==-1){this.condition=this.condition.replace(/\$COUNT/g,"$"+fieldGroupCountName)}}if(this.condition===""||this.condition.toLowerCase()==="true"){this.ignoreCondition=true}else{this.ignoreCondition=false;this.conditionAsts=$$.parseDynamic(this.condition,this.keyName);var compiler=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts);conditionRefNames=compiler.getReferenceNameArray()}this.actionAsts=$$.parseDynamic(this.action,this.keyName);compiler=new InfoPlus.Dynamics.Parser.Compile(this.actionAsts);var actionRefNames=compiler.getReferenceNameArray();var refNames=[];for(var vrIndex=0;vrIndex<actionRefNames.length;vrIndex++){var valueRefName=actionRefNames[vrIndex];var found=false;for(var crIndex=0;crIndex<conditionRefNames.length;crIndex++){if(conditionRefNames[crIndex]===valueRefName){found=true;break}}if(!found){refNames.push(valueRefName)}}this.references=refNames.concat(conditionRefNames)};action.prototype={action:"",actionAsts:null,ignoreCondition:false,condition:"",conditionAsts:null,references:[],isRepeatItemAction:false,keyName:"",getReferedAction:function(targetFieldName){return new InfoPlus.Dynamics.ReferedAction(targetFieldName,this)}};define("InfoPlus.Dynamics.Action",action)})(window);
(function(window,undefined){var referedAction=function(targetFieldName,action){this.targetFieldName=targetFieldName;this.action=action.action;this.actionAsts=action.actionAsts;this.ignoreCondition=action.ignoreCondition;this.condition=action.condition;this.conditionAsts=action.conditionAsts};referedAction.prototype={targetFieldName:"",action:"",actionAsts:null,condition:"",conditionAsts:null,ignoreCondition:true};define("InfoPlus.Dynamics.ReferedAction",referedAction)})(window);
(function(window,undefined){var validation=function(dynamicValidation){this.tip=dynamicValidation.tip;this.condition=dynamicValidation.condition||"";this.keyName=dynamicValidation.keyName;var fieldRowIndexName=dynamicValidation.fieldRowIndexName||"";if(fieldRowIndexName!==""){if(this.tip.indexOf("$INDEX")!==-1){this.tip=this.tip.replace(/\$INDEX/g,"$"+fieldRowIndexName)}if(this.condition.indexOf("$INDEX")!==-1){this.condition=this.condition.replace(/\$INDEX/g,"$"+fieldRowIndexName)}}var fieldGroupCountName=dynamicValidation.fieldGroupCountName||"";if(fieldGroupCountName!==""){if(this.tip.indexOf("$COUNT")!==-1){this.tip=this.tip.replace(/\$COUNT/g,"$"+fieldGroupCountName)}if(this.condition.indexOf("$COUNT")!==-1){this.condition=this.condition.replace(/\$COUNT/g,"$"+fieldGroupCountName)}}var conditionRefNames=[];if(this.condition===""||this.condition.toLowerCase()==="true"){this.ignoreCondition=true}else{this.conditionAsts=$$.parseDynamic(this.condition,this.keyName);var compiler=new InfoPlus.Dynamics.Parser.Compile(this.conditionAsts);conditionRefNames=compiler.getReferenceNameArray()}this.tipAsts=$$.parseDynamic(this.tip,this.keyName);compiler=new InfoPlus.Dynamics.Parser.Compile(this.tipAsts);var tipRefNames=compiler.getReferenceNameArray();var refNames=[];for(var vrIndex=0;vrIndex<tipRefNames.length;vrIndex++){var valueRefName=tipRefNames[vrIndex];var found=false;for(var crIndex=0;crIndex<conditionRefNames.length;crIndex++){if(conditionRefNames[crIndex]===valueRefName){found=true;break}}if(!found){refNames.push(valueRefName)}}this.references=refNames.concat(conditionRefNames)};validation.prototype={tip:"",tipAsts:null,ignoreCondition:false,condition:"",conditionAsts:null,references:[],keyName:"",getReferedValidation:function(targetFieldName){return new InfoPlus.Dynamics.ReferedValidation(targetFieldName,this)}};define("InfoPlus.Dynamics.Validation",validation)})(window);
(function(window,undefined){var referedValidation=function(targetFieldName,validation){this.targetFieldName=targetFieldName;this.tip=validation.tip;this.tipAsts=validation.tipAsts;this.ignoreCondition=validation.ignoreCondition;this.condition=validation.condition;this.conditionAsts=validation.conditionAsts};referedValidation.prototype={targetFieldName:"",tip:"",tipAsts:null,condition:"",conditionAsts:null,ignoreCondition:false};define("InfoPlus.Dynamics.ReferedValidation",referedValidation)})(window);
(function(window,undefined){var cache=function(){};cache.prototype={context:{},build:function(){var controls={},paths=[],context={};var pushControl=function(control){var path=control.path;if(controls[path]==null){controls[path]=[];paths.push(path)}controls[path].push(control)};$$.params.renderForm.find("."+$Control.CLASSNAME_CONTROL).each(function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);if(control==null||control.path==null||control.field==null){return}pushControl(control)});$$.params.renderForm.find("."+InfoPlus.Repeat.RepeatControl.CLASS_REPEAT_PARENT_ELEMENT).each(function(){var control=$(this).data(InfoPlus.Repeat.RepeatControl.DATA_REPEAT_CONTROL_OBJECT);if(control==null||control.path==null||control.groupName==null){return}pushControl(control)});var findChildrenPaths=function(mainPath){var childrenPaths=[];for(var i=0,len=paths.length;i<len;i++){var path=paths[i];if(path.length>mainPath.length){if(path.substr(0,mainPath.length)===mainPath&&path.substr(mainPath.length,1)==="_"){childrenPaths.push(path)}}}return childrenPaths};for(var path in controls){if(controls.hasOwnProperty(path)){var referedPaths=$IU.getReferedControlPaths(path),childrenPaths=findChildrenPaths(path);referedPaths=referedPaths.concat(childrenPaths);var cacheControls=[];for(var i=0,len=referedPaths.length;i<len;i++){cacheControls=cacheControls.concat(controls[referedPaths[i]])}context[path]=cacheControls}}this.context=context},get:function(path){var context=this.context;if(context.hasOwnProperty(path)){return context[path]}return[]}};define("InfoPlus.Dynamics.Cache",cache)})(window);
(function(window,undefined){var controlReference=function(control){this.element=control.element;this.permission=control.field.permission;this.isValid=control.checkValid()};controlReference.prototype={element:null};define("InfoPlus.Dynamics.ControlReference",controlReference)})(window);
(function(window,undefined){var repeatControlReference=function(repeatControl){this.repeatParentElement=repeatControl.repeatParentElement;this.permission=repeatControl.groupInformation.permission};repeatControlReference.prototype={element:null};define("InfoPlus.Dynamics.RepeatControlReference",repeatControlReference)})(window);
(function(window,undefined){var control=function(controlType,path,field,render,initValue,initDisplayValue,initAttributes){if(controlType==null||field==null){return}this.controlType=controlType;this.path=path;this.field=field;this.render=render;this.initValue=initValue;this.initDisplayValue=initDisplayValue;this.initAttributes=initAttributes;if(field.fieldChanging===true){this.onFieldChange=true}if(field.needSync===true){this.onFieldSync=true}var controlElement=this.createControl();if(controlElement==null){this.element=null;this.controlContainer=null}};control.CONTROL_TYPE_EDIT="BoundEdit";control.CONTROL_TYPE_TEXT="BoundTextArea";control.CONTROL_TYPE_RICHTEXT="BoundRichText";control.CONTROL_TYPE_DATE="BoundDate";control.CONTROL_TYPE_TIME="BoundTime";control.CONTROL_TYPE_CHECKBOX="BoundCheck";control.CONTROL_TYPE_CHECKBOX_LIST="BoundCheckList";control.CONTROL_TYPE_RADIO="BoundOption";control.CONTROL_TYPE_RADIO_LIST="BoundOptionList";control.CONTROL_TYPE_RADIO_GROUP="BoundOptionGroup";control.CONTROL_TYPE_SELECT="BoundSelect";control.CONTROL_TYPE_REMARK="BoundRemark";control.CONTROL_TYPE_ANCHOR="BoundAnchor";control.CONTROL_TYPE_ACTION="BoundAction";control.CONTROL_TYPE_LABEL="BoundLabel";control.CONTROL_TYPE_HIDDEN="BoundHidden";control.CONTROL_TYPE_SUGGESTER="BoundSuggester";control.CONTROL_TYPE_SUGGESTER2="BoundSuggester2";control.CONTROL_TYPE_FILE="BoundFile";control.CONTROL_TYPE_FILE_LIST="BoundFileList";control.CONTROL_TYPE_IMAGE="BoundImage";control.CONTROL_TYPE_PICTURE="BoundPicture";control.CONTROL_TYPE_HELP="BoundHelp";control.CONTROL_TYPE_BUTTON="BoundButton";control.CONTROL_TYPE_LINK_BUTTON="BoundLinkButton";control.CONTROL_TYPE_CHECK_BUTTON="BoundCheckButton";control.CONTROL_TYPE_PASSWORD="BoundPassword";control.CONTROL_TYPE_IFRAME="BoundIFrame";control.CONTROL_TYPE_THING="BoundThing";control.CONTROL_TYPE_CONVERTED_LABEL="BoundConvertedLabel";control.CONTROL_TYPE_SWITCH="BoundSwitch";control.CONTROL_TYPE_MAP="BoundMap";control.CONTROL_TYPE_SIGNATURE="BoundSignature";control.CONTROL_TYPE_SEAL="BoundSeal";control.CONTROL_TYPE_DOC="BoundDoc";control.DATA_CONTROL_OBJECT="controlObject";control.DATA_TYPE="dataType";control.DATA_TYPE_STRING="string";control.DATA_TYPE_ANYURI="anyURI";control.DATA_TYPE_XHTML="XHTML";control.DATA_TYPE_INT="integer";control.DATA_TYPE_DOUBLE="double";control.DATA_TYPE_BOOL="boolean";control.DATA_TYPE_DATE="date";control.DATA_TYPE_TIME="time";control.DATA_TYPE_DATETIME="dateTime";control.DATA_TYPE_USER="User";control.DATA_TYPE_ORGANIZE="Organize";control.DATA_TYPE_CODE="Code";control.DATA_TYPE_FILE="File";control.DATA_TYPE_THING="Thing";control.DATA_TYPE_DOC="Doc";control.DATA_TYPE_LOCATION="Location";control.DATA_TYPE_SIGNATURE="Signature";control.DATA_TYPE_LIST="List";control.DATA_IS_CONTROL="isControl";control.DATA_PATH="path";control.DATA_RENDER="render";control.DATA_FIELD="field";control.DATA_EXTERNAL_LINK="externalLink";control.DATA_SUGGESTER="suggester";control.DATA_CONTROL_TYPE="controlType";control.DATA_VALIDATOR="validator";control.DATA_VALIDATOR_PROMPT_POSITION="validatorPromptPosition";control.DATA_ORIGIN_INPUT="originInput";control.DATA_ORIGIN_CONTROL="originControl";control.DATA_SOURCE_CONTROL="sourceControl";control.DATA_ORIGIN_STYLE="originStyle";control.DATA_ATTRIBUTES="attributes";control.DATA_VALUE="value";control.DATA_DISPLAY_VALUE="displayValue";control.CLASSNAME_CONTROL="infoplus_control";control.CLASSNAME_READONLY="infoplus_readonly";control.CLASSNAME_WRITABLE="infoplus_writable";control.CLASSNAME_FIELD_CHANGE="infoplus_fieldChange";control.CLASSNAME_VAR="infoplus_var";control.CLASSNAME_ROWINDEX="infoplus_rowIndex";control.CLASSNAME_GROUP_COUNT="infoplus_groupCount";control.prototype={guid:null,compatibleFieldTypes:[],element:null,elementClassName:"",name:"",controlContainer:null,onFieldChange:false,onFieldRefer:false,onFieldSync:false,ignoreClass:false,ignoreValidation:false,allowFocus:true,autoTriggerFieldChangeEvent:true,fieldChangeProcessor:new InfoPlus.Controls.Event.FieldChangeEventProcessor(),dynamicProcessor:new InfoPlus.Dynamics.Processor(),events:[],conditionalStyles:[],validatorPromptPosition:"topRight",parentValue:null,maxLength:null,clickFireFieldChange:false,synced:false,tooltip:null,dynamicReadonly:false,dynamicParallelReadonly:false,hasHiddenElement:false,getElementClassName:function(){return"infoplus_"+this.name+"Control"},getContainerClassName:function(){return this.getElementClassName()+"Container"},createControl:function(){if(this.checkCompatibility()===false){$IU.delayedErrorMessageBox($$.lt("control.createError",this.field.name));return null}this.element=this.createElement();if(this.element==null){return null}if(this.hasHiddenElement&&$(this.element).data($Control.DATA_ORIGIN_INPUT)==null){this.createHiddenElement()}this.guid=$$.guid();this.setInfopathFormAttributes();this.setControlData();this.setElementAttribute();this.processValidation();this.processDynamicValidation();this.specialSetting();this.setPermission();this.setPlaceHolder();if(this.isReadable()){this.setValue(this.initValue,this.initDisplayValue,true,this.initAttributes);this.setAttributes(this.initAttributes)}this.addFieldChangeClass();this.registerEvent();return this.element},createElement:function(){return null},createHiddenElement:function(element){if(element===undefined){element=this.element}var hiddenInput=document.createElement("input");hiddenInput.type="hidden";$(element).data($Control.DATA_ORIGIN_INPUT,hiddenInput);$(hiddenInput).data($Control.DATA_SOURCE_CONTROL,this).data($Control.DATA_CONTROL_TYPE,this.controlType);if(this.controlContainer==null){element.appendChild(hiddenInput)}else{this.controlContainer.appendChild(hiddenInput)}},syncValue:function(fieldValue,fieldDisplayValue,attributes){if(this.autoTriggerFieldChangeEvent===false){this.synced=true}this.setValue(fieldValue,fieldDisplayValue,false,attributes)},setValue:function(fieldValue,fieldDisplayValue,isInit){$(this.element).val(fieldValue)},getValue:function(isInit){if(this.element!=null){return $(this.element).val()}return null},setStyle:function(name,value){$IU.setDynamicStyle(this.element,name,value)},getStyle:function(name){return $IU.getElementStyle(this.element,name)},getId:function(){return this.element.id},checkValid:function(){return true},getParentValue:function(){return this.parentValue},getAttributes:function(){return $(this.element).data($Control.DATA_ATTRIBUTES)},setAttributes:function(attributes){if(attributes==null){$(this.element).removeData($Control.DATA_ATTRIBUTES)}else{$(this.element).data($Control.DATA_ATTRIBUTES,attributes)}},getSortValue:function(){var val=this.getValue();if(val instanceof $Controls.Data.ValuePair){return val.displayValue}if(val instanceof $Controls.Data.Uri){return val.value}return val},getPosition:function(){var $element=(this.controlContainer!=null)?$(this.controlContainer):$(this.element);if(!$element.is(":visible")){return null}return{left:$element.offset().left,top:$element.offset().top,width:$element.outerWidth(),height:$element.outerHeight()}},setElementAttribute:function(){if(!this.hasHiddenElement){var element=this.element;var render=this.render;element.id=render.controlId+this.path;$(element).attr("name",render.field+this.path);$(element).data($Control.DATA_FIELD,render.field).data($Control.DATA_RENDER,render);if(this.controlContainer!=null){$(this.controlContainer).attr("id",element.id+"_Container")}}else{this.setHiddenAttribute()}},setHiddenAttribute:function(){var $element=$(this.element),hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT),render=this.render,path=this.path;this.element.id=this.name+"_"+$$.guid();hiddenInput.id=render.controlId+path;hiddenInput.name=render.field+path;$(hiddenInput).data($Control.DATA_PATH,path).data($Control.DATA_FIELD,render.field).data($Control.DATA_RENDER,render).data($Control.DATA_IS_CONTROL,true).data($Control.DATA_CONTROL_OBJECT,this);$element.data($Control.DATA_FIELD,render.field);if(this.controlContainer!=null){$(this.controlContainer).attr("id",this.element.id+"_Container")}},specialSetting:function(){},getControlContainer:function(){if(this.controlContainer!=null){return this.controlContainer}return this.element},setReadOnly:function(){this.element.readOnly=true;switch(this.controlType){case $Control.CONTROL_TYPE_EDIT:case $Control.CONTROL_TYPE_TEXT:case $Control.CONTROL_TYPE_DATE:case $Control.CONTROL_TYPE_TIME:case $Control.CONTROL_TYPE_PASSWORD:case $Control.CONTROL_TYPE_SWITCH:$(this.element).addClass($Control.CLASSNAME_READONLY);break;case $Control.CONTROL_TYPE_SELECT:case $Control.CONTROL_TYPE_CHECKBOX:case $Control.CONTROL_TYPE_BUTTON:case $Control.CONTROL_TYPE_CHECK_BUTTON:$(this.element).addClass($Control.CLASSNAME_READONLY);this.element.disabled=true;break;case $Control.CONTROL_TYPE_RADIO:case $Control.CONTROL_TYPE_RADIO_GROUP:$(this.element).addClass($Control.CLASSNAME_READONLY).addClass("disabled");this.element.disabled=true;break;case $Control.CONTROL_TYPE_CHECKBOX_LIST:$(this.element).find("input[type=checkbox]").each(function(){$(this).addClass($Control.CLASSNAME_READONLY).addClass("disabled");var $label=$(this).parent();if(this.checked){$label.addClass("checked").removeClass("unchecked")}else{$label.addClass("unchecked").removeClass("checked")}$label.addClass($Control.CLASSNAME_READONLY);this.disabled=true});break;case $Control.CONTROL_TYPE_RADIO_LIST:$(this.element).find("input[type=radio]").each(function(){$(this).addClass($Control.CLASSNAME_READONLY).addClass("disabled");$(this).parent().attr("class",this.checked?"checked":"unchecked").addClass($Control.CLASSNAME_READONLY);this.disabled=true});break;case $Control.CONTROL_TYPE_SUGGESTER2:var select=$(this.element).data($Control.DATA_ORIGIN_INPUT);$(this.element).addClass($Control.CLASSNAME_READONLY);select.disabled=true;break;case $Control.CONTROL_TYPE_RICHTEXT:case $Control.CONTROL_TYPE_REMARK:case $Control.CONTROL_TYPE_SUGGESTER:case $Control.CONTROL_TYPE_FILE:case $Control.CONTROL_TYPE_FILE_LIST:case $Control.CONTROL_TYPE_ANCHOR:case $Control.CONTROL_TYPE_LINK_BUTTON:break;case $Control.CONTROL_TYPE_THING:$(this.element).addClass($Control.CLASSNAME_READONLY);break;case $Control.CONTROL_TYPE_LABEL:case $Control.CONTROL_TYPE_HIDDEN:break;case $Control.CONTROL_TYPE_MAP:break;default:$(this.element).addClass($Control.CLASSNAME_READONLY);if(this.controlContainer!=null){$(this.controlContainer).addClass($Control.CLASSNAME_READONLY)}break}},setDynamicReadOnly:function(isReadOnly){},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=true;this.setReadOnly()},setWritableClass:function(){switch(this.controlType){case $Control.CONTROL_TYPE_EDIT:case $Control.CONTROL_TYPE_TEXT:case $Control.CONTROL_TYPE_RICHTEXT:case $Control.CONTROL_TYPE_DATE:case $Control.CONTROL_TYPE_TIME:case $Control.CONTROL_TYPE_SELECT:case $Control.CONTROL_TYPE_SUGGESTER2:case $Control.CONTROL_TYPE_CHECKBOX:case $Control.CONTROL_TYPE_RADIO:$(this.element).addClass($Control.CLASSNAME_WRITABLE);break;case $Control.CONTROL_TYPE_RADIO_LIST:$(this.element).find("input[type=radio]").addClass($Control.CLASSNAME_WRITABLE);break;case $Control.CONTROL_TYPE_CHECKBOX_LIST:$(this.element).find("input[type=checkbox]").addClass($Control.CLASSNAME_WRITABLE);break;case $Control.CONTROL_TYPE_REMARK:case $Control.CONTROL_TYPE_SUGGESTER:case $Control.CONTROL_TYPE_FILE:break;case $Control.CONTROL_TYPE_ANCHOR:case $Control.CONTROL_TYPE_ACTION:case $Control.CONTROL_TYPE_LABEL:case $Control.CONTROL_TYPE_HIDDEN:break}},checkCompatibility:function(){if(this.field==null||this.render==null||this.render.renderCategory!=="Boundable"){return false}return $.inArray(this.field.type,this.compatibleFieldTypes)!==-1},checkDataType:function(fieldValue){switch(this.field.type){case InfoPlus.Controls.Control.DATA_TYPE_STRING:case InfoPlus.Controls.Control.DATA_TYPE_ANYURI:case InfoPlus.Controls.Control.DATA_TYPE_XHTML:case InfoPlus.Controls.Control.DATA_TYPE_USER:case InfoPlus.Controls.Control.DATA_TYPE_ORGANIZE:case InfoPlus.Controls.Control.DATA_TYPE_CODE:return $IU.isString(fieldValue);case InfoPlus.Controls.Control.DATA_TYPE_INT:case InfoPlus.Controls.Control.DATA_TYPE_DATE:return $IU.isInt(fieldValue);case InfoPlus.Controls.Control.DATA_TYPE_DOUBLE:return $IU.isNumber(fieldValue);case InfoPlus.Controls.Control.DATA_TYPE_BOOL:return $IU.isBoolean(fieldValue)}return false},setControlData:function(){var $element=$(this.element);$element.data($Control.DATA_TYPE,this.field.type).data($Control.DATA_CONTROL_TYPE,this.controlType).data($Control.DATA_CONTROL_OBJECT,this).data($Control.DATA_IS_CONTROL,true).data($Control.DATA_PATH,this.path).addClass($Control.CLASSNAME_CONTROL).addClass(this.getElementClassName());if(this.controlContainer!=null){$(this.controlContainer).data($Control.DATA_CONTROL_OBJECT,this)}},processDynamicValidation:function(){if(this.ignoreValidation||this.isReadOnly()){return}var element=this.element;var dynamics=this.render.properties;if(dynamics!=null&&dynamics.length>0){for(var i=0,len=dynamics.length;i<len;i++){var dynamic=dynamics[i];if(dynamic.key==="validation"&&dynamic.values!=null){var validator=$(element).data($Control.DATA_VALIDATOR);if(validator==null){validator={required:false,builtIn:false,dynamics:[]};$(element).data($Control.DATA_VALIDATOR,validator);var hiddenInput=$(element).data($Control.DATA_ORIGIN_INPUT);if(hiddenInput!==undefined){$(hiddenInput).data($Control.DATA_VALIDATOR,validator);if(this.validatorPromptPosition!==null){$(hiddenInput).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition)}}if(this.validatorPromptPosition!==null){$(element).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition)}$IU.addElementValidateClass(element)}if(validator.dynamics==null){validator.dynamics=[]}for(var tipIndex=0,tipLen=dynamic.values.length;tipIndex<tipLen;tipIndex++){var tip=dynamic.values[tipIndex];validator.dynamics.push({tip:tip.value,condition:tip.condition,builtIn:tip.builtIn})}}}}},processValidation:function(){if(this.ignoreValidation||this.isReadOnly()){return}var field=this.field;var element=this.element;if(field.notNull===true||field.regEx){var validator={required:field.notNull,regEx:field.regEx,prompt:field.prompt,builtIn:false};var hiddenInput=$(element).data($Control.DATA_ORIGIN_INPUT);if(hiddenInput!==undefined){$(hiddenInput).data($Control.DATA_VALIDATOR,validator)}$(element).data($Control.DATA_VALIDATOR,validator);if(this.validatorPromptPosition!==null){$(element).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition)}$IU.addElementValidateClass(element)}},setInfopathFormAttributes:function(){var element=this.element;if(element==null){return}var $element=$(element);var attributeList=this.render.attributes;if(attributeList==null||!$IU.isArray(attributeList)){return}for(var i=0;i<attributeList.length;i++){var attribute=attributeList[i];var key=attribute.key;if(null!=attribute.namespace&&""!==attribute.namespace){key=attribute.namespace+":"+key}try{switch(key.toLocaleLowerCase()){case"class":if(!this.ignoreClass){$element.addClass(attribute.value)}break;case"hidefocus":case"tabindex":if(this.allowFocus){element.setAttribute(key,attribute.value)}break;case"onclick":case"value":case"contenteditable":break;default:element.setAttribute(key,attribute.value);break}}catch(exception){}}},isWritable:function(){var field=this.field;if(field!=null){var permission=field.permission||"";return permission.indexOf("w")!==-1&&(!this.dynamicParallelReadonly)}return false},isReadable:function(){var field=this.field;if(field!=null){var permission=field.permission||"";return permission.indexOf("r")!==-1}return false},isEditable:function(){var field=this.field;if(field!=null){var permission=field.permission||"";return permission.indexOf("e")!==-1}return false},isDynamicReadonly:function(){return this.dynamicReadonly},hasNoPowerAtAll:function(){return(!this.isWritable()&&!this.isReadable())},isReadOnly:function(){return(!this.isWritable()&&this.isReadable())},isVisible:function(){return $(this.controlContainer||this.element).is(":visible")},hideControl:function(){this.element.style.display="none";this.element.disabled=true},setPermission:function(){if(this.field==null){return}if(!this.isReadable()){this.visible(false);return}if(this.isReadOnly()){this.setReadOnly()}if(this.isWritable()){this.setWritableClass()}},addFieldChangeClass:function(){if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){var originInput=$(this.element).data($Control.DATA_ORIGIN_INPUT);if(originInput!==undefined){$(originInput).addClass($Control.CLASSNAME_FIELD_CHANGE)}else{$(this.element).addClass($Control.CLASSNAME_FIELD_CHANGE)}}},setDynamicStyle:function(render,fromInit){this.dynamicProcessor.processDynamicStyle(this,render,undefined,undefined,fromInit)},doDynamicAction:function(render,fromInit){this.dynamicProcessor.processDynamicAction(this,render,undefined,undefined,fromInit)},doDynamicValidation:function(render,fromInit){this.dynamicProcessor.processDynamicValidation(this,render,undefined,undefined,fromInit)},setDynamicValue:function(render,fromInit){this.dynamicProcessor.processDynamicFormula(this,render,undefined,undefined,undefined,fromInit)},fieldChangeEvent:function(formData){return this.fieldChangeProcessor.fieldChangeEvent(this,formData)},fieldReferEvent:function(render,referParent,referSibling,referChild,fieldChangingReferAll,doAllActionStyle,excludePath){this.dynamicProcessor.fieldReferEvent(this,render,referParent,referSibling,referChild,fieldChangingReferAll,doAllActionStyle,excludePath)},fieldSyncEvent:function(){var value=this.getValue(),name=this.render.field+this.path,thisElement=this.element,count=0,displayValue,attributes;if(value instanceof $Controls.Data.ValuePair){displayValue=value.displayValue;attributes=this.getAttributes();value=value.value}if(value instanceof $Controls.Data.Uri){value=value.value}$$.params.fieldSyncing=true;var getControl=function($element){var control=$element.data($Control.DATA_SOURCE_CONTROL);if(control===undefined){control=$element.data($Control.DATA_CONTROL_OBJECT)}return control};var elements=document.getElementsByName(name);for(var i=0,len=elements.length;i<len;i++){var control=getControl($(elements[i]));if(control==null||elements[i]===thisElement||control===this){continue}if(this.controlType===$Control.CONTROL_TYPE_RADIO&&control.controlType===$Control.CONTROL_TYPE_RADIO){continue}var oldValue=control.getValue();if(oldValue instanceof $Controls.Data.Thing){var changed=(oldValue.value!==value)||(oldValue.displayValue!==displayValue)}else{if(oldValue!=null&&oldValue.value!==undefined){oldValue=oldValue.value}changed=oldValue!==value}if(!changed){continue}control.syncValue(value,displayValue,attributes);count++}$$.params.fieldSyncing=false},registerEvent:function(){},shouldFireChangeEvent:function(fieldValue){if(this.synced===true){this.synced=false;return false}if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){var oldValue=this.getValue(),currentValueIsValuePair=(fieldValue!=null&&fieldValue.value!==undefined&&fieldValue.displayValue!==undefined);if(oldValue instanceof $Controls.Data.Uri){return oldValue.value!==fieldValue}if(oldValue instanceof $Controls.Data.Thing){if(currentValueIsValuePair){return(oldValue.value!==fieldValue.value)||(oldValue.displayValue!==fieldValue.displayValue)}else{return(oldValue.displayValue!==fieldValue)}}if(oldValue instanceof $Controls.Data.ValuePair){if(currentValueIsValuePair){return(oldValue.value!==fieldValue.value)}else{return(oldValue.value!==fieldValue)}}if(currentValueIsValuePair){return(oldValue!==fieldValue.value)}else{return(oldValue!==fieldValue)}}return false},shouldFireChangeEventAgain:function(fieldValue){return this.autoTriggerFieldChangeEvent&&this.shouldFireChangeEvent(fieldValue)},getDataSource:function(){return null},getDataType:function(){if(this.field==null){return null}return this.field.type},setFocus:function(){if(this.element==null||!this.isReadable()){return}try{this.element.focus()}catch(e){}},lostFocus:function(){if(this.element==null||!this.isReadable()){return}try{this.element.blur()}catch(e){}},getDynamicKeyName:function(){if(this.field==null){return null}return this.field.name},getDynamicContextControlName:function(){if(this.field==null||this.field.name==null){return null}return this.field.name+"Ref"},setPlaceHolder:function(){if(this.element!=null&&this.element.placeholder!==undefined){if(this.field!=null&&this.field.placeHolder!=null){$(this.element).attr("placeholder",this.field.placeHolder)}}},setParentValue:function(parentValue){if((parentValue instanceof $Controls.Data.ValuePair)||(parentValue instanceof $Controls.Data.Uri)){this.parentValue=parentValue.value}else{this.parentValue=parentValue}},visible:function(isVisible){if(this.element==null){return}if(isVisible){if(this.isReadable()){if(this.isWritable()){$(this.element).removeAttr("disabled")}$(this.element).show();if(this.controlContainer!=null){$(this.controlContainer).show()}}}else{$(this.element).attr("disabled","disabled").hide();if(this.controlContainer!=null){$(this.controlContainer).hide()}}},convertEmptyValue:function(val){if(val==null||val===""){return""}else{return val}},getRow:function(){var container=this.controlContainer,element=container==null?this.element:container;return $(element).parents("tr,.infoplus_repeatingSection,.infoplus_view").first()},setMaxLength:function(){if(this.field.settings!=null){if(this.field.settings.maxLength!=null){var max=parseInt(this.field.settings.maxLength,10);if(!isNaN(max)&&max!==0){this.maxLength=max}}}},getGroupName:function(){if(this.field==null){return""}var field=this.field;if(field.groupArray.length<2){return""}return field.groupArray[field.groupArray.length-1]},getGroupRowIndexName:function(){if(this.field==null){return""}var field=this.field;if(field.groupArray.length<2){return""}var groupName=field.groupArray[field.groupArray.length-1];groupName=groupName.substr(0,1).toUpperCase()+groupName.substr(1);return"field"+groupName+"RowIndex"+$$.params.rowIndexSuffix},getGroupCountName:function(){if(this.field==null){return""}var field=this.field;if(field.groupArray.length<2){return""}var groupName=field.groupArray[field.groupArray.length-1];groupName=groupName.substr(0,1).toUpperCase()+groupName.substr(1);return"field"+groupName+"Count"+$$.params.rowIndexSuffix},isDetailControl:function(){if(this.element==null){return false}return $(this.element).parents(".detailCell").size()>0||$(this.element).parents(".detailSection").size()>0},setTooltip:function(tooltip){try{if(tooltip===""){this.tooltip=null}else{this.tooltip=$.parseJSON(tooltip);if(typeof this.tooltip!=="object"){this.tooltip={tip:tooltip,type:"info"}}}}catch(e){this.tooltip={tip:tooltip,type:"info"}}},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip===""){return}$(this.element).validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",true);$(this.element).one("blur",function(){$(this).validationEngine("hidePrompt")})},markModified:function(){this.setClass("modified")},clearModified:function(){this.removeClass("modified")},setClass:function(className){if(this.controlContainer!=null){$(this.controlContainer).addClass(className)}else{$(this.element).addClass(className)}},removeClass:function(className){if(this.controlContainer!=null){$(this.controlContainer).removeClass(className)}else{$(this.element).removeClass(className)}}};define("InfoPlus.Controls.Control",control);window.$Controls=InfoPlus.Controls;window.$Control=InfoPlus.Controls.Control})(window);
(function(window,undefined){var adapter={};adapter.defaultOptions={dateFormat:"yy-mm-dd",changeYear:true,changeMonth:true,yearRange:"c-100:c+50",beforeShow:function(input){var validator=$(this).data($Control.DATA_VALIDATOR);if(validator===undefined||validator===null){return}if(validator.required===true||(validator.regEx&&validator.prompt)){$IU.removeElementValidateClass(this)}if($(input).attr("readonly")){return false}},onClose:function(){var validator=$(this).data($Control.DATA_VALIDATOR);if(validator===undefined||validator===null){return}if(validator.required===true||(validator.regEx&&validator.prompt)){$IU.addElementValidateClass(this);$$.params.renderForm.validationEngine("validateField","#"+this.id)}}};adapter.create=function(element,options){var checkDateFormat=function(format){var field=$(element).data($Control.DATA_CONTROL_OBJECT).field;if(format==null||!$IU.isString(format)){return false}if(format.length!=8||format.substr(0,6)!="yy-mm-"){$IU.debugTip($$.lt("date.errorFormat",field.name),"warning");return false}var day=parseInt(format.substr(6,2),10);if(isNaN(day)||day>31){$IU.debugTip($$.lt("date.errorFormat",field.name),"warning");return false}return true};if(options.dateFormat!=null){var format=options.dateFormat;if(checkDateFormat(format)){var day=parseInt(format.substr(7,2),10);options.showYearMonthOnly=true;options.showButtonPanel=true;options.onClose=function(dateText,inst){$(this).datepicker("setDate",new Date(inst.selectedYear,inst.selectedMonth,day));adapter.defaultOptions.onClose()}}options.dateFormat="yy-mm-dd"}options=$.extend({},adapter.defaultOptions,options);$(element).datepicker(options)};adapter.destroy=function(element){$(element).datepicker("destroy")};adapter.setReadOnly=function(element,isReadOnly){element.readOnly=(isReadOnly===true)};define("InfoPlus.Controls.Adapter.DateAdapter",adapter)})(window);
(function(window,undefined){var anchor=function(path,field,render,initValue,initDisplayValue){$Control.call(this,$Control.CONTROL_TYPE_ANCHOR,path,field,render,initValue,initDisplayValue)};anchor.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_CODE],ignoreValidation:true,allowFocus:false,name:"anchor",clickFireFieldChange:true,getAnchorText:function(displayValue){var field=this.field,settings=field.settings;var anchorText=$$.lt("anchor.defaultText");if(displayValue!=null&&displayValue!==""){anchorText=displayValue}else{if(settings!=null&&settings.displayText!=null){anchorText=settings.displayText}}return anchorText},createElement:function(){var field=this.field;var endPoint=this.initValue;if(endPoint==null||endPoint===""){endPoint="#"}var element=document.createElement("a");var $element=$(element);var anchorText=this.getAnchorText(this.initDisplayValue);$element.text(anchorText);var externalLink=new InfoPlus.ExternalLink(endPoint,field.settings,anchorText);element.setAttribute("href","");element.setAttribute("target",externalLink.mode===InfoPlus.ExternalLink.MODE_SELF?"_self":"_blank");$element.data("href",endPoint).data($Control.DATA_EXTERNAL_LINK,externalLink);return element},setValue:function(fieldValue,fieldDisplayValue){var externalLink=$(this.element).data($Control.DATA_EXTERNAL_LINK);if(externalLink==null){return}if(fieldValue!=null&&fieldValue!==""){externalLink.endPoint=fieldValue}else{externalLink.endPoint="#"}var anchorText=this.getAnchorText(fieldDisplayValue);$(this.element).text(anchorText)},getValue:function(){var externalLink=$(this.element).data($Control.DATA_EXTERNAL_LINK);if(externalLink==null){switch(this.field.type){case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri("");case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair("","")}return""}switch(this.field.type){case $Control.DATA_TYPE_STRING:return externalLink.endPoint==="#"?"":externalLink.endPoint;case $Control.DATA_TYPE_ANYURI:return externalLink.endPoint==="#"?new $Controls.Data.Uri(""):new $Controls.Data.Uri(externalLink.endPoint);case $Control.DATA_TYPE_CODE:return externalLink.endPoint==="#"?new $Controls.Data.ValuePair("",""):new $Controls.Data.ValuePair(externalLink.endPoint,$(this.element).text())}return""},getSortValue:function(){return this.element.innerHTML},getAttributes:function(){if(this.field.type===$Control.DATA_TYPE_ANYURI){var val=this.getValue();return $IU.getParamFromUrl(val.value)}return null},registerEvent:function(){this.events=InfoPlus.Controls.Anchor.Events.events},setDynamicReadOnly:function(isReadOnly){if(isReadOnly){$(this.element).addClass($Control.CLASSNAME_READONLY)}else{$(this.element).removeClass($Control.CLASSNAME_READONLY)}},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=true;this.setDynamicReadOnly(true)}});define("InfoPlus.Controls.Anchor",anchor);var anchorEvents={onMouseDown:function(e){if(e.which===2||e.which===3){e.stopImmediatePropagation();e.preventDefault();var instance=this;setTimeout(function(){$IU.fireClick(instance)},e.which===3?200:0);return false}},onContextMenu:function(){return false},onActionClick:function(){var anchorControl=$(this).data($Control.DATA_CONTROL_OBJECT),field=anchorControl.field,externalLink=$(this).data($Control.DATA_EXTERNAL_LINK),endPoint=externalLink.endPoint,instance=this;if(field==null){return false}if($(instance).data("clickFromCode")===true){$(instance).data("clickFromCode",false);return true}var clickEvent=function(){instance.href=endPoint;externalLink.href=endPoint;return(!externalLink.openWindow())};if(field.placeHolder!=null&&field.placeHolder!==""){if(!confirm(field.placeHolder)){return false}}if(field.fieldChanging===true){var data={},render=$$.getFormRender();data=render.save(data,anchorControl.isDetailControl());anchorControl.fieldChangeEvent(data).done(function(){render.doDynamicsAfterFieldChange();$$.fieldChanged($$(anchorControl));$$(anchorControl).fieldChanged()}).fail(function(data){if(data.errCode==="EVENT_CANCELLED"){render.doDynamicsAfterFieldChange()}}).done(function(){endPoint=$(instance).data($Control.DATA_EXTERNAL_LINK).endPoint;if(clickEvent()){$(instance).data("clickFromCode",true);$IU.fireClick(instance.id);setTimeout(function(){$(instance).data("clickFromCode",false)},1000)}});return false}else{return clickEvent()}}};anchorEvents.events=[{type:"click",handler:anchorEvents.onActionClick},{type:"mousedown",handler:anchorEvents.onMouseDown},{type:"contextmenu",handler:anchorEvents.onContextMenu}];define("InfoPlus.Controls.Anchor.Events",anchorEvents)})(window);
(function(window,undefined){var button=function(path,field,render,initValue,initDisplayValue){field.fieldChanging=true;if(initDisplayValue==null||initDisplayValue===""){if(field.settings!=null&&field.settings.displayText!=null){initDisplayValue=field.settings.displayText}}$Control.call(this,$Control.CONTROL_TYPE_BUTTON,path,field,render,initValue,initDisplayValue)};button.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_CODE],ignoreClass:true,ignoreValidation:true,name:"button",clickFireFieldChange:true,hasHiddenElement:true,getButtonText:function(value,displayValue){var field=this.field,settings=field.settings;if(displayValue!=null&&displayValue!==""){return displayValue}if(value!=null&&value!==""){return value}if(settings!=null&&settings.displayText!=null){return settings.displayText}return $$.lt("button.defaultText")},createElement:function(){var element=document.createElement("button");var buttonText=this.getButtonText(this.initValue,this.initDisplayValue);var buttonContainer=document.createElement("div");element.setAttribute("type","button");$(element).text(buttonText);buttonContainer.appendChild(element);this.controlContainer=buttonContainer;$(buttonContainer).addClass("infoplus_buttonControlContainer");return element},setValue:function(fieldValue,fieldDisplayValue){var buttonText=this.getButtonText(fieldValue,fieldDisplayValue);$(this.element).text(buttonText).val(fieldValue)},getValue:function(){var value=this.convertEmptyValue($(this.element).val());switch(this.field.type){case $Control.DATA_TYPE_STRING:return value;case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair(value,$(this.element).text())}},registerEvent:function(){this.events=InfoPlus.Controls.Button.Events.events},triggerChange:function(){var $element=$(this.element),hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);if(this.onFieldChange){$element.attr("disabled","disabled")}$(hiddenInput).change()}});define("InfoPlus.Controls.Button",button);var buttonEvents={onButtonClick:function(){var buttonControl=$(this).data($Control.DATA_CONTROL_OBJECT),field=buttonControl.field;if(field==null){return false}if(buttonControl.isReadOnly()||$(buttonControl.element).hasClass($Control.CLASSNAME_READONLY)){return false}if(field.placeHolder!=null&&field.placeHolder!==""){$IU.yesNoBox(field.placeHolder,400,function(){buttonControl.triggerChange()})}else{buttonControl.triggerChange()}return false}};buttonEvents.events=[{type:"click",handler:buttonEvents.onButtonClick}];define("InfoPlus.Controls.Button.Events",buttonEvents)})(window);
(function(window,undefined){var linkButton=function(path,field,render,initValue,initDisplayValue){field.fieldChanging=true;if(initDisplayValue==null||initDisplayValue===""){if(field.settings!=null&&field.settings.displayText!=null){initDisplayValue=field.settings.displayText}}$Control.call(this,$Control.CONTROL_TYPE_LINK_BUTTON,path,field,render,initValue,initDisplayValue)};linkButton.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_CODE],ignoreClass:true,ignoreValidation:true,name:"linkButton",hasHiddenElement:true,clickFireFieldChange:true,getButtonText:function(value,displayValue){var field=this.field,settings=field.settings;if(displayValue!=null&&displayValue!==""){return displayValue}if(value!=null&&value!==""){return value}if(settings!=null&&settings.displayText!=null){return settings.displayText}return $$.lt("button.defaultText")},createElement:function(){var element=document.createElement("a"),$element=$(element);var buttonText=this.getButtonText(this.initValue,this.initDisplayValue);var buttonContainer=document.createElement("div");$element.text(buttonText);element.setAttribute("href","");buttonContainer.appendChild(element);this.controlContainer=buttonContainer;$(buttonContainer).addClass("infoplus_buttonControlContainer");return element},setValue:function(fieldValue,fieldDisplayValue){var buttonText=this.getButtonText(fieldValue,fieldDisplayValue);$(this.element).text(buttonText).val(fieldValue)},getValue:function(){var value=this.convertEmptyValue($(this.element).val());switch(this.field.type){case $Control.DATA_TYPE_STRING:return value;case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair(value,$(this.element).text())}},registerEvent:function(){this.events=InfoPlus.Controls.LinkButton.Events.events},setDynamicReadOnly:function(isReadOnly){if(isReadOnly){$(this.element).addClass($Control.CLASSNAME_READONLY)}else{$(this.element).removeClass($Control.CLASSNAME_READONLY)}},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=true;this.setDynamicReadOnly(true)},triggerChange:function(){var $element=$(this.element),hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);if(this.onFieldChange){$element.attr("disabled","disabled")}$(hiddenInput).change()}});define("InfoPlus.Controls.LinkButton",linkButton);var buttonEvents={onButtonClick:function(){if($(this).is("[disabled]")){return false}var buttonControl=$(this).data($Control.DATA_CONTROL_OBJECT),field=buttonControl.field;if(field==null){return false}if(buttonControl.isReadOnly()||$(buttonControl.element).hasClass($Control.CLASSNAME_READONLY)){return false}if(field.placeHolder!=null&&field.placeHolder!==""){$IU.yesNoBox(field.placeHolder,400,function(){buttonControl.triggerChange()})}else{buttonControl.triggerChange()}return false}};buttonEvents.events=[{type:"click",handler:buttonEvents.onButtonClick}];define("InfoPlus.Controls.LinkButton.Events",buttonEvents)})(window);
(function(window,undefined){var checkButton=function(path,field,render,initValue,initDisplayValue,initAttributes){if(initDisplayValue==null||initDisplayValue===""){if(field.settings!=null&&field.settings.displayText!=null){initDisplayValue=field.settings.displayText}}$Control.call(this,$Control.CONTROL_TYPE_CHECK_BUTTON,path,field,render,initValue,initDisplayValue,initAttributes)};checkButton.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL,$Control.DATA_TYPE_CODE],ignoreClass:true,ignoreValidation:true,name:"checkButton",clickFireFieldChange:true,hasHiddenElement:true,getButtonText:function(displayValue){var field=this.field,settings=field.settings;if(displayValue!=null&&displayValue!==""){return displayValue}if(settings!=null&&settings.displayText!=null){return settings.displayText}return $$.lt("button.defaultText")},createElement:function(){var element=document.createElement("button");var buttonText=this.getButtonText(this.initDisplayValue);var buttonContainer=document.createElement("div");element.setAttribute("type","button");$(element).text(buttonText);buttonContainer.appendChild(element);this.controlContainer=buttonContainer;$(buttonContainer).addClass("infoplus_checkButtonControlContainer");return element},setValue:function(fieldValue,fieldDisplayValue,fromInit,attributes){var buttonText=this.getButtonText(fieldDisplayValue);var hiddenInput=$(this.element).data($Control.DATA_ORIGIN_INPUT);hiddenInput.value=fieldValue;$(this.element).text(buttonText);this.setAttributes(attributes);this.setCheckClass()},toggleCheckValue:function(){if(this.field.type===$Control.DATA_TYPE_BOOL){var hiddenInput=$(this.element).data($Control.DATA_ORIGIN_INPUT);if(hiddenInput.value==="true"){hiddenInput.value="false"}else{hiddenInput.value="true"}}else{var attributes=this.getAttributes();if(attributes==null){attributes={checked:"true"};this.setAttributes(attributes)}else{attributes.checked=attributes.checked==="true"?"false":"true"}}this.setCheckClass()},setCheckClass:function(){if(this.field.type===$Control.DATA_TYPE_BOOL){var value=$(this.element).data($Control.DATA_ORIGIN_INPUT).value;if(value==="true"){$(this.element).addClass("checked")}else{$(this.element).removeClass("checked")}}else{var attributes=this.getAttributes();if(attributes!=null&&attributes.checked==="true"){$(this.element).addClass("checked")}else{$(this.element).removeClass("checked")}}},getValue:function(){var hiddenInput=$(this.element).data($Control.DATA_ORIGIN_INPUT);switch(this.field.type){case $Control.DATA_TYPE_BOOL:return hiddenInput.value.toLowerCase()==="true";case $Control.DATA_TYPE_CODE:return new $Controls.Data.ValuePair($(hiddenInput).val(),$(this.element).text())}},registerEvent:function(){this.events=InfoPlus.Controls.CheckButton.Events.events},triggerChange:function(){var $element=$(this.element),hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);if(this.onFieldChange){$element.attr("disabled","disabled")}$(hiddenInput).change()}});define("InfoPlus.Controls.CheckButton",checkButton);var buttonEvents={onButtonClick:function(){var buttonControl=$(this).data($Control.DATA_CONTROL_OBJECT),field=buttonControl.field;if(field==null){return false}if(buttonControl.isReadOnly()||$(buttonControl.element).hasClass($Control.CLASSNAME_READONLY)){return false}buttonControl.toggleCheckValue();if(field.placeHolder!=null&&field.placeHolder!==""){$IU.yesNoBox(field.placeHolder,400,function(){buttonControl.triggerChange()})}else{buttonControl.triggerChange()}return false}};buttonEvents.events=[{type:"click",handler:buttonEvents.onButtonClick}];define("InfoPlus.Controls.CheckButton.Events",buttonEvents)})(window);
(function(window,undefined){var check=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_CHECKBOX,path,field,render,initValue,null)};check.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL],name:"check",createElement:function(){var element=document.createElement("input");element.type="checkbox";return element},initCheck:function(){if(this.element===undefined){return}var siblings=this.element.parentElement.childNodes;for(var i=0,len=siblings.length;i<len;i++){if(siblings[i]===this.element&&i<len-1){var nextNode=siblings[i+1],$nextNode=$(nextNode);if(!$nextNode.hasClass($Control.CLASSNAME_CONTROL)&&$nextNode.find("."+$Control.CLASSNAME_CONTROL).length===0){var label=document.createElement("label"),$label=$(label);$nextNode.detach().appendTo($label);$label.attr("for",this.element.getAttribute("id")).insertAfter(this.element).addClass("infoplus_checkLabel")}break}}},setValue:function(fieldValue){if(fieldValue==null){fieldValue=false}if($IU.isString(fieldValue)){fieldValue=(fieldValue.toLowerCase()==="true")}this.element.checked=(fieldValue===true);if(fieldValue===true){$(this.element).addClass("checked")}else{$(this.element).removeClass("checked")}},getValue:function(){return this.element.checked},getSortValue:function(){return this.getValue()?1:0},setReadOnly:function(){this.element.readOnly=true;this.element.disabled=true;$(this.element).addClass($Control.CLASSNAME_READONLY).addClass("disabled")},registerEvent:function(){this.events=InfoPlus.Controls.Check.Events.events},markModified:function(){$(this.element).parent().addClass("modified")},clearModified:function(){$(this.element).parent().removeClass("modified")}});define("InfoPlus.Controls.Check",check);var checkEvents={onCheckChange:function(event){var checkControl=$(this).data($Control.DATA_CONTROL_OBJECT),field=checkControl.field;if($(this).is(":checked")){$(this).addClass("checked")}else{$(this).removeClass("checked")}if(field!=null&&field.placeHolder!=null&&field.placeHolder!==""){if(checkControl.checkFromConfirm===true){checkControl.checkFromConfirm=false;return}var value=$(this).is(":checked");checkControl.setValue(!value);$IU.yesNoBox(field.placeHolder,400,function(){checkControl.setValue(value);checkControl.checkFromConfirm=true;$(checkControl.element).change()});event.stopImmediatePropagation();return false}}};checkEvents.events=[{type:"change",handler:checkEvents.onCheckChange}];define("InfoPlus.Controls.Check.Events",checkEvents)})(window);
(function(window,undefined){var findValueInItems=function(value,items){for(var i=0,len=items.length;i<len;i++){if(value===items[i].id){return true}}return false};var addItemsFromInitValue=function(initValue,initDisplayValue,items){if(initValue.indexOf("\n")!==-1){var values=initValue.split("\n")}else{values=initValue.split(",")}var names;if(initDisplayValue!=null){if(initDisplayValue.indexOf("\n")!==-1){names=initDisplayValue.split("\n")}else{names=initDisplayValue.split(",")}}names=names||[];for(var i=0,len=values.length;i<len;i++){if(!findValueInItems(values[i],items)){items.unshift({id:values[i],text:names[i]?names[i]:values[i],enabled:false})}}};var checkList=function(path,field,render,initValue,initDisplayValue){var items=null;if(field.code!=null){var code=$$.codeManager.getCode(field.code);if(code!=null){items=[];for(var i=0,len=code.items.length;i<len;i++){items.push({id:code.items[i].codeId,text:code.items[i].codeName,enabled:code.items[i].enabled})}}if(items==null||($IU.isArray(items)&&items.length===0)){if(code==null||(code!=null&&code.codeType==="External")){$$.codeManager.addRequestCode(field.code,field.name)}}}if(initValue!=null&&initValue!==""){if(items==null){items=[]}addItemsFromInitValue(initValue,initDisplayValue,items)}this.items=items;$Control.call(this,$Control.CONTROL_TYPE_CHECKBOX_LIST,path,field,render,initValue,initDisplayValue)};checkList.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],ignoreClass:true,autoTriggerFieldChangeEvent:false,name:"checkList",validatorPromptPosition:"topLeft",hasHiddenElement:true,createElement:function(){var element=document.createElement("div");this.createHiddenElement(element);this.setDataSourceFromItems(element,this.items,true,true);return element},setValue:function(fieldValue,fieldDisplayValue,fromInit){if(fieldValue==null){fieldValue=""}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);var $element=$(this.element);var hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);switch(this.field.type){case $Control.DATA_TYPE_STRING:hiddenInput.value=fieldValue;$(hiddenInput).data("label",fieldDisplayValue);break}var valueArray=fieldValue.split(",");var isReadOnly=this.isReadOnly();$(this.element).find("input[type=checkbox]").each(function(){this.checked=$IU.arrayContains(valueArray,$IU.trimString($(this).val()));if(isReadOnly){if(this.checked){$(this).parent().addClass("checked").removeClass("unchecked")}else{$(this).parent().addClass("unchecked").removeClass("checked")}}else{if(this.checked){$(this).parent().addClass("checked")}else{$(this).parent().removeClass("checked")}}});if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(fromInit){if(this.field==null||this.element==null){return""}if(fromInit===true){var hiddenInput=$(this.element).data($Control.DATA_ORIGIN_INPUT);return hiddenInput.value}var val="",name="";$(this.element).find("input[type=checkbox]").each(function(){if(this.checked){val+=$IU.trimString(this.value)+",";name+=$IU.trimString($(this).data("label"))+","}});if(val!==""){val=val.substr(0,val.length-1)}if(name!==""){name=name.substr(0,name.length-1)}return new $Controls.Data.ValuePair(val,name)},getStringValue:function(fromInit){var val=this.getValue(fromInit);if(val instanceof $Controls.Data.ValuePair){return val.value}else{return val}},checkValid:function(){var result=true;if(this.isReadOnly()){return result}$(this.element).find("input[type=checkbox]").each(function(){if(this.checked){if($(this).parent().hasClass("deprecated")){result=false}}});return result},setDataSourceFromItems:function(element,items,fromInit,fromCreate){var hiddenInput=$(element).data($Control.DATA_ORIGIN_INPUT);var value=fromInit?hiddenInput.value:this.getValue(),valueArray=(value==null||value==="")?[]:(value instanceof $Controls.Data.ValuePair?value.value.split(","):value.split(","));var isReadOnly=this.isReadOnly();$(element).children("label").remove();var hasDeprecatedItem=false;if($IU.isArray(items)){for(var i=0,len=items.length;i<len;i++){var item=items[i];var label=document.createElement("label"),input=document.createElement("input"),$label=$(label);input.type="checkbox";input.value=item.id;if($IU.arrayContains(valueArray,$IU.trimString(item.id))){input.checked=true;$label.addClass("checked")}$(input).data("label",item.text);var span=document.createElement("span");$(span).text(item.text);$label.append(input);$label.append(span);if(fromInit&&!item.enabled&&!isReadOnly){$label.addClass("deprecated");var icon=document.createElement("i");$(icon).addClass("i-icon-delete-outline");$label.append(icon);hasDeprecatedItem=true}element.appendChild(label)}}if(hasDeprecatedItem){var dynamicValidation={key:"validation",values:[{value:"'"+$$.lt("checkList.deprecated")+"'",condition:"!$"+this.field.name+"Ref.isValid",builtIn:true}]};var dynamics=this.render.properties;if(dynamics==null){this.render.properties=[dynamicValidation]}else{dynamics.push(dynamicValidation)}}if(fromCreate!==true){this.setDynamicStyle($$.params.formRender,fromInit)}},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip===""){return}var $element=$(this.element);$element.validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",true);$element.find("input").one("blur",function(){$element.validationEngine("hidePrompt")})},setStyle:function(name,value){var $labels=$(this.element).find("label");for(var i=0,len=$labels.length;i<len;i++){var label=$labels[i];$IU.setDynamicStyle(label,name,value)}},specialSetting:function(){var style=$(this.element).attr("style");if(style!=null){style=style.toLowerCase();if(style.indexOf("height:")!==-1){$(this.element).css("min-height",$(this.element).css("height"));$(this.element).css("height","")}}},registerEvent:function(){this.events=InfoPlus.Controls.CheckList.Events.events},setOptions:function(element,items){var removeInitItems=function(initItems){for(var i=0,len=items.length;i<len;i++){var item=items[i];var foundIndex=-1;for(var j=0,l=initItems.length;j<l;j++){var oldItem=initItems[j];if(oldItem.id===item.codeId){foundIndex=j;break}}if(foundIndex!==-1){initItems.splice(foundIndex,1)}}};if(this.items==null){this.items=[]}removeInitItems(this.items);for(var i=0,len=items.length;i<len;i++){var item=items[i];this.items.push({id:item.codeId,text:item.codeName,enabled:item.enabled})}this.setDataSourceFromItems(this.element,this.items,true);this.setPermission()},setDataSource:function(dataSource,fromInit){this.items=[];if($IU.isString(dataSource)){if(dataSource.indexOf("\n")!==-1){var dataArray=dataSource.split("\n")}else{dataArray=dataSource.split(",")}for(var i=0,len=dataArray.length;i<len;i++){var data=dataArray[i];this.items.push({id:data,text:data,enabled:true})}}if(fromInit&&this.initValue!==""){addItemsFromInitValue(this.initValue,this.initDisplayValue,this.items)}this.setDataSourceFromItems(this.element,this.items,fromInit);this.setPermission();var $element=$(this.element);var $hiddenInput=$($element.data($Control.DATA_ORIGIN_INPUT));$hiddenInput.val(this.getStringValue()).change()},setDynamicReadOnly:function(isReadOnly){if(isReadOnly){$(this.element).find("input[type=checkbox]").each(function(){if(this.checked){$(this).parent().addClass("checked").removeClass("unchecked")}else{$(this).parent().addClass("unchecked").removeClass("checked")}$(this).addClass($Control.CLASSNAME_READONLY);this.disabled=true})}else{$(this.element).find("label").removeAttr("class");$(this.element).find("input[type=checkbox]").each(function(){$(this).removeClass($Control.CLASSNAME_READONLY);this.disabled=false})}}});define("InfoPlus.Controls.CheckList",checkList);var checkListEvents={onClick:function(){var $label=$(this).parent();if($(this).is(":checked")){$label.addClass("checked")}else{$label.removeClass("checked");if($label.hasClass("deprecated")){$label.animate({width:0},function(){$label.remove()})}}var hiddenInput=$(this).parent().siblings("input[type=hidden]");var control=$(hiddenInput).data($Control.DATA_CONTROL_OBJECT);$(hiddenInput).val(control.getStringValue());$(hiddenInput).change()}};checkListEvents.events=[{type:"click",selector:".infoplus_checkListControl > label > input[type=checkbox]",handler:checkListEvents.onClick}];define("InfoPlus.Controls.CheckList.Events",checkListEvents)})(window);
(function(window,undefined){var date=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_DATE,path,field,render,initValue,null)};date.DEFAULT_VALIDATOR_REGEX="^(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29)$";date.DEFAULT_VALIDATOR_PROMPT=$$.lt("date.validateMessage");date.INPUT_TYPE_DATE_SUPPORT=true;date.mobileDateSupport=function(){return true};var useHtml5DateInput=function(){return $$.MOBILE&&date.INPUT_TYPE_DATE_SUPPORT&&date.mobileDateSupport};date.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_DATE],name:"date",createElement:function(){var checkDateFormat=function(field){var format=field.format;if(format==null||!$IU.isString(format)){return false}if(format.length!==8||format.substr(0,6)!=="yy-mm-"){$IU.debugTip($$.lt("date.errorFormat",field.name),"warning");return false}var day=parseInt(format.substr(6,2),10);if(isNaN(day)||day>31){$IU.debugTip($$.lt("date.errorFormat",field.name),"warning");return false}return true};if(this.field.format!=null&&this.field.format!==""){if(checkDateFormat(this.field)){this.monthOnly=true;this.monthDay=this.field.format.substr(6,2)}}var element=document.createElement("input");if(useHtml5DateInput()){try{element.type=this.monthOnly?"month":"date"}catch(e){date.INPUT_TYPE_DATE_SUPPORT=false;element.type="text"}}else{element.type="text"}$(element).attr("autocomplete","off");return element},setValue:function(fieldValue){if(fieldValue==null){fieldValue=""}if(fieldValue!==""&&isNaN(fieldValue)===false){var value=$IU.unixTimeToDateString(fieldValue);this.element.value=(useHtml5DateInput()&&this.monthOnly)?value.substr(0,7):value}else{this.element.value=""}},getValue:function(){var elementValue=(useHtml5DateInput()&&this.monthOnly)?(this.element.value+"-"+this.monthDay):this.element.value;var val=this.convertEmptyValue(elementValue);val=$IU.dateStringToUnixTime(val);if(val!=null&&val!==""&&!isNaN(val)){return val}else{return""}},getSortValue:function(){var val=this.getValue();return val===""?0:val},addDefaultValidator:function(){var permission=this.field.permission||"";if(permission.indexOf("r")!==-1&&permission.indexOf("w")===-1){return}var $element=$(this.element);var validator=$element.data($Control.DATA_VALIDATOR);if(validator==null){$element.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:date.DEFAULT_VALIDATOR_REGEX,prompt:date.DEFAULT_VALIDATOR_PROMPT,builtIn:true})}else{if(validator.regEx==null||validator.regEx===""){validator.regEx=date.DEFAULT_VALIDATOR_REGEX;validator.prompt=date.DEFAULT_VALIDATOR_PROMPT;validator.builtIn=(!validator.required===true)}}},specialSetting:function(){this.initDatePicker();this.addDefaultValidator()},initDatePicker:function(){var permission=this.field.permission||"";if(permission.indexOf("w")!==-1){var fieldName=this.field.name;if(fieldName.substr(fieldName.length-2)==="To"){var instance=this;setTimeout(function(){instance.initDatePickerOption()},500)}else{this.initDatePickerOption()}}},reInitDatePicker:function(){if(useHtml5DateInput()){return}var permission=this.field.permission||"";if(permission.indexOf("w")!==-1){$(this.element).datepicker("destroy");this.initDatePickerOption()}},initDatePickerOption:function(options){if(options==null){options={}}if(options.minDate==null){var fieldName=this.field.name;if(fieldName.substr(fieldName.length-2)==="To"){var pos=fieldName.lastIndexOf("To");var fromName=fieldName.substr(0,pos)+fieldName.substr(pos).replace(/To/,"From")+this.path;var $fromDateElement=$$.params.renderForm.find("."+this.getElementClassName()+"[name='"+fromName+"'");if($fromDateElement.length>0){var value=$fromDateElement.data($Control.DATA_CONTROL_OBJECT).getValue();if(useHtml5DateInput()){if(value!==""){$(this.element).attr("min",$IU.unixTimeToDateString(value))}else{$(this.element).attr("min","")}}else{if(value!==""){options.minDate=$IU.unixTimeToDate(value)}}}}}if(useHtml5DateInput()){return}var permission=this.field.permission||"";if(permission.indexOf("w")!==-1){if(this.field.format!=null&&this.field.format!==""){options.dateFormat=this.field.format}InfoPlus.Controls.Adapter.DateAdapter.create(this.element,options)}},onDatePickerBeforeShow:function(input,inst){var validator=$(this).data($Control.DATA_VALIDATOR);if(validator===undefined||validator===null){return}if(validator.required===true||(validator.regEx&&validator.prompt)){$IU.removeElementValidateClass(this)}if($(input).attr("readonly")){return false}},onDatePickerClose:function(dateText,inst){var validator=$(this).data($Control.DATA_VALIDATOR);if(validator===undefined||validator===null){return}if(validator.required===true||(validator.regEx&&validator.prompt)){$IU.addElementValidateClass(this);$$.params.renderForm.validationEngine("validateField","#"+this.id)}},registerEvent:function(){this.events=InfoPlus.Controls.Date.Events.events},setDynamicReadOnly:function(isReadOnly){InfoPlus.Controls.Adapter.DateAdapter.setReadOnly(this.element,isReadOnly)}});define("InfoPlus.Controls.Date",date);var dateEvents={onChange:function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT),value=control.getValue();var fieldName=control.field.name;if(fieldName.length>4){if(fieldName.substr(fieldName.length-4)==="From"){var pos=fieldName.lastIndexOf("From");var toName=fieldName.substr(0,pos)+fieldName.substr(pos).replace(/From/,"To")+control.path;var $toDateElement=$$.params.renderForm.find("."+control.getElementClassName()+"[name='"+toName+"'");if($toDateElement.length>0){if(useHtml5DateInput()){if(value!==""){$toDateElement.attr("min",$IU.unixTimeToDateString(value))}else{$toDateElement.attr("min","")}}else{InfoPlus.Controls.Adapter.DateAdapter.destroy($toDateElement[0]);if(value!==""){$toDateElement.data($Control.DATA_CONTROL_OBJECT).initDatePickerOption({minDate:$IU.unixTimeToDate(value)})}else{$toDateElement.data($Control.DATA_CONTROL_OBJECT).initDatePickerOption()}}}}}},onFocus:function(){if($$.MOBILE&&/(iPhone|iPad)/i.test(navigator.userAgent)){if(this.getAttribute("readonly")!=null){this.blur()}}}};dateEvents.events=[{type:"change",handler:dateEvents.onChange},{type:"focus",handler:dateEvents.onFocus}];define("InfoPlus.Controls.Date.Events",dateEvents)})(window);
(function(window,undefined){var time=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_TIME,path,field,render,initValue,null)};time.DEFAULT_VALIDATOR_REGEX="^(([1-9]{1})|([0-1][0-9])|([1-2][0-3])):([0-5][0-9])$";time.DEFAULT_VALIDATOR_PROMPT=$$.lt("time.validateMessage");time.INPUT_TYPE_TIME_SUPPORT=true;var useHtml5TimeInput=function(){return $$.MOBILE&&time.INPUT_TYPE_TIME_SUPPORT};time.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_TIME],name:"time",createElement:function(){var element=document.createElement("input");if(useHtml5TimeInput()){try{element.type="time"}catch(e){time.INPUT_TYPE_DATE_SUPPORT=false;element.type="text"}}else{element.type="text"}$(element).attr("autocomplete","off");return element},setValue:function(fieldValue){if(fieldValue==null){fieldValue=""}if(fieldValue!==""&&isNaN(fieldValue)===false){this.element.value=$IU.unixTimeToTimeString(fieldValue)}else{this.element.value=""}},getValue:function(){var val=this.convertEmptyValue(this.element.value);if(val===""||val==null){return""}val=$IU.timeStringToUnixTime(val);if(val!=null&&val!==""&&!isNaN(val)){return val}else{return""}},getSortValue:function(){var val=this.getValue();return val===""?0:val},addDefaultValidator:function(){var permission=this.field.permission||"";if(permission.indexOf("r")!==-1&&permission.indexOf("w")===-1){return}var $element=$(this.element);var validator=$element.data($Control.DATA_VALIDATOR);if(validator==null){$element.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:time.DEFAULT_VALIDATOR_REGEX,prompt:time.DEFAULT_VALIDATOR_PROMPT,builtIn:true});$IU.addElementValidateClass(this.element)}else{if(validator.regEx==null||validator.regEx===""){validator.regEx=time.DEFAULT_VALIDATOR_REGEX;validator.prompt=time.DEFAULT_VALIDATOR_PROMPT;validator.builtIn=(!validator.required===true)}}},specialSetting:function(){if(!useHtml5TimeInput()){this.initClockPicker()}this.addDefaultValidator()},initClockPicker:function(){if(useHtml5TimeInput()){return}var permission=this.field.permission||"";if(permission.indexOf("w")!==-1){var $element=$(this.element);var clockPicker=$(this.element).clockpicker({autoclose:true,afterDone:function(){$element.change()}});$element.data("clock",clockPicker)}},setDynamicReadOnly:function(isReadOnly){var element=this.element;if(isReadOnly){if(!useHtml5TimeInput()){var clockPicker=$(element).data("clock");if(clockPicker!=null){clockPicker.clockpicker("remove");$(element).removeData("clock")}}}else{$(element).removeClass($Control.CLASSNAME_READONLY);this.initClockPicker()}}});define("InfoPlus.Controls.Time",time)})(window);
(function(window,undefined){var edit=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_EDIT,path,field,render,initValue,null)};edit.DEFAULT_VALIDATOR_REGEX_INTEGER="^-?\\d+$";edit.DEFAULT_VALIDATOR_REGEX_DOUBLE="^(-?\\d+)(\\.\\d+)?$";edit.DEFAULT_VALIDATOR_PROMPT_INTEGER=$$.lt("edit.validateIntegerMessage");edit.DEFAULT_VALIDATOR_PROMPT_DOUBLE=$$.lt("edit.validateFloatMessage");edit.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_INT,$Control.DATA_TYPE_DOUBLE],name:"edit",createElement:function(){var element=document.createElement("input");element.type="text";if(this.field.placeHolder!=null){$(element).attr("placeholder",this.field.placeHolder)}return element},addDefaultValidator:function(){var permission=this.field.permission||"";if(permission.indexOf("r")!==-1&&permission.indexOf("w")===-1){return}var fieldType=this.field.type;if(fieldType!==$Control.DATA_TYPE_INT&&fieldType!==$Control.DATA_TYPE_DOUBLE){return}var $element=$(this.element);var validator=$element.data($Control.DATA_VALIDATOR);if(validator==null){if(fieldType===$Control.DATA_TYPE_INT){$element.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:edit.DEFAULT_VALIDATOR_REGEX_INTEGER,prompt:edit.DEFAULT_VALIDATOR_PROMPT_INTEGER,builtIn:true})}else{$element.data($Control.DATA_VALIDATOR,{required:this.field.notNull,regEx:edit.DEFAULT_VALIDATOR_REGEX_DOUBLE,prompt:edit.DEFAULT_VALIDATOR_PROMPT_DOUBLE,builtIn:true})}$IU.addElementValidateClass(this.element)}else{if(validator.regEx==null||validator.regEx===""){validator.regEx=(fieldType===$Control.DATA_TYPE_INT)?edit.DEFAULT_VALIDATOR_REGEX_INTEGER:edit.DEFAULT_VALIDATOR_REGEX_DOUBLE;validator.prompt=(fieldType===$Control.DATA_TYPE_INT)?edit.DEFAULT_VALIDATOR_PROMPT_INTEGER:edit.DEFAULT_VALIDATOR_PROMPT_DOUBLE;validator.builtIn=(!validator.required===true);$IU.addElementValidateClass(this.element)}}},specialSetting:function(){this.setCleaveFormat();this.setMaxLength();if(this.maxLength!=null){$(this.element).attr("maxlength",this.maxLength)}this.addDefaultValidator()},setCleaveFormat:function(){var element=this.element;var format=this.field.format;if(format!=null&&format!=""){var groupStyle="";if(format=="#,###.##"){groupStyle="thousand"}else{if(format=="#,####.##"){groupStyle="wan"}else{$IU.debugTip($$.lt("edit.formatWarning",this.field.name),"warning")}}if(groupStyle){setTimeout(function(){if(typeof Cleave!="undefined"){$(element).addClass("hasCleaveFormat");var cleave=new Cleave(element,{numeral:true,numeralThousandsGroupStyle:groupStyle})}},0)}}},setValue:function(fieldValue){if(fieldValue==null){fieldValue=""}switch(this.field.type){case $Control.DATA_TYPE_STRING:if(this.maxLength!=null){fieldValue=fieldValue.substr(0,this.maxLength)}$(this.element).val(fieldValue);break;case $Control.DATA_TYPE_INT:var intValue=parseInt(fieldValue,10);$(this.element).val(isNaN(intValue)?"":intValue);break;case $Control.DATA_TYPE_DOUBLE:var floatValue=parseFloat(fieldValue);$(this.element).val(isNaN(floatValue)?"":floatValue);break}},getValue:function(){if(this.field==null||this.element==null){return""}var val=this.convertEmptyValue(this.element.value);var format=this.field.format;if(format!=null&&format!=""){if(format=="#,###.##"||format=="#,####.##"){val=val.replace(/,/g,"")}}switch(this.field.type){case $Control.DATA_TYPE_STRING:val=val||"";if(this.maxLength!=null){val=val.substr(0,this.maxLength)}return val;case $Control.DATA_TYPE_INT:var intValue=parseInt(val);return isNaN(intValue)?"":intValue;case $Control.DATA_TYPE_DOUBLE:var floatValue=parseFloat(val);return isNaN(floatValue)?"":floatValue}return""},getSortValue:function(){var value=this.getValue();if((this.field.type===$Control.DATA_TYPE_INT||this.field.type===$Control.DATA_TYPE_DOUBLE)&&value===""){return 0}else{return value}}});define("InfoPlus.Controls.Edit",edit)})(window);
(function(window,undefined){var hidden=function(path,field,render,initValue,initDisplayValue,initAttributes){$Control.call(this,$Control.CONTROL_TYPE_HIDDEN,path,field,render,initValue,initDisplayValue,initAttributes)};hidden.ERROR_CODE_PERMISSION_DENIED=1;hidden.ERROR_CODE_POSITION_UNAVAILABLE=2;hidden.ERROR_CODE_TIMEOUT=3;hidden.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_INT,$Control.DATA_TYPE_DOUBLE,$Control.DATA_TYPE_BOOL,$Control.DATA_TYPE_DATE,$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE,$Control.DATA_TYPE_THING,$Control.DATA_TYPE_FILE,$Control.DATA_TYPE_LOCATION],autoTriggerFieldChangeEvent:false,ignoreValidation:true,allowFocus:false,name:"hidden",createElement:function(){var element=document.createElement("input");element.type="hidden";return element},getAttributes:function(){if(this.field.type===$Control.DATA_TYPE_ANYURI){var val=this.getValue();return $IU.getParamFromUrl(val.value)}return $(this.element).data($Control.DATA_ATTRIBUTES)},setValue:function(fieldValue,fieldDisplayValue,fromInit,attributes){if(fieldValue==null){fieldValue=""}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);var $hidden=$(this.element);$hidden.val(fieldValue);this.setAttributes(attributes);$hidden.data($Control.DATA_DISPLAY_VALUE,fieldDisplayValue);if(fireChangeEvent){setTimeout(function(){$hidden.change()},0)}},getValue:function(){if(this.field==null||this.element==null){return""}var val=this.convertEmptyValue(this.element.value),displayValue=$(this.element).data($Control.DATA_DISPLAY_VALUE);switch(this.field.type){case $Control.DATA_TYPE_STRING:case $Control.DATA_TYPE_XHTML:case $Control.DATA_TYPE_FILE:return val;case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(val);case $Control.DATA_TYPE_INT:var intValue=parseInt(val);return isNaN(intValue)?"":intValue;case $Control.DATA_TYPE_DOUBLE:var floatValue=parseFloat(val);return isNaN(floatValue)?"":floatValue;case $Control.DATA_TYPE_BOOL:return val.toLowerCase()==="true";case $Control.DATA_TYPE_DATE:var dateValue=parseInt(val);return isNaN(dateValue)?"":dateValue;case $Control.DATA_TYPE_USER:case $Control.DATA_TYPE_ORGANIZE:case $Control.DATA_TYPE_CODE:case $Control.DATA_TYPE_LOCATION:return new $Controls.Data.ValuePair(val,displayValue);case $Control.DATA_TYPE_THING:return new $Controls.Data.Thing(val,displayValue)}return""},getSortValue:function(){var value=this.getValue();var type=this.field.type;if(type===$Control.DATA_TYPE_BOOL){return value?1:0}if((type===$Control.DATA_TYPE_INT||type===$Control.DATA_TYPE_DOUBLE||type===$Control.DATA_TYPE_DATE)&&value===""){return 0}if(type===$Control.DATA_TYPE_USER||type===$Control.DATA_TYPE_ORGANIZE||type===$Control.DATA_TYPE_CODE||type===$Control.DATA_TYPE_THING||type===$Control.DATA_TYPE_LOCATION){return value.displayValue}return value},specialSetting:function(){var instance=this;if(this.field.type===$Control.DATA_TYPE_LOCATION){if(this.isWritable()&&$IU.isEmptyStr(this.initValue)){if(navigator.geolocation!=null){navigator.geolocation.getCurrentPosition(function(position){instance.setValue(position.coords.longitude+","+position.coords.latitude,$$.lt("map.autoPosition"),true)},function(error){switch(error.code){case hidden.ERROR_CODE_PERMISSION_DENIED:$IU.messageBox(null,$$.lt("map.geolocation.denied"),null,300);break;case hidden.ERROR_CODE_POSITION_UNAVAILABLE:$IU.messageBox(null,$$.lt("map.geolocation.unavailable"),null,300);break;case hidden.ERROR_CODE_TIMEOUT:$IU.messageBox(null,$$.lt("map.geolocation.timeout"),null,300);break}},{enableHighAccuracy:true,maximumAge:0})}}}}});define("InfoPlus.Controls.Hidden",hidden)})(window);
(function(window,undefined){var label=function(path,field,render,initValue,initDisplayValue,initAttributes,isConverted){this.isConverted=(isConverted===true);$Control.call(this,$Control.CONTROL_TYPE_LABEL,path,field,render,initValue,initDisplayValue,initAttributes)};label.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_XHTML,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_INT,$Control.DATA_TYPE_DOUBLE,$Control.DATA_TYPE_BOOL,$Control.DATA_TYPE_DATE,$Control.DATA_TYPE_TIME,$Control.DATA_TYPE_DATETIME,$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE,$Control.DATA_TYPE_THING,$Control.DATA_TYPE_FILE,$Control.DATA_TYPE_LOCATION],ignoreClass:true,ignoreValidation:true,allowFocus:false,autoTriggerFieldChangeEvent:false,name:"label",hasHiddenElement:true,isConverted:false,createElement:function(){var labelContainer=document.createElement("div"),$labelContainer=$(labelContainer);this.controlContainer=labelContainer;$labelContainer.addClass("infoplus_labelControlContainer");if(this.isConverted&&$$.params.tenantReadOnlyStyle==="Underline"){$labelContainer.addClass("underline")}var element;if(this.field.type===$Control.DATA_TYPE_XHTML){element=document.createElement("iframe");element.setAttribute("scrolling","auto");element.setAttribute("frameborder","0");$labelContainer.addClass("iframe")}else{element=document.createElement("div")}$labelContainer.append(element);return element},getAttributes:function(){if(this.field.type===$Control.DATA_TYPE_ANYURI){var val=this.getValue();return $IU.getParamFromUrl(val.value)}return $(this.element).data($Control.DATA_ATTRIBUTES)},setValue:function(fieldValue,fieldDisplayValue,fromInit,attributes){if(fieldValue==null){fieldValue=""}if(fieldDisplayValue==null){fieldDisplayValue="";if(this.field.type===$Control.DATA_TYPE_CODE){if(this.items!=null){for(var i=0,len=this.items.length;i<len;i++){var item=this.items[i];if(item.codeId===fieldValue){fieldDisplayValue=item.codeName}}}}}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);var $element=$(this.element);var hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);hiddenInput.value=fieldValue;var format=this.field.format;if(format!=null&&format!=""){var groupStyle="";if(format=="#,###.##"){groupStyle="thousand"}else{if(format=="#,####.##"){groupStyle="wan"}else{$IU.debugTip($$.lt("label.formatWarning",this.field.name),"warning")}}if(groupStyle){if(typeof Cleave!="undefined"){var cleave=new Cleave(hiddenInput,{numeral:true,numeralThousandsGroupStyle:groupStyle})}}}fieldValue=hiddenInput.value;switch(this.field.type){case $Control.DATA_TYPE_DATE:if(fieldValue!==""&&isNaN(fieldValue)===false){fieldValue=parseInt(fieldValue,10);$element.text($IU.unixTimeToDateString(fieldValue))}else{$element.text("")}break;case $Control.DATA_TYPE_TIME:if(fieldValue!==""&&isNaN(fieldValue)===false){fieldValue=parseInt(fieldValue,10);$element.text($IU.unixTimeToTimeString(fieldValue))}else{$element.text("")}break;case $Control.DATA_TYPE_DATETIME:if(fieldValue!==""&&isNaN(fieldValue)===false){fieldValue=parseInt(fieldValue,10);if($IU.isSameTimezone()){$element.text($IU.unixTimeToLocalTimeString(fieldValue))}else{var span=document.createElement("span");$(span).text($IU.unixTimeToLocalTimeString(fieldValue));$element.append(span);i=document.createElement("i");var $help=$(i);$help.addClass("i-icon-clock-o help");$element.append(i);var helpContent=$$.lt("label.timezone")+":"+$IU.getTimezoneString(-$IU.stdTimezoneOffset())+"<br>";helpContent+=$IU.getTimezoneString($$.params.tenantTimeZoneOffset/60)+" "+$IU.unixTimeToString(fieldValue);$help.attr("original-title",helpContent);$help.tipsy({html:true,fade:true,gravity:"w",trigger:"manual",opacity:0.9});$help.click(function(){$(this).tipsy("show")}).mouseenter(function(){$(this).tipsy("show")}).mouseleave(function(){$(this).tipsy("hide")})}}else{$element.text("")}break;case $Control.DATA_TYPE_USER:case $Control.DATA_TYPE_ORGANIZE:case $Control.DATA_TYPE_CODE:case $Control.DATA_TYPE_LOCATION:$element.text(fieldDisplayValue).data($Control.DATA_DISPLAY_VALUE,fieldDisplayValue);break;case $Control.DATA_TYPE_XHTML:setTimeout(function(){var style=$element.attr("style");var getStyle=function(style){var retVal="",styles=style.split(";");for(var i=0,len=styles.length;i<len;i++){var s=styles[i];if(s.indexOf(":")!==-1){var styleName=$IU.trimString(s.substr(0,s.indexOf(":")));if(styleName==="color"||styleName.substr(0,4)==="font"){retVal+=(s+";")}}}return retVal};style="overflow:auto;overflow-y:hidden;"+getStyle(style||"");var iframeWindow=$element[0].contentWindow,doc=iframeWindow.document;doc.open();doc.write("<html><body style='"+style+"'>"+fieldValue+"</body></html>");doc.close();$element.css("height","").css("max-height","0px");var initHeight=iframeWindow.document.body.scrollHeight,sameTimes=0;var setHeight=function(){var currentHeight=iframeWindow.document.body.scrollHeight;if(currentHeight!==initHeight){$element.css("height",(currentHeight+10)+"px").css("max-height","")}else{if(sameTimes++>10){$element.css("height",(currentHeight+10)+"px").css("max-height","")}else{setTimeout(setHeight,50)}}};setTimeout(setHeight,50)},0);break;case $Control.DATA_TYPE_INT:var value=parseInt(fieldValue,10);$element.text(isNaN(value)?"":value);break;case $Control.DATA_TYPE_THING:$element.text(fieldDisplayValue);break;case $Control.DATA_TYPE_FILE:if($IU.isString(fieldValue)){try{var fileInfo=$.parseJSON(fieldValue);$element.text(fileInfo.name)}catch(e){fileInfo=null}}break;default:var htmlValue=InfoPlus.Utilities.htmlEncode(fieldValue.toString()||"");$element.html(htmlValue)}this.setAttributes(attributes);if(fromInit!==true){this.adjustHeightStyle()}if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(){if(this.field==null||this.element==null){return""}var element=this.element;var hiddenInput=$(element).data($Control.DATA_ORIGIN_INPUT);var formatValue=hiddenInput.value;var format=this.field.format;if(format!=null&&format!=""){if(format=="#,###.##"||format=="#,####.##"){formatValue=formatValue.replace(/,/g,"");hiddenInput.value=formatValue}}var val=this.convertEmptyValue(hiddenInput.value);var displayValue=$(element).data($Control.DATA_DISPLAY_VALUE);switch(this.field.type){case $Control.DATA_TYPE_STRING:case $Control.DATA_TYPE_XHTML:case $Control.DATA_TYPE_FILE:return val;case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(val);case $Control.DATA_TYPE_DATE:case $Control.DATA_TYPE_TIME:case $Control.DATA_TYPE_DATETIME:var dateValue=parseInt(val);return isNaN(dateValue)?"":dateValue;case $Control.DATA_TYPE_INT:var intValue=parseInt(val);return isNaN(intValue)?"":intValue;case $Control.DATA_TYPE_DOUBLE:var floatValue=parseFloat(val);return isNaN(floatValue)?"":floatValue;case $Control.DATA_TYPE_BOOL:return val.toLowerCase()==="true";case $Control.DATA_TYPE_USER:case $Control.DATA_TYPE_ORGANIZE:case $Control.DATA_TYPE_CODE:case $Control.DATA_TYPE_LOCATION:return new $Controls.Data.ValuePair(val,displayValue);case $Control.DATA_TYPE_THING:return new $Controls.Data.Thing(val,displayValue)}return""},getSortValue:function(){var value=this.getValue();var type=this.field.type;if(type===$Control.DATA_TYPE_BOOL){return value?1:0}if((type===$Control.DATA_TYPE_INT||type===$Control.DATA_TYPE_DOUBLE||type===$Control.DATA_TYPE_DATE||type===$Control.DATA_TYPE_DATETIME)&&value===""){return 0}if(type===$Control.DATA_TYPE_USER||type===$Control.DATA_TYPE_ORGANIZE||type===$Control.DATA_TYPE_CODE||type===$Control.DATA_TYPE_THING||type===$Control.DATA_TYPE_LOCATION){return value.displayValue}return value},adjustHeightStyle:function(){var $label=$(this.element);if(this.render.renderType==="BoundConvertedLabel"){if(this.render.convertFromText!==true){var lineHeight=parseInt($label.css("line-height"),10);if(!isNaN(lineHeight)&&lineHeight>0){if($label.height()>lineHeight){$label.css("height",$label.css("line-height"));$label.css("line-height","")}}}}else{if(this.field.type!==$Control.DATA_TYPE_XHTML){var minHeight=parseInt($label.css("min-height"),10);if(!isNaN(minHeight)&&minHeight>0){if(!($label.height()>minHeight)){$label.css("line-height",$label.css("min-height"));if($label.height()>parseInt($label.css("line-height"),10)){$label.css("line-height","")}}else{lineHeight=parseInt($label.css("line-height"),10);if(!isNaN(lineHeight)&&lineHeight>0){if($label.height()>lineHeight){$label.css("line-height","")}}}}}}},addRepeatInitHeightStyle:function(){this.adjustHeightStyle()},initHeightStyle:function(){var style=$(this.element).attr("style"),changeClass=false;if(style!=null){style=style.toLowerCase();if(style.indexOf("height:")===-1){changeClass=true}else{var $label=$(this.element);if(this.render.renderType==="BoundConvertedLabel"){if(this.render.convertFromText===true){$label.css("min-height",$label.css("height"));$label.css("height","")}else{$label.css("line-height",$label.css("height"));$label.css("height","");if($$.params.initializing===true){$$.visible(function(){if($label.height()>parseInt($label.css("line-height"),10)){$label.css("height",$label.css("line-height"));$label.css("line-height","")}})}}}else{$label.css("min-height",$label.css("height"));$label.css("height","");if($$.params.initializing===true&&this.field.type!==$Control.DATA_TYPE_XHTML){$$.visible(function(){if(!($label.height()>parseInt($label.css("min-height"),10))){$label.css("line-height",$label.css("min-height"));if($label.height()>parseInt($label.css("line-height"),10)){$label.css("line-height","")}}})}}}}else{changeClass=true}if(changeClass){$(this.element).addClass("inline");$(this.controlContainer).addClass("inline")}},specialSetting:function(){this.initHeightStyle();if(this.isWritable()&&this.field.type===$Control.DATA_TYPE_XHTML){$IU.debugTip($$.lt("label.xhtmlWarning",this.field.name),"warning")}},setDataSource:function(dataSource,fromInit){if(this.field.type!==$Control.DATA_TYPE_CODE){return}this.items=[];if($IU.isString(dataSource)){var dataArray=$IU.splitAttribute(dataSource);for(var i=0,len=dataArray.length;i<len;i++){this.items.push({codeId:dataArray[i],codeName:dataArray[i],enabled:true})}}else{if($IU.isArray(dataSource)){for(i=0,len=dataSource.length;i<len;i++){var data=dataSource[i];if(data.value!==undefined&&data.displayValue!==undefined){this.items.push({codeId:data.value,codeName:data.displayValue,enabled:true,parentId:data.parentId})}}}}var val=$(this.element).data($Control.DATA_ORIGIN_INPUT).value;for(i=0,len=this.items.length;i<len;i++){var item=this.items[i];if(item.codeId===val){$(this.element).text(item.codeName).data($Control.DATA_DISPLAY_VALUE,item.codeName)}}}});define("InfoPlus.Controls.Label",label)})(window);
(function(window,undefined){var radio=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_RADIO,path,field,render,initValue,null)};radio.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],name:"radio",createElement:function(){var element=document.createElement("input");element.type="radio";element.value=this.render.onValue;return element},initRadio:function(){if(this.element===undefined){return}var siblings=this.element.parentElement.childNodes;for(var i=0,len=siblings.length;i<len;i++){if(siblings[i]===this.element&&i<len-1){var nextNode=siblings[i+1],$nextNode=$(nextNode);if(!$nextNode.hasClass($Control.CLASSNAME_CONTROL)&&$nextNode.find("."+$Control.CLASSNAME_CONTROL).length===0){var label=document.createElement("label"),$label=$(label);$nextNode.detach().appendTo($label);$label.attr("for",this.element.getAttribute("id")).insertAfter(this.element).addClass("infoplus_radioLabel")}break}}},setValue:function(fieldValue){if(fieldValue==null){fieldValue=""}this.element.checked=(fieldValue===this.element.value);if(this.element.checked){$(this.element).addClass("checked")}else{$(this.element).removeClass("checked")}$("."+this.getElementClassName()+"[name="+this.element.name+"]").each(function(){if(this.checked){$(this).addClass("checked")}else{$(this).removeClass("checked")}})},getValue:function(){var instance=this;if(this.element.checked){return this.convertEmptyValue(this.element.value)}else{var val="";$("."+this.getElementClassName()+"[name="+this.element.name+"]").each(function(){if(this.checked){val=instance.convertEmptyValue(this.value)}});return val}},shouldFireChangeEventAgain:function(fieldValue){return fieldValue===this.element.value&&this.shouldFireChangeEvent(fieldValue)},registerEvent:function(){this.events=InfoPlus.Controls.Radio.Events.events},markModified:function(){$(this.element).parent().addClass("modified")},clearModified:function(){$(this.element).parent().removeClass("modified")}});define("InfoPlus.Controls.Radio",radio);var radioEvents={onClick:function(event){var name=$(this).attr("name");$("input:radio[name='"+name+"']").each(function(){if($(this).is(":checked")){$(this).addClass("checked")}else{$(this).removeClass("checked")}})}};radioEvents.events=[{type:"click",handler:radioEvents.onClick}];define("InfoPlus.Controls.Radio.Events",radioEvents)})(window);
(function(window,undefined){var radioList=function(path,field,render,initValue,initDisplayValue,parentValue,initAttributes){var items=null;if(field.code!=null){var code=$$.codeManager.getCode(field.code);if(code!=null){items=code.items}if(items==null||($IU.isArray(items)&&items.length===0)){if(code==null||(code!=null&&code.codeType==="External")){$$.codeManager.addRequestCode(field.code,field.name)}}}this.items=items;this.parentValue=parentValue;if(initValue!==""){if(items==null||($IU.isArray(items)&&items.length===0)){this.items=[{codeId:initValue,codeName:initDisplayValue,enabled:true,parentId:parentValue,attributes:initAttributes}]}}$Control.call(this,$Control.CONTROL_TYPE_RADIO_LIST,path,field,render,initValue,initDisplayValue,initAttributes)};radioList.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_CODE],ignoreClass:true,name:"radioList",validatorPromptPosition:"topLeft",createElement:function(){var element=document.createElement("div");if($IU.isArray(this.items)){this.setOptions(element,this.items,this.initValue,true,true)}return element},setValue:function(fieldValue,fieldDisplayValue,isInit,attributes){if(fieldValue==null){fieldValue=""}var isReadOnly=this.isReadOnly();if(attributes!=null){if(attributes.datasource!=null||attributes.datasource_Codes!=null){var items=[];var ids=(attributes.datasource!=null)?$IU.splitAttribute(attributes.datasource):$IU.splitAttribute(attributes.datasource_Codes),names=$IU.splitAttribute(attributes.datasource_Names);for(i=0,len=ids.length;i<len;i++){items.push({codeId:ids[i],codeName:names[i]!=null?names[i]:ids[i],enabled:true,attributes:attributes})}this.setOptions(this.element,items,fieldValue,isInit)}this.setAttributes(attributes)}else{var $radios=$(this.element).find("input[type=radio]");for(var i=0,len=$radios.length;i<len;i++){var radio=$radios[i];radio.checked=(radio.value===fieldValue);if(isReadOnly){if(radio.checked){$(radio).parent().addClass("checked").removeClass("unchecked")}else{$(radio).parent().addClass("unchecked").removeClass("checked")}}else{if(radio.checked){$(radio).parent().addClass("checked")}else{$(radio).parent().removeClass("checked")}}}}},getValue:function(){var $radios=$(this.element).find("input[type=radio]");for(var i=0,len=$radios.length;i<len;i++){var radio=$radios[i];if(radio.checked){var displayValue=$(radio).parent().text();return new $Controls.Data.ValuePair(radio.value,displayValue,this.parentValue)}}return new $Controls.Data.ValuePair("","",this.parentValue)},setDataSourceFromItems:function(element,items,initValue,fromInit){var oldValue=this.getValue();this.setOptions(element,items,initValue,fromInit)},setElementAttribute:function(){var $element=$(this.element),render=this.render;this.element.id="optionListDiv_"+$$.guid();$element.attr("name",render.field+this.path);$element.data($Control.DATA_FIELD,render.field).data($Control.DATA_RENDER,render)},setStyle:function(name,value){var $labels=$(this.element).find("label");for(var i=0,len=$labels.length;i<len;i++){var label=$labels[i];$IU.setDynamicStyle(label,name,value)}},addValidation:function(radioElement){var field=this.field;if(field.notNull===true||field.regEx){var permission=field.permission||"";if(permission.indexOf("r")!==-1&&permission.indexOf("w")===-1){return}$(radioElement).data($Control.DATA_VALIDATOR,{required:field.notNull,regEx:field.regEx,prompt:field.prompt,builtIn:false}).data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition);$IU.addElementValidateClass(radioElement)}},processValidation:function(){var field=this.field,element=this.element,$radios=$(element).find("input[type=radio]");if(field.notNull===true||field.regEx){var permission=field.permission||"";if(permission.indexOf("r")!==-1&&permission.indexOf("w")===-1){return}$radios.data($Control.DATA_VALIDATOR,{required:field.notNull,regEx:field.regEx,prompt:field.prompt,builtIn:false});if(this.validatorPromptPosition!==null){$radios.data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition)}for(var i=0,len=$radios.length;i<len;i++){var radio=$radios[i];$IU.addElementValidateClass(radio)}}var dynamics=this.render.properties;if(dynamics!=null&&dynamics.length>0){for(i=0,len=dynamics.length;i<len;i++){var dynamic=dynamics[i];if(dynamic.key==="validation"&&dynamic.values!=null){var validator=$radios.data($Control.DATA_VALIDATOR);if(validator==null){validator={required:false,builtIn:false,dynamics:[]};$radios.data($Control.DATA_VALIDATOR,validator);if(this.validatorPromptPosition!==null){$radios.data($Control.DATA_VALIDATOR_PROMPT_POSITION,this.validatorPromptPosition)}for(i=0,len=$radios.length;i<len;i++){radio=$radios[i];$IU.addElementValidateClass(radio)}}if(validator.dynamics==null){validator.dynamics=[]}for(var tipIndex=0,tipLen=dynamic.values.length;tipIndex<tipLen;tipIndex++){var tip=dynamic.values[tipIndex];validator.dynamics.push({tip:tip.value,condition:tip.condition})}}}}},registerEvent:function(){this.events=InfoPlus.Controls.RadioList.Events.events},setOptions:function(element,items,initValue,fromInit,fromCreate){var field=this.field,parentValue=this.parentValue,path=this.path,name=this.render.field+path,isReadOnly=this.isReadOnly();if(initValue===undefined){initValue=this.initValue}var isDisplay=function(item){if(field.code!=null){if(field.parent==null){return true}else{return parentValue===item.parentId}}else{if(field.parent==null){return true}else{return parentValue===item.parentId}}};var isEnabled=function(item){return !(item.isEnabled===false||item.enabled===false)};$(element).children("label").remove();if($IU.isArray(items)){for(var i=0,len=items.length;i<len;i++){var item=items[i];if(isEnabled(item)&&isDisplay(item)){var label=document.createElement("label");var input=document.createElement("input");input.type="radio";input.value=item.codeId;input.name="radioList-"+name;input.id=name+"-"+i;$(input).data($Control.DATA_ATTRIBUTES,item.attributes);if(initValue===$IU.trimString(item.codeId)){input.checked=true}if(isReadOnly){if(input.checked){$(label).addClass("checked").removeClass("unchecked")}else{$(label).addClass("unchecked").removeClass("checked")}}else{if(input.checked){$(label).addClass("checked")}}$(input).data($Control.DATA_IS_CONTROL,true).data($Control.DATA_CONTROL_OBJECT,this);var text=item.codeName;if((item.description||"")!==""){text=text+"("+$IU.trimString(item.description)+")"}var textNode=document.createTextNode(text);$(label).append(input);$(label).append(textNode);element.appendChild(label);this.addValidation(input)}}}this.items=items;if(fromCreate!==true){this.setDynamicStyle($$.params.formRender,fromInit)}},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip===""){return}var $element=$(this.element);$element.validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",true);$element.find("input").one("blur",function(){$element.validationEngine("hidePrompt")})},setDataSource:function(dataSource,fromInit){var oldValue=this.getValue();if(oldValue==null){oldValue=""}else{oldValue=oldValue.value}var useFirstAsDefault=false;if(dataSource instanceof InfoPlus.Dynamics.Params){var params=dataSource.params;if(params.length>1&&params[1]===true){useFirstAsDefault=true}dataSource=params[0]}this.items=[];if($IU.isString(dataSource)){var dataArray=$IU.splitAttribute(dataSource);for(var i=0,len=dataArray.length;i<len;i++){this.items.push({codeId:dataArray[i],codeName:dataArray[i],enabled:true})}}else{if($IU.isArray(dataSource)){for(i=0,len=dataSource.length;i<len;i++){var data=dataSource[i];if(data.value!==undefined&&data.displayValue!==undefined){this.items.push({codeId:data.value,codeName:data.displayValue,enabled:true,parentId:data.parentId})}}}}if(!fromInit){if(useFirstAsDefault&&this.items.length>0){oldValue=this.items[0].codeId}}this.setOptions(this.element,this.items,oldValue,fromInit);this.setPermission()},getAttributes:function(){var $radios=$(this.element).find("input[type=radio]");for(var i=0,len=$radios.length;i<len;i++){var radio=$radios[i];if(radio.checked){return $(radio).data($Control.DATA_ATTRIBUTES)}}return null},setParentValue:function(parentValue,fromInit){var oldValue=this.getValue();if(oldValue==null){oldValue=""}else{oldValue=oldValue.value}if((parentValue instanceof $Controls.Data.ValuePair)||(parentValue instanceof $Controls.Data.Uri)){this.parentValue=parentValue.value}else{this.parentValue=parentValue}this.setOptions(this.element,this.items,oldValue,fromInit)},setDynamicReadOnly:function(isReadOnly){if(isReadOnly){$(this.element).find("input[type=radio]").each(function(){if(this.checked){$(this).parent().addClass("checked").removeClass("unchecked")}else{$(this).parent().addClass("unchecked").removeClass("checked")}$(this).addClass($Control.CLASSNAME_READONLY).addClass("disabled");this.disabled=true})}else{$(this.element).find("label").removeAttr("class");$(this.element).find("input[type=radio]").each(function(){$(this).removeClass($Control.CLASSNAME_READONLY).removeClass("disabled");this.disabled=false})}}});define("InfoPlus.Controls.RadioList",radioList);var radioEvents={onClick:function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);$(control.element).find("input[type=radio]").each(function(){if(this.checked){$(this).parent().addClass("checked")}else{$(this).parent().removeClass("checked")}})}};radioEvents.events=[{type:"click",handler:radioEvents.onClick}];define("InfoPlus.Controls.RadioList.Events",radioEvents)})(window);
(function(window,undefined){var radio=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_RADIO_GROUP,path,field,render,initValue,null)};radio.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL],name:"radioGroup",createElement:function(){var element=document.createElement("input");element.type="radio";element.value=true;return element},unselectSiblings:function(){var path=this.path;if(this.getValue()===true){$$("&"+this.field.name).each(function(){var radioControl=this.control;if($IU.isSibling(path,radioControl.path)){radioControl.setValue(false)}})}},setValue:function(fieldValue){if(fieldValue===true){this.element.checked=true;this.unselectSiblings()}else{this.element.checked=false}},getValue:function(){return this.element.checked},registerEvent:function(){this.events=InfoPlus.Controls.RadioGroup.Events.events}});define("InfoPlus.Controls.RadioGroup",radio);var radioEvents={onClick:function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT);control.unselectSiblings()}};radioEvents.events=[{type:"click",handler:radioEvents.onClick}];define("InfoPlus.Controls.RadioGroup.Events",radioEvents)})(window);
(function(window,undefined){var remark=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_REMARK,path,field,render,initValue,null)};remark.HAS_VALUE="infoplus_remarkControl_has_value";remark.NO_VALUE="infoplus_remarkControl_no_value";remark.prototype=$.extend(new $Controls.Control(),{autoTriggerFieldChangeEvent:false,compatibleFieldTypes:[$Control.DATA_TYPE_STRING],allowFocus:false,remarkValue:"",name:"remark",hasHiddenElement:true,createElement:function(){var element=document.createElement("div");$(element).tipsy({html:true,fade:true,gravity:$.fn.tipsy.autoWE,trigger:"manual"});return element},setValue:function(fieldValue,fieldDisplayValue,fromInit){if(fieldValue==null){fieldValue=""}if(this.maxLength!=null){fieldValue=fieldValue.substr(0,this.maxLength)}var remarkElement=this.element;var hiddenInput=$(remarkElement).data($Control.DATA_ORIGIN_INPUT);var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);hiddenInput.value=fieldValue;if(fieldValue===""){$(remarkElement).removeClass(InfoPlus.Controls.Remark.HAS_VALUE).addClass(InfoPlus.Controls.Remark.NO_VALUE)}else{$(remarkElement).removeClass(InfoPlus.Controls.Remark.NO_VALUE).addClass(InfoPlus.Controls.Remark.HAS_VALUE)}var htmlValue='<div class="tipsy-inner-infoplus">'+$IU.htmlEncode(fieldValue)+"</div>";remarkElement.setAttribute("original-title",htmlValue);if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(){var hiddenInput=$(this.element).data($Control.DATA_ORIGIN_INPUT);var val=this.convertEmptyValue(hiddenInput.value);val=val.replace(/\r\n/g,"\n");if(this.maxLength!=null){val=val.substr(0,this.maxLength)}return val},setTipEncodeInnerHtml:function(sourceString,tipSpan){var setSpanWidth=function(span,maxWidth){if(maxWidth>52){span.style.width="365px"}else{span.style.width=parseInt(maxWidth*7)+5+"px"}span.style.whiteSpace="normal"};var s="";if(sourceString==null||sourceString.length==0){setSpanWidth(tipSpan,0);tipSpan.innerHTML="";return}var currentLine=1;var maxLineWidth=0;var currentLineWidth=0;for(var i=0;i<sourceString.length;i++){if(i>tipSpan.maxCharCount){$(tipSpan).html(s+"...");currentLineWidth+=3;if(currentLineWidth>maxLineWidth){maxLineWidth=currentLineWidth}setSpanWidth(tipSpan,maxLineWidth);return}if(sourceString.charCodeAt(i)>127||sourceString.charCodeAt(i)==94){currentLineWidth+=2}else{currentLineWidth+=1}if(currentLineWidth>maxLineWidth){maxLineWidth=currentLineWidth}switch(sourceString.substr(i,1)){case"<":s+="&lt;";break;case">":s+="&gt;";break;case"&":s+="&amp;";break;case" ":if(sourceString.substr(i+1,1)==" "){s+=" &nbsp;";i++}else{s+=" "}break;case'"':s+="&quot;";break;case"\n":if(++currentLine>tipSpan.maxLineCount){$(tipSpan).html(s+"...");currentLineWidth+=3;if(currentLineWidth>maxLineWidth){maxLineWidth=currentLineWidth}setSpanWidth(tipSpan,maxLineWidth);return}else{s+="<br>";currentLineWidth=0}break;default:s+=sourceString.substr(i,1);break}}setSpanWidth(tipSpan,maxLineWidth);$(tipSpan).html(s)},showRemarkDialog:function(){var remarkElement=this.element,instance=this,textarea=document.createElement("textarea"),title=this.field.label==null?$$.lt("remark.inputValue"):this.field.label;textarea.setAttribute("id","form_remark_textarea");if(this.field.placeHolder!=null){$(textarea).attr("placeholder",this.field.placeHolder)}var content=textarea;if(this.maxLength!=null&&this.isWritable()){var div=document.createElement("div"),$div=$(div);$div.addClass("infoplus_textareaControlContainer");$div.append(textarea);var maxLengthSpan=document.createElement("span");$(maxLengthSpan).addClass("infoplus_textareaControlMaxLengthTip");$div.append(maxLengthSpan);$(maxLengthSpan).hide();content=div;$div.css("margin-bottom","20px");$(maxLengthSpan).css("bottom","-17px")}if(remarkElement.readOnly===true){textarea.readOnly=true;$(textarea).addClass($Control.CLASSNAME_READONLY)}$(textarea).val($(remarkElement).data($Control.DATA_ORIGIN_INPUT).value);var buttons;if(remarkElement.readOnly===true){buttons=[]}else{buttons=[{name:$$.lt("common.ok"),defaultButton:true,callOnClose:true,callback:function(){instance.setValue($(textarea).val());var validator=$(remarkElement).data($Control.DATA_VALIDATOR);if(validator===undefined||validator===null){return}if(validator.required===true||(validator.regEx&&validator.prompt)){$$.params.renderForm.validationEngine("validateField","#"+remarkElement.id)}}},{name:$$.lt("common.cancel")}]}var options={container:$$.params.renderForm,title:title,content:content,maxWidth:600,buttons:buttons};if(this.tooltip!=null&&this.tooltip.tip!=""){options.onShow=function(){setTimeout(function(){$(textarea).validationEngine("showPrompt",$IU.htmlEncode(instance.tooltip.tip),instance.tooltip.type,"topRight",true);$(textarea).on("blur",function(){$(this).validationEngine("hidePrompt")});$(textarea).on("focus",function(){$(textarea).validationEngine("showPrompt",$IU.htmlEncode(instance.tooltip.tip),instance.tooltip.type,"topRight",true)})},300)};options.onClose=function(){$(textarea).validationEngine("hidePrompt")}}var dialog=new InfoPlus.Render.Dialog(options);dialog.show();var maxLength=this.maxLength;if(maxLength!=null&&this.isWritable()){var currentLength=function(){var value=$(textarea).val();var len=value.replace(/\r\n/g,"~").replace(/\n/g,"~").length;return{used:len,remaining:maxLength-len}};var showCurrentLengthTip=function(slide){var len=currentLength();var $span=$(maxLengthSpan);$span.text(len.used+"/"+maxLength);if(len.remaining>0){$span.css("color","green")}else{$span.css("color","red")}if($span.data("hideTipTimer")!=null){clearTimeout($span.data("hideTipTimer"))}if(slide===true){$span.show("slide",{direction:"right"},500)}else{$span.show()}var hideTipTimer=setTimeout(function(){$span.fadeOut(1000)},3000);$span.data("hideTipTimer",hideTipTimer)};var showMaxLengthTip=function(){var len=currentLength();var $span=$(maxLengthSpan);$span.text($$.lt("remark.maxLength",maxLength));if(len.remaining>0){$span.css("color","green")}else{$span.css("color","red")}if($span.data("hideTipTimer")!=null){clearTimeout($span.data("hideTipTimer"))}$span.show();var hideTipTimer=setTimeout(function(){$span.hide("slide",{direction:"right"},1000,function(){showCurrentLengthTip(true)})},5000);$span.data("hideTipTimer",hideTipTimer)};var truncate=function(){var len=currentLength();if(len.remaining>=0){return}var element=textarea,lines=$(element).val().split(/\r\n|\n/),value="",i=0;while(value.length<maxLength&&i<lines.length){value+=lines[i].substring(0,maxLength-value.length)+"\n";i++}$(element).val(value.substring(0,maxLength));element.scrollTop=element.scrollHeight;showCurrentLengthTip()};$(textarea).keypress(function(event){var value=$(textarea).val(),len=value.replace(/\r\n/g,"~").replace(/\n/g,"~").length;var ch=String.fromCharCode(event.charCode==null?event.keyCode:event.charCode);return(event.ctrlKey||event.metaKey||ch=="\u0000"||len<maxLength)});$(textarea).focus(function(event){showMaxLengthTip()});$(textarea).keyup(function(event){showCurrentLengthTip();truncate()})}return false},registerEvent:function(){this.events=InfoPlus.Controls.Remark.Events.events},specialSetting:function(){this.setMaxLength();var $element=$(this.element);$element.css("width","").css("height","")},showTooltip:function(){}});define("InfoPlus.Controls.Remark",remark);var remarkEvents={onClick:function(){var remarkControl=$(this).data($Control.DATA_CONTROL_OBJECT);remarkControl.showRemarkDialog()},onMouseEnter:function(){if(!$$.MOBILE){if($(this).data($Control.DATA_ORIGIN_INPUT).value!=""){$(this).tipsy("show")}}},onMouseLeave:function(){if(!$$.MOBILE){$(this).tipsy("hide")}}};remarkEvents.events=[{type:"mouseenter",handler:remarkEvents.onMouseEnter},{type:"mouseleave",handler:remarkEvents.onMouseLeave},{type:"click",handler:remarkEvents.onClick}];define("InfoPlus.Controls.Remark.Events",remarkEvents)})(window);
(function(window,undefined){var seal=function(path,field,render,initValue,initDisplayValue){$Control.call(this,$Control.CONTROL_TYPE_SIGNATURE,path,field,render,initValue,initDisplayValue)};seal.IFRAME_ID="iframeId";seal.IFRAME_DIALOG="iframeDialog";seal.eventRegistered=false;seal.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_SIGNATURE],ignoreClass:true,name:"seal",clickFireFieldChange:true,hasHiddenElement:true,createElement:function(){var element=document.createElement("div");if(this.isWritable()){var signatureAdd=document.createElement("div");$(signatureAdd).addClass("signatureAdd");if(this.field.placeHolder!=null){$(signatureAdd).addClass("hasPlaceHolder");$(signatureAdd).append("<p>"+this.field.placeHolder+"</p>")}element.appendChild(signatureAdd)}if(this.isReadable()){var signatureImgContainer=document.createElement("div");$(signatureImgContainer).addClass("signatureImgContainer");var signatureImg=document.createElement("img");$(signatureImg).addClass("signatureImg");signatureImgContainer.appendChild(signatureImg);$(signatureImgContainer).hide();element.appendChild(signatureImgContainer)}return element},setValue:function(fieldValue,fieldDisplayValue){if(fieldValue!=""&&fieldValue!=null){var data=JSON.parse(fieldValue);this.getCheckedSignatureData(data,this.element)}},getValue:function(){var value=this.convertEmptyValue($(this.element).data($Control.DATA_ORIGIN_INPUT).value);switch(this.field.type){case $Control.DATA_TYPE_SIGNATURE:return value}},requestSealInfo:function(_seal){var _this=this;var csrfToken=$(document).find("meta[itemscope=csrfToken]").attr("content");var requestUrl=$$.params.graphqlUrl+"?csrfToken="+csrfToken;var seal=_seal.name;var stepId=$$.params.formStepId==null?-1:$$.params.formStepId;var query='{sealSignatures(seal:"'+seal+'", stepId:'+stepId+") {seal{name,text,certificate{name,version,issuer,subject,description,validStart,validLimit,algorithm,signature,publicKey}},text,signer{name,account},timestamp,comment}}";$.ajax({type:"POST",url:requestUrl,contentType:"application/json",data:$.toJSON({query:query})}).done(function(res){var data=res.data;var sealSignaturesDiv=$("<div class='sealSignatures'></div>");if(_seal){var sealInfo=$("<div class='sealSignatureSection'><div class='sectionTitle'>"+$$.lt("seal.sealSignatures.sealInfo.title")+"</div><div class='sectionBody sealInfo'><p class='sectionListp'><span>"+$$.lt("seal.sealSignatures.sealInfo.sealText")+":</span><span>"+_seal.text+"</span></p><p class='sectionListp'><span>"+$$.lt("seal.sealSignatures.sealInfo.sealImage")+":</span><span><img src='"+_seal.image+"'></span></p></div></div>");sealSignaturesDiv.append(sealInfo)}if(data&&data.sealSignatures&&data.sealSignatures.length>0){var sealSignatures=data.sealSignatures;var certificate=sealSignatures[0].seal.certificate;var sealCertificate=$("<div class='sealSignatureSection'><div class='sectionTitle'>"+$$.lt("seal.sealSignatures.sealCertificate.title")+"</div><div class='sectionBody'></div></div>");var certificateBody=sealCertificate.find(".sectionBody");_this.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.subject"),certificate.subject,certificateBody);_this.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.issuer"),certificate.issuer,certificateBody);_this.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.signature"),certificate.signature,certificateBody);_this.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.serialNumber"),certificate.name,certificateBody);_this.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.termOfValidity"),_this.sealDateFormat(certificate.validStart)+" - "+_this.sealDateFormat(certificate.validLimit),certificateBody);_this.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealCertificate.intendedUse"),certificate.description,certificateBody);sealSignaturesDiv.append(sealCertificate);var sealUse=$("<div class='sealSignatureSection'><div class='sectionTitle'>"+$$.lt("seal.sealSignatures.sealUse.title")+"</div><div class='sectionBody'></div></div>");var sealUseBody=sealUse.find(".sectionBody");sealSignaturesDiv.append(sealUse);for(var i=0;i<sealSignatures.length;i++){var sealSignature=sealSignatures[i];var sealUseBodySection=$("<div></div>");_this.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealUse.signatory"),sealSignature.signer.name,sealUseBodySection);_this.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealUse.signatureTime"),_this.sealDateFormat(sealSignature.timestamp),sealUseBodySection);_this.createSealSectionBodyItem($$.lt("seal.sealSignatures.sealUse.comment"),sealSignature.comment,sealUseBodySection);if(i==sealSignatures.length-1){sealUseBodySection.addClass("last")}sealUseBody.append(sealUseBodySection)}}var title=$$.lt("seal.sealSignatures.title");if(!$$.MOBILE){var dialog=new InfoPlus.Render.Dialog({title:title,content:sealSignaturesDiv,maxWidth:650,showFooter:false,showCloseButton:true,buttons:[]});dialog.show()}else{var page=new InfoPlus.Render.Mobile.Page({title:title,content:sealSignaturesDiv});page.show()}})},sealDateFormat:function(time){if(time){var dateAttachment=new Date(time*1000);var dateFormat="yyyy/MM/dd hh:mm";return $IU.dateFormat(dateAttachment,dateFormat)}else{return""}},createSealSectionBodyItem:function(title,value,parent){var item=$("<p class='sectionListp'><span>"+title+":</span><span>"+(value?value:"")+"</span></p>");parent.append(item)},registerEvent:function(){this.events=InfoPlus.Controls.Seal.Events.events;if(InfoPlus.Controls.Seal.eventRegistered){return}var _this=this;$(window).on("message",function(e){var message;try{message=e.originalEvent.data}catch(e){}if(message==null||message.command==null){return}if(message.command=="createSignature"){_this.closeIframeDialog(message)}else{if(message.command=="closeSignature"){_this.iframeDialog.hide()}}});InfoPlus.Controls.Signature.eventRegistered=true},closeIframeDialog:function(message){var data=message.data;var iframeId=data.iframeId;var selector="."+this.getElementClassName();var element=null;if(iframeId){$(selector).each(function(){var _iframeId=$(this).data(InfoPlus.Controls.Seal.IFRAME_ID);if(_iframeId==iframeId){element=this;return}})}if(element){var iframeDialog=$(element).data(InfoPlus.Controls.Seal.IFRAME_DIALOG);this.getCheckedSignatureData(data,element,function(){if(!$$.MOBILE){iframeDialog.hide()}else{iframeDialog.close()}})}},getCheckedSignatureData:function(data,element,callback){if(data){var seal=data.seal;if(seal&&seal.name&&seal.image){var _seal={};_seal.name=seal.name;_seal.image=seal.image;if(seal.text){_seal.text=seal.text}if(seal.kind){_seal.kind=seal.kind}if(seal.certificate){_seal.certificate=seal.certificate}var signatureData={};signatureData.seal=_seal;if(data.attributes){signatureData.attributes=data.attributes}var $element=$(element);var hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);$(hiddenInput).val(JSON.stringify(signatureData));var signatureAdd=$element.find(".signatureAdd");signatureAdd.hide();$element.find(".signatureImg").attr("src",seal.image);var signatureImgContainer=$element.find(".signatureImgContainer");signatureImgContainer.show();if(this.isReadable()){var menuItems=[];var _this=this;if(this.isWritable()){menuItems.push({id:"edit",text:$$.lt("seal.menu.edit"),iconClass:"i-icon-pencil-square",iconCss:"left:-1px",click:function(){_this.triggerChange()}})}menuItems.push({id:"view",text:$$.lt("seal.menu.view"),iconClass:"i-icon-search2",iconCss:"left:-1px",click:function(){_this.requestSealInfo(seal);return false}});if(this.isWritable()){menuItems.push({id:"remove",text:$$.lt("seal.menu.remove"),iconClass:"i-icon-trash",iconCss:"left:-1px",click:function(){signatureImgContainer.hide().find("img").attr("src","");signatureAdd.show();var hiddenInput=$(element).data($Control.DATA_ORIGIN_INPUT);hiddenInput.value="";return false}})}if(menuItems&&menuItems.length>0){var popMenu=new InfoPlus.Render.PopMenu({container:signatureImgContainer,items:menuItems,horizontalMenuItem:true,position:"bottom-left"})}}if(callback!=null&&typeof callback==="function"){callback()}}else{$IU.messageBox(null,$$.lt("seal.dialog.missSealInfo"),null,300)}}},openIframeDialog:function(uri,title,modal,allowOpenNewWindow,width,height){var iframe=document.createElement("iframe");$(iframe).attr("id",this.field.name+"_signature_iframe");$(iframe).addClass("signature_iframe");iframe.src=uri;iframe.setAttribute("width","100%");iframe.setAttribute("height",(height===0||height==null?$(window).height()*0.75:height)+"px");var dialog=new InfoPlus.Render.Dialog({title:title,content:iframe,maxWidth:(width==null||width===0?$(window).width:width),openNewUrl:uri,showFooter:false,showCloseButton:true,showOpenNewButton:allowOpenNewWindow,showMinimiseButton:!modal,modal:modal});dialog.show();this.iframeLoaded(iframe,dialog)},iframeLoaded:function(iframe,dialog){if(iframe){var _this=this;iframe.onload=function(){var data={iframeId:"signature_"+$$.guid()};$(_this.element).data(InfoPlus.Controls.Seal.IFRAME_ID,data.iframeId);$(_this.element).data(InfoPlus.Controls.Seal.IFRAME_DIALOG,dialog);iframe.contentWindow.postMessage({command:"initSignature",data:data},"*")}}},triggerChange:function(){var url=$$.params.uriSealSelector;url=url.replace("%2",this.field.name);url=url.replace("%1",$$.params.formStepId);url=url.replace("%path",this.path||"");var title=$$.lt("seal.dialog.title");var height="360px";var modal=true;var width="400px";var allowOpenNewWindow=false;if(!$$.MOBILE){this.openIframeDialog(url,title,modal,allowOpenNewWindow,width,height)}else{var page=new InfoPlus.Render.Mobile.Page({title:title,uri:url});page.show();var iframe=$(page.element).find("iframe")[0];this.iframeLoaded(iframe,page)}}});define("InfoPlus.Controls.Seal",seal);var sealEvents={onSignatureClick:function(){var signatureControl=$(this).data($Control.DATA_CONTROL_OBJECT),field=signatureControl.field;if(field==null){return false}if(signatureControl.isReadOnly()||$(signatureControl.element).hasClass($Control.CLASSNAME_READONLY)){return false}if($(signatureControl.element).find(".signatureImgContainer").css("display")!="none"){return false}signatureControl.triggerChange();return false}};sealEvents.events=[{type:"click",handler:sealEvents.onSignatureClick}];define("InfoPlus.Controls.Seal.Events",sealEvents)})(window);
(function(window,undefined){var select=function(path,field,render,initValue,initDisplayValue,parentValue,initAttributes){var items=null;if(field.code!=null){var code=$$.codeManager.getCode(field.code);if(code!=null){items=code.items}if(items==null||($IU.isArray(items)&&items.length===0)){if(code==null||(code!=null&&code.codeType==="External")){$$.codeManager.addRequestCode(field.code,field.name)}}}this.items=items;this.parentValue=parentValue;if(initValue!==""){if(items==null||($IU.isArray(items)&&items.length===0)){this.items=[{codeId:initValue,codeName:initDisplayValue,enabled:true,parentId:parentValue,attributes:initAttributes}]}}$Control.call(this,$Control.CONTROL_TYPE_SELECT,path,field,render,initValue,initDisplayValue,initAttributes)};select.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_CODE],name:"select",emptyOption:null,setDataSourceFromItems:function(element,items,initValue,fromInit){var oldValue=this.getValue();this.setOptions(element,items,initValue);if(fromInit!==true){if(element.selectedIndex===0){if(this.field.notNull===true&&element.options.length===2){element.options[1].selected=true}}$IU.highLightElement(element);var newValue=this.getValue();if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){if(oldValue.value!==newValue.value){setTimeout(function(){$(element).change()},0)}}}},createElement:function(){var element=document.createElement("select");if(this.isReadOnly()){if(this.initValue!=null){var op=document.createElement("option");op.value=this.initValue;op.text=this.initDisplayValue;op.selected=true;element.add(op)}}else{var emptyOption=document.createElement("option");emptyOption.value="";emptyOption.text=$$.lt("select.choose");$(emptyOption).addClass("emptyOption");if(this.field.notNull===true){emptyOption.setAttribute("disabled","disabled")}element.add(emptyOption);this.emptyOption=emptyOption;if($IU.isArray(this.items)){this.setOptions(element,this.items,this.initValue)}else{}}return element},setPlaceHolder:function(){if(this.emptyOption!=null){if(this.field!=null&&this.field.placeHolder!=null&&this.field.placeHolder!==""){$($(this.element).children()[0]).text(this.field.placeHolder)}}},setValue:function(fieldValue,fieldDisplayValue,isInit,attributes){if(fieldValue==null){fieldValue=""}if(attributes!=null){if(attributes.datasource!=null||attributes.datasource_Codes!=null){var items=[];var ids=(attributes.datasource!=null)?$IU.splitAttribute(attributes.datasource):$IU.splitAttribute(attributes.datasource_Codes),names=$IU.splitAttribute(attributes.datasource_Names);for(i=0,len=ids.length;i<len;i++){items.push({codeId:ids[i],codeName:names[i]!=null?names[i]:ids[i],enabled:true,attributes:attributes})}this.setOptions(this.element,items,fieldValue)}this.setAttributes(attributes)}else{var ops=this.element.options,len=ops.length,foundSelectIndex=false;for(var i=1;i<len;i++){if(ops[i].value===fieldValue){ops[i].selected=true;foundSelectIndex=true}}if(!foundSelectIndex){if(isInit===true&&(fieldValue==null||fieldValue==="")&&this.field.notNull===true&&len===2){this.element.selectedIndex=1}else{this.element.selectedIndex=0}}}},getValue:function(){var selectedIndex=this.element.selectedIndex;if(selectedIndex<0){return new $Controls.Data.ValuePair("","",this.parentValue)}var val=this.element.options[selectedIndex].value;var displayValue=this.element.options[selectedIndex].text;if(selectedIndex===0&&val===""){displayValue=""}return new $Controls.Data.ValuePair(val,displayValue,this.parentValue)},getAttributes:function(){var selectedIndex=this.element.selectedIndex;if(selectedIndex===-1){return null}if(this.items==null){return null}var val=this.element.options[selectedIndex].value;if(val===""){return null}if($IU.isArray(this.items)){for(var i=0,l=this.items.length;i<l;i++){if(this.items[i].enabled===true&&this.items[i].codeId===val){return this.items[i].attributes}}}return null},getDataSource:function(){var result=[];var options=this.element.options;for(var i=0,len=options.length;i<len;i++){var option=options[i];if(i===0&&option.value===""){continue}result.push(new $Controls.Data.ValuePair(option.value,option.text,this.parentValue))}return result},setOptions:function(element,items,initValue){var field=this.field,parentValue=this.parentValue;if(initValue===undefined){initValue=element.value}var isDisplay=function(item){if(field.code!=null){if(field.parent==null){return true}else{return parentValue===item.parentId}}else{if(field.parent==null){return true}else{return parentValue===item.parentId}}};var isEnabled=function(item){return !(item.isEnabled===false||item.enabled===false)};element.options.length=1;if(!$IU.isArray(items)){return}var found=false;for(var i=0,len=items.length;i<len;i++){var item=items[i];if(isEnabled(item)&&isDisplay(item)){var op=document.createElement("option");op.value=item.codeId;op.text=item.codeName;if(item.codeId===initValue){op.selected=true;found=true}else{op.selected=false}element.add(op)}}if(!found){element.value=""}this.items=items},setDataSource:function(dataSource,fromInit){if(!this.isWritable()){return}var oldValue=this.element.value;var useFirstAsDefault=false;if(dataSource instanceof InfoPlus.Dynamics.Params){var params=dataSource.params;if(params.length>1&&params[1]===true){useFirstAsDefault=true}dataSource=params[0]}this.items=[];if($IU.isString(dataSource)){var dataArray=$IU.splitAttribute(dataSource);for(var i=0,len=dataArray.length;i<len;i++){this.items.push({codeId:dataArray[i],codeName:dataArray[i],enabled:true})}}else{if($IU.isArray(dataSource)){for(i=0,len=dataSource.length;i<len;i++){var data=dataSource[i];if(data.value!==undefined&&data.displayValue!==undefined){this.items.push({codeId:data.value,codeName:data.displayValue,enabled:true,parentId:data.parentId})}}}}if(!fromInit){if(useFirstAsDefault&&this.items.length>0){oldValue=this.items[0].codeId}}this.setDataSourceFromItems(this.element,this.items,oldValue,fromInit)},setParentValue:function(parentValue,fromInit){var oldValue=this.element.value;if((parentValue instanceof $Controls.Data.ValuePair)||(parentValue instanceof $Controls.Data.Uri)){this.parentValue=parentValue.value}else{this.parentValue=parentValue}this.setDataSourceFromItems(this.element,this.items,oldValue,fromInit)},specialSetting:function(){var $select=$(this.element);if($select.css("text-align").toLocaleLowerCase()==="right"){$select.attr("dir","rtl")}}});define("InfoPlus.Controls.Select",select)})(window);
(function(window,undefined){var signature=function(path,field,render,initValue,initDisplayValue){$Control.call(this,$Control.CONTROL_TYPE_SIGNATURE,path,field,render,initValue,initDisplayValue)};signature.IFRAME_ID="iframeId";signature.IFRAME_DIALOG="iframeDialog";signature.eventRegistered=false;signature.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_SIGNATURE],ignoreClass:true,name:"signature",clickFireFieldChange:true,hasHiddenElement:true,createElement:function(){var element=document.createElement("div");if(this.isWritable()){var signatureAdd=document.createElement("div");$(signatureAdd).addClass("signatureAdd");if(this.field.placeHolder!=null){$(signatureAdd).addClass("hasPlaceHolder");$(signatureAdd).append("<p>"+this.field.placeHolder+"</p>")}element.appendChild(signatureAdd)}if(this.isReadable()){var signatureImgContainer=document.createElement("div");$(signatureImgContainer).addClass("signatureImgContainer");var signatureImg=document.createElement("img");$(signatureImg).addClass("signatureImg");var signatureInvaild=document.createElement("div");$(signatureInvaild).addClass("signatureInvaild").hide();signatureImgContainer.appendChild(signatureImg);signatureImgContainer.appendChild(signatureInvaild);$(signatureImgContainer).hide();element.appendChild(signatureImgContainer)}return element},setValue:function(fieldValue,fieldDisplayValue){if(fieldValue!=""&&fieldValue!=null){var data=JSON.parse(fieldValue);this.getCheckedSignatureData(data,this.element)}},checkSignature:function(textHash){var text=this.getFormatContent();var _textHash=$.md5(text);if(textHash&&_textHash!=textHash){$(this.element).find(".signatureInvaild").show()}},getFormatContent:function(){var instance=this;var getSortedContext=function(){$$.dynamics.cache.build();var context=instance.dynamicProcessor.getControlContext(instance,undefined,true);var sortArray=new InfoPlus.QuickSortArray();for(var k in context){if(context.hasOwnProperty(k)){sortArray.push({name:k,obj:context[k]})}}sortArray.sort(function(u1,u2){var l1=u1.name.length,l2=u2.name.length;if(l1>l2){return -1}else{if(l1===l2){return 0}else{return 1}}});return sortArray};var replaceContent=function(format){var context=getSortedContext();for(var i=0,len=context.length;i<len;i++){var o=context[i];var fieldName=o.name;format=replaceFormat(format,o.obj,fieldName,"displayValue");format=replaceFormat(format,o.obj,fieldName,"name");if(o.name!==instance.field.name){format=replaceFormat(format,o.obj,fieldName,"value");format=replaceFormat(format,o.obj,fieldName)}}return format};var replaceFormat=function(format,obj,fieldName,property){if(obj==null){return format}if(property!=null){if(obj[property]!=null){format=format.replace(new RegExp("\\$"+fieldName+"\\."+property,"gm"),obj[property]);return format.replace(new RegExp("\\${"+fieldName+"\\."+property+"}","gm"),obj[property])}}else{format=format.replace(new RegExp("\\$"+fieldName,"gm"),obj);return format.replace(new RegExp("\\${"+fieldName+"}","gm"),obj)}return format};var format=this.field.format||"";var content=replaceContent(format);return content},getValue:function(isSave){var value=this.convertEmptyValue($(this.element).data($Control.DATA_ORIGIN_INPUT).value);switch(this.field.type){case $Control.DATA_TYPE_SIGNATURE:if(value&&isSave&&this.isWritable()){value=JSON.parse(value);var text=this.getFormatContent();value.text=text;var textHash=$.md5(text);value.textHash=textHash;value=JSON.stringify(value)}return value}},registerEvent:function(){this.events=InfoPlus.Controls.Signature.Events.events;if(InfoPlus.Controls.Signature.eventRegistered){return}var _this=this;$(window).on("message",function(e){var message;try{message=e.originalEvent.data}catch(e){}if(message==null||message.command==null){return}if(message.command=="createSignature"){_this.closeIframeDialog(message)}else{if(message.command=="closeSignature"){_this.iframeDialog.hide()}}});InfoPlus.Controls.Signature.eventRegistered=true},closeIframeDialog:function(message){var data=message.data;var iframeId=data.iframeId;var selector="."+this.getElementClassName();var element=null;if(iframeId){$(selector).each(function(){var _iframeId=$(this).data(InfoPlus.Controls.Signature.IFRAME_ID);if(_iframeId==iframeId){element=this;return}})}if(element){var iframeDialog=$(element).data(InfoPlus.Controls.Signature.IFRAME_DIALOG);this.getCheckedSignatureData(data,element,function(){if(!$$.MOBILE){iframeDialog.hide()}else{iframeDialog.close()}})}},getCheckedSignatureData:function(data,element,callback){if(data){var seal=data.seal;if(seal&&seal.name&&seal.image){var _seal={};_seal.name=seal.name;_seal.image=seal.image;if(seal.text){_seal.text=seal.text}if(seal.kind){_seal.kind=seal.kind}if(seal.certificate){_seal.certificate=seal.certificate}var signatureData={};signatureData.seal=_seal;if(data.signer){signatureData.signer=data.signer}if(data.mfa){signatureData.mfa=data.mfa}if(data.algorithm){signatureData.algorithm=data.algorithm}if(data.signature){signatureData.signature=data.signature}if(data.timestamp){signatureData.timestamp=data.timestamp}if(data.comment){signatureData.comment=data.comment}if(data.text){signatureData.text=data.text}if(data.textHash){signatureData.textHash=data.textHash}if(data.uri){signatureData.uri=data.uri}if(data.attributes){signatureData.attributes=data.attributes}var _this=this;if(this.isReadable()&&!this.isWritable()){var textHash=data.textHash;setTimeout(function(){_this.checkSignature(textHash)},0)}var $element=$(element);var hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);$(hiddenInput).val(JSON.stringify(signatureData));var signatureAdd=$element.find(".signatureAdd");signatureAdd.hide();$element.find(".signatureImg").attr("src",seal.image);var signatureImgContainer=$element.find(".signatureImgContainer");signatureImgContainer.show();if(this.isReadable()&&this.isWritable()){var menuItems=[];menuItems.push({id:"edit",text:$$.lt("seal.menu.edit"),iconClass:"i-icon-pencil-square",iconCss:"left:-1px",click:function(){_this.triggerChange()}});menuItems.push({id:"remove",text:$$.lt("file.menu.remove"),iconClass:"i-icon-trash",iconCss:"left:-1px",click:function(){signatureImgContainer.hide().find("img").attr("src","");signatureAdd.show();var hiddenInput=$(element).data($Control.DATA_ORIGIN_INPUT);hiddenInput.value="";return false}});var popMenu=new InfoPlus.Render.PopMenu({container:signatureImgContainer,items:menuItems,horizontalMenuItem:true,position:"bottom-right"})}if(callback!=null&&typeof callback==="function"){callback()}}else{$IU.messageBox(null,$$.lt("signature.dialog.missSealInfo"),null,300)}}},openIframeDialog:function(uri,title,modal,allowOpenNewWindow,width,height){var iframe=document.createElement("iframe");$(iframe).attr("id",this.field.name+"_signature_iframe");$(iframe).addClass("signature_iframe");iframe.src=uri;iframe.setAttribute("width","100%");iframe.setAttribute("height",(height===0||height==null?$(window).height()*0.75:height)+"px");var dialog=new InfoPlus.Render.Dialog({title:title,content:iframe,maxWidth:(width==null||width===0?$(window).width:width),openNewUrl:uri,showFooter:false,showCloseButton:true,showOpenNewButton:allowOpenNewWindow,showMinimiseButton:!modal,modal:modal});dialog.show();this.iframeLoaded(iframe,dialog)},iframeLoaded:function(iframe,dialog){if(iframe){var _this=this;iframe.onload=function(){var data={iframeId:"signature_"+$$.guid()};$(_this.element).data(InfoPlus.Controls.Signature.IFRAME_ID,data.iframeId);$(_this.element).data(InfoPlus.Controls.Signature.IFRAME_DIALOG,dialog);iframe.contentWindow.postMessage({command:"initSignature",data:data},"*")}}},triggerChange:function(){var url=$$.params.uriSealSelector;url=url.replace("%2",this.field.name);url=url.replace("%1",$$.params.formStepId);url=url.replace("%path",this.path||"");var title=$$.lt("signature.dialog.title");var height="360px";var modal=true;var width="400px";var allowOpenNewWindow=false;if(!$$.MOBILE){this.openIframeDialog(url,title,modal,allowOpenNewWindow,width,height)}else{var page=new InfoPlus.Render.Mobile.Page({title:title,uri:url});page.show();var iframe=$(page.element).find("iframe")[0];this.iframeLoaded(iframe,page)}}});define("InfoPlus.Controls.Signature",signature);var signatureEvents={onSignatureClick:function(){var signatureControl=$(this).data($Control.DATA_CONTROL_OBJECT),field=signatureControl.field;if(field==null){return false}if(signatureControl.isReadOnly()||$(signatureControl.element).hasClass($Control.CLASSNAME_READONLY)){return false}if($(signatureControl.element).find(".signatureImgContainer").css("display")!="none"){return false}signatureControl.triggerChange();return false}};signatureEvents.events=[{type:"click",handler:signatureEvents.onSignatureClick}];define("InfoPlus.Controls.Signature.Events",signatureEvents)})(window);
(function(window,undefined){var suggester=function(path,field,render,formRender,initValue,initDisplayValue,parentValue,tipFormat,suggestService,initializeService,initAttributes){this.parentValue=parentValue;this.suggestService=suggestService;this.initializeService=initializeService;this.tipFormat=tipFormat;this.formRender=formRender;$Control.call(this,$Control.CONTROL_TYPE_SUGGESTER,path,field,render,initValue,initDisplayValue,initAttributes)};suggester.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE],autoTriggerFieldChangeEvent:false,name:"suggester",createElement:function(){var element=document.createElement("select");return element},setValue:function(fieldValue,fieldDisplayValue,isInit,attributes){if(fieldValue==null){fieldValue=""}if(fieldDisplayValue==null){fieldDisplayValue=""}var suggesterControl=$(this.element).data($Control.DATA_SUGGESTER);if(suggesterControl==null){return}this.setAttributes(attributes);suggesterControl.setData({codeId:fieldValue,codeName:fieldDisplayValue,attributes:attributes},fieldDisplayValue)},getValue:function(){var element=this.element;var val=this.convertEmptyValue(element.value);var suggesterControl=$(element).data($Control.DATA_SUGGESTER);if(suggesterControl==null){return new $Controls.Data.ValuePair("","",this.parentValue)}var displayValue=suggesterControl.text||"";return new $Controls.Data.ValuePair(val,displayValue,this.parentValue)},getSortValue:function(){return this.getValue().displayValue},setStyle:function(name,value){var suggesterControl=$(this.element).data($Control.DATA_SUGGESTER);suggesterControl.setSuggesterStyle(name,value)},getStyle:function(name){var suggesterControl=$(this.element).data($Control.DATA_SUGGESTER);return suggesterControl.getSuggesterStyle(name)},specialSetting:function(){this.createSuggester()},setDynamicReadOnly:function(isReadOnly){if(isReadOnly){this.element.readOnly=true;var suggesterControl=$(this.element).data($Control.DATA_SUGGESTER);$(suggesterControl.activeInput).addClass(InfoPlus.Suggester.CLASSNAME_READONLY)}else{this.element.readOnly=false;suggesterControl=$(this.element).data($Control.DATA_SUGGESTER);$(suggesterControl.activeInput).removeClass(InfoPlus.Suggester.CLASSNAME_READONLY)}},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=true;this.setDynamicReadOnly(true)},createSuggester:function(){var field=this.field;var element=this.element;var type=field.type;var code=field.code;if(type===$Control.DATA_TYPE_CODE&&code==null){$IU.delayedErrorMessageBox($$.lt("suggester.noCode",field.name));return null}var mode=this.configSuggesterMode();var suggesterControl=new InfoPlus.Suggester(field,element,this.initValue,this.initDisplayValue,type,code,mode,this.tipFormat,this.suggestService,this.initializeService);$(element).data($Control.DATA_SUGGESTER,suggesterControl);this.controlContainer=suggesterControl.container;$(this.controlContainer).data($Control.DATA_CONTROL_OBJECT,this).attr("id",this.element.id+"_Container");if($(element).css("text-align").toLocaleLowerCase()==="right"){$(suggesterControl.activeInput).css("text-align","right")}return suggesterControl},configSuggesterMode:function(){var permission=this.field.permission||"";var field=this.field;var type=field.type;var mode=0;if(permission.indexOf("w")<0){mode|=InfoPlus.Suggester.MODE_FLAG_READONLY}if(permission.indexOf("w")<0&&permission.indexOf("r")<0){mode|=InfoPlus.Suggester.MODE_FLAG_DISAPPEAR}if(type===$Control.DATA_TYPE_USER){if(!(field.settings!=null&&field.settings.userTraversal===true)){mode|=InfoPlus.Suggester.MODE_FLAG_DISABLE_MULTIPAGE}}if(field.notNull===false){mode|=InfoPlus.Suggester.MODE_FLAG_EMPTY_ITEM_APPEAR}if(field.allowExternalCode===true){mode|=InfoPlus.Suggester.MODE_FLAG_EXTERNAL_VALUE}return mode},setPlaceHolder:function(){if(this.field!=null&&this.field.placeHolder!=null){var suggester=$(this.element).data($Control.DATA_SUGGESTER);if(suggester!=null){var input=suggester.activeInput;if(input!=null&&input.placeholder!==undefined){$(input).attr("placeholder",this.field.placeHolder)}}}},setFocus:function(){var suggesterControl=$(this.element).data($Control.DATA_SUGGESTER);suggesterControl.containerClick()},lostFocus:function(){var suggesterControl=$(this.element).data($Control.DATA_SUGGESTER);if(suggesterControl.activeInput){suggesterControl.activeInput.blur()}},hideControl:function(){this.controlContainer.style.display="none"},getDataSource:function(){var suggesterControl=$(this.element).data($Control.DATA_SUGGESTER);if(suggesterControl==null){return[]}var ds=[];for(var i=0,data=suggesterControl.suggestData,len=data.length;i<len;i++){ds.push({value:data[i].codeId,displayValue:data[i].codeName})}return ds},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip===""){return}var $element=$(this.controlContainer).find(".active_input");$element.validationEngine("showPrompt",$IU.htmlEncode(this.tooltip.tip),this.tooltip.type,"topLeft",true);$element.one("blur",function(){$(this).validationEngine("hidePrompt")})},setParentValue:function(parentValue,fromInit){var oldParentValue=this.parentValue;if((parentValue instanceof $Controls.Data.ValuePair)||(parentValue instanceof $Controls.Data.Uri)){this.parentValue=parentValue.value}else{this.parentValue=parentValue}if(fromInit!==true&&$$.params.fieldChanging==null&&(oldParentValue!==this.parentValue)){this.setValue("","");$IU.highLightElement(this.element)}},visible:function(isVisible){if(this.controlContainer==null){return}if(isVisible){$(this.controlContainer).show()}else{$(this.controlContainer).hide()}}});define("InfoPlus.Controls.Suggester",suggester)})(window);
(function(window,undefined){var suggester2=function(path,field,render,initValue,initDisplayValue,parentValue,suggestService,initAttributes,originControl){this.isOnPagePopup=(originControl!=null);var option={ajax:{url:suggestService,delay:250,dataType:"json",type:"POST",data:this.getQueryData(field),processResults:this.processQueryResults,transport:this.ajaxTransport(field)},allowClear:true,dropdownAutoWidth:!this.isOnPagePopup,language:{errorLoading:function(){return $$.lt("suggester2.errorLoading")},inputTooLong:function(e){var t=e.input.length-e.maximum;return $$.lt("suggester2.tooLong",t)},inputTooShort:function(e){var t=e.minimum-e.input.length;return $$.lt("suggester2.tooShort",t)},loadingMore:function(){return $$.lt("suggester2.loadMore")},maximumSelected:function(e){return $$.lt("suggester2.maxSelect",e.maximum)},noResults:function(){return $$.lt("suggester2.noResult")},searching:function(e){$$.params.suggeseter2={query:e};var term=e.term||"";if(term.length===0){return field.type.toLocaleLowerCase()==="user"?$$.lt("suggester2.emptyUser"):$$.lt("suggester2.emptyHint")}else{return $$.lt("suggester2.searching")}}},templateResult:this.formatState};this.option=option;this.parentValue=parentValue;this.initAttributes=initAttributes;this.suggestService=suggestService;this.dataType=field.type;if(this.isOnPagePopup){this.originSuggester=originControl;field.needSync=true}$Control.call(this,$Control.CONTROL_TYPE_SUGGESTER2,path,field,render,initValue,initDisplayValue,initAttributes);var select=$(this.element).data($Control.DATA_ORIGIN_INPUT),$select=$(select);$select.data("ajaxOption",option)};suggester2.PAGE_ITEM_COUNT=15;suggester2.isPagePopup=function(){return true},suggester2.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_USER,$Control.DATA_TYPE_ORGANIZE,$Control.DATA_TYPE_CODE],name:"suggester2",autoTriggerFieldChangeEvent:false,searchResults:[],formatState:function(state){var makeSpace=function(data){var count=0,result="";if(data==null){return result}for(var index=0;index<data.length;index++){if((data.charCodeAt(index)<0)||(data.charCodeAt(index)>255)){count+=2}else{count++}}count=Math.round(count/2);for(index=0;index<count;index++){result+=""}return result};var findIndexOf=function(content,fromIndex){var prefixValue=$$.params.suggeseter2.query.term||"";var searchArray=prefixValue.toLocaleLowerCase().split(/[ ]|,/);if(searchArray.length===0){return{index:-1,len:0}}var index=-1,searchLen=0;for(var i=0,len=searchArray.length;i<len;i++){if(searchArray[i].length===0){continue}var thisIndex=content.indexOf(searchArray[i],fromIndex);if(thisIndex!==-1&&(index===-1||thisIndex<index)){index=thisIndex;searchLen=searchArray[i].length}}return{index:index,len:searchLen}};var replacePrefix=function(text){var lowerCaseText=text.toLocaleLowerCase(),currentIndex=0,resultText="";var findResult=findIndexOf(lowerCaseText,currentIndex);while(findResult.index!==-1){resultText+=text.substring(currentIndex,findResult.index);resultText+="<u>"+text.substr(findResult.index,findResult.len)+"</u>";currentIndex=findResult.index+findResult.len;findResult=findIndexOf(lowerCaseText,currentIndex)}resultText+=text.substr(currentIndex);return resultText};if(state.item==null){return state.text}else{if(state.item.external===true){return $("<span class='externalCode'>"+replacePrefix(state.text)+"</span>")}else{const readableId=state.item.codeIdReadable||state.item.codeId;if(state.item.duplicated!==true){var findResult=findIndexOf(readableId,0);if(findResult.index!==-1){return $("<span>"+(replacePrefix(state.text)+makeSpace(readableId))+'</span><span class="tip">'+replacePrefix(readableId)+"</span>")}else{return $("<span>"+replacePrefix(state.text)+"</span>")}}else{return $("<span>"+(replacePrefix(state.text)+makeSpace(readableId))+'</span><span class="tip">'+replacePrefix(readableId)+"</span>")}}}},getQueryData:function(field){return function(params){var control=this.data($Control.DATA_CONTROL_OBJECT);if(control==null){return null}return{prefix:params.term==null?"":params.term,type:field.type,code:field.code||"",parent:control.parentValue||"",isTopLevel:field.parent==null,pageNo:isNaN(params.page)?0:params.page-1,rand:Math.random()*999,settings:$.toJSON(field.settings==null?{}:field.settings)}}},processQueryResults:function(data,params){var items=data.items;var control=this.$element.data($Control.DATA_CONTROL_OBJECT),field=control.field,moreUser=(field.settings!=null&&field.settings.userTraversal===true);if(params._type==="query"){control.searchResults=[]}var findDuplicatedItems=function(items,newItem){var r=[];for(var i=0,len=items.length;i<len;i++){var oldItem=items[i];if((oldItem.codeName||"")===(newItem.codeName||"")){r.push(oldItem)}}return r};var findItemInResults=function(results,item){for(var i=0,len=results.length;i<len;i++){var result=results[i];if(result.id===item.codeId){return result}}return null};var getItemText=function(item){var text=$IU.trimString(item.codeName)||"";if(item.description!=null&&item.description!==""){text+="("+$IU.trimString(item.description)+")"}return text};var getInaccurateTotal=function(total){if(total>100000){return $$.lt("suggester2.inaccurateTotal.hundredThousand")}if(total>10000){return $$.lt("suggester2.inaccurateTotal.tenThousand")}if(total>1000){return $$.lt("suggester2.inaccurateTotal.thousand")}return total};for(var i=0,len=items.length,results=[];i<len;i++){var item=items[i];var text=getItemText(item);var duplicatedItems=findDuplicatedItems(control.searchResults,item);if(duplicatedItems.length>0){item.duplicated=true;for(var index=0,l=duplicatedItems.length;index<l;index++){var dupItem=duplicatedItems[index];dupItem.duplicated=true;var result=findItemInResults(results,dupItem);if(result!=null){result.item.duplicated=true}else{this.container.$results.find(".select2-results__option").each(function(){var data=$(this).data("data");if(data!=null){$(this).html(control.formatState(data))}})}}}item.text=text;control.searchResults.push(item);results.push({id:item.codeId,name:$IU.trimString(item.codeName)||"",text:text,attributes:item.attributes,item:item})}if(field.allowExternalCode===true&&results.length===0){var fakeItem={external:true,codeId:params.term,codeName:params.term};control.searchResults.push(fakeItem);results.push({id:params.term,name:params.term,text:getItemText(fakeItem),attributes:null,item:fakeItem})}if(control.dataType.toLocaleLowerCase()==="user"&&!moreUser&&data.total>suggester2.PAGE_ITEM_COUNT){results.push({id:" ",name:"",text:$$.lt("suggester2.moreUser",getInaccurateTotal(data.total)),attributes:null,item:null})}return{results:results,pagination:{more:control.dataType.toLocaleLowerCase()==="user"?moreUser:len>=suggester2.PAGE_ITEM_COUNT}}},ajaxTransport:function(field){return function(params,success,failure){if(params.data.type.toLocaleLowerCase()==="user"){var prefix=params.data.prefix||"";if(prefix.length<2){if(!(field.settings!=null&&field.settings.userTraversal===true)){return}}}params.needParse=false;params.showParseErrMsg=false;params.showAjaxErrMsg=false;params.addFormParam=true;var request=$$.ajax(params);request.done(success).fail(failure)}},createElement:function(){var suggester2Container=document.createElement("div");var select=document.createElement("select");var op=document.createElement("option");op.value="";op.text="";select.add(op);if(this.initValue!=null&&this.initValue!==""){op=document.createElement("option");op.value=this.initValue||"";op.text=this.initDisplayValue||"";op.selected=true;select.add(op)}$(suggester2Container).data($Control.DATA_ORIGIN_INPUT,select);$(select).data($Control.DATA_SOURCE_CONTROL,this).data($Control.DATA_CONTROL_TYPE,this.controlType);this.controlContainer=suggester2Container;$(suggester2Container).addClass("infoplus_suggester2ControlContainer").addClass("infoplus_select2");suggester2Container.appendChild(select);return suggester2Container},getAttributes:function(){var select=$(this.element).data($Control.DATA_ORIGIN_INPUT),$select=$(select);if($select.data("select2Object")!=null){var data=$select.select2("data");return data!=null&&data.length>0?data[0].attributes:null}else{return this.initAttributes}},setValue:function(fieldValue,fieldDisplayValue,fromInit,attributes){if(fieldValue==null){fieldValue=""}if(fieldDisplayValue==null){fieldDisplayValue=""}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);var select=$(this.element).data($Control.DATA_ORIGIN_INPUT),select2=$(select).data("select2Object");select.options.length=0;var op=document.createElement("option");op.value="";op.text="";select.add(op);if(fieldValue!==""){op=document.createElement("option");op.value=fieldValue;op.text=fieldDisplayValue;op.selected=true;select.add(op)}if(select2!=null){select2.val(fieldValue);var data=$(select).find("option:selected").data("data");if(data!=null){data.name=data.text;data.attributes=attributes}else{data={id:fieldValue,text:fieldDisplayValue,name:fieldDisplayValue,attributes:attributes,selected:true,title:"",disabled:false};$(select).find("option:selected").data("data",data)}if(fireChangeEvent){setTimeout(function(){select2.trigger("change")},0)}}},getValue:function(){var select=$(this.element).data($Control.DATA_ORIGIN_INPUT),select2=$(select).data("select2Object");if(select2!=null){var data=$(select).select2("data");if(data!=null&&data.length>0){return new $Controls.Data.ValuePair($IU.trimString(data[0].id),data[0].name,this.parentValue)}else{return new $Controls.Data.ValuePair("","",this.parentValue)}}else{var ops=select.options,len=ops.length;for(var i=0;i<len;i++){var op=ops[i];if(op.selected===true){return new $Controls.Data.ValuePair(op.value,op.text,this.parentValue)}}return new $Controls.Data.ValuePair("","",this.parentValue)}},getSortValue:function(){return this.getValue().displayValue},setElementAttribute:function(){this.setHiddenAttribute("suggester2")},specialSetting:function(){var select=$(this.element).data($Control.DATA_ORIGIN_INPUT),style=this.element.getAttribute("style");if(style!=null){select.setAttribute("style",style)}},initSelect2:function(){var select=$(this.element).data($Control.DATA_ORIGIN_INPUT),$select=$(select),height=$IU.getElementStyle(this.element,"height"),option=$select.data("ajaxOption"),select2=$select.select2(option);$select.removeAttr("style");$select.data("select2Object",select2);var data=$select.find("option:selected").data("data");if(data!=null){data.name=data.text;data.attributes=this.initAttributes}if(!this.isReadable()){this.visible(false)}var $select2span=$select.siblings(".select2"),$arrow=$select2span.find(".select2-selection__arrow");$arrow.children().remove();if($IU.endWith(height,"rem")){var rootFontSize=parseFloat($("html").css("font-size"));var parseHeight=parseFloat(height)*rootFontSize}else{parseHeight=parseInt(height,10)}if(!isNaN(parseHeight)&&parseHeight!==0){var $selection=$select2span.find(".select2-selection");$selection.css("height",parseHeight+"px");$selection.find(".select2-selection__rendered").css("height",parseHeight+"px").css("line-height",parseHeight+"px");$arrow.css("height",(parseHeight-2)+"px")}$arrow.addClass(this.dataType.toLocaleLowerCase());if(this.isOnPagePopup===true){$(this.element).css("width","100%");$select2span.css("width","100%")}this.initEvent()},initEvent:function(){var select=$(this.element).data($Control.DATA_ORIGIN_INPUT),$select=$(select),select2=$select.data("select2Object"),originControl=this;if(this.field.parent!=null){select2.on("select2:opening",function(event){var $self=$(this);if($self.data("openAgain")!==true){setTimeout(function(){$self.data("openAgain",true);select2.select2("open");$self.data("openAgain",false)},0);return false}else{if($IU.shouldShowSuggesterPage()&&originControl.isOnPagePopup!==true&&suggester2.isPagePopup()==true){$IU.clearAllError();$IU.showSuggester2Page(originControl);return false}}})}else{if($IU.shouldShowSuggesterPage()&&originControl.isOnPagePopup!==true&&suggester2.isPagePopup()==true){select2.on("select2:opening",function(event){$IU.clearAllError();$IU.showSuggester2Page(originControl);return false})}}if($IU.shouldShowSuggesterPage()&&originControl.isOnPagePopup!==true){if(suggester2.isPagePopup()==false){$(select).siblings(".select2-container").attr("isPagePopup","false")}}select2.on("select2:select",function(event){var $element=$(this),$selectedOption=$element.find("option:selected");$selectedOption.text(event.params.data.name);var data=$selectedOption.data("data");data.text=data.name;$element.find("option").not(":selected").each(function(){if($(this).val()!==""){$(this).remove()}});if(originControl.isOnPagePopup===true){var $pageDiv=$element.closest(".mobile_page_div");if($pageDiv.length>0){var page=$pageDiv.data(InfoPlus.Render.Mobile.Page.DATA_PAGE_OBJECT);if(page!=null){page.close()}}}});if(this.dataType.toLocaleLowerCase()==="user"){select2.on("select2:selecting",function(event){if(($IU.trimString((event.params.args.data.id))||"")===""){return false}})}select2.on("select2:open",function(){var $dialog=$(this).closest("div.dialog");if($dialog.length>0){var overlayZIndex=$dialog.parent().css("z-index");if((overlayZIndex||"")!==""){select2.data("select2").$dropdown.css("z-index",overlayZIndex)}}if(originControl.isOnPagePopup===true){var $pageDiv=$(this).closest(".mobile_page_div");if($pageDiv.length>0){select2.data("select2").$dropdown.css("z-index",$pageDiv.css("z-index"))}}})},setPlaceHolder:function(){if(this.field!=null&&this.field.placeHolder!=null){this.option.placeholder=this.field.placeHolder}else{this.option.placeholder=""}},showTooltip:function(){if(this.tooltip==null||this.tooltip.tip===""){return}var tooltip=this.tooltip;var $element=$(this.element);setTimeout(function(){var $searchContainer=null;$(".select2-container").each(function(){if(!$(this).hasClass("select2")){$searchContainer=$(this)}});if($searchContainer!=null){if($searchContainer.offset().top<$element.offset().top){$element.validationEngine("showPrompt",$IU.htmlEncode(tooltip.tip),tooltip.type,"bottomLeft",true)}else{$element.validationEngine("showPrompt",$IU.htmlEncode(tooltip.tip),tooltip.type,"topLeft",true)}$(".select2-search__field").one("blur",function(){$element.validationEngine("hidePrompt")})}},300)},setParentValue:function(parentValue,fromInit){if((parentValue instanceof $Controls.Data.ValuePair)||(parentValue instanceof $Controls.Data.Uri)){this.parentValue=parentValue.value}else{this.parentValue=parentValue}var select=$(this.element).data($Control.DATA_ORIGIN_INPUT);if(fromInit!==true&&$$.params.fieldChanging==null){this.setValue("","");var select2=$(select).data("select2Object");if(select2!=null){$IU.highLightElement(select)}}},visible:function(isVisible){if(this.element==null){return}var select=$(this.element).data($Control.DATA_ORIGIN_INPUT),$select=$(select),select2=$select.data("select2Object");if(isVisible){$select.show()}else{$select.hide()}if(select2!=null){var $select2Label=$select.siblings(".select2");if(isVisible){$select2Label.show()}else{$select2Label.hide()}}if(isVisible){$(this.controlContainer).show()}else{$(this.controlContainer).hide()}},setDynamicReadOnly:function(isReadOnly){var $container=$(this.element),select=$container.data($Control.DATA_ORIGIN_INPUT);if(isReadOnly){select.disabled=true;$container.addClass($Control.CLASSNAME_READONLY)}else{select.disabled=false;$container.removeClass($Control.CLASSNAME_READONLY)}}});define("InfoPlus.Controls.Suggester2",suggester2)})(window);
(function(window,undefined){var text=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_TEXT,path,field,render,initValue,null)};text.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_XHTML],name:"textarea",createElement:function(){var element=document.createElement("textarea");if(this.field.placeHolder!=null){$(element).attr("placeholder",this.field.placeHolder)}return element},setValue:function(fieldValue){if(fieldValue==null){fieldValue=""}var $element=$(this.element);if(this.maxLength!=null){fieldValue=fieldValue.substr(0,this.maxLength)}$element.val(fieldValue);if(this.render.settings.autoSize===true){$element.autoheight("init")}},registerEvent:function(){if(this.maxLength!=null&&this.isWritable()){this.events=InfoPlus.Controls.Text.Events.events}},specialSetting:function(){var $element=$(this.element);this.setMaxLength();if(this.maxLength!=null&&this.isWritable()){var div=document.createElement("div"),$div=$(div);$div.addClass("infoplus_textareaControlContainer");$div.append(this.element);var span=document.createElement("span");$(span).addClass("infoplus_textareaControlMaxLengthTip");$div.append(span);if(this.element.style.width!=null){$div.css("width",this.element.style.width)}this.maxLengthTipSpan=span;this.controlContainer=div;$(span).hide()}if(this.isWritable()&&this.field.type===$Control.DATA_TYPE_XHTML){$IU.debugTip($$.lt("text.xhtmlWarning",this.field.name),"warning")}if(this.render.settings.autoSize===true){$element.autoheight();$element.css("min-height",$element.height())}},getValue:function(){var val=this.convertEmptyValue(this.element.value);val=val.replace(/\r\n/g,"\n");if(this.maxLength!=null){val=val.substr(0,this.maxLength)}return val}});define("InfoPlus.Controls.Text",text);var currentLength=function(control){var value=$(control.element).val();var len=value.replace(/\r\n/g,"~").replace(/\n/g,"~").length;return{used:len,remaining:control.maxLength-len}};var addClass=function(len,$span,isShowLength){if(len.remaining>0){$span.removeClass("incorrect").addClass("correct")}else{$span.removeClass("correct").addClass("incorrect")}if(isShowLength){$span.addClass("length")}else{$span.removeClass("length")}};var showCurrentLengthTip=function(control,slide){var maxLength=control.maxLength,len=currentLength(control);var $span=$(control.maxLengthTipSpan);$span.text(len.used+"/"+maxLength);addClass(len,$span,true);if(control.hideTipTimer!=null){clearTimeout(control.hideTipTimer)}if(slide===true){$span.show("slide",{direction:"right"},500)}else{$span.show()}control.hideTipTimer=setTimeout(function(){$span.fadeOut(1000)},3000)};var showMaxLengthTip=function(control){var maxLength=control.maxLength,len=currentLength(control);var $span=$(control.maxLengthTipSpan);$span.text($$.lt("text.maxLength",maxLength));addClass(len,$span,false);if(control.hideTipTimer!=null){clearTimeout(control.hideTipTimer)}$span.show();control.hideTipTimer=setTimeout(function(){$span.hide("slide",{direction:"right"},1000,function(){showCurrentLengthTip(control,true)})},5000)};var truncate=function(control){var len=currentLength(control);if(len.remaining>=0){return}var element=control.element,maxLength=control.maxLength,lines=$(element).val().split(/\r\n|\n/),value="",i=0;while(value.length<maxLength&&i<lines.length){value+=lines[i].substring(0,maxLength-value.length)+"\n";i++}$(element).val(value.substring(0,maxLength));element.scrollTop=element.scrollHeight;showCurrentLengthTip(control)};var textEvents={onKeyPress:function(event){var textControl=$(this).data($Control.DATA_CONTROL_OBJECT),maxLength=textControl.maxLength,value=$(textControl.element).val(),len=value.replace(/\r\n/g,"~").replace(/\n/g,"~").length;if(maxLength==null){return true}var ch=String.fromCharCode(event.charCode==null?event.keyCode:event.charCode);return(event.ctrlKey||event.metaKey||ch==="\u0000"||len<maxLength)},onKeyUp:function(event){var textControl=$(this).data($Control.DATA_CONTROL_OBJECT),maxLength=textControl.maxLength;if(maxLength!=null&&textControl.maxLengthTipSpan!=null){showCurrentLengthTip(textControl);truncate(textControl)}},focus:function(){var textControl=$(this).data($Control.DATA_CONTROL_OBJECT),maxLength=textControl.maxLength;if(maxLength!=null&&textControl.maxLengthTipSpan!=null){showMaxLengthTip(textControl)}},onPaste:function(event){},onCut:function(event){}};textEvents.events=[{type:"keypress",handler:textEvents.onKeyPress},{type:"keyup",handler:textEvents.onKeyUp},{type:"focus",handler:textEvents.focus}];define("InfoPlus.Controls.Text.Events",textEvents)})(window);
(function(window,undefined){var richtext=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_RICHTEXT,path,field,render,initValue,null)};richtext.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_XHTML],name:"richText",editor:null,init:function(){var settings=this.render.settings||{},option={language:$$.params.lang};if(settings.autoSize===true){option=$.extend(option,{removePlugins:"resize"})}else{option=$.extend(option,{removePlugins:"autogrow"})}var endPoint=$$.params.uriCkUploadImage+"?stepId="+($$.params.formStepId==null?-1:$$.params.formStepId)+"&field="+this.field.name;if($$.params.formInstanceId!=null){endPoint+="&instanceId="+$$.params.formInstanceId}if($$.params.workflowId!=null){endPoint+="&workflowId="+$$.params.workflowId}if($$.params.release!=null){endPoint+="&release="+$$.params.release}option.imageUploadURL=endPoint;this.editor=CKEDITOR.replace(this.element.id+"_text",option);var instance=this,dynamicReadonly=this.dynamicReadonly,dynamicParallelReadonly=this.dynamicParallelReadonly;setTimeout(function(){if(dynamicReadonly||dynamicParallelReadonly){instance.setDynamicReadOnly(true,false)}},1000)},createElement:function(){var div=document.createElement("div"),textarea=document.createElement("textarea");if(this.field.placeHolder!=null){$(textarea).attr("placeholder",this.field.placeHolder)}$(div).append(textarea);return div},setValue:function(fieldValue){if(fieldValue==null){fieldValue=""}$(this.element).children("textarea").val(fieldValue)},getValue:function(){if(window.CKEDITOR==null){return this.initValue}return CKEDITOR.instances[this.element.id+"_text"].getData()},setElementAttribute:function(){var element=this.element;var render=this.render;element.id=render.controlId+this.path;$(element).children("textarea").attr("id",element.id+"_text");$(element).attr("name",render.field+this.path);$(element).data($Control.DATA_FIELD,render.field).data($Control.DATA_RENDER,render)},setInfopathFormAttributes:function(){var element=this.element;if(element==null){return}var $textarea=$(element).children("textarea");var attributeList=this.render.attributes;if(attributeList==null||!$IU.isArray(attributeList)){return}for(var i=0;i<attributeList.length;i++){var attribute=attributeList[i];var key=attribute.key;if(null!=attribute.namespace&&""!==attribute.namespace){key=attribute.namespace+":"+key}try{switch(key.toLocaleLowerCase()){case"class":case"hidefocus":case"tabindex":case"onclick":case"value":case"contenteditable":break;default:$textarea.attr(key,attribute.value);break}}catch(exception){}}},visible:function(isVisible,fromInit){if(this.element==null){return}if(isVisible){if(this.isReadable()){if(!fromInit&&this.isWritable()&&!this.isDynamicReadonly()){if(this.editor!=null){this.editor.setReadOnly(false)}}$(this.element).show()}}else{$(this.element).hide()}},setDynamicReadOnly:function(isReadOnly,fromInit){if(!fromInit){if(this.editor!=null){this.editor.setReadOnly(isReadOnly)}}},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=true}});define("InfoPlus.Controls.RichText",richtext)})(window);
(function(window,undefined){var file=function(path,field,render,initValue){this.supportXhr=qq.isXhrUploadSupported();$Control.call(this,$Control.CONTROL_TYPE_FILE,path,field,render,initValue)};file.UPLOAD_LIST_OUT="uploadListOut";file.FILE_LIST_CLICK_FILEID="clickFileId";file.UPLOAD_PROGRESS_DIV="uploadProgressDiv";file.DISPLAY_DIV="displayDiv";file.UPLOAD_DIV="uploadDiv";file.UPLOAD_FILE_ID="uploadingFileId";file.CLASS_UPLOAD_FILE_NAME="uploadFileName";file.CLASS_UPLOAD_FILE_SIZE="uploadFileSize";file.CLASS_CANCEL="infoplus_fileControl_cancel";file.CLASS_LINK="infoplus_fileControl_link";file.OFFICE_FILE_SUFFIX=["doc","docx","xls","xlsx","ppt","pptx"];file.OFFICE365_FILE_SUFFIX=["docx","xlsx"];file.APP_NATIVE_OPEN_FILE_SUFFIX=["pdf","png","jpg","jpeg","gif"];file.MAX_PERCENT_WIDTH=100;file.MIN_PERCENT_WIDTH=40;if(!$$.APP){file.OFFICE_FILE_SUFFIX.push("pdf")}var calculateWidth=function($uploadProgressDiv,$uploadFileNameDiv,$uploadFileSizeDiv,$percentDiv){var totalWidth=$uploadProgressDiv.width()-16-16,nameWidth=$uploadFileNameDiv.width(),sizeWidth=$uploadFileSizeDiv.width(),percentWidth=$percentDiv.outerWidth();if(nameWidth+sizeWidth+percentWidth<totalWidth){if(totalWidth-nameWidth-sizeWidth>file.MAX_PERCENT_WIDTH){$percentDiv.css("width",file.MAX_PERCENT_WIDTH+"px")}else{$percentDiv.css("width",(totalWidth-nameWidth-sizeWidth)+"px")}}else{$percentDiv.css("width","");$uploadFileNameDiv.css("width",(totalWidth-sizeWidth-file.MIN_PERCENT_WIDTH)+"px")}};var getFileSuffix=function(fileName){if(fileName==null){return""}var dotIndex=fileName.lastIndexOf(".");if(dotIndex!==-1&&((dotIndex+1)<fileName.length)){return fileName.substring(dotIndex+1).toLowerCase()}return""};var getUriTypeParam=function(fileInfo){if($$.APP){var fileSuffix=getFileSuffix(fileInfo.name);if(fileSuffix!==""){return"&type="+fileSuffix}}return""};var getFileLink=function(fileInfo){var uri=fileInfo.uri||"";if($$.APP){var fileSuffix=getFileSuffix(fileInfo.name);if(fileSuffix!==""){uri+="?type="+fileSuffix}}return uri};var addItemsFromFieldValue=function(fieldValue){var items=[];if($IU.isString(fieldValue)){var values=fieldValue.split("\n");for(var i=0;i<values.length;i++){try{var value=$.parseJSON(values[i])}catch(e){var value=null}if(value){items.push(value)}}}else{if(fieldValue){items.push(fieldValue)}}return items};var deleteFileItemByFileId=function(fileItems,fileId){if(fileItems&&fileItems.length>0){for(var i=0;i<fileItems.length;i++){if(fileItems[i].id==fileId){fileItems.splice(i,1);break}}}return fileItems};var getFileItemByFileId=function(fileItems,fileId){var fileInfo=null;if(fileItems&&fileItems.length>0){for(var i=0;i<fileItems.length;i++){if(fileItems[i].id==fileId){fileInfo=fileItems[i];break}}}return fileInfo};var getFileListString=function(fileItems){var fileListString="";if(fileItems&&fileItems.length>0){for(var i=0;i<fileItems.length;i++){delete fileItems[i]["uploadSuccess"];fileListString=fileListString+$.toJSON(fileItems[i])+"\n"}}if(fileListString){fileListString=fileListString.substr(0,fileListString.length-1)}return fileListString};var IEDownloadFile=function(fileName,url){var type="text/plain; charset=UTF-8";var blob=typeof File==="function"?new File([url],fileName,{type:type}):new Blob([url],{type:type});if(typeof window.navigator.msSaveBlob!=="undefined"){window.navigator.msSaveBlob(blob,fileName)}else{var URL=window.URL||window.webkitURL;var downloadUrl=URL.createObjectURL(blob);window.location=downloadUrl}};var createIFrameForDownload=function(fileName,fileUri,triggerDelay,removeDelay){if(isIE()){IEDownloadFile(fileName,fileUri)}else{setTimeout(function(){var frame=$('<iframe style="display: none;"></iframe>');frame.attr("src",fileUri);$(document.body).after(frame);setTimeout(function(){frame.remove()},removeDelay)},triggerDelay)}};var isIE=function(){if(!!window.ActiveXObject||"ActiveXObject" in window){return true}else{return false}};const isFileSecure=function(settings){if(null==settings){return false}const fso=settings.fileSecure;return fso!=null&&fso!==false&&fso!=="False"};file.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_FILE,$Control.DATA_TYPE_DOC,$Control.DATA_TYPE_LIST],ignoreClass:true,allowFocus:true,fileInfo:null,fileInfoList:[],events:[],supportXhr:false,autoTriggerFieldChangeEvent:false,validatorPromptPosition:"topLeft",name:"file",hasHiddenElement:true,uploadCallbacks:{onCancel:function(id,fileName){},onError:function(id,fileName,errorReason){},onSubmit:function(id,fileName){var $uploadContainer=$($(this._options.button).data("container"));var fileControl=$uploadContainer.data($Control.DATA_CONTROL_OBJECT);if(fileControl.field.type==$Control.DATA_TYPE_LIST){$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,id);var fileId=fileControl.field.name+"_fileList_"+id;var fieldItem=fileControl.createFileListLi(fileId);$uploadContainer=fieldItem;var $uploadProgressDiv=$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV);var $nameDiv=$uploadProgressDiv.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).html($IU.htmlEncode(fileName)).css("width","");$uploadProgressDiv.find(".pi").css("width","0%");$uploadProgressDiv.removeClass("focus");$nameDiv[0].setAttribute("title",$$.lt("file.uploading",fileName));$uploadContainer.data(InfoPlus.Controls.File.DISPLAY_DIV).hide();$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).show();var $sizeDiv=$uploadProgressDiv.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).empty(),$percentDiv=$uploadProgressDiv.find(".po");calculateWidth($uploadProgressDiv,$nameDiv,$sizeDiv,$percentDiv)}else{var $uploadProgressDiv=$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV),$nameDiv=$uploadProgressDiv.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).html($IU.htmlEncode(fileName)).css("width","");$uploadProgressDiv.find(".pi").css("width","0%");$uploadProgressDiv.removeClass("focus");$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,id);$nameDiv[0].setAttribute("title",$$.lt("file.uploading",fileName));$uploadContainer.data(InfoPlus.Controls.File.DISPLAY_DIV).hide();$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_DIV).hide();$uploadContainer.find(".uploadFileTip").hide();$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).show();var $sizeDiv=$uploadProgressDiv.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).empty(),$percentDiv=$uploadProgressDiv.find(".po");calculateWidth($uploadProgressDiv,$nameDiv,$sizeDiv,$percentDiv)}},onUpload:function(id,fileName){},onProgress:function(id,fileName,loaded,total){var $uploadContainer=$($(this._options.button).data("container"));var fileControl=$uploadContainer.data($Control.DATA_CONTROL_OBJECT);if(fileControl.field.type==$Control.DATA_TYPE_LIST){$uploadContainer=$uploadContainer.find("#"+fileControl.field.name+"_fileList_"+id)}var $uploadProgressDiv=$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV);var sizeObj=$IU.convertFileSize(total);var $sizeDiv=$uploadProgressDiv.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).html("("+sizeObj.size+sizeObj.unit+")");if(loaded<total){var percent=Math.round(loaded/total*100);$uploadProgressDiv.find(".pi").css("width",percent+"%")}else{$uploadProgressDiv.find(".pi").css("width","100%")}var $nameDiv=$uploadProgressDiv.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME),$percentDiv=$uploadProgressDiv.find(".po");calculateWidth($uploadProgressDiv,$nameDiv,$sizeDiv,$percentDiv)},onComplete:function(id,fileName,responseJSON){var $uploadContainer=$($(this._options.button).data("container"));var fileControl=$uploadContainer.data($Control.DATA_CONTROL_OBJECT);if(fileControl.field.type==$Control.DATA_TYPE_LIST){$uploadContainer=$uploadContainer.find("#"+fileControl.field.name+"_fileList_"+id);if($uploadContainer.size()>0){$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).removeClass("focus");$uploadContainer.data(InfoPlus.Controls.File.DISPLAY_DIV).removeClass("focus");$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,null);if(responseJSON.success&&responseJSON.infoPlusFile!=null){var fileInfo=responseJSON.infoPlusFile;$uploadContainer.attr("id",fileControl.field.name+"_fileList_"+fileInfo.id);fileControl.setValue({uploadSuccess:true,id:fileInfo.id,name:fileInfo.name,size:fileInfo.size,uri:fileInfo.uri,mime:fileInfo.mime,createTime:fileInfo.createTime})}else{$IU.messageBox(null,$$.lt("file.uploadFail"),null,300);$uploadContainer.remove()}}}else{$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).removeClass("focus");$uploadContainer.data(InfoPlus.Controls.File.DISPLAY_DIV).removeClass("focus");$uploadContainer.data(InfoPlus.Controls.File.UPLOAD_FILE_ID,null);if(responseJSON.success&&responseJSON.infoPlusFile!=null){var fileInfo=responseJSON.infoPlusFile;fileControl.setValue({uploadSuccess:true,id:fileInfo.id,name:fileInfo.name,size:fileInfo.size,uri:fileInfo.uri,mime:fileInfo.mime,createTime:fileInfo.createTime})}else{$IU.messageBox(null,$$.lt("file.uploadFail"),null,300);fileControl.setValue(null)}}},onValidateBatch:function(fileData){var validationOption=this._options.validation;if(validationOption===undefined||validationOption===null){return true}var len=fileData.length;for(var i=0;i<len;i++){var data=fileData[i];if(data.name!==undefined){if(validationOption.allowedExtensions!==undefined&&validationOption.allowedExtensions.length>0){var fileSuffix=getFileSuffix(data.name);var allowedExtensions=validationOption.allowedExtensions;var extensionLength=validationOption.allowedExtensions.length;var matchFileSuffix=false;var allFileSuffix="";for(var extensionIndex=0;extensionIndex<extensionLength;extensionIndex++){allFileSuffix=allFileSuffix+allowedExtensions[extensionIndex]+((extensionIndex!==extensionLength-1)?",":"");if(fileSuffix===allowedExtensions[extensionIndex]){matchFileSuffix=true}}if(!matchFileSuffix){$IU.messageBox(null,$$.lt("file.suffix",allFileSuffix),null,300);return false}}}if(data.size!==undefined){var sizeLimit=validationOption.sizeLimit;if(sizeLimit!==null&&!isNaN(sizeLimit)&&sizeLimit!==0){if(data.size>sizeLimit){var sizeObj=$IU.convertFileSize(sizeLimit);$IU.messageBox(null,$$.lt("file.sizeLimit",(sizeObj.size+sizeObj.unit)),null,360);return false}}}}return true}},hasFile:function(){var fileInfo=this.fileInfo;return(fileInfo!=null&&fileInfo.id!=null)},setPlaceHolder:function(){var isIe89=function(){if($.browser.msie){return parseInt($.browser.version,10)<=9}return false};if(this.field!=null&&this.field.placeHolder!=null&&this.field.placeHolder!==""){var container=this.element;var link=document.createElement("span");$(link).text(this.field.placeHolder);$(container).find(".uploadFileButton").append(link)}},setFileListClickFileId:function(displayDiv){if(this.field.type==$Control.DATA_TYPE_LIST){var id=$(displayDiv).parents(".uploadItemContainer").attr("id");var fileId=id.split("_fileList_")[1];if(fileId){$(this.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID,fileId)}}},createDisplayDiv:function(container){var displayDiv=document.createElement("div");$(displayDiv).addClass("display").hide().data("container",container);var link=document.createElement("a");$(link).attr("target","_blank").attr("href","#").addClass(InfoPlus.Controls.File.CLASS_LINK);var fileNameDiv=document.createElement("div");fileNameDiv.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME);var fileSizeDiv=document.createElement("div");fileSizeDiv.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE);link.appendChild(fileNameDiv);link.appendChild(fileSizeDiv);displayDiv.appendChild(link);if(this.isWritable()){var uploadSuccessSpan=document.createElement("span");uploadSuccessSpan.setAttribute("class","uploadSuccess");$(uploadSuccessSpan).css("display","none");$(uploadSuccessSpan).text($$.lt("file.uploadSuccess"));displayDiv.appendChild(uploadSuccessSpan)}container.appendChild(displayDiv);$(container).data(InfoPlus.Controls.File.DISPLAY_DIV,$(displayDiv));var fileControl=this;var menuItems=[];if(this.field.type===$Control.DATA_TYPE_DOC){if((this.isWritable()||this.isEditable())&&$$.params.uriWordEdit!=null&&$$.params.uriWordEdit!==""){menuItems.push({id:"edit",text:$$.lt("file.menu.edit"),iconClass:"i-icon-pencil-square",iconCss:"left:1px",link:true})}menuItems.push({id:"preview",text:$$.lt("file.menu.preview"),iconClass:"i-icon-search2",initVisible:false,click:function(){fileControl.preview()}})}else{menuItems.push({id:"preview",text:$$.lt("file.menu.preview"),iconClass:"i-icon-search2",initVisible:false,click:function(){fileControl.setFileListClickFileId(displayDiv);fileControl.preview()}})}menuItems.push({id:"download",text:$$.lt("file.menu.download"),iconClass:"i-icon-cloud-download",link:true,click:function(){fileControl.setFileListClickFileId(displayDiv);return fileControl.download()}});if(this.isWritable()){menuItems.push({id:"remove",text:$$.lt("file.menu.remove"),iconClass:"i-icon-trash",iconCss:"left:-1px",click:function(){fileControl.setFileListClickFileId(displayDiv);fileControl.deleteFile()}})}if(this.field.type==$Control.DATA_TYPE_LIST){menuItems.push({id:"batches",text:$$.lt("file.batchMenu.batchButton"),iconClass:"i-icon-my-library-books",iconCss:"left:-1px",initVisible:false,click:function(){fileControl.showBatchesDialog()}})}var popMenu=new InfoPlus.Render.PopMenu({container:displayDiv,items:menuItems,horizontalMenuItem:true,position:"top-left"});if(this.field.type==$Control.DATA_TYPE_LIST){$(displayDiv).data("popMenu",popMenu)}else{this.popMenu=popMenu}},createUploadProgressDiv:function(container){var uploadProgressDiv=document.createElement("div");$(uploadProgressDiv).addClass("uploadProgress").hide().data("container",container);var fileNameDiv,cancelDiv;if(this.supportXhr){var table=document.createElement("table");table.setAttribute("class","uploadProgressTable");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");td.setAttribute("class","uploadTd");var span=document.createElement("span");span.setAttribute("class","uploadSpan");fileNameDiv=document.createElement("div");fileNameDiv.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME);var fileSizeDiv=document.createElement("div");fileSizeDiv.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE);span.appendChild(fileNameDiv);span.appendChild(fileSizeDiv);td.appendChild(span);tr.appendChild(td);td=document.createElement("td");td.setAttribute("class","uploadTd");var uploadContainerDiv=document.createElement("div");var progOutDiv=document.createElement("div");var progInnerDiv=document.createElement("div");progInnerDiv.setAttribute("class","pi");progInnerDiv.setAttribute("style","width:0%");progOutDiv.setAttribute("class","po");progOutDiv.appendChild(progInnerDiv);uploadContainerDiv.appendChild(progOutDiv);td.appendChild(uploadContainerDiv);tr.appendChild(td);td=document.createElement("td");td.setAttribute("class","uploadTd");cancelDiv=document.createElement("div");cancelDiv.setAttribute("class",InfoPlus.Controls.File.CLASS_CANCEL);cancelDiv.setAttribute("title",$$.lt("common.cancel"));td.appendChild(cancelDiv);tr.appendChild(td);tbody.appendChild(tr);table.appendChild(tbody);uploadProgressDiv.appendChild(table)}else{fileNameDiv=document.createElement("div");fileNameDiv.setAttribute("class",InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME);var uploadingDiv=document.createElement("div");uploadingDiv.setAttribute("class","uploading");cancelDiv=document.createElement("div");cancelDiv.setAttribute("class",InfoPlus.Controls.File.CLASS_CANCEL);cancelDiv.setAttribute("title",$$.lt("common.cancel"));uploadProgressDiv.appendChild(fileNameDiv);uploadProgressDiv.appendChild(uploadingDiv);uploadProgressDiv.appendChild(cancelDiv)}container.appendChild(uploadProgressDiv);$(container).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV,$(uploadProgressDiv))},createUploadButtonDiv:function(container){var uploadDiv=document.createElement("div");if(this.field.settings!=null){if(this.field.settings.displayText!==undefined){$(uploadDiv).text(this.field.settings.displayText)}}$(uploadDiv).addClass("uploadFileButton droppable").data("container",container);$(uploadDiv).css("display","inline-block").hide();var endPoint=$$.params.attachmentUrl+"?stepId="+($$.params.formStepId==null?-1:$$.params.formStepId)+"&field="+this.field.name;if($$.params.formInstanceId!=null){endPoint+="&instanceId="+$$.params.formInstanceId}if($$.params.workflowId!=null){endPoint+="&workflowId="+$$.params.workflowId}if($$.params.release!=null){endPoint+="&release="+$$.params.release}var options={request:{endpoint:endPoint},button:uploadDiv,multiple:false,debug:false,callbacks:this.uploadCallbacks};if(this.field.type==$Control.DATA_TYPE_LIST){options.multiple=true;uploadDiv.classList.add("uploadFileListButton")}var settings=this.field.settings;var getFileSizeLimit=function(){if(settings.fileSizeMax!==undefined&&$IU.isNumber(settings.fileSizeMax)){return parseInt(settings.fileSizeMax,10)}if(settings.maxLength!==undefined&&$IU.isNumber(settings.maxLength)){return parseInt(settings.maxLength,10)}};var validation={};var isFileTypesExit=false;if(settings!==undefined&&settings!==null){if(settings.fileTypes!==undefined){validation.allowedExtensions=settings.fileTypes.split(",");isFileTypesExit=true}validation.sizeLimit=getFileSizeLimit()}if(this.field.type===$Control.DATA_TYPE_DOC){if(!isFileTypesExit){validation.allowedExtensions=file.OFFICE365_FILE_SUFFIX}}if(validation.allowedExtensions!==undefined||validation.sizeLimit!==undefined){options.validation=validation}var uploader=new qq.FineUploaderBasic(options);if(qq.DragAndDrop!=null){var dragAndDropModule=new qq.DragAndDrop({dropZoneElements:[uploadDiv],classes:{dropActive:"dropActive"},callbacks:{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(files,dropTarget){uploader.addFiles(files)}}})}container.appendChild(uploadDiv);$(container).data(InfoPlus.Controls.File.UPLOAD_DIV,$(uploadDiv)).data("uploader",uploader)},createElement:function(){var container=document.createElement("div");if(this.field.type==$Control.DATA_TYPE_LIST){if(this.isReadable()){var uploadListOutDiv=document.createElement("div");uploadListOutDiv.classList.add("uploadListOutDiv");var uploadList=document.createElement("ul");uploadList.classList.add("uploadListOut");uploadList.classList.add("clearfix");uploadListOutDiv.appendChild(uploadList);container.appendChild(uploadListOutDiv);$(container).data(InfoPlus.Controls.File.UPLOAD_LIST_OUT,uploadList)}if(this.isWritable()){this.createUploadButtonDiv(container)}}else{if(this.isReadable()){this.createDisplayDiv(container)}if(this.isWritable()){this.createUploadProgressDiv(container);this.createUploadButtonDiv(container)}}return container},ifBatchesButtonShow:function(){var uploadItemContainers=$(this.element).find(".uploadItemContainer");if(uploadItemContainers.size()>1){uploadItemContainers.each(function(index,item){var thisPopMenu=$(item).data(InfoPlus.Controls.File.DISPLAY_DIV).data("popMenu");if(thisPopMenu){thisPopMenu.showMenuItem("batches")}})}else{uploadItemContainers.each(function(index,item){var thisPopMenu=$(item).data(InfoPlus.Controls.File.DISPLAY_DIV).data("popMenu");if(thisPopMenu){thisPopMenu.hideMenuItem("batches")}})}},createFileListLi:function(fileId){var fieldItem=document.createElement("li");fieldItem.classList.add("uploadItemContainer");fieldItem.setAttribute("id",fileId);var uploadListOutDiv=$(this.element).data(InfoPlus.Controls.File.UPLOAD_LIST_OUT);if(uploadListOutDiv){uploadListOutDiv.appendChild(fieldItem);this.createDisplayDiv(fieldItem);this.createUploadProgressDiv(fieldItem)}this.specialSetting(fieldItem);this.setDynamicStyle(this.render,false);return $(fieldItem)},createBatchDialogContent:function(){var dialogDiv=$("<div class='fileBatchesDialog'></div>");var uploadItemContainers=$(this.element).find(".uploadItemContainer");if(uploadItemContainers.size()>0){var ul=$("<ul></ul>");for(var i=0;i<uploadItemContainers.size();i++){var uploadItemContainer=uploadItemContainers.eq(i);var uploadFileName=uploadItemContainer.find(".display").find(".uploadFileName").text();var uploadFileSize=uploadItemContainer.find(".display").find(".uploadFileSize").text();var li=$("<li><input type='checkbox' class='batchChb' id='batchChb"+i+"' /><label for='batchChb"+i+"'><span class='uploadFileName'>"+uploadFileName+"</span><span class='uploadFileSize'>"+uploadFileSize+"</span></label></li>");li.data("fileId",uploadItemContainer.attr("id").split("_fileList_")[1]);ul.append(li)}dialogDiv.append($("<div id='batchCheckAllContainer'><input type='checkbox' id='batchCheckAll' /><label for='batchCheckAll'>"+$$.lt("file.batchMenu.dialog.selectAll")+"</label></div>"));dialogDiv.append(ul);dialogDiv.find("#batchCheckAll").change(function(){var isCheckedAll=$(this).prop("checked");dialogDiv.find(".batchChb").prop("checked",isCheckedAll)})}return dialogDiv},showBatchesDialog:function(){var fileControl=this;var dialogDiv=fileControl.createBatchDialogContent();var title=$$.lt("file.batchMenu.dialog.title");var titleColor="";var maxWidth="600px";var defaultButtonText=$$.lt("file.batchMenu.dialog.download");var field=fileControl.field;const fileSecure=isFileSecure(field.settings);if(fileSecure){defaultButtonText=$$.lt("file.batchMenu.dialog.secureLinkDownload")}var buttons=[{name:$$.lt("common.close")}];if(this.isWritable()){buttons.push({name:$$.lt("file.batchMenu.dialog.deleteText"),callback:function(){fileControl.fileBatchesDelete()}})}buttons.push({defaultButton:true,name:defaultButtonText,callback:function(){fileControl.fileBatchesDownload()}});var dialog=new InfoPlus.Render.Dialog({title:title,titleColor:titleColor,content:dialogDiv,maxWidth:maxWidth!=null?maxWidth:800,buttons:buttons});dialog.show()},fileBatchesDownload:function(){const fileControl=this;const fileSecure=isFileSecure(field.settings);var batchChbChecked=$(".fileBatchesDialog").find(".batchChb:checked");if(batchChbChecked.size()>0){batchChbChecked.each(function(index,item){var li=$(item).parents("li").eq(0);var fileId=li.data("fileId");if(fileId){var fileInfoList=fileControl.fileInfoList;var fileInfo=getFileItemByFileId(fileInfoList,fileId);if(fileSecure){fileControl.download(fileInfo,true)}else{createIFrameForDownload(fileInfo.name,fileInfo.uri,100,1000)}}})}else{$IU.messageBox(null,$$.lt("file.batchMenu.selectMoreMessage"),null,300)}},fileBatchesDelete:function(){var fileControl=this;var fileIdList=[];var fileInfoList=fileControl.fileInfoList;var batchChbChecked=$(".fileBatchesDialog").find(".batchChb:checked");batchChbChecked.each(function(index,item){var li=$(item).parents("li").eq(0);var fileId=li.data("fileId");if(fileId){fileIdList.push(fileId)}});if(fileIdList.length>0){$IU.confirmBox($$.lt("file.confirmDelete"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){for(var i=0;i<fileIdList.length;i++){var fileId=fileIdList[i];deleteFileItemByFileId(fileInfoList,fileId);if(fileId){var uploadItemContainer=$(fileControl.element).find("#"+fileControl.field.name+"_fileList_"+fileId);if(uploadItemContainer.size()>0){uploadItemContainer.remove()}}}fileControl.ifBatchesButtonShow()})}else{$IU.messageBox(null,$$.lt("file.batchMenu.selectMoreMessage"),null,300)}},shouldFireChangeEvent:function(newFileInfo){if(this.synced===true){this.synced=false;return false}if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){if(this.fileInfo==null){return newFileInfo!=null}else{if(newFileInfo==null){return true}else{return newFileInfo.id!==this.fileInfo.id}}}return false},setStyle:function(name,value){var $uploadItemContainers=$(this.element).find(".uploadItemContainer");for(var i=0,len=$uploadItemContainers.length;i<len;i++){var uploadItemContainer=$uploadItemContainers[i];$IU.setDynamicStyle(uploadItemContainer,name,value)}},setValue:function(fieldValue,fieldDisplayValue,fromInit){var fileInfo;var fileInfoList;if(this.field.type==$Control.DATA_TYPE_LIST){fileInfoList=addItemsFromFieldValue(fieldValue);var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fileInfo);this.canPreview=false;var $container=$(this.element),hiddenInput=$container.data($Control.DATA_ORIGIN_INPUT);if(fromInit){this.fileInfoList=[]}if(fileInfoList&&fileInfoList.length>0){for(var i=0;i<fileInfoList.length;i++){fileInfo=fileInfoList[i];var $uploadItemContainer=$(this.element).find("#"+this.field.name+"_fileList_"+fileInfo.id);if($uploadItemContainer.size()==0){var fileId=this.field.name+"_fileList_"+fileInfo.id;$uploadItemContainer=this.createFileListLi(fileId)}this.fileInfoList.push(fileInfo);hiddenInput.value=fileInfo.id;this.setDisplayDivContent($uploadItemContainer,fileInfo)}}else{$container.data($Control.DATA_ORIGIN_INPUT).value="";var clickFileId=$(this.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID);if(clickFileId){deleteFileItemByFileId(this.fileInfoList,clickFileId);var $uploadItemContainer=$(this.element).find("#"+this.field.name+"_fileList_"+clickFileId);if($uploadItemContainer){$uploadItemContainer.remove()}}}if($container.data(InfoPlus.Controls.File.UPLOAD_DIV)!==undefined){$container.data(InfoPlus.Controls.File.UPLOAD_DIV).css("display","inline-block");$container.find(".uploadFileTip").show()}this.ifBatchesButtonShow()}else{if($IU.isString(fieldValue)){try{fileInfo=$.parseJSON(fieldValue)}catch(e){fileInfo=null}}else{fileInfo=fieldValue}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fileInfo);this.fileInfo=fileInfo;this.canPreview=false;var $container=$(this.element),hiddenInput=$container.data($Control.DATA_ORIGIN_INPUT);if(fileInfo!=null&&fileInfo.id!=null){hiddenInput.value=fileInfo.id;this.setDisplayDivContent($container,fileInfo);if($container.data(InfoPlus.Controls.File.UPLOAD_DIV)!==undefined){$container.data(InfoPlus.Controls.File.UPLOAD_DIV).hide();$container.find(".uploadFileTip").hide()}}else{$container.data($Control.DATA_ORIGIN_INPUT).value="";$container.data(InfoPlus.Controls.File.DISPLAY_DIV).hide();if($container.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==undefined){$container.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).hide()}if($container.data(InfoPlus.Controls.File.UPLOAD_DIV)!==undefined){$container.data(InfoPlus.Controls.File.UPLOAD_DIV).css("display","inline-block");$container.find(".uploadFileTip").show()}}}if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},setDisplayDivContent:function(container,fileInfo){var $container=container;var link=$container.find(".display a")[0];if(link!=null){var $link=$(link);link.setAttribute("href",getFileLink(fileInfo));this.fileUri=fileInfo.uri||"";var $menu=$container.find(".infoplus_popMenu"),menuId=$menu.attr("id");$menu.find("#"+menuId+"_download_link").attr("href",link.href);if(this.isWritable()||this.isEditable()){if(this.field.type===$Control.DATA_TYPE_DOC&&$$.params.uriWordEdit!=null&&$$.params.uriWordEdit!==""){const formIdentity=$$.params.formStepId>0?$$.params.formStepId:("e"+$$.params.formEntryId);var url=$$.params.uriWordEdit.replace("%1",formIdentity);url=url.replace("%2",this.field.name);url=url.replace("%mime",fileInfo.mime!==undefined?encodeURIComponent(fileInfo.mime):"");url=url.replace("%uri",encodeURIComponent(fileInfo.uri));url=url.replace("%path",this.path||"");$menu.find("#"+menuId+"_edit_link").attr("href",url);link.setAttribute("href",url);if($$.params.uriWordDown!=null&&$$.params.uriWordDown!==""){var $downLoadMenuItem=$menu.find("#"+menuId+"_download");$downLoadMenuItem.addClass("infoplus_popMenuItem_choose");var $downLoadMenuItemLink=$menu.find("#"+menuId+"_download_link");var downLoadUrlBefore=$downLoadMenuItemLink.attr("href");var downLoadUrlAfter=$$.params.uriWordDown.replace("%1",formIdentity);downLoadUrlAfter=downLoadUrlAfter.replace("%2",this.field.name);downLoadUrlAfter=downLoadUrlAfter.replace("%mime",fileInfo.mime!==undefined?encodeURIComponent(fileInfo.mime):"");downLoadUrlAfter=downLoadUrlAfter.replace("%uri",encodeURIComponent(fileInfo.uri));downLoadUrlAfter=downLoadUrlAfter.replace("%path",this.path||"");$downLoadMenuItem.append("<span class='infoplus_popMenuItemSelect'><i class='i-icon-triangle-down'></i></span>");var $selectGroup=$("<div class='infoplus_popMenuItemSelectGroup'><a href='"+downLoadUrlBefore+"' target='_blank' >"+$$.lt("file.menu.beforeEdit")+"</a><a href='"+downLoadUrlAfter+"' target='_blank' >"+$$.lt("file.menu.afterEdit")+"</a></div>");var $selectButton=$downLoadMenuItem.find(".infoplus_popMenuItemSelect");$selectButton.append($selectGroup);$selectButton.click(function(event){event.stopPropagation();$downLoadMenuItem.toggleClass("show");if($downLoadMenuItem.hasClass("show")){$(this).find("i").removeClass("i-icon-triangle-down").addClass("i-icon-triangle-up")}else{$(this).find("i").removeClass("i-icon-triangle-up").addClass("i-icon-triangle-down")}});$menu.hover(function(){},function(){$downLoadMenuItem.removeClass("show");$selectButton.find("i").removeClass("i-icon-triangle-up").addClass("i-icon-triangle-down")})}}}var title="";if(fileInfo.name!=null){title=fileInfo.name}if(fileInfo.createTime!=null){title+=(" "+$$.lt("file.createAt",$IU.dateFormat(new Date(fileInfo.createTime*1000),"yyyy-MM-dd hh:mm:ss")))}link.setAttribute("title",title);$link.find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).text(fileInfo.name||" ");var sizeObj=$IU.convertFileSize(fileInfo.size);$link.children("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_SIZE).html("("+sizeObj.size+sizeObj.unit+")");if(fileInfo.uploadSuccess===true){var successSpan=$container.find(".display span.uploadSuccess")[0];$(successSpan).css("display","")}var $fileNameDiv=$container.data(InfoPlus.Controls.File.DISPLAY_DIV).find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME),$uploadSpan=$container.find(".display span.uploadSuccess"),showUploadSuccess=$uploadSpan.length>0&&$uploadSpan[0].style.display!=="none";var getUnit=function(value){if(value==null||value.length<2){return null}return value.substr(value.length-2).toLocaleLowerCase()};var cssFontSize=$(this.element).css("font-size");if(!$IU.isEmptyStr(cssFontSize)){var unit=getUnit(cssFontSize);var fontSize=parseFloat(cssFontSize);if(unit=="pt"){fontSize=fontSize*4/3}}if(isNaN(fontSize)){fontSize=16}var width=this.element.style.width,reservedWidth=showUploadSuccess?9*fontSize+12+12+2:5*fontSize+12;var getMaxWidth=function($container,reservedWidth){var $displayDiv=$container.children(".display"),containerWidth=parseInt($container.width(),10),maxDisplayWidth=parseInt($displayDiv.css("max-width"),10);if(isNaN(maxDisplayWidth)){return containerWidth>reservedWidth?containerWidth-reservedWidth:0}else{if(containerWidth<maxDisplayWidth){return containerWidth>reservedWidth?containerWidth-reservedWidth:0}else{return maxDisplayWidth>reservedWidth?maxDisplayWidth-reservedWidth:0}}};if(width!=null&&width!==""){if(width.substring(width.length-1)!=="%"){if(this.field.type==$Control.DATA_TYPE_LIST){$fileNameDiv.css("max-width","0px");var setAutoWidth=function(){if($container.width()===0){setTimeout(function(){setAutoWidth()},100)}else{$fileNameDiv.css("max-width",getMaxWidth($container,reservedWidth)+"px")}};setTimeout(function(){setAutoWidth()},300)}else{$fileNameDiv.css("max-width",getMaxWidth($container,reservedWidth)+"px")}}else{if($container.width()!==0&&$container.width()!==parseInt(width,10)){$fileNameDiv.css("max-width",getMaxWidth($container,reservedWidth)+"px")}else{$fileNameDiv.css("max-width","0px");var setPercentWidth=function(){if($container.width()===parseInt(width,10)){setTimeout(function(){setPercentWidth()},300)}else{var maxWidth=getMaxWidth($container,reservedWidth),currentMaxWidth=parseFloat($fileNameDiv.css("max-width"),10);$fileNameDiv.css("max-width",maxWidth+"px");if(Math.floor(maxWidth)!==Math.floor(currentMaxWidth)||maxWidth===0){setTimeout(function(){setPercentWidth()},300)}}};setTimeout(function(){setPercentWidth()},300)}}}else{$fileNameDiv.css("max-width","0px");var setAutoWidth=function(){if($container.width()===0){setTimeout(function(){setAutoWidth()},100)}else{$fileNameDiv.css("max-width",getMaxWidth($container,reservedWidth)+"px")}};setTimeout(function(){setAutoWidth()},300)}var thisPopMenu=this.popMenu;if(this.field.type==$Control.DATA_TYPE_LIST){thisPopMenu=$container.data(InfoPlus.Controls.File.DISPLAY_DIV).data("popMenu")}var fileSuffix=getFileSuffix(fileInfo.name);if((($$.params.uriFilePreview||"")!=="")&&$.inArray(fileSuffix,file.OFFICE_FILE_SUFFIX)!==-1){thisPopMenu.showMenuItem("preview");this.canPreview=true}else{thisPopMenu.hideMenuItem("preview")}if($$.APP){if($.inArray(fileSuffix,file.APP_NATIVE_OPEN_FILE_SUFFIX)!==-1){thisPopMenu.setMenuItemText("download",$$.lt("file.menu.open"))}else{thisPopMenu.setMenuItemText("download",$$.lt("file.menu.download"))}}}else{$(link).children("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).html("&nbsp;")}$container.data(InfoPlus.Controls.File.DISPLAY_DIV).show();if($container.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==undefined){$container.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).hide()}},getValue:function(){if(this.field.type==$Control.DATA_TYPE_LIST){var fileListString=getFileListString(this.fileInfoList);if(this.field==null||this.element==null||fileListString==""){return""}return fileListString}else{if(this.field==null||this.element==null||this.fileInfo==null){return""}var fileInfo=this.fileInfo;delete fileInfo.uploadSuccess;return $.toJSON(fileInfo)}},getSortValue:function(){if(this.field==null||this.element==null||this.fileInfo==null){return""}return this.fileInfo.name},specialSetting:function(container){var element=this.element;var $container=$(element);if(container){$container=$(container)}var width=element.style.width;if(width!=null){if(width.substring(width.length-1)!=="%"){var containerWidth=parseInt(width,10);var uploadingFileNameWidth=this.supportXhr?containerWidth-230:containerWidth-70;if($container.data(InfoPlus.Controls.File.DISPLAY_DIV)!==undefined){var $uploadSuccessSpan=$container.data(InfoPlus.Controls.File.DISPLAY_DIV).find("span.uploadSuccess");var showUploadSuccess=$uploadSuccessSpan.length>0&&$uploadSuccessSpan[0].style.display!=="none";var reservedWidth=showUploadSuccess?($$.MOBILE?210:165):($$.MOBILE?130:105);$container.data(InfoPlus.Controls.File.DISPLAY_DIV).css("max-width",containerWidth+"px").find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).css("max-width",(containerWidth-reservedWidth)+"px")}var $uploadProgressDiv=$container.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV);if($uploadProgressDiv!==undefined){$container.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).css("max-width",containerWidth+"px").find("."+InfoPlus.Controls.File.CLASS_UPLOAD_FILE_NAME).css("max-width",uploadingFileNameWidth+"px");if(!this.supportXhr){$container.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).find(".uploadSpan").css("max-width"+(containerWidth-30)+"px");var $uploadTable=$container.data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).find(".uploadProgressTable");if($uploadTable.length!==0){$uploadTable[0].setAttribute("width",(containerWidth-14));$uploadTable.find("td.uploadTd")[0].width=(containerWidth-30);$uploadTable.find("td.uploadTd")[1].width=16}}}}else{}}var height=element.style.height;if(height!=null){$(element).css("height","").css("min-height",height)}},registerEvent:function(){this.events=InfoPlus.Controls.File.Events.events},setDynamicReadOnly:function(isReadOnly){var container=this.element;if(isReadOnly){$(container).addClass($Control.CLASSNAME_READONLY);this.popMenu.hideMenuItem("remove");this.popMenu.hideMenuItem("edit")}else{$(container).removeClass($Control.CLASSNAME_READONLY);this.popMenu.showMenuItem("remove");this.popMenu.showMenuItem("edit")}if(this.field.type===$Control.DATA_TYPE_DOC&&$$.params.uriWordEdit!=null&&$$.params.uriWordEdit!==""){var fileUri=this.fileUri;if(fileUri){var $display=$(this.element).find(".display");if($display&&$display.size()>0){var $link=$display.find("."+InfoPlus.Controls.File.CLASS_LINK);if($link&&$link.size()>0){if(isReadOnly){this.popMenu.showMenuItem("preview");$link.data("uriWordEdit",$link.attr("href"));$link.attr("href",fileUri)}else{this.popMenu.hideMenuItem("preview");var uriWordEdit=$link.data("uriWordEdit");$link.attr("href",uriWordEdit)}}}}}},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=true;this.setDynamicReadOnly(true)},preview:function(){if($$.params.uriFilePreview!=null&&$$.params.uriFilePreview!==""){if(this.field.type==$Control.DATA_TYPE_LIST){var clickFileId=$(this.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID);var fileInfo=getFileItemByFileId(this.fileInfoList,clickFileId);this.fileUri=fileInfo.uri;this.fileInfo=fileInfo}var field=this.field,fileUri=this.fileUri,fileInfo=this.fileInfo;if(isFileSecure(field.settings)){$$.ajax({type:"POST",url:$$.params.attachmentTokenUrl,addFormParam:true,data:{field:field.name,fileUri:fileUri}}).done(function(data){if(data!=null){if(data.errno===0){var token=data.entities[0];if($IU.isObject(token)){token=token.token}fileUri+=((fileUri.indexOf("?")!==-1)?"&":"?")+"access_token="+token;var url=$$.params.uriFilePreview.replace("%s",encodeURIComponent(fileUri));if(!$$.MOBILE){$IU.iframeBox(url,fileInfo.name,false,true)}else{var page=new InfoPlus.Render.Mobile.Page({title:fileInfo.name,uri:url});page.show()}}else{$$.debug(data.error)}}})}else{var url=$$.params.uriFilePreview.replace("%s",encodeURIComponent(fileUri));if(!$$.MOBILE){$IU.iframeBox(url,fileInfo.name,false,true)}else{var page=new InfoPlus.Render.Mobile.Page({title:fileInfo.name,uri:url});page.show()}}}return false},download:function(fileInfo,isBatchDownload){var field=this.field;if(field.type==$Control.DATA_TYPE_LIST){if(!isBatchDownload){var clickFileId=$(this.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID);var fileInfo=getFileItemByFileId(this.fileInfoList,clickFileId)}this.fileInfo=fileInfo;this.fileUri=fileInfo.uri}if(isFileSecure(field.settings)){if(this.popupDownloadTip!=null){this.popupDownloadTip.close(true)}var popTip=createPopupTip(this);this.popupDownloadTip=popTip;var fileName=this.fileInfo.name;var fileUri=this.fileUri,fileControl=this;$$.ajax({type:"POST",url:$$.params.attachmentTokenUrl,addFormParam:true,data:{field:field.name,fileUri:fileUri}}).done(function(data){if(data!=null){if(data.errno===0){var token=data.entities[0];if($IU.isObject(token)){var expireIn=token.expireIn;token=token.token}fileUri+=((fileUri.indexOf("?")!==-1)?"&":"?")+"access_token="+token;fileUri+=getUriTypeParam(fileControl.fileInfo);setTimeout(function(){if(field.type==$Control.DATA_TYPE_LIST){if(isBatchDownload){createIFrameForDownload(fileInfo.name,fileUri,100,1000)}else{createSecureDownloadTipContent(popTip,fileUri,fileName,expireIn)}}else{createSecureDownloadTipContent(popTip,fileUri,fileName,expireIn)}},1000)}else{$$.debug(data.error)}}});return false}else{if($$.MINIPROGRAM&&window.openWxWebviewDownloadFile){$IU.wxWebviewDownloadFile(this.fileUri,this.fileInfo.name);return false}}},deleteFile:function(){var instance=this;$IU.confirmBox($$.lt("file.confirmDelete"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){instance.setValue(null)})}});define("InfoPlus.Controls.File",file);var createPopupTip=function(fileControl){var isList=false;if(fileControl.field.type==$Control.DATA_TYPE_LIST){isList=true;var clickFileId=$(fileControl.element).data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID);var uploadItemContainer=$(fileControl.element).find("#"+fileControl.field.name+"_fileList_"+clickFileId)}var contentDiv=document.createElement("div"),$contentDiv=$(contentDiv),textSpan=document.createElement("span"),$textSpan=$(textSpan);$textSpan.text($$.lt("file.prepareSecureLink")).addClass("loadingSecureLink");$contentDiv.append(textSpan);return new InfoPlus.Render.PopTip({popper:isList?uploadItemContainer:fileControl.element,content:contentDiv,showCloseButton:true,backgroundColor:"#f8eda5",placement:"top"})};var createSecureDownloadTipContent=function(popTip,fileUri,fileName,expireIn){var contentDiv=document.createElement("div"),$contentDiv=$(contentDiv);var linkSpan=document.createElement("span"),downloadSpan=document.createElement("span"),link=document.createElement("a");$(linkSpan).text($$.lt("file.secureLinkReady"));$(downloadSpan).text($$.lt("file.download"));if($$.MINIPROGRAM&&window.openWxWebviewDownloadFile){$(link).text($$.lt("file.link")).attr("href","javascript:;").addClass("secureFileLink");$(link).click(function(){$IU.wxWebviewDownloadFile(fileUri,fileName)})}else{$(link).text($$.lt("file.link")).attr("href",fileUri).attr("target","_blank").addClass("secureFileLink")}$contentDiv.append(linkSpan).append(link).append(downloadSpan).css("");if(expireIn!==undefined){var now=new Date();var second=expireIn-Math.round(now.getTime()/1000);var invalidSpan=document.createElement("span");$(invalidSpan).text($$.lt("file.invalidText",second));$contentDiv.append(invalidSpan);var updateInvalidTimeFlag=setInterval(function(){now=new Date();second=expireIn-Math.round(now.getTime()/1000);if(second>0){$(invalidSpan).text($$.lt("file.invalidText",second))}else{popTip.close();clearInterval(updateInvalidTimeFlag)}},1000)}popTip.changeContent(contentDiv)};var fileEvents={onCancel:function(){var $container=$(this).parents("."+$Control.CLASSNAME_CONTROL);var uploadingFileId=$container.data(InfoPlus.Controls.File.UPLOAD_FILE_ID);if(uploadingFileId!=null){var uploader=$container.data("uploader");uploader.cancel(uploadingFileId);var fileControl=$container.data($Control.DATA_CONTROL_OBJECT);if(fileControl&&fileControl.field.type==$Control.DATA_TYPE_LIST){var $uploadItemContainer=$(this).parents(".uploadItemContainer");var fileId=$uploadItemContainer.attr("id").split("_fileList_")[1];$(this).parents(".infoplus_fileControl").data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID,fileId)}fileControl.setValue(null)}},onFocusIn:function(){if($(this).data(InfoPlus.Controls.File.DISPLAY_DIV)!==undefined){$(this).data(InfoPlus.Controls.File.DISPLAY_DIV).addClass("focus")}if($(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==undefined){$(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).addClass("focus")}},onFocusOut:function(){if($(this).data(InfoPlus.Controls.File.DISPLAY_DIV)!==undefined){$(this).data(InfoPlus.Controls.File.DISPLAY_DIV).removeClass("focus")}if($(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV)!==undefined){$(this).data(InfoPlus.Controls.File.UPLOAD_PROGRESS_DIV).removeClass("focus")}},onLinkClick:function(){if($$.MOBILE){return false}var fileControl=$(this).parents(".infoplus_fileControl").data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT);if(fileControl&&fileControl.field.type==$Control.DATA_TYPE_LIST){var $uploadItemContainer=$(this).parents(".uploadItemContainer");var fileId=$uploadItemContainer.attr("id").split("_fileList_")[1];$(this).parents(".infoplus_fileControl").data(InfoPlus.Controls.File.FILE_LIST_CLICK_FILEID,fileId)}if(fileControl!=null){if(fileControl.field.type===$Control.DATA_TYPE_DOC){if((fileControl.isWritable()||fileControl.isEditable())&&$$.params.uriWordEdit!=null&&$$.params.uriWordEdit!==""){return true}}if(fileControl.canPreview===true){fileControl.preview();return false}}return fileControl.download()},onMouseDown:function(event){if(event.button===2){var fileControl=$(this).data(InfoPlus.Controls.Control.DATA_CONTROL_OBJECT);var field=fileControl.field;if(field.type==$Control.DATA_TYPE_LIST){return false}if(isFileSecure(field.settings)){if(fileControl.popupDownloadTip!=null){fileControl.popupDownloadTip.close(true)}var popTip=createPopupTip(fileControl);fileControl.popupDownloadTip=popTip;var fileUri=fileControl.fileUri;var fileName=fileControl.name;$$.ajax({type:"POST",url:$$.params.attachmentTokenUrl,addFormParam:true,data:{field:field.name,fileUri:fileUri}}).done(function(data){if(data!=null){if(data.errno===0){var token=data.entities[0];if($IU.isObject(token)){var expireIn=token.expireIn;token=token.token}fileUri+=((fileUri.indexOf("?")!==-1)?"&":"?")+"access_token="+token;fileUri+=getUriTypeParam(fileControl.fileInfo);setTimeout(function(){createSecureDownloadTipContent(popTip,fileUri,fileName,expireIn)},1000)}else{$$.debug(data.error)}}});return false}}}};fileEvents.events=[{selector:"."+InfoPlus.Controls.File.CLASS_CANCEL,type:"click",handler:fileEvents.onCancel},{selector:"."+InfoPlus.Controls.File.CLASS_LINK,type:"click",handler:fileEvents.onLinkClick},{type:"focusin",handler:fileEvents.onFocusIn},{type:"focusout",handler:fileEvents.onFocusOut},{type:"mousedown",handler:fileEvents.onMouseDown}];define("InfoPlus.Controls.File.Events",fileEvents)})(window);
(function(window,undefined){var doc=function(path,field,render,initValue){this.supportXhr=qq.isXhrUploadSupported();$Control.call(this,$Control.CONTROL_TYPE_DOC,path,field,render,initValue)};doc.UPLOAD_PROGRESS_DIV="uploadProgressDiv";doc.DISPLAY_DIV="displayDiv";doc.UPLOAD_DIV="uploadDiv";doc.UPLOAD_FILE_ID="uploadingFileId";doc.CLASS_UPLOAD_FILE_NAME="uploadFileName";doc.CLASS_UPLOAD_FILE_SIZE="uploadFileSize";doc.CLASS_CANCEL="infoplus_fileControl_cancel";doc.OFFICE_FILE_SUFFIX=["doc","docx","xls","xlsx","ppt","pptx"];doc.OFFICE365_FILE_SUFFIX=["docx","xlsx"];doc.MAX_PERCENT_WIDTH=100;doc.MIN_PERCENT_WIDTH=40;var calculateWidth=function($uploadProgressDiv,$uploadFileNameDiv,$uploadFileSizeDiv,$percentDiv){var totalWidth=$uploadProgressDiv.width()-16-16,nameWidth=$uploadFileNameDiv.width(),sizeWidth=$uploadFileSizeDiv.width(),percentWidth=$percentDiv.outerWidth();if(nameWidth+sizeWidth+percentWidth<totalWidth){if(totalWidth-nameWidth-sizeWidth>doc.MAX_PERCENT_WIDTH){$percentDiv.css("width",doc.MAX_PERCENT_WIDTH+"px")}else{$percentDiv.css("width",(totalWidth-nameWidth-sizeWidth)+"px")}}else{$percentDiv.css("width","");$uploadFileNameDiv.css("width",(totalWidth-sizeWidth-doc.MIN_PERCENT_WIDTH)+"px")}};doc.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_DOC],ignoreClass:true,allowFocus:true,fileInfo:null,events:[],supportXhr:false,autoTriggerFieldChangeEvent:false,validatorPromptPosition:"topLeft",name:"doc",hasHiddenElement:true,uploadCallbacks:{onCancel:function(id,fileName){},onError:function(id,fileName,errorReason){},onSubmit:function(id,fileName){var $uploadContainer=$($(this._options.button).data("container")),$uploadProgressDiv=$uploadContainer.data(doc.UPLOAD_PROGRESS_DIV),$nameDiv=$uploadProgressDiv.find("."+doc.CLASS_UPLOAD_FILE_NAME).html($IU.htmlEncode(fileName)).css("width","");$uploadProgressDiv.find(".pi").css("width","0%");$uploadProgressDiv.removeClass("focus");$uploadContainer.data(doc.UPLOAD_FILE_ID,id);$nameDiv[0].setAttribute("title",$$.lt("file.uploading",fileName));$uploadContainer.data(doc.UPLOAD_DIV).hide();$uploadContainer.data(doc.UPLOAD_PROGRESS_DIV).show();var $sizeDiv=$uploadProgressDiv.find("."+doc.CLASS_UPLOAD_FILE_SIZE).empty(),$percentDiv=$uploadProgressDiv.find(".po");calculateWidth($uploadProgressDiv,$nameDiv,$sizeDiv,$percentDiv)},onUpload:function(id,fileName){},onProgress:function(id,fileName,loaded,total){var $uploadContainer=$($(this._options.button).data("container")),$uploadProgressDiv=$uploadContainer.data(doc.UPLOAD_PROGRESS_DIV);var sizeObj=$IU.convertFileSize(total);var $sizeDiv=$uploadProgressDiv.find("."+doc.CLASS_UPLOAD_FILE_SIZE).html("("+sizeObj.size+sizeObj.unit+")");if(loaded<total){var percent=Math.round(loaded/total*100);$uploadProgressDiv.find(".pi").css("width",percent+"%")}else{$uploadProgressDiv.find(".pi").css("width","100%")}var $nameDiv=$uploadProgressDiv.find("."+doc.CLASS_UPLOAD_FILE_NAME),$percentDiv=$uploadProgressDiv.find(".po");calculateWidth($uploadProgressDiv,$nameDiv,$sizeDiv,$percentDiv)},onComplete:function(id,fileName,responseJSON){var $uploadContainer=$($(this._options.button).data("container"));$uploadContainer.data(doc.UPLOAD_PROGRESS_DIV).removeClass("focus");$uploadContainer.data(doc.DISPLAY_DIV).removeClass("focus");$uploadContainer.data(doc.UPLOAD_FILE_ID,null);var fileControl=$uploadContainer.data($Control.DATA_CONTROL_OBJECT);if(responseJSON.success&&responseJSON.infoPlusFile!=null){var fileInfo=responseJSON.infoPlusFile;fileControl.setValue({uploadSuccess:true,id:fileInfo.id,name:fileInfo.name,size:fileInfo.size,uri:fileInfo.uri,mime:fileInfo.mime,createTime:fileInfo.createTime})}else{$IU.messageBox(null,$$.lt("file.uploadFail"),null,300);fileControl.setValue(null)}},onValidateBatch:function(fileData){var validationOption=this._options.validation;if(validationOption===undefined||validationOption===null){return true}var getFileSuffix=function(fileName){var dotIndex=fileName.lastIndexOf(".");if(dotIndex!==-1&&((dotIndex+1)<fileName.length)){return fileName.substring(dotIndex+1).toLowerCase()}return""};var len=fileData.length;for(var i=0;i<len;i++){var data=fileData[i];if(data.name!==undefined){if(validationOption.allowedExtensions!==undefined&&validationOption.allowedExtensions.length>0){var fileSuffix=getFileSuffix(data.name);var allowedExtensions=validationOption.allowedExtensions;var extensionLength=validationOption.allowedExtensions.length;var matchFileSuffix=false;var allFileSuffix="";for(var extensionIndex=0;extensionIndex<extensionLength;extensionIndex++){allFileSuffix=allFileSuffix+allowedExtensions[extensionIndex]+((extensionIndex!==extensionLength-1)?",":"");if(fileSuffix===allowedExtensions[extensionIndex]){matchFileSuffix=true}}if(!matchFileSuffix){$IU.messageBox(null,$$.lt("file.suffix",allFileSuffix),null,300);return false}}}if(data.size!==undefined){var sizeLimit=validationOption.sizeLimit;if(sizeLimit!==null&&!isNaN(sizeLimit)&&sizeLimit!==0){if(data.size>sizeLimit){var sizeObj=$IU.convertFileSize(sizeLimit);$IU.messageBox(null,$$.lt("file.sizeLimit",(sizeObj.size+sizeObj.unit)),null,360);return false}}}}return true}},hasFile:function(){var fileInfo=this.fileInfo;return(fileInfo!=null&&fileInfo.id!=null)},setPlaceHolder:function(){if(this.field!=null&&this.field.placeHolder!=null&&this.field.placeHolder!==""){var container=this.element;var link=document.createElement("span");$(link).text(this.field.placeHolder);$(container).find(".uploadFileButton").append(link)}},createIframe:function(displayDiv){var iframe=document.createElement("iframe");iframe.setAttribute("scrolling","auto");displayDiv.appendChild(iframe);return iframe},createDisplayDiv:function(container){var displayDiv=document.createElement("div"),$displayDiv=$(displayDiv);$displayDiv.addClass("display").hide().data("container",container);this.createIframe(displayDiv);container.appendChild(displayDiv);$(container).data(doc.DISPLAY_DIV,$displayDiv);if(this.isWritable()){var docControl=this;var menuItems=[{id:"remove",text:$$.lt("file.menu.remove"),iconClass:"i-icon-trash",iconCss:"left:-1px",click:function(){docControl.deleteFile()}}];this.popMenu=new InfoPlus.Render.PopMenu({container:displayDiv,items:menuItems,horizontalMenuItem:true,position:"top-left"})}},createUploadProgressDiv:function(container){var uploadProgressDiv=document.createElement("div");$(uploadProgressDiv).addClass("uploadProgress").hide().data("container",container);var fileNameDiv,cancelDiv;if(this.supportXhr){var table=document.createElement("table");table.setAttribute("class","uploadProgressTable");var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td=document.createElement("td");td.setAttribute("class","uploadTd");var span=document.createElement("span");span.setAttribute("class","uploadSpan");fileNameDiv=document.createElement("div");fileNameDiv.setAttribute("class",doc.CLASS_UPLOAD_FILE_NAME);var fileSizeDiv=document.createElement("div");fileSizeDiv.setAttribute("class",doc.CLASS_UPLOAD_FILE_SIZE);span.appendChild(fileNameDiv);span.appendChild(fileSizeDiv);td.appendChild(span);tr.appendChild(td);td=document.createElement("td");td.setAttribute("class","uploadTd");var uploadContainerDiv=document.createElement("div");var progOutDiv=document.createElement("div");var progInnerDiv=document.createElement("div");progInnerDiv.setAttribute("class","pi");progInnerDiv.setAttribute("style","width:0%");progOutDiv.setAttribute("class","po");progOutDiv.appendChild(progInnerDiv);uploadContainerDiv.appendChild(progOutDiv);td.appendChild(uploadContainerDiv);tr.appendChild(td);td=document.createElement("td");td.setAttribute("class","uploadTd");cancelDiv=document.createElement("div");cancelDiv.setAttribute("class",doc.CLASS_CANCEL);cancelDiv.setAttribute("title",$$.lt("common.cancel"));td.appendChild(cancelDiv);tr.appendChild(td);tbody.appendChild(tr);table.appendChild(tbody);uploadProgressDiv.appendChild(table)}else{fileNameDiv=document.createElement("div");fileNameDiv.setAttribute("class",doc.CLASS_UPLOAD_FILE_NAME);var uploadingDiv=document.createElement("div");uploadingDiv.setAttribute("class","uploading");cancelDiv=document.createElement("div");cancelDiv.setAttribute("class",doc.CLASS_CANCEL);cancelDiv.setAttribute("title",$$.lt("common.cancel"));uploadProgressDiv.appendChild(fileNameDiv);uploadProgressDiv.appendChild(uploadingDiv);uploadProgressDiv.appendChild(cancelDiv)}container.appendChild(uploadProgressDiv);$(container).data(doc.UPLOAD_PROGRESS_DIV,$(uploadProgressDiv))},createUploadButtonDiv:function(container){var uploadDiv=document.createElement("div");if(this.field.settings!=null){if(this.field.settings.displayText!==undefined){$(uploadDiv).text(this.field.settings.displayText)}}$(uploadDiv).addClass("uploadFileButton droppable").data("container",container);$(uploadDiv).css("display","inline-block").hide();var endPoint=$$.params.attachmentUrl+"?stepId="+($$.params.formStepId==null?-1:$$.params.formStepId)+"&field="+this.field.name;if($$.params.formInstanceId!=null){endPoint+="&instanceId="+$$.params.formInstanceId}if($$.params.workflowId!=null){endPoint+="&workflowId="+$$.params.workflowId}if($$.params.release!=null){endPoint+="&release="+$$.params.release}var options={request:{endpoint:endPoint},button:uploadDiv,multiple:false,debug:false,callbacks:this.uploadCallbacks,validation:{allowedExtensions:doc.OFFICE365_FILE_SUFFIX}};var settings=this.field.settings;var getFileSizeLimit=function(){if(settings.fileSizeMax!==undefined&&$IU.isNumber(settings.fileSizeMax)){return parseInt(settings.fileSizeMax,10)}if(settings.maxLength!==undefined&&$IU.isNumber(settings.maxLength)){return parseInt(settings.maxLength,10)}};if(settings!==undefined&&settings!==null){if(settings.fileTypes!==undefined){options.validation.allowedExtensions=settings.fileTypes.split(",")}options.validation.sizeLimit=getFileSizeLimit()}var uploader=new qq.FineUploaderBasic(options);if(qq.DragAndDrop!=null){var dragAndDropModule=new qq.DragAndDrop({dropZoneElements:[uploadDiv],classes:{dropActive:"dropActive"},callbacks:{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(files,dropTarget){uploader.addFiles(files)}}})}container.appendChild(uploadDiv);$(container).data(doc.UPLOAD_DIV,$(uploadDiv)).data("uploader",uploader)},createElement:function(){var container=document.createElement("div");if(this.isReadable()){this.createDisplayDiv(container)}if(this.isWritable()){this.createUploadProgressDiv(container);this.createUploadButtonDiv(container)}return container},shouldFireChangeEvent:function(newFileInfo){if(this.synced===true){this.synced=false;return false}if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){if(this.fileInfo==null){return newFileInfo!=null}else{if(newFileInfo==null){return true}else{return newFileInfo.id!==this.fileInfo.id}}}return false},setValue:function(fieldValue,fieldDisplayValue,fromInit){var fileInfo;if($IU.isString(fieldValue)){try{fileInfo=$.parseJSON(fieldValue)}catch(e){fileInfo=null}}else{fileInfo=fieldValue}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fileInfo);this.fileInfo=fileInfo;this.canPreview=false;var $container=$(this.element),hiddenInput=$container.data($Control.DATA_ORIGIN_INPUT),$iframe=$(this.element).find("iframe");if(fileInfo!=null&&fileInfo.id!=null){hiddenInput.value=fileInfo.id;if($iframe.length!==0){if((this.isWritable()||this.isEditable())&&!$$.MOBILE){if($$.params.uriWordEdit!=null&&$$.params.uriWordEdit!==""){const formIdentity=$$.params.formStepId>0?$$.params.formStepId:("e"+$$.params.formEntryId);var url=$$.params.uriWordEdit.replace("%1",formIdentity);url=url.replace("%2",this.field.name);url=url.replace("%mime",fileInfo.mime!==undefined?encodeURIComponent(fileInfo.mime):"");url=url.replace("%uri",encodeURIComponent(fileInfo.uri));url=url.replace("%path",this.path||"");$iframe.attr("src",url)}}else{if($$.params.uriFilePreview!=null&&$$.params.uriFilePreview!==""){url=$$.params.uriFilePreview.replace("%s",encodeURIComponent(fileInfo.uri));$iframe.attr("src",url)}}}$container.data(doc.DISPLAY_DIV).show();if($container.data(doc.UPLOAD_PROGRESS_DIV)!==undefined){$container.data(doc.UPLOAD_PROGRESS_DIV).hide()}if($container.data(doc.UPLOAD_DIV)!==undefined){$container.data(doc.UPLOAD_DIV).hide()}}else{$container.data($Control.DATA_ORIGIN_INPUT).value="";$container.data(doc.DISPLAY_DIV).hide();if($container.data(doc.UPLOAD_PROGRESS_DIV)!==undefined){$container.data(doc.UPLOAD_PROGRESS_DIV).hide()}if($container.data(doc.UPLOAD_DIV)!==undefined){$container.data(doc.UPLOAD_DIV).css("display","inline-block")}$iframe.attr("src","")}if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(){if(this.field==null||this.element==null||this.fileInfo==null){return""}var fileInfo=this.fileInfo;delete fileInfo.uploadSuccess;return $.toJSON(fileInfo)},getSortValue:function(){if(this.field==null||this.element==null||this.fileInfo==null){return""}return this.fileInfo.name},specialSetting:function(){var element=this.element,$container=$(element),$iframe=$container.find("iframe");var width=element.style.width;if(width!=null){$iframe.css("width",width)}var height=element.style.height;if(height!=null){$iframe.css("height",height)}$container.data("size",{width:width,height:height}).css("width","").css("height","")},closeIframe:function(){if(this.hasFile()){$(this.element).find("iframe").attr("src","");$(this.element).data("iframeClosed",true)}},reopenIframe:function(){var $container=$(this.element);if(!$container.data("iframeClosed")){return}this.setValue(this.fileInfo)},registerEvent:function(){this.events=doc.Events.events},setDynamicReadOnly:function(isReadOnly){var container=this.element;if(isReadOnly){$(container).addClass($Control.CLASSNAME_READONLY);if(this.popMenu!==undefined){this.popMenu.hideMenuItem("remove")}}else{$(container).removeClass($Control.CLASSNAME_READONLY);if(this.popMenu!==undefined){this.popMenu.showMenuItem("remove")}}},setDynamicParallelReadOnly:function(){this.dynamicParallelReadonly=true;this.setDynamicReadOnly(true)},deleteFile:function(){var instance=this;$IU.confirmBox($$.lt("file.confirmDelete"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){instance.setValue(null)})}});define("InfoPlus.Controls.Doc",doc);var docEvents={onCancel:function(){var $container=$(this).parents("."+$Control.CLASSNAME_CONTROL);var uploadingFileId=$container.data(doc.UPLOAD_FILE_ID);if(uploadingFileId!=null){var uploader=$container.data("uploader");uploader.cancel(uploadingFileId);var fileControl=$container.data($Control.DATA_CONTROL_OBJECT);fileControl.setValue(null)}},onFocusIn:function(){if($(this).data(doc.UPLOAD_PROGRESS_DIV)!==undefined){$(this).data(doc.UPLOAD_PROGRESS_DIV).addClass("focus")}},onFocusOut:function(){if($(this).data(doc.UPLOAD_PROGRESS_DIV)!==undefined){$(this).data(doc.UPLOAD_PROGRESS_DIV).removeClass("focus")}}};docEvents.events=[{selector:"."+doc.CLASS_CANCEL,type:"click",handler:docEvents.onCancel},{type:"focusin",handler:docEvents.onFocusIn},{type:"focusout",handler:docEvents.onFocusOut}];define("InfoPlus.Controls.Doc.Events",docEvents)})(window);
(function(window,undefined){var help=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_HELP,path,field,render,initValue)};help.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],ignoreClass:true,ignoreValidation:true,allowFocus:false,autoTriggerFieldChangeEvent:false,name:"help",hasHiddenElement:true,createElement:function(){var element=document.createElement("div");$(element).data("showTitle",false).tipsy({html:true,fade:true,gravity:$.fn.tipsy.autoWE,trigger:"manual",opacity:0.9});return element},setValue:function(fieldValue,fieldDisplayValue,fromInit){if(fieldValue==null){fieldValue=""}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);var htmlValue='<div class="tipsy-inner-infoplus">'+$IU.htmlEncode(fieldValue)+"</div>";this.element.setAttribute("original-title",htmlValue);var hiddenInput=$(this.element).data($Control.DATA_ORIGIN_INPUT);hiddenInput.value=fieldValue;if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(){var hiddenInput=$(this.element).data($Control.DATA_ORIGIN_INPUT);var val=this.convertEmptyValue(hiddenInput.value);return val.replace(/\r\n/g,"\n")},registerEvent:function(){this.events=InfoPlus.Controls.Help.Events.events}});define("InfoPlus.Controls.Help",help);var helpEvents={onClick:function(){$(this).data("showTitle",true).tipsy("show")},onMouseEnter:function(){if(!$$.MOBILE){$(this).data("showTitle",true).tipsy("show")}},onMouseLeave:function(){if(!$$.MOBILE){$(this).data("showTitle",false).tipsy("hide")}},onTouchStart:function(){if($(this).data("showTitle")===true){$(this).data("showTitle",false).tipsy("hide")}else{$(this).data("showTitle",true).tipsy("show")}return false}};helpEvents.events=[{type:"mouseenter",handler:helpEvents.onMouseEnter},{type:"mouseleave",handler:helpEvents.onMouseLeave},{type:"click",handler:helpEvents.onClick},{type:"touchstart",handler:helpEvents.onTouchStart}];define("InfoPlus.Controls.Help.Events",helpEvents)})(window);
(function(window,undefined){var image=function(path,field,render,initValue,initDisplayValue,initAttributes){$Control.call(this,$Control.CONTROL_TYPE_IMAGE,path,field,render,initValue,initDisplayValue,initAttributes)};image.DATA_IMG="img";image.DATA_IMG_LOADED="loaded";image.DATA_IMG_LOADFAIL_COUNT="failCount";image.MAX_IMG_LOADFAIL_COUNT=10;image.CLASS_IMAGE="infoplus_imageControl_image";image.DEFAULT_FORMAT="jpeg";image.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_ANYURI,$Control.DATA_TYPE_FILE,$Control.DATA_TYPE_THING],ignoreClass:true,ignoreValidation:true,allowFocus:false,imageInfo:null,name:"image",hasHiddenElement:true,createElement:function(){var element=document.createElement("div");var link=document.createElement("a");link.setAttribute("data-lightbox",$$.guid());var img=document.createElement("img");img.setAttribute("class",image.CLASS_IMAGE);link.appendChild(img);element.appendChild(link);$(element).data(InfoPlus.Controls.Image.DATA_IMG,img);return element},setValue:function(fieldValue,fieldDisplayValue,fromInit,attributes){var imageInfo;if(this.field.type===$Control.DATA_TYPE_THING){imageInfo={uri:$IU.getBarcodePrintUrl(fieldValue)}}else{if($IU.isString(fieldValue)){if($IU.isUrl(fieldValue)){imageInfo={uri:fieldValue}}else{try{imageInfo=$.parseJSON(fieldValue)}catch(e){imageInfo=null}}}else{imageInfo=fieldValue}}this.imageInfo=imageInfo;var $element=$(this.element),hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT),imgElement=$element.data(InfoPlus.Controls.Image.DATA_IMG),$imgElement=$(imgElement);if(imageInfo!=null){if(this.field.type===$Control.DATA_TYPE_THING){hiddenInput.value=fieldValue}else{if($IU.isUrl(fieldValue)){hiddenInput.value=fieldValue}else{hiddenInput.value=$.toJSON({id:imageInfo.id,name:imageInfo.name,size:imageInfo.size,uri:imageInfo.uri,mime:imageInfo.mime})}}$imgElement.attr("src",imageInfo.uri).data(InfoPlus.Controls.Image.DATA_IMG_LOADFAIL_COUNT,0);$imgElement.parent().attr("href",imageInfo.uri)}else{if(fieldValue!=null&&fieldValue!==""){var imageFormat=(this.field.format||"jpeg").toLowerCase();if(!(imageFormat==="png"||imageFormat==="gif"||imageFormat==="jpeg")){imageFormat=image.DEFAULT_FORMAT}var src="data:image/"+imageFormat+";base64,"+fieldValue;hiddenInput.value=fieldValue;$imgElement.attr("src",src);$imgElement.parent().attr("href",src)}else{hiddenInput.value="";$imgElement.removeAttr("src").hide();$imgElement.parent().attr("href","")}}this.setAttributes(attributes);$element.data($Control.DATA_DISPLAY_VALUE,fieldDisplayValue)},getValue:function(){var $element=$(this.element),hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT),val=this.convertEmptyValue(hiddenInput.value);switch(this.field.type){case $Control.DATA_TYPE_ANYURI:return new $Controls.Data.Uri(val);case $Control.DATA_TYPE_THING:var displayValue=$element.data($Control.DATA_DISPLAY_VALUE);return new $Controls.Data.Thing(val,displayValue);default:return val}},getAttributes:function(){if(this.field.type===$Control.DATA_TYPE_ANYURI){var val=this.getValue();return $IU.getParamFromUrl(val.value)}if(this.field.type===$Control.DATA_TYPE_THING){return $(this.element).data($Control.DATA_ATTRIBUTES)}return null},getSortValue:function(){if(this.field==null||this.element==null||this.imgageInfo==null){return""}return this.imageInfo.name},setElementAttribute:function(){var $element=$(this.element),w=$element[0].style.width,h=$element[0].style.height;this.setHiddenAttribute();var $img=$($element.data(image.DATA_IMG));$img.css("width",w);$img.css("height",h);$img.css("cursor","pointer");$element.attr("style","float:left;margin:0; padding:0;")},specialSetting:function(){var $img=$($(this.element).data(image.DATA_IMG));$img.data(image.DATA_IMG_LOADED,false);$img.on("load",function(){$(this).data(image.DATA_IMG_LOADED,true);$(this).fadeIn().data(image.DATA_IMG_LOADFAIL_COUNT,0)}).on("error",function(){var failCount=$(this).data(image.DATA_IMG_LOADFAIL_COUNT)+1;if(failCount<image.MAX_IMG_LOADFAIL_COUNT){$(this).data(image.DATA_IMG_LOADFAIL_COUNT,failCount);var src=$(this).parent().attr("href"),imgInstance=this;setTimeout(function(){$(imgInstance).attr("src",src)},1000+failCount*200)}})}});define("InfoPlus.Controls.Image",image)})(window);
(function(window,undefined){var picture=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_PICTURE,path,field,render,initValue)};picture.UPLOAD_PICTURE_ID="uploadingPictureId";picture.DISPLAY_DIV="displayDiv";picture.DISPLAY_IMG="displayImg";picture.PREVIEW_IMG="previewImg";picture.UPLOAD_DIV="uploadDiv";picture.MASK_DIV="maskDiv";picture.UPLOAD_FILE_ID="uploadingFileId";picture.CLASS_DELETE_PICTURE="infoplus_pictureControl_delete";picture.DISPLAY_DIV_MAX_WIDTH="maxW";picture.DISPLAY_DIV_MAX_HEIGHT="maxH";picture.IMG_LOAD_LOCAL="ll";picture.DATA_IMG_LOADFAIL_COUNT="failCount";picture.DATA_URL="url";const isFileSecure=function(settings){if(null==settings){return false}const fso=settings.fileSecure;return fso!=null&&fso!==false&&fso!=="False"};picture.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING,$Control.DATA_TYPE_FILE],ignoreClass:true,autoTriggerFieldChangeEvent:false,validatorPromptPosition:"topLeft",name:"picture",hasHiddenElement:true,pictureInfo:null,uploadCallbacks:{onCancel:function(id,fileName){},onError:function(id,fileName,errorReason){},onSubmit:function(id,fileName,localFileName){var $container=$($(this._options.button).data("container")),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV),$uploadDiv=$container.data(InfoPlus.Controls.Picture.UPLOAD_DIV),previewImg=$displayDiv.data(InfoPlus.Controls.Picture.PREVIEW_IMG),$displayImg=$($displayDiv.data(InfoPlus.Controls.Picture.DISPLAY_IMG)),$previewImg=$(previewImg),$link=$($(previewImg).parent()[0]),file=this._buttons[0].getInput();var instance=this,pictureControl=$container.data($Control.DATA_CONTROL_OBJECT);if(file.files&&file.files[0]){$previewImg.data(InfoPlus.Controls.Picture.IMG_LOAD_LOCAL,true);$previewImg.css("margin-top",(pictureControl.getMaxHeight()+1)+"px");$previewImg.css("margin-left",(pictureControl.getMaxWidth()+1)+"px").show();var reader=new FileReader();reader.onload=function(evt){previewImg.src=evt.target.result;$link.attr("href",previewImg.src)};reader.readAsDataURL(file.files[0])}else{if(previewImg.filters&&localFileName){$displayImg.hide();$previewImg.css("margin-top",(pictureControl.getMaxHeight()+1)+"px");$previewImg.css("margin-left",(pictureControl.getMaxWidth()+1)+"px").show();$displayDiv.show();$uploadDiv.hide();if($.browser.msie&&$.browser.version.substr(0,1)==="9"){var oldOffsetWidth=previewImg.offsetWidth,oldOffsetHeight=previewImg.offsetHeight;previewImg.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=localFileName;var timer=setInterval(function(){if(previewImg.offsetWidth!==oldOffsetWidth||previewImg.offsetHeight!==oldOffsetHeight){var zoomRect=$IU.clacImgZoomParam(pictureControl.getMaxWidth(),pictureControl.getMaxHeight(),previewImg.offsetWidth,previewImg.offsetHeight);pictureControl.setDisplayDivSize(zoomRect.width,zoomRect.height);$displayDiv.css("filter",'progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'+localFileName+'"');$previewImg.hide();clearTimeout(timer)}},500)}else{previewImg.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=localFileName;var rect=$IU.clacImgZoomParam(pictureControl.getMaxWidth(),pictureControl.getMaxHeight(),previewImg.offsetWidth,previewImg.offsetHeight);pictureControl.setDisplayDivSize(rect.width,rect.height);$displayDiv.css("filter",'progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="'+localFileName+'"');$(previewImg).hide()}}}$container.data(InfoPlus.Controls.Picture.UPLOAD_FILE_ID,id);setTimeout(function(){instance.uploadStoredFiles()},0)},onUpload:function(id,fileName){var $container=$($(this._options.button).data("container")),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV),$maskDiv=$displayDiv.data(InfoPlus.Controls.Picture.MASK_DIV),pictureControl=$container.data($Control.DATA_CONTROL_OBJECT);$maskDiv.css("top","0%");$maskDiv[0].style.width=$displayDiv[0].style.width;$maskDiv[0].style.height=$displayDiv[0].style.height;$maskDiv.show();var maxWidth=pictureControl.getMaxWidth(),maxHeight=pictureControl.getMaxHeight(),size=maxHeight<maxWidth?maxHeight:maxWidth,lines=10+parseInt(size/25,10),radius=5+parseInt(size/10,10),width=4+parseInt(size/100,10),length=4+parseInt(size/80,10);var opts={lines:lines,length:length,width:width,radius:radius,corners:1,rotate:0,direction:1,color:"#ffffff",speed:1,trail:60,shadow:false,hwaccel:true,className:"spinner",zIndex:2000000000,top:"50%",left:"50%"};var spinner=new Spinner(opts).spin($displayDiv[0]);var tipDiv=document.createElement("div");$(tipDiv).css("font-size","12px").css("white-space","nowrap").css("word-wrap","normal").css("top","50%").css("left","50%").css("margin-left","-25px").css("margin-top","-6px").css("color",opts.color).text("");spinner.el.appendChild(tipDiv);$displayDiv.data("spin",spinner)},onProgress:function(id,fileName,loaded,total){var $container=$($(this._options.button).data("container")),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV),$maskDiv=$displayDiv.data(InfoPlus.Controls.Picture.MASK_DIV);var percent=(loaded<total)?Math.round(loaded/total*100):100;$maskDiv.css("top",percent+"%")},onComplete:function(id,fileName,responseJSON){var $container=$($(this._options.button).data("container")),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV),$maskDiv=$displayDiv.data(InfoPlus.Controls.Picture.MASK_DIV),pictureControl=$container.data($Control.DATA_CONTROL_OBJECT);var spinner=$displayDiv.data("spin");if(spinner!=null){spinner.stop()}$maskDiv.css("top","100%").hide();$container.data(InfoPlus.Controls.Picture.UPLOAD_FILE_ID,null);if(responseJSON.success&&responseJSON.infoPlusFile!=null){var pictureInfo=responseJSON.infoPlusFile;pictureControl.setValue({uploadSuccess:true,id:pictureInfo.id,name:pictureInfo.name,size:pictureInfo.size,uri:pictureInfo.uri,mime:pictureInfo.mime})}else{$IU.messageBox(null,$$.lt("picture.uploadFail"),null,300);pictureControl.setValue(null)}},onValidateBatch:function(fileData){var validationOption=this._options.validation;if(validationOption===undefined||validationOption===null){return true}var getFileSuffix=function(fileName){var dotIndex=fileName.lastIndexOf(".");if(dotIndex!==-1&&((dotIndex+1)<fileName.length)){return fileName.substring(dotIndex+1).toLowerCase()}return""};var len=fileData.length;for(var i=0;i<len;i++){var data=fileData[i];if(data.name!==undefined){if(validationOption.allowedExtensions!==undefined&&validationOption.allowedExtensions.length>0){var fileSuffix=getFileSuffix(data.name);var allowedExtensions=validationOption.allowedExtensions;var extensionLength=validationOption.allowedExtensions.length;var matchFileSuffix=false;var allFileSuffix="";for(var extensionIndex=0;extensionIndex<extensionLength;extensionIndex++){allFileSuffix=allFileSuffix+allowedExtensions[extensionIndex]+((extensionIndex!==extensionLength-1)?",":"");if(fileSuffix===allowedExtensions[extensionIndex]){matchFileSuffix=true}}if(!matchFileSuffix){$IU.messageBox(null,$$.lt("picture.suffix",allFileSuffix),null,300);return false}}}if(data.size!==undefined){var sizeLimit=validationOption.sizeLimit;if(sizeLimit!==null&&!isNaN(sizeLimit)&&sizeLimit!==0){if(data.size>sizeLimit){var sizeObj=$IU.convertFileSize(sizeLimit);$IU.messageBox(null,$$.lt("picture.sizeLimit",(sizeObj.size+sizeObj.unit)),null,360);return false}}}}return true}},createUploader:function(container,uploadDiv){var endPoint=$$.params.attachmentUrl+"?stepId="+($$.params.formStepId==null?-1:$$.params.formStepId)+"&field="+this.field.name;if($$.params.formInstanceId!=null){endPoint+="&instanceId="+$$.params.formInstanceId}if($$.params.workflowId!=null){endPoint+="&workflowId="+$$.params.workflowId}if($$.params.release!=null){endPoint+="&release="+$$.params.release}var options={request:{endpoint:endPoint},button:uploadDiv,multiple:false,debug:false,autoUpload:false,callbacks:this.uploadCallbacks};var settings=this.field.settings;var getFileSizeLimit=function(){if(settings.fileSizeMax!==undefined&&$IU.isNumber(settings.fileSizeMax)){return parseInt(settings.fileSizeMax,10)}if(settings.maxLength!==undefined&&$IU.isNumber(settings.maxLength)){return parseInt(settings.maxLength,10)}return null};var validation={allowedExtensions:["jpg","jpeg","gif","png"]};var acceptFiles="image/*";validation.acceptFiles=acceptFiles;if(settings!==undefined&&settings!==null){var sizeLimit=getFileSizeLimit();if(sizeLimit!=null){validation.sizeLimit=sizeLimit}}options.validation=validation;var uploader=new qq.FineUploaderBasic(options);$(container).data("uploader",uploader)},createUploadDiv:function(container){var uploadDiv=document.createElement("div");$(uploadDiv).attr("title",$$.lt("picture.upload")).addClass("uploadDiv").data("container",container).hide();container.appendChild(uploadDiv);this.createUploader(container,uploadDiv);$(container).data(InfoPlus.Controls.File.UPLOAD_DIV,$(uploadDiv))},getMaxWidth:function(){var $container=$(this.element),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV),maxWidth=$displayDiv.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_WIDTH);if(maxWidth.substr(maxWidth.length-1)==="%"){maxWidth=$container.outerWidth()*parseInt(maxWidth,10)/100}else{maxWidth=parseFloat(maxWidth)}return maxWidth},getMaxHeight:function(){var $container=$(this.element),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV),maxHeight=$displayDiv.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_HEIGHT);if(maxHeight.substr(maxHeight.length-1)==="%"){maxHeight=$container.outerHeight()*parseInt(maxHeight,10)/100}else{maxHeight=parseFloat(maxHeight)}return maxHeight},createDisplayDiv:function(container){var instance=this,displayDiv=document.createElement("div"),link=document.createElement("a"),$displayDiv=$(displayDiv),$container=$(container);link.setAttribute("data-lightbox",$$.guid());var previewImg=document.createElement("img");$(previewImg).attr("border","0").addClass("preview").data(InfoPlus.Controls.Picture.IMG_LOAD_LOCAL,false).data(InfoPlus.Controls.Picture.DISPLAY_DIV,$(displayDiv));$(previewImg).load(function(){var $uploadDiv=$container.data(InfoPlus.Controls.Picture.UPLOAD_DIV),maxWidth=instance.getMaxWidth(),maxHeight=instance.getMaxHeight();$displayDiv.addClass("uploading");$uploadDiv.hide();$displayDiv.show();var rect=$IU.clacImgZoomParam(maxWidth,maxHeight,this.width,this.height);this.width=rect.width;this.height=rect.height;$(this).css("margin-left","0px").css("margin-top","0px");instance.setDisplayDivSize(rect.width,rect.height);$(this).data(InfoPlus.Controls.Picture.IMG_LOAD_LOCAL,false)});link.appendChild(previewImg);var displayImg=document.createElement("img");$(displayImg).attr("border","0").data(InfoPlus.Controls.Picture.DISPLAY_DIV,$(displayDiv));$(displayImg).load(function(){var img=this,$img=$(img),$uploadDiv=$container.data(InfoPlus.Controls.Picture.UPLOAD_DIV),maxWidth=instance.getMaxWidth(),maxHeight=instance.getMaxHeight();$img.css("margin-top",(maxHeight+1)+"px").css("margin-left",(maxWidth+1)+"px").show();var getImgWidth=function(image){if(image.naturalWidth!=null){return image.naturalWidth}else{return image.width}};var getImgHeight=function(image){if(image.naturalHeight!=null){return image.naturalHeight}else{return image.height}};var setImgSize=function(){var w=getImgWidth(img),h=getImgHeight(img);$img.data("naturalWidth",w).data("naturalHeight",h);var rect=$IU.clacImgZoomParam(maxWidth,maxHeight,w,h);img.width=rect.width;img.height=rect.height;$(img).css("margin-left","0px").css("margin-top","0px");if($(displayDiv).css("filter")!=null){$(displayDiv).css("filter","")}instance.setDisplayDivSize(rect.width,rect.height);$displayDiv.show();$(previewImg).hide();$(img).show();if($uploadDiv!=null){$uploadDiv.hide()}$(img).parent().attr("href",img.src)};if(getImgWidth(img)===0||getImgHeight(img)===0){var flag=setInterval(function(){if(getImgWidth(img)!==0&&getImgHeight(img)!==0){setImgSize();clearTimeout(flag)}},100)}else{setImgSize()}$displayDiv.removeClass("loading")}).error(function(){});link.appendChild(displayImg);displayDiv.appendChild(link);var maskDiv=document.createElement("div"),$maskDiv=$(maskDiv);$maskDiv.addClass(InfoPlus.Controls.Picture.MASK_DIV).hide();displayDiv.appendChild(maskDiv);if(this.isWritable()){var deleteDiv=document.createElement("div");$(deleteDiv).attr("title",$$.lt("common.deleteText")).addClass(picture.CLASS_DELETE_PICTURE);displayDiv.appendChild(deleteDiv)}container.appendChild(displayDiv);$(displayDiv).addClass(InfoPlus.Controls.Picture.DISPLAY_DIV).data("container",container).data(InfoPlus.Controls.Picture.PREVIEW_IMG,previewImg).data(InfoPlus.Controls.Picture.DISPLAY_IMG,displayImg).data(InfoPlus.Controls.Picture.MASK_DIV,$maskDiv);$(container).data(InfoPlus.Controls.Picture.DISPLAY_DIV,$(displayDiv));$(link).data("pictureControl",this)},createElement:function(){var container=document.createElement("div");if(this.isReadable()){this.createDisplayDiv(container)}if(this.isWritable()){this.createUploadDiv(container)}return container},shouldFireChangeEvent:function(newPictureInfo){if(this.synced===true){this.synced=false;return false}if(this.onFieldChange||this.onFieldRefer||this.onFieldSync){if(this.pictureInfo==null){return newPictureInfo!=null}else{if(newPictureInfo==null){return true}else{return newPictureInfo.id!==this.pictureInfo.id}}}return false},setValue:function(fieldValue,fieldDisplayValue,fromInit){var field=this.field;var pictureInfo;var setPictureUrl=function(img,url){var $img=$(img);var requestImg=function(changeLink){$$.ajax({type:"POST",url:$$.params.attachmentTokenUrl,addFormParam:true,data:{field:field.name,fileUri:url}}).done(function(data){if(data!=null){if(data.errno===0){var token=data.entities[0];if($IU.isObject(token)){token=token.token}var newUrl=url+((url.indexOf("?")!==-1)?"&":"?")+"access_token="+token;if(changeLink){linkChanged=true;$img.parent().attr("href",newUrl);$img.click();linkChanged=false}else{img.src=newUrl;$img.data(InfoPlus.Controls.Picture.DATA_IMG_LOADFAIL_COUNT,0)}}else{$$.debug(data.error)}}})};if(url!==""){$img.hide();var $displayDiv=$img.parents(".displayDiv");$displayDiv.removeClass("uploading").addClass("loading");if(pictureInfo.name!=null){$img.attr("alt",pictureInfo.name)}if(isFileSecure(field.settings)){requestImg(false);var linkChanged=false;$img.unbind("click").click(function(){if(!linkChanged){requestImg(true);return false}})}else{img.src=url;$img.data(InfoPlus.Controls.Picture.DATA_IMG_LOADFAIL_COUNT,0)}}else{$img.removeAttr("src").removeAttr("width").removeAttr("height").removeAttr("style");$img.parent().removeAttr("href")}$img.data(InfoPlus.Controls.Picture.DATA_URL,url)};if($IU.isString(fieldValue)){try{pictureInfo=$.parseJSON(fieldValue)}catch(e){pictureInfo=null}}else{pictureInfo=fieldValue}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(pictureInfo);this.pictureInfo=pictureInfo;var $container=$(this.element),hiddenInput=$container.data($Control.DATA_ORIGIN_INPUT),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV),$uploadDiv=$container.data(InfoPlus.Controls.Picture.UPLOAD_DIV),displayImg=$displayDiv.data(InfoPlus.Controls.Picture.DISPLAY_IMG),previewImg=$displayDiv.data(InfoPlus.Controls.Picture.PREVIEW_IMG);if(pictureInfo!=null&&pictureInfo.id!=null){hiddenInput.value=pictureInfo.id;setPictureUrl(displayImg,pictureInfo.uri)}else{hiddenInput.value="";$displayDiv.hide();if($uploadDiv!=null){var fileInput=$uploadDiv.children("input")[0];fileInput.style.height=$uploadDiv[0].style.height;$uploadDiv.show()}setPictureUrl(displayImg,"");$(previewImg).removeAttr("width").removeAttr("height").removeAttr("style").removeAttr("src")}if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(){if(this.field==null||this.element==null||this.pictureInfo==null){return""}var $container=$(this.element),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV),$displayImg=$($displayDiv.data(InfoPlus.Controls.Picture.DISPLAY_IMG));var pictureInfo=this.pictureInfo;return $.toJSON({id:pictureInfo.id,name:pictureInfo.name,size:pictureInfo.size,uri:pictureInfo.uri,mime:pictureInfo.mime,width:$displayImg.data("naturalWidth"),height:$displayImg.data("naturalHeight")})},getSortValue:function(){if(this.field==null||this.element==null||this.pictureInfo==null){return""}return this.pictureInfo.name},setDisplayDivSize:function(width,height){var $container=$(this.element),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV);if($displayDiv!=null){var $maskDiv=$displayDiv.data(InfoPlus.Controls.Picture.MASK_DIV);$displayDiv.css("width",width);$displayDiv.css("height",height);if($maskDiv!=null){$maskDiv.css("width",width);$maskDiv.css("height",height)}}},specialSetting:function(){var $container=$(this.element),$displayDiv=$container.data(InfoPlus.Controls.Picture.DISPLAY_DIV),$uploadDiv=$container.data(InfoPlus.Controls.Picture.UPLOAD_DIV);var w=$container[0].style.width,h=$container[0].style.height;if(w.substr(w.length-1)==="%"){$IU.debugTip($$.lt("picture.widthWarning",this.field.name))}if($displayDiv!=null){$displayDiv.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_WIDTH,w);$displayDiv.data(InfoPlus.Controls.Picture.DISPLAY_DIV_MAX_HEIGHT,h)}this.setDisplayDivSize(w,h);if($uploadDiv!=null){$uploadDiv.css("width",w);$uploadDiv.css("height",h);var fileInput=$uploadDiv.children("input")[0];fileInput.style.height=h}$container.css("width","");$container.css("height","")},deletePicture:function(callback){var instance=this;$IU.confirmBox($$.lt("picture.confirmDelete"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){instance.setValue(null);if(callback!=null&&(typeof callback==="function")){callback()}})},registerEvent:function(){this.events=InfoPlus.Controls.Picture.Events.events},setDynamicReadOnly:function(isReadOnly){var container=this.element;if(isReadOnly){$(container).addClass($Control.CLASSNAME_READONLY)}else{$(container).removeClass($Control.CLASSNAME_READONLY)}}});define("InfoPlus.Controls.Picture",picture);var pictureEvents={onImgLoad:function(){},onCancel:function(){var $container=$(this).parents("."+$Control.CLASSNAME_CONTROL);var uploadingPictureId=$container.data(InfoPlus.Controls.Picture.UPLOAD_PICTURE_ID);if(uploadingPictureId!=null){var uploader=$container.data("uploader");uploader.cancel(uploadingPictureId);var pictureControl=$container.data($Control.DATA_CONTROL_OBJECT);pictureControl.setValue(null)}},onDelete:function(){var pictureControl=$(this).parents("."+$Control.CLASSNAME_CONTROL).data($Control.DATA_CONTROL_OBJECT);pictureControl.deletePicture();return false}};pictureEvents.events=[{selector:"."+InfoPlus.Controls.Picture.CLASS_DELETE_PICTURE,type:"click",handler:pictureEvents.onDelete}];define("InfoPlus.Controls.Picture.Events",pictureEvents)})(window);
(function(window,undefined){var password=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_PASSWORD,path,field,render,initValue,null)};password.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_STRING],name:"password",createElement:function(){var element=document.createElement("input");element.type="password";return element},setValue:function(fieldValue){if(fieldValue==null){fieldValue=""}$(this.element).val(fieldValue)},getValue:function(){if(this.field==null||this.element==null){return""}return this.convertEmptyValue(this.element.value)}});define("InfoPlus.Controls.Password",password)})(window);
(function(window,undefined){var iframe=function(path,field,render,initValue){if(!InfoPlus.Controls.Iframe.initialized){var flyoutDiv=document.createElement("div");flyoutDiv.setAttribute("id",FLYOUT_DIV_ID);$(flyoutDiv).addClass("round-corner");iframe.flyoutDiv=flyoutDiv;$(document.body).append(flyoutDiv);InfoPlus.Controls.Iframe.initialized=true}$Control.call(this,$Control.CONTROL_TYPE_IFRAME,path,field,render,initValue)};iframe.eventRegistered=false;iframe.initialized=false;var FLYOUT_DIV_ID="infoplus_iframe_flyout_div";var REGEXP_URL=/^.+:\/\/[^/]+/;iframe.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_ANYURI],ignoreValidation:true,allowFocus:false,autoTriggerFieldChangeEvent:false,name:"iframe",hasHiddenElement:true,flyoutIframe:null,flyoutIframeId:null,innerId:null,flyoutInnerId:null,flyoutPage:null,createElement:function(){var iframeContainer=document.createElement("div");var iframe=document.createElement("iframe");iframe.setAttribute("scrolling","auto");iframeContainer.appendChild(iframe);this.controlContainer=iframeContainer;$(iframeContainer).addClass("infoplus_iframeControlContainer");return iframe},sendMessage:function(data){var iframeElement=this.element;var origin=iframeElement.src.match(REGEXP_URL)[0];iframeElement.contentWindow.postMessage($.toJSON(data),origin)},flyoutWindowSendMessage:function(data){if(this.flyoutIframeId!=null){var $flyoutFrame=$("#"+this.flyoutIframeId);if($flyoutFrame.length>0){var origin=$flyoutFrame[0].src.match(REGEXP_URL)[0];$flyoutFrame[0].contentWindow.postMessage($.toJSON(data),origin)}}},closeFlyout:function(omitClosePage){if(this.flyoutIframeId!=null){$(iframe.flyoutDiv).empty().detach().removeData("iframeControl").removeClass("center");$(document.body).append(iframe.flyoutDiv);this.flyoutIframe=null;this.flyoutIframeId=null}if(this.flyoutPage!=null){if(!(omitClosePage===true)){this.flyoutPage.close()}this.flyoutPage=null}},registerEvent:function(){if(InfoPlus.Controls.Iframe.eventRegistered){return}var selector="iframe."+this.getElementClassName();var checkOrigin=function(iframeControl,eventOrigin,isFlyout){if(!isFlyout){var origin=iframeControl.element!=null?iframeControl.element.src.match(REGEXP_URL)[0]:null}else{origin=iframeControl.flyoutIframe!=null?iframeControl.flyoutIframe.src.match(REGEXP_URL)[0]:null}return origin===eventOrigin};var commandConfirm=function(message,eventOrigin,isFlyout){if(message.cid==null||message.pid==null){return}$(selector).each(function(){var iframeControl=$(this).data($Control.DATA_CONTROL_OBJECT);if(!checkOrigin(iframeControl,eventOrigin,isFlyout)){return}if(message.pid===this.id){if(!isFlyout){iframeControl.innerId=message.cid}else{iframeControl.flyoutInnerId=message.cid}}})};var commandCreate=function(message,eventOrigin,isFlyout){if(message.cid==null){return}$(selector).each(function(){var iframeControl=$(this).data($Control.DATA_CONTROL_OBJECT);if(!checkOrigin(iframeControl,eventOrigin,isFlyout)){return}if(!isFlyout){iframeControl.sendMessage({command:"query",cid:message.cid,pid:this.id})}else{iframeControl.flyoutWindowSendMessage({command:"queryFlyout",cid:message.cid,pid:this.id})}})};var commandChange=function(message){if(message.cid==null){return}$(selector).each(function(){var iframeControl=$(this).data($Control.DATA_CONTROL_OBJECT);if(message.cid===iframeControl.innerId){var iframeUrl=message.url||"";var fireChangeEvent=iframeControl.shouldFireChangeEvent(iframeUrl);var $element=$(iframeControl.element);var hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);hiddenInput.value=iframeUrl;if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}}})};var closeLastFlyout=function(){var control=$(InfoPlus.Controls.Iframe.flyoutDiv).data("iframeControl");if(control!=null){control.closeFlyout()}};var DEFAULT_FLYOUT_WIDTH=300,DEFAULT_FLYOUT_HEIGHT=100;var commandOpenFlyout=function(message){var createFlyoutIframe=function(iframeControl){var flyoutId="flyout_"+$$.guid(),iframeFlyout=document.createElement("iframe");iframeFlyout.setAttribute("id",flyoutId);iframeFlyout.setAttribute("frameborder","0");iframeFlyout.setAttribute("class","infoplus_iframeControl_flyout");$(iframe.flyoutDiv).append(iframeFlyout).data("iframeControl",iframeControl);iframeControl.flyoutIframeId=flyoutId;iframeControl.flyoutIframe=iframeFlyout};var setFlyoutOptions=function(iframeControl,options){var iframeFlyout=iframeControl.flyoutIframe;var setPosition=function(width,height){switch(options.position){case"top":$(iframe.flyoutDiv).css("top","-"+height+"px").css("left","0");break;case"bottom":$(iframe.flyoutDiv).css("top",$(iframeControl.element).outerHeight()+"px").css("left","0");break;case"left":$(iframe.flyoutDiv).css("top","0").css("left","-"+width+"px");break;case"right":$(iframe.flyoutDiv).css("top","0").css("left",$(iframeControl.element).outerWidth()+"px");break;case"center":$(iframe.flyoutDiv).css("top",(($(window).height()-height)/2)+"px").css("left",(($(window).width()-width)/2)+"px").addClass("center");break;default:if(($(iframeControl.element).offset().top-$(window).scrollTop()+$(iframeControl.element).height()+height<=$(window).height())||($(iframeControl.element).offset().top-$(window).scrollTop()<height)){$(iframe.flyoutDiv).css("top",$(iframeControl.element).outerHeight()+"px")}else{$(iframe.flyoutDiv).css("top","-"+height+"px")}}};iframeFlyout.setAttribute("scrolling","auto");if(iframeFlyout.getAttribute("src")!==options.src){iframeFlyout.setAttribute("src",options.src)}if(!$$.MOBILE){var height=options.height!=null?parseInt(options.height,10):DEFAULT_FLYOUT_HEIGHT;iframeFlyout.setAttribute("height",height+"");var width=options.width!=null?parseInt(options.width,10):DEFAULT_FLYOUT_WIDTH;iframeFlyout.setAttribute("width",width+"");height+=14;setPosition(width,height);if(!(options.shadow===false)){$(iframe.flyoutDiv).addClass("z-depth-1")}else{$(iframe.flyoutDiv).removeClass("z-depth-1")}}};if(message.cid==null){return}$(selector).each(function(){var iframeControl=$(this).data($Control.DATA_CONTROL_OBJECT);if(message.cid===iframeControl.innerId){var options=message.options;if(!$$.MOBILE){if(iframeControl.flyoutIframe==null){closeLastFlyout();createFlyoutIframe(iframeControl);if(options.position!=="center"){iframeControl.controlContainer.appendChild(iframe.flyoutDiv)}}setFlyoutOptions(iframeControl,options)}else{if(iframeControl.flyoutIframe==null){createFlyoutIframe(iframeControl)}setFlyoutOptions(iframeControl,options);var pageOptions={content:$(iframe.flyoutDiv),buttons:[{name:$$.lt("common.close"),callOnClose:true,defaultButton:true,callback:function(){iframeControl.closeFlyout(true)}}]};var page=new InfoPlus.Render.Mobile.Page(pageOptions);iframeControl.flyoutPage=page;page.show()}}})};var commandCloseFlyout=function(message){if(message.cid==null){return}$(selector).each(function(){var iframeControl=$(this).data($Control.DATA_CONTROL_OBJECT);if(message.cid===iframeControl.flyoutInnerId){iframeControl.sendMessage({command:"closeFlyout",data:message.data,pid:this.id});iframeControl.closeFlyout()}if(message.cid===iframeControl.innerId){iframeControl.closeFlyout()}})};$(window).on("message",function(e){var message;try{message=$.parseJSON(e.originalEvent.data)}catch(e){}if(message==null||message.command==null){return}switch(message.command){case"change":commandChange(message);break;case"create":commandCreate(message,e.originalEvent.origin,false);break;case"createFlyout":commandCreate(message,e.originalEvent.origin,true);break;case"openFlyout":commandOpenFlyout(message);break;case"closeFlyout":commandCloseFlyout(message);break;case"confirm":commandConfirm(message,e.originalEvent.origin,false);break;case"confirmFlyout":commandConfirm(message,e.originalEvent.origin,true);break}});if(!$$.MOBILE){$(document).mousedown(function(event){if(event.target.id!==FLYOUT_DIV_ID){closeLastFlyout()}})}InfoPlus.Controls.Iframe.eventRegistered=true},getAttributes:function(){var url=this.getValue();return $IU.getParamFromUrl(url.value)},resetInnerId:function(){this.innerId=null;this.flyoutInnerId=null},setValue:function(fieldValue,fieldDisplayValue,fromInit){if(fieldValue==null){fieldValue=""}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);this.resetInnerId();var $element=$(this.element);var hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);hiddenInput.value=fieldValue;$element.attr("src",fieldValue);if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(){if(this.field==null||this.element==null){return""}var $element=$(this.element),hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);return new $Controls.Data.Uri(hiddenInput.value)}});define("InfoPlus.Controls.Iframe",iframe)})(window);
(function(window,undefined){var thing=function(path,field,render,initValue,initDisplayValue,initAttributes){$Control.call(this,$Control.CONTROL_TYPE_THING,path,field,render,initValue,initDisplayValue,initAttributes)};thing.BARCODE_LENGTH=13;thing.HAS_VALUE="infoplus_thingControl_has_value";thing.NO_VALUE="infoplus_thingControl_no_value";thing.CLASS_INPUT_NAME_DIV="infoplus_thingControl_inputNameDiv";thing.CLASS_INPUT_BARCODE_DIV="infoplus_thingControl_inputBarcodeDiv";thing.CLASS_NAME_DIV="infoplus_thingControl_nameDiv";thing.CLASS_PRINT_DIV="infoplus_thingControl_printDiv";thing.CLASS_DELETE_DIV="infoplus_thingControl_deleteDiv";thing.CODE_REG=/^\d{13}$/;thing.IMG_HOLDER="INFOPLUS_THING_IMG_HOLDER";thing.prototype=$.extend(new $Controls.Control(),{autoTriggerFieldChangeEvent:false,compatibleFieldTypes:[$Control.DATA_TYPE_THING],allowFocus:false,name:"thing",hasHiddenElement:true,getCheckCode:function(code){var _odd=0,_even=0;for(var _i=0;_i<=11;_i++){_i%2===0?_odd+=parseInt(code[_i]):_even+=parseInt(code[_i])}return((10-(_odd+_even*3)%10)%10).toString()},getNewBarCode:function(){var code=""+(690+Math.round(Math.random()*(695-690)));for(var i=0;i<9;i++){code+=(""+Math.ceil(Math.random()*9))}code+=this.getCheckCode(code);return code},getPrintContent:function(imgReady,printCallback){var printUrl=$IU.getBarcodePrintUrl(this.getValue().value);if(printUrl==null){return null}var instance=this;var printDiv=document.createElement("div"),$printDiv=$(printDiv);var getSortedContext=function(){$$.dynamics.cache.build();var context=instance.dynamicProcessor.getControlContext(instance,undefined,true);var sortArray=new InfoPlus.QuickSortArray();for(var k in context){if(context.hasOwnProperty(k)){sortArray.push({name:k,obj:context[k]})}}sortArray.sort(function(u1,u2){var l1=u1.name.length,l2=u2.name.length;if(l1>l2){return -1}else{if(l1===l2){return 0}else{return 1}}});return sortArray};var addBarImg=function(){var imgIndex=imgReady.length;imgReady[imgIndex]=false;var div=document.createElement("div");var img=document.createElement("img");img.src=printUrl;div.appendChild(img);div.setAttribute("style","margin:15px 0 15px -5px");var isImgLoaded=function(){if(!img.complete){setTimeout(isImgLoaded,300)}else{imgReady[imgIndex]=true;printCallback()}};setTimeout(isImgLoaded,300);$printDiv.append(div)};var replaceFormat=function(format,obj,fieldName,property){if(obj==null){return format}if(property!=null){if(obj[property]!=null){format=format.replace(new RegExp("\\$"+fieldName+"\\."+property,"gm"),obj[property]);return format.replace(new RegExp("\\${"+fieldName+"\\."+property+"}","gm"),obj[property])}}else{format=format.replace(new RegExp("\\$"+fieldName,"gm"),obj);return format.replace(new RegExp("\\${"+fieldName+"}","gm"),obj)}return format};var replaceBarCodeImg=function(format,fieldName){format=format.replace(new RegExp("\\$"+fieldName+"\\.value","gm"),thing.IMG_HOLDER);format=format.replace(new RegExp("\\${"+fieldName+"\\.value}","gm"),thing.IMG_HOLDER);format=format.replace(new RegExp("\\$"+fieldName,"gm"),thing.IMG_HOLDER);format=format.replace(new RegExp("\\${"+fieldName+"}","gm"),thing.IMG_HOLDER);return format};var replaceContent=function(format){var context=getSortedContext();for(var i=0,len=context.length;i<len;i++){var o=context[i];var fieldName=o.name;format=replaceFormat(format,o.obj,fieldName,"displayValue");format=replaceFormat(format,o.obj,fieldName,"name");if(o.name!==instance.field.name){format=replaceFormat(format,o.obj,fieldName,"value");format=replaceFormat(format,o.obj,fieldName)}else{format=replaceBarCodeImg(format,fieldName)}}return format.split("\n")};var putFormatPrintContent=function(format){var separator=new RegExp(/^-(\d|-)*-$/);var content=replaceContent(format);for(var i=0,len=content.length;i<len;i++){var line=content[i];if(line.indexOf(thing.IMG_HOLDER)!==-1){addBarImg()}else{var trimLine=$IU.trimString(line);if(separator.test(trimLine)===true){var separatorHeight=parseInt(trimLine.replace(/-/g,""),10);if(isNaN(separatorHeight)){separatorHeight=10}var separatorDiv=document.createElement("div");separatorDiv.setAttribute("style","height:"+separatorHeight+"px");$printDiv.append(separatorDiv)}else{var contentDiv=document.createElement("div");$(contentDiv).text(line);$printDiv.append(contentDiv)}}}};var putDefaultPrintContent=function(){var titleDiv=document.createElement("div");$(titleDiv).text($$.params.instanceName);$printDiv.append(titleDiv);if(($$.params.instanceTags||"")!==""){var tagDiv=document.createElement("div");$(tagDiv).text($$.params.instanceTags);$printDiv.append(tagDiv)}addBarImg();var nameDiv=document.createElement("div");$(nameDiv).text($$.lt("thing.name")+""+instance.getValue().name);$printDiv.append(nameDiv)};var format=this.field.format||"";if(format!==""){putFormatPrintContent(format)}else{putDefaultPrintContent()}$printDiv.attr("style","text-align:left");return printDiv},print:function(){var imgReady=[],windowReady=false;var w=window.open();var print=function(){if(!windowReady){return}for(var i=0,len=imgReady.length;i<len;i++){if(!imgReady[i]){return}}setTimeout(function(){w.focus();w.print();w.close()},1000)};var $invoiceDiv=$("#div_invoice");$invoiceDiv.empty();var printContent=this.getPrintContent(imgReady,print);if(printContent!=null){$invoiceDiv.append(printContent);var html=$invoiceDiv.html();w.document.write("<style>body {text-align:center}</style>"+html);w.document.close();var onWindowReady=function(){if(!windowReady){windowReady=true;print()}};$(w).load(onWindowReady);$(w.document).ready(onWindowReady)}},createElement:function(){var element=document.createElement("div");var inputNameDiv=document.createElement("div");inputNameDiv.setAttribute("class",thing.CLASS_INPUT_NAME_DIV);element.appendChild(inputNameDiv);var nameDiv=document.createElement("div");nameDiv.setAttribute("class",thing.CLASS_NAME_DIV);element.appendChild(nameDiv);var deleteDiv=document.createElement("div");deleteDiv.setAttribute("class",thing.CLASS_DELETE_DIV);deleteDiv.setAttribute("title",$$.lt("common.deleteText"));element.appendChild(deleteDiv);var printDiv=document.createElement("div");printDiv.setAttribute("class",thing.CLASS_PRINT_DIV);var i=document.createElement("i");i.setAttribute("class","i-icon-print");printDiv.appendChild(i);element.appendChild(printDiv);return element},setValue:function(fieldValue,fieldDisplayValue,fromInit,attributes){if(fieldValue==null){fieldValue="";fieldDisplayValue="";attributes=null}var $thingContainer=$(this.element),hiddenInput=$thingContainer.data($Control.DATA_ORIGIN_INPUT),fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);hiddenInput.value=fieldValue;$thingContainer.children("."+InfoPlus.Controls.Thing.CLASS_NAME_DIV).text(fieldDisplayValue);if(fieldDisplayValue===""){$thingContainer.removeClass(InfoPlus.Controls.Thing.HAS_VALUE).addClass(InfoPlus.Controls.Thing.NO_VALUE)}else{$thingContainer.removeClass(InfoPlus.Controls.Thing.NO_VALUE).addClass(InfoPlus.Controls.Thing.HAS_VALUE);var width=this.element.style.width;if(width!=null&&width!==""){var w=$thingContainer.find("."+thing.CLASS_PRINT_DIV).width()+$thingContainer.find("."+thing.CLASS_DELETE_DIV).width();if(width.substring(width.length-1)!=="%"){var containerWidth=parseInt(width,10);if(w===0){w=$$.MOBILE?48:32;$thingContainer.find("."+thing.CLASS_NAME_DIV).css("max-width",(containerWidth-w-24)+"px")}else{$thingContainer.find("."+thing.CLASS_NAME_DIV).css("max-width",(containerWidth-w-24)+"px")}}else{var setWidth=function(){if($thingContainer.width()===parseInt(width,10)){setTimeout(function(){setWidth()},300)}else{containerWidth=parseInt($thingContainer.width(),10);var w=$thingContainer.find("."+thing.CLASS_PRINT_DIV).width()+$thingContainer.find("."+thing.CLASS_DELETE_DIV).width();$thingContainer.find("."+thing.CLASS_NAME_DIV).css("max-width",(containerWidth-w-24)+"px")}};setWidth()}}}this.setAttributes(attributes);$thingContainer.data($Control.DATA_DISPLAY_VALUE,fieldDisplayValue);if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},setName:function(fieldDisplayValue){if(fieldDisplayValue==null){fieldDisplayValue=""}var $thingContainer=$(this.element),hiddenInput=$thingContainer.data($Control.DATA_ORIGIN_INPUT),fireChangeEvent=this.shouldFireChangeEvent(fieldDisplayValue);$thingContainer.children("."+InfoPlus.Controls.Thing.CLASS_NAME_DIV).text(fieldDisplayValue);if(fieldDisplayValue===""){$thingContainer.removeClass(InfoPlus.Controls.Thing.HAS_VALUE).addClass(InfoPlus.Controls.Thing.NO_VALUE)}else{$thingContainer.removeClass(InfoPlus.Controls.Thing.NO_VALUE).addClass(InfoPlus.Controls.Thing.HAS_VALUE)}$thingContainer.data($Control.DATA_DISPLAY_VALUE,fieldDisplayValue);if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(){var $thingContainer=$(this.element),hiddenInput=$thingContainer.data($Control.DATA_ORIGIN_INPUT),val=this.convertEmptyValue(hiddenInput.value),displayValue=$thingContainer.data($Control.DATA_DISPLAY_VALUE);return new $Controls.Data.Thing(val,displayValue)},setPlaceHolder:function(){if(this.field!=null&&this.field.placeHolder!=null&&this.field.placeHolder!==""){var container=this.element;var tipDiv=document.createElement("div");var link=document.createElement("a");link.setAttribute("href","#");$(link).text(this.field.placeHolder);tipDiv.appendChild(link);$(tipDiv).addClass("thingTip");$(container).find("."+thing.CLASS_INPUT_NAME_DIV).after(tipDiv);$(tipDiv).click(function(){$IU.fireClick($(this).siblings("."+thing.CLASS_INPUT_NAME_DIV)[0]);return false})}},showThingDialog:function(inputBarcode){var value=this.getValue();if(value.value===""){value.value=this.getNewBarCode()}var thingContainer=this.element,instance=this,thingId=document.createElement("div"),$thingId=$(thingId),thingIdInput=document.createElement("input"),$thingIdInput=$(thingIdInput),thingName=document.createElement("input"),$thingName=$(thingName),title=$$.lt("thing.pleaseInput"),content=document.createElement("div");$thingId.attr("id","form_thing_id").css("display","inline-block").css("position","relative");$thingIdInput.attr("id","form_thing_id_input").attr("type","text").attr("maxlength",thing.BARCODE_LENGTH).val(value.value);$thingName.attr("id","form_thing_name").attr("type","text");if(thingContainer.readOnly===true){thingIdInput.readOnly=true;$thingIdInput.addClass($Control.CLASSNAME_READONLY);$thingIdInput.hide();thingName.readOnly=true;$thingName.addClass($Control.CLASSNAME_READONLY)}$thingId.text(value.value).css("margin-left","10px");if(!inputBarcode){$thingIdInput.hide()}else{$thingId.hide();$thingIdInput.css("display","inline-block")}$thingIdInput.css("margin-left","10px").css("width","235px");$thingName.val(value.displayValue).css("margin-left","10px").css("width","235px");$(content).append("<span>"+$$.lt("thing.code")+"</span>").append(thingId).append(thingIdInput).append("<br>").append("<span>"+$$.lt("thing.name")+"</span>").append(thingName);$(content).css("line-height","30px");$thingIdInput.keyup(function(event){if($thingIdInput.val().length===thing.BARCODE_LENGTH){if($thingIdInput.data("requesting")!==true){$thingIdInput.data("requesting",true);$$.ajax({type:"GET",url:$$.params.formRender.thingService+"/"+$thingIdInput.val(),data:{},needParse:false,showParseErrMsg:false,showAjaxErrMsg:false,addFormParam:true}).done(function(data){if(data.entities.length===0){$IU.messageBox(null,$$.lt("thing.notFound"),null,300)}else{var thing=data.entities[0];$thingName.val(thing.name);$thingIdInput.data("attr",thing.attributes)}}).fail(function(data){if(data.errno===50001){$IU.messageBox(null,$$.lt("thing.notFound"),null,300)}else{$IU.messageBox(null,data.msg,null)}}).always(function(){setTimeout(function(){$thingIdInput.removeData("requesting")},300)})}}if(event.keyCode===13){$(thingName).focus()}});var buttons;if(thingContainer.readOnly===true){buttons=[]}else{buttons=[{name:$$.lt("common.save"),defaultButton:true,callOnClose:false,preventDefault:true,callback:function(){if($thingIdInput.is(":visible")){if($thingIdInput.val()===""){$IU.messageBox(null,$$.lt("thing.check.code"),null,200);return false}var code=$thingIdInput.val();if(code.length!==13||instance.getCheckCode(code.substr(0,12))!==code.substr(12)){$IU.messageBox(null,$$.lt("thing.check.codeError"),null,240);return false}}else{if($thingName.val()===""){$IU.messageBox(null,$$.lt("thing.check.name"),null,200);return false}}if($thingName.val()===""){$IU.messageBox(null,$$.lt("thing.check.name"),null,200);return false}instance.setValue($thingIdInput.val(),$thingName.val(),false,$thingIdInput.data("attr"))}},{name:$$.lt("common.cancel")},{name:$$.lt("thing.scan"),preventDefault:true,callback:function(){$thingId.hide();$thingIdInput.val("").css("display","inline-block").focus();return false}}]}var dialog=new InfoPlus.Render.Dialog({title:title,content:content,maxWidth:340,buttons:buttons});dialog.show();return false},registerEvent:function(){this.events=InfoPlus.Controls.Thing.Events.events},specialSetting:function(){var $element=$(this.element);$element.css("height","");$element.children("."+InfoPlus.Controls.Thing.CLASS_INPUT_NAME_DIV).attr("title",$$.lt("thing.clickToInput"));$element.children("."+InfoPlus.Controls.Thing.CLASS_NAME_DIV).attr("title",$$.lt("thing.clickToInput"));$element.children("."+InfoPlus.Controls.Thing.CLASS_PRINT_DIV).attr("title",$$.lt("thing.print"))}});define("InfoPlus.Controls.Thing",thing);var thingEvents={inputNameClick:function(){var thingControl=$(this).parent().data($Control.DATA_CONTROL_OBJECT);if(thingControl==null){return false}thingControl.showThingDialog(false);return false},nameClick:function(){var thingControl=$(this).parent().data($Control.DATA_CONTROL_OBJECT);if(thingControl==null){return false}thingControl.showThingDialog();return false},printClick:function(){var thingControl=$(this).parent().data($Control.DATA_CONTROL_OBJECT);if(thingControl==null){return false}thingControl.print();return false},deleteClick:function(){var thingControl=$(this).parent().data($Control.DATA_CONTROL_OBJECT);if(thingControl==null){return false}$IU.confirmBox($$.lt("thing.deleteConfirm"),$$.lt("common.confirm"),$$.lt("common.ok"),300,function(){thingControl.setValue("","",false,null)});return false}};thingEvents.events=[{selector:"."+InfoPlus.Controls.Thing.CLASS_INPUT_NAME_DIV,type:"click",handler:thingEvents.inputNameClick},{selector:"."+InfoPlus.Controls.Thing.CLASS_NAME_DIV,type:"click",handler:thingEvents.nameClick},{selector:"."+InfoPlus.Controls.Thing.CLASS_PRINT_DIV,type:"click",handler:thingEvents.printClick},{selector:"."+InfoPlus.Controls.Thing.CLASS_DELETE_DIV,type:"click",handler:thingEvents.deleteClick}];define("InfoPlus.Controls.Thing.Events",thingEvents)})(window);
(function(window,undefined){var switcher=function(path,field,render,initValue){$Control.call(this,$Control.CONTROL_TYPE_SWITCH,path,field,render,initValue)};switcher.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_BOOL],autoTriggerFieldChangeEvent:false,name:"switch",hasHiddenElement:true,createElement:function(){var element=document.createElement("div");var buttonDiv=document.createElement("div");$(buttonDiv).addClass("switchButton");$(element).append(buttonDiv);return element},setValue:function(fieldValue,fieldDisplayValue,fromInit){if(fieldValue==null){fieldValue=""}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);var $element=$(this.element);var hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);hiddenInput.value=fieldValue;this.setSwitchClass(hiddenInput.value);if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(){if(this.field==null||this.element==null){return""}var element=this.element;var hiddenInput=$(element).data($Control.DATA_ORIGIN_INPUT);var val=this.convertEmptyValue(hiddenInput.value);return val.toLowerCase()==="true"},getSortValue:function(){var value=this.getValue();return value?1:0},setSwitchClass:function(value){if(value==="true"){$(this.element).addClass("checked")}else{$(this.element).removeClass("checked")}},toggleValue:function(){if(this.getValue()===true){this.setValue(false)}else{this.setValue(true)}},registerEvent:function(){this.events=InfoPlus.Controls.Switch.Events.events}});define("InfoPlus.Controls.Switch",switcher);var switchEvents={onButtonClick:function(){var control=$(this).data($Control.DATA_CONTROL_OBJECT),field=control.field;if(field==null){return false}if(control.isReadOnly()||$(control.element).hasClass($Control.CLASSNAME_READONLY)){return false}control.toggleValue();return false}};switchEvents.events=[{type:"click",handler:switchEvents.onButtonClick}];define("InfoPlus.Controls.Switch.Events",switchEvents)})(window);
(function(window,undefined){var loadJs=function(){map.jsLoadStatus="loading";var head=document.getElementsByTagName("head")[0];var script=document.createElement("script");script.src="https://api.map.baidu.com/api?v=3.0&ak="+$$.params.mapKey+"&callback=InfoPlus.Controls.Map.loadCallback";script.type="text/javascript";script.onload=script.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"||this.readyState==="complete"){script.onload=script.onreadystatechange=null}};head.appendChild(script)};var Position=function(){this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT;this.defaultOffset=new BMap.Size(0,0)};var map=function(path,field,render,initValue,initDisplayValue,initAttributes){if(map.jsLoadStatus==="unload"){loadJs()}if(map.jsLoadStatus!=="loaded"){map.waitingMapControls.push(this)}if(initDisplayValue==null||initDisplayValue===""){if(field.settings!=null&&field.settings.displayText!=null){initDisplayValue=field.settings.displayText}}$Control.call(this,$Control.CONTROL_TYPE_MAP,path,field,render,initValue,initDisplayValue,initAttributes)};map.DEFAULT_ZOOM_LEVEL=17;map.DEFAULT_CITY_ZOOM_LEVEL=11;map.jsLoadStatus="unload";map.waitingMapControls=[];map.LABEL_STYLE={"font-size":"14px",border:"1px solid #ababab","background-color":"white",color:"#2196F3"};map.loadCallback=function(){map.jsLoadStatus="loaded";Position.prototype=new BMap.Control();Position.prototype.convertedPoint=null;Position.prototype.initialize=function(map){var div=document.createElement("div"),textSpan=document.createElement("span"),naviSpan=document.createElement("span");$(textSpan).text($$.lt("map.currentPosition",$$.lt("map.noPosition")));var i=document.createElement("i"),naviInnerSpan=document.createElement("span");$(i).addClass("i-icon-navigation");$(naviInnerSpan).text($$.lt("map.navigation"));$(naviSpan).append(i).append(naviInnerSpan).addClass("map_navigation").hide();$(div).append(textSpan).append(naviSpan).addClass("map_position");map.getContainer().appendChild(div);this.textSpan=textSpan;this.naviSpan=naviSpan;var instance=this;$(textSpan).click(function(){if(instance.marker!=null){map.panTo(instance.marker.getPosition())}});$(naviSpan).click(function(){if(instance.marker==null){return false}var openTip=function(){var contentDiv=document.createElement("div"),$contentDiv=$(contentDiv),textSpan=document.createElement("span"),$textSpan=$(textSpan);$textSpan.text($$.lt("map.naviTip"));$contentDiv.append(textSpan);var helper=new InfoPlus.Render.CommandBarHelper({content:contentDiv,position:"top",backgroundColor:"#fff9c4"});var $commandBar=$("#form_command_bar");if($commandBar.length>0){$commandBar.append(helper.element)}else{$(document.body).append(helper.element)}helper.show($commandBar.length===0);setTimeout(function(){helper.hide()},6000)};var ua=navigator.userAgent.toLowerCase();isAndroid=/android/i.test(ua);isIos=/mac os/i.test(ua);var point=instance.marker.getPosition(),label=instance.marker.getLabel(),lat=point.lat,lng=point.lng,addr=label.getContent();var uri=[];if(isAndroid){uri[0]="bdapp://map/direction?destination="+lat+","+lng+"&mode=walking";if(instance.convertedPoint!=null){uri[1]="amapuri://route/plan/?dlat="+instance.convertedPoint.lat+"&dlon="+instance.convertedPoint.lng+"&dev=0&t=2";uri[2]="qqmap://map/routeplan?type=walk&fromcoord=CurrentLocation&tocoord="+instance.convertedPoint.lat+","+instance.convertedPoint.lng+"&referer=infoplusweb"}}else{if(isIos){uri[0]="baidumap://map/direction?destination="+lat+","+lng+"&mode=walking";if(instance.convertedPoint!=null){uri[1]="iosamap://route/plan/?dlat="+instance.convertedPoint.lat+"&dlon="+instance.convertedPoint.lng+"&dev=0&t=2";uri[2]="qqmap://map/routeplan?type=walk&fromcoord=CurrentLocation&tocoord="+instance.convertedPoint.lat+","+instance.convertedPoint.lng+"&referer=infoplusweb";uri[3]="http://maps.apple.com/?daddr="+instance.convertedPoint.lat+","+instance.convertedPoint.lng+"&dirflg=w"}}}if(uri.length===0){return false}var openUri=function(u){try{window.location.href=u}catch(e){}};openTip();openUri(uri[0]);var timeFlag=[];if(instance.convertedPoint!=null){for(var i=1,len=uri.length;i<len;i++){timeFlag[i-1]=setTimeout(function(index){return function(){openUri(uri[index])}}(i),(isIos?4000:2000)*i)}}window.beforeunload=window.pagehide=window.onblur=function(){for(var i=0,len=timeFlag.length;i<len;i++){clearTimeout(timeFlag[i])}}});return div};Position.prototype.setMarker=function(marker){if(marker==null){this.setValue(null)}else{var point=marker.getPosition(),label=marker.getLabel(),value=label!=null?label.getContent():point.lng+","+point.lat;this.setValue(value);var result=InfoPlus.CoordTransform.bdtogcj(point.lng,point.lat);this.convertedPoint=new BMap.Point(result[0],result[1])}this.marker=marker};Position.prototype.setValue=function(value){$(this.textSpan).text($$.lt("map.currentPosition",value==null?$$.lt("map.noPosition"):value));if(!$IU.isEmptyStr(value)&&$$.MOBILE){$(this.naviSpan).show()}else{$(this.naviSpan).hide()}};Position.prototype.addEvent=function(event,callback){};var controls=map.waitingMapControls;for(var i=0,len=controls.length;i<len;i++){var mapControl=controls[i];mapControl.initMap()}};map.prototype=$.extend(new $Controls.Control(),{compatibleFieldTypes:[$Control.DATA_TYPE_LOCATION],ignoreClass:true,autoTriggerFieldChangeEvent:false,allowFocus:false,name:"map",hasHiddenElement:true,map:null,currentMarker:null,currentPosition:null,markerClicking:false,getMapPoint:function(value){if(!$IU.isString(value)||$IU.isEmptyStr(value)){return null}var values=value.split(",");if(values.length<2){return null}var lng=parseFloat(values[0]),lat=parseFloat(values[1]);if(isNaN(lng)||isNaN(lat)){return null}var result=InfoPlus.CoordTransform.wgstobd(lng,lat);return new BMap.Point(result[0],result[1])},getMapZoomLevel:function(value){if(!$IU.isString(value)||$IU.isEmptyStr(value)){return map.DEFAULT_ZOOM_LEVEL}var values=value.split(",");if(values.length!==3){return map.DEFAULT_ZOOM_LEVEL}var z=parseInt(values[2],10);if(isNaN(z)){return map.DEFAULT_ZOOM_LEVEL}if(z>19||z<0){return map.DEFAULT_ZOOM_LEVEL}return z},setMapMarker:function(marker,fromInit){if(marker!=null){var point=marker.getPosition(),label=marker.getLabel();this.currentPosition.setMarker(marker);this.currentMarker=marker;var result=InfoPlus.CoordTransform.bdtowgs(point.lng,point.lat);this.setValue(result[0]+","+result[1],label!=null?label.getContent():"",fromInit,null,true)}else{this.currentPosition.setMarker(null);this.currentMarker=null;this.setValue("","",fromInit,null,true)}},createInfoWindow:function(marker,sugs){var instance=this;var infoDom=document.createElement("div"),labelDiv=document.createElement("div"),inputDiv=document.createElement("div"),confirmDiv=document.createElement("div"),sugUl=document.createElement("ul"),input=document.createElement("input"),okLink=document.createElement("a"),deleteLink;$(labelDiv).text($$.lt("map.selectCurrentPositionTitle")).addClass("map_info_title");$(input).attr("type","text").attr("maxLength","50").addClass("labelInput");if(marker.getLabel()!=null){$(input).val(marker.getLabel().content);deleteLink=document.createElement("a");$(deleteLink).text($$.lt("map.deletePosition")).attr("href","#").addClass("deleteLink").click(function(){$IU.confirmBox($$.lt("map.confirmDelete",marker.getLabel().content),null,$$.lt("common.ok"),300,function(){instance.map.removeOverlay(marker);instance.setMapMarker(null,false)})});$(confirmDiv).append(deleteLink)}else{if(sugs.length>0){$(input).val(sugs[0])}}var useCurrentPosition=function(){var content=$(input).val();if($IU.trimString(content)!==""){marker.closeInfoWindow();if(marker.getLabel()==null){var label=new BMap.Label(content,{offset:new BMap.Size(15,-22)});label.setStyle(map.LABEL_STYLE);marker.setLabel(label)}else{marker.getLabel().setContent(content)}if(instance.currentMarker!=null&&instance.currentMarker!==marker){instance.map.removeOverlay(instance.currentMarker)}instance.setMapMarker(marker,false)}else{$IU.messageBox(null,$$.lt("map.inputLabel"),null,300)}};$(okLink).text($$.lt("map.usePoint")).attr("href","#").addClass("okLink").click(function(){useCurrentPosition();return false});$(input).keypress(function(event){if(event.keyCode===13){useCurrentPosition();return false}});$(inputDiv).append(input);$(sugUl).addClass("map_sug_list");for(var i=0,len=sugs.length;i<len;i++){var li=document.createElement("li"),span=document.createElement("span");$(span).text(sugs[i]).attr("title","");$(li).append(span);$(sugUl).append(li)}$(confirmDiv).append(okLink).addClass("confirmDiv");$(infoDom).append(labelDiv).append(inputDiv).append(sugUl).append(confirmDiv).addClass("map_info_window");$(sugUl).on("click","li",function(){$(input).val($(this).children("span").text())});return infoDom},addMarker:function(point,label,sugs,clear,isAuto){var instance=this;var map=this.map;if(clear!==false){map.clearOverlays()}else{var allOverlay=map.getOverlays();for(var i=0;i<allOverlay.length;i++){if(allOverlay[i]!==this.currentMarker){map.removeOverlay(allOverlay[i])}}}if(isAuto){label=new BMap.Label($$.lt("map.autoPosition"),{offset:new BMap.Size(15,-22)});label.setStyle(map.LABEL_STYLE)}var marker=new BMap.Marker(point,{enableClicking:true});if(this.isWritable()){marker.addEventListener("click",function(){if(instance.isDynamicReadonly()){return false}instance.markerClicking=true;var allOverlay=map.getOverlays();for(var i=0;i<allOverlay.length;i++){if(allOverlay[i]!==this){map.removeOverlay(allOverlay[i])}}if(sugs!=null){marker.openInfoWindow(new BMap.InfoWindow(instance.createInfoWindow(marker,sugs),{enableCloseOnClick:false}))}else{var geoc=new BMap.Geocoder();geoc.getLocation(this.getPosition(),function(rs){var sugs=instance.getSugs(rs);marker.openInfoWindow(new BMap.InfoWindow(instance.createInfoWindow(marker,sugs),{enableCloseOnClick:false}))},{poiRadius:50})}return false})}if(label!=null){marker.setLabel(label)}map.addOverlay(marker);return marker},getSugs:function(rs){var sugs=[];if(rs.addressComponents.streetNumber!==""){sugs.push(rs.address)}else{if(rs.addressComponents.street||""!==""){sugs.push(rs.addressComponents.street)}}var pois=rs.surroundingPois;for(var i=0,len=pois.length;i<len;i++){sugs.push(pois[i].title)}return sugs},initMap:function(){var instance=this;var bMap=new BMap.Map(this.element.getAttribute("id"));this.map=bMap;var positionControl=new Position();bMap.addControl(positionControl);positionControl.addEvent("click",function(){if(instance.currentMarker!=null){bMap.panTo(instance.currentMarker.getPosition())}});this.currentPosition=positionControl;var navigation=new BMap.NavigationControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});bMap.addControl(navigation);var getLocationInfo=function(locationPoint,fromInit){var options={poiRadius:50};if($$.MOBILE){options.numPois=5}var geoc=new BMap.Geocoder();geoc.getLocation(locationPoint,function(rs){var sugs=instance.getSugs(rs);var marker=instance.addMarker(locationPoint,null,sugs,false,fromInit);var infoWindow=new BMap.InfoWindow(instance.createInfoWindow(marker,sugs),{enableCloseOnClick:false});infoWindow.enableAutoPan();infoWindow.addEventListener("clickclose",function(){if(marker!==instance.currentMarker){bMap.removeOverlay(marker)}});marker.openInfoWindow(infoWindow);if(fromInit){instance.setMapMarker(marker,true)}},options)};var useDefaultLocation=function(){var useDefaultLocation=false;if(!$IU.isEmptyStr($$.params.defaultLocation)){var defaultPoint=instance.getMapPoint($$.params.defaultLocation);if(defaultPoint!=null){zoomValue=instance.getMapZoomLevel($$.params.defaultLocation);bMap.centerAndZoom(defaultPoint,zoomValue);useDefaultLocation=true}}if(!useDefaultLocation){var myCity=new BMap.LocalCity();myCity.get(function(result){var cityName=result.name;bMap.centerAndZoom(cityName,map.DEFAULT_CITY_ZOOM_LEVEL)})}};var point=this.getMapPoint(this.initValue);if(point!=null){var zoomValue=this.getMapZoomLevel(this.initValue);setTimeout(function(){bMap.centerAndZoom(point,zoomValue)},1000);var label;if(!$IU.isEmptyStr(this.initDisplayValue)){label=new BMap.Label(this.initDisplayValue,{offset:new BMap.Size(15,-22)});label.setStyle(map.LABEL_STYLE)}var marker=this.addMarker(point,label,null,false,false);this.setMapMarker(marker,true)}else{var geolocation=new BMap.Geolocation();geolocation.enableSDKLocation();geolocation.getCurrentPosition(function(r){switch(this.getStatus()){case BMAP_STATUS_SUCCESS:var initPoint=new BMap.Point(r.point.lng,r.point.lat);bMap.centerAndZoom(initPoint,map.DEFAULT_ZOOM_LEVEL);if(instance.isWritable()){getLocationInfo(r.point,true)}break;case BMAP_STATUS_TIMEOUT:$IU.messageBox(null,$$.lt("map.geolocation.timeout"),null,300);break;case BMAP_STATUS_PERMISSION_DENIED:var foundBaiduIframe=false,$iframes=$("iframe");for(var i=0,len=$iframes.length;i<len;i++){if($iframes[i].src.indexOf("baidu.com")!==-1){foundBaiduIframe=true;break}}if(foundBaiduIframe&&navigator.geolocation!=null){navigator.geolocation.getCurrentPosition(function(position){var result=InfoPlus.CoordTransform.wgstobd(position.coords.longitude,position.coords.latitude);var currentPoint=new BMap.Point(result[0],result[1]);bMap.centerAndZoom(currentPoint,map.DEFAULT_ZOOM_LEVEL);if(instance.isWritable()){getLocationInfo(currentPoint,true)}},function(error){useDefaultLocation()},{enableHighAccuracy:true,maximumAge:0})}else{$IU.messageBox(null,$$.lt("map.geolocation.denied"),null,300);useDefaultLocation()}break;case BMAP_STATUS_UNKNOWN_LOCATION:$IU.messageBox(null,$$.lt("map.geolocation.unknown"),null,300);break}},{enableHighAccuracy:true})}if(instance.isWritable()){var mapClick=function(map,point){getLocationInfo(point,false)};if($$.MOBILE){bMap.addEventListener("touchstart",function(e){if(instance.isDynamicReadonly()){return false}if(instance.markerClicking){instance.markerClicking=false;return false}instance.touchPoint=e.pixel});bMap.addEventListener("touchend",function(e){if(instance.isDynamicReadonly()){return false}if(instance.markerClicking){instance.markerClicking=false;return false}if(instance.touchPoint!=null&&Math.abs(instance.touchPoint.x-e.pixel.x)<3&&Math.abs(instance.touchPoint.y-e.pixel.y)<3){mapClick(this,e.point)}instance.touchPoint=null})}else{bMap.addEventListener("click",function(e){if(instance.isDynamicReadonly()){return false}if(instance.markerClicking){instance.markerClicking=false;return false}mapClick(this,e.point)})}}},createElement:function(){var mapContainer=document.createElement("div"),$mapContainer=$(mapContainer);this.controlContainer=mapContainer;$mapContainer.addClass("infoplus_mapControlContainer");var element=document.createElement("div");$mapContainer.append(element);return element},setMapValue:function(value,displayValue){var point=this.getMapPoint(value);if(point!=null){this.map.centerAndZoom(point,this.map.getZoom());var label;if(!$IU.isEmptyStr(displayValue)){label=new BMap.Label(displayValue,{offset:new BMap.Size(15,-22)});label.setStyle(map.LABEL_STYLE)}var marker=this.addMarker(point,label,label!=null?[label.getContent()]:[""],true,false);this.setMapMarker(marker,false)}},setValue:function(fieldValue,fieldDisplayValue,fromInit,attributes,fromMap){if(map.jsLoadStatus!=="loaded"||this.map==null){return}if(fieldValue==null){fieldValue=""}var fireChangeEvent=!(!!fromInit)&&this.shouldFireChangeEvent(fieldValue);var $element=$(this.element);var hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);if(map.jsLoadStatus==="loaded"&&fromMap!==true){if(fieldDisplayValue==null){var values=fieldValue.split(",");if(values.length>2){fieldDisplayValue=values[2];fieldValue=[values[0],values[1]].join(",")}}this.setMapValue(fieldValue,fieldDisplayValue)}hiddenInput.value=fieldValue;$element.data($Control.DATA_DISPLAY_VALUE,fieldDisplayValue);this.setAttributes(attributes);if(fireChangeEvent){setTimeout(function(){$(hiddenInput).change()},0)}},getValue:function(){if(this.field==null||this.element==null){return""}var $element=$(this.element),hiddenInput=$element.data($Control.DATA_ORIGIN_INPUT);var value=hiddenInput.value;if(!$IU.isEmptyStr(value)&&this.map!=null){value=value+","+this.map.getZoom()}var displayValue=$element.data($Control.DATA_DISPLAY_VALUE);return new $Controls.Data.ValuePair(value,displayValue)},specialSetting:function(){var instance=this;if(map.jsLoadStatus==="loaded"){setTimeout(function(){instance.initMap()},100)}}});define("InfoPlus.Controls.Map",map)})(window);
(function(window,undefined){var helpTopic=["index","input","toolbar","navMenu","end"];var removeAllBlock=function(){$(".help_block").remove()};var getLeftByRect=function(x,no,rect1,rect2){if(no===1){return(x===0?0:(x===1?rect1.left:rect1.left+rect1.width))}else{return(x===0?0:(x===1?rect2.left:rect2.left+rect2.width))}};var getTopByRect=function(y,no,rect1,rect2){if(no===1){return(y===0?0:(y===1?rect1.top:rect1.top+rect1.height))}else{return(y===0?rect2.top:rect2.top+rect2.height)}};var getWidthByRect=function(x,no,rect1,rect2){if(no===1){return(x===0?rect1.left:(x===1?rect1.width:(screen.width>$(document).width()?screen.width:$(document).width())-rect1.left-rect1.width))}else{return(x===0?rect2.left:(x===1?rect2.width:(screen.width>$(document).width()?screen.width:$(document).width())-rect2.left-rect2.width))}};var getHeightByRect=function(y,no,rect1,rect2){if(no===1){return(y===0?rect1.top:(y===1?rect1.height:rect2.top-rect1.top-rect1.height))}else{return(y===0?rect2.height:(screen.height>$(document).height()?screen.height:$(document).height()-rect2.top-rect2.height))}};var getLeft=function(x,left,width){return(x===0?0:(x===1?left:left+width))+"px"};var getTop=function(y,top,height){return(y===0?0:(y===1?top:top+height))+"px"};var getWidth=function(x,left,width){return(x===0?left:(x===1?width:(screen.width>$(document).width()?screen.width:$(document).width())-left-width))+"px"};var getHeight=function(y,top,height){return(y===0?top:(y===1?height:(screen.height>$(document).height()?screen.height:$(document).height())-top-height))+"px"};var maskTowRect=function(rect1,rect2,step){removeAllBlock();$(document.body).css("overflow","hidden");for(var x=0;x<3;x++){for(var y=0;y<3;y++){var d=document.createElement("div");var $d=$(d);$d.attr("id","help_block_1_"+x+"_"+y).addClass("help_block");if(x===1&&y===1){$d.addClass("help_highlight")}else{$d.addClass("help_background")}$d.css("left",getLeftByRect(x,1,rect1,rect2)+"px").css("top",getTopByRect(y,1,rect1,rect2)+"px").css("width",getWidthByRect(x,1,rect1,rect2)+"px").css("height",getHeightByRect(y,1,rect1,rect2)+"px");$d.data("step",step);document.body.appendChild(d)}}for(x=0;x<3;x++){for(y=0;y<2;y++){d=document.createElement("div");$d=$(d);$d.attr("id","help_block_2_"+x+"_"+y).addClass("help_block");if(x===1&&y===0){$d.addClass("help_highlight")}else{$d.addClass("help_background")}$d.css("left",getLeftByRect(x,2,rect1,rect2)+"px").css("top",getTopByRect(y,2,rect1,rect2)+"px").css("width",getWidthByRect(x,2,rect1,rect2)+"px").css("height",getHeightByRect(y,2,rect1,rect2)+"px");$d.data("step",step);document.body.appendChild(d)}}$(".help_block").unbind().click(function(){nextStepHelp(step+1)})};var mask=function(left,top,width,height,step){removeAllBlock();$(document.body).css("overflow","hidden");for(var x=0;x<3;x++){for(var y=0;y<3;y++){var d=document.createElement("div");var $d=$(d);$d.attr("id","help_block_"+x+"_"+y).addClass("help_block");if(x===1&&y===1){$d.addClass("help_highlight")}else{$d.addClass("help_background")}$d.css("left",getLeft(x,left,width)).css("top",getTop(y,top,height)).css("width",getWidth(x,left,width)).css("height",getHeight(y,top,height));$d.data("step",step);document.body.appendChild(d)}}$(".help_block").unbind().click(function(){nextStepHelp(step+1)})};var adjustMask=function(left,top,width,height){for(var x=0;x<3;x++){for(var y=0;y<3;y++){$("#help_block_"+x+"_"+y).css("left",getLeft(x,left,width)).css("top",getTop(y,top,height)).css("width",getWidth(x,left,width)).css("height",getHeight(y,top,height))}}};var adjustTowRectMask=function(rect1,rect2){for(var x=0;x<3;x++){for(var y=0;y<3;y++){$("#help_block_1_"+x+"_"+y).css("left",getLeftByRect(x,1,rect1,rect2)+"px").css("top",getTopByRect(y,1,rect1,rect2)+"px").css("width",getWidthByRect(x,1,rect1,rect2)+"px").css("height",getHeightByRect(y,1,rect1,rect2)+"px")}}for(x=0;x<3;x++){for(y=0;y<2;y++){$("#help_block_2_"+x+"_"+y).css("left",getLeftByRect(x,2,rect1,rect2)+"px").css("top",getTopByRect(y,2,rect1,rect2)+"px").css("width",getWidthByRect(x,2,rect1,rect2)+"px").css("height",getHeightByRect(y,2,rect1,rect2)+"px")}}};var adjustHelpContentPosition=function(left,right,top,bottom){var $help=$("#help_content");if(left!==undefined){$help.css("left",left+"px")}if(right!==undefined){$help.css("right",right+"px")}if(top!==undefined){$help.css("top",top+"px")}if(bottom!==undefined){$help.css("bottom",bottom+"px")}};var showHelp=function(step,left,right,top,bottom){var $help=$("#help_content"),topic=helpTopic[step];$help.attr("class","").css("left","").css("top","").css("right","").css("bottom","").hide();adjustHelpContentPosition(left,right,top,bottom);$help.addClass("help_"+topic).data("step",step).fadeIn(1500);$help.unbind().click(function(){nextStepHelp(step+1)});$help.show()};var resizeHelpMask=function(){};var nextStepHelp=function(step){$(window).off("resize",resizeHelpMask);var topic=helpTopic[step],$navMenu=$("#nav_menu"),$renderHolder=$("#form_holder"),$titleDescription=$("#title_description");if(!$titleDescription.is(":visible")){$titleDescription=$("#title_description_short")}var getMaskArea=function(){var $commandBar=$("#form_command_bar");switch(topic){case"input":return[{left:$titleDescription.offset().left,top:$titleDescription.offset().top,width:$titleDescription.width(),height:$titleDescription.height(),helpContentLeft:$renderHolder.offset().left,helpContentTop:0},{left:$renderHolder.offset().left,top:$renderHolder.offset().top,width:$renderHolder.width(),height:$renderHolder.height()}];break;case"toolbar":return{left:$commandBar.offset().left,top:$commandBar.offset().top,width:$commandBar.width(),height:$commandBar.height(),helpContentLeft:$commandBar.offset().left,helpContentTop:$commandBar.offset().top+$commandBar.height()};break;case"inputArea":return{left:$renderHolder.offset().left,top:$renderHolder.offset().top,width:$renderHolder.width(),height:$renderHolder.height(),helpContentLeft:$renderHolder.offset().left,helpContentTop:0};break;case"numberArea":return{left:$titleDescription.offset().left,top:$titleDescription.offset().top,width:$titleDescription.width(),height:$titleDescription.height(),helpContentRight:20,helpContentTop:$titleDescription.offset().top+$titleDescription.height()};break;case"command":var $buttons=$commandBar.find("li.command_button").filter(":visible"),left=0,width=0;if($buttons.length>0){left=$($buttons[0]).offset().left;width=$($buttons[$buttons.length-1]).offset().left-left+$($buttons[$buttons.length-1]).width()}else{var $menu=$commandBar.find("#command_menu");left=$menu.offset().left;width=$menu.width()}var top=$commandBar.offset().top,height=$commandBar.height();return{left:left,top:top,width:width,height:height,helpContentLeft:left,helpContentTop:top+height+5};break;case"save":$buttons=$commandBar.find("li.tool_button");left=$($buttons[$buttons.length-1]).offset().left;width=$($buttons[0]).offset().left-$($buttons[$buttons.length-1]).offset().left+$($buttons[$buttons.length-1]).width();height=$commandBar.height();top=$commandBar.offset().top;return{left:left,top:top,width:width,height:height,helpContentRight:20,helpContentTop:top+height+5};break;case"navMenu":var $titleIcon=$("#title_icon");return{left:$titleIcon.offset().left,top:$titleIcon.offset().top,width:$titleIcon.width(),height:$titleIcon.height(),helpContentLeft:0,helpContentTop:$titleIcon.offset().top+$titleIcon.height()+5};break;case"navContent":return{left:0,top:$navMenu.offset().top,width:$navMenu.width(),height:$navMenu.height(),helpContentLeft:0,helpContentTop:$navMenu.offset().top};break}};if(topic==="end"){$("#help_content").hide();$(".help_block").remove();$(document).scrollTop(0);$(document.body).css("overflow","");$(document).off("keypress",blockKeyPress)}else{if(topic==="navContent"){$navMenu.show()}if(topic==="remark"){$navMenu.hide();if($(document.body).height()-$(window).height()>0){$(document).scrollTop($(document.body).height()-$(window).height())}else{$(document).scrollTop(0)}}var area=getMaskArea();if(Object.prototype.toString.call(area)!=="[object Array]"){mask(area.left,area.top,area.width,area.height,step);showHelp(step,area.helpContentLeft,area.helpContentRight,area.helpContentTop,area.helpContentBottom)}else{maskTowRect(area[0],area[1],step);showHelp(step,area[0].helpContentLeft,area[0].helpContentRight,area[0].helpContentTop,area[0].helpContentBottom)}resizeHelpMask=function(){var resizeArea=getMaskArea();if(Object.prototype.toString.call(area)!=="[object Array]"){adjustMask(resizeArea.left,resizeArea.top,resizeArea.width,resizeArea.height);adjustHelpContentPosition(resizeArea.helpContentLeft,resizeArea.helpContentRight,resizeArea.helpContentTop,resizeArea.helpContentBottom)}else{adjustTowRectMask(resizeArea[0],resizeArea[1]);adjustHelpContentPosition(resizeArea[0].helpContentLeft,resizeArea[0].helpContentRight,resizeArea[0].helpContentTop,resizeArea[0].helpContentBottom)}};$(window).resize(resizeHelpMask)}};var blockKeyPress=function(){return false};window.loadHelp=function(){if(!$$.params.showTutorial){return}$(document).keypress(blockKeyPress);$("html, body").scrollTop(0).scrollLeft(0);mask(0,0,0,0,0);showHelp(0)}})(window);
